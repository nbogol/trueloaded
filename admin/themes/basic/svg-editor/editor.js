var svgEditor=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=23)}([function(e,t,n){e.exports=n(6)},function(e,t){function n(e,t,n,r,i,a,s){try{var o=e[a](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise(function(i,a){var s=e.apply(t,r);function o(e){n(s,i,a,o,l,"next",e)}function l(e){n(s,i,a,o,l,"throw",e)}o(void 0)})}}},function(e,t,n){"use strict";t.a=function(e,t){var n=$.extend({heading:"",className:"",top:200,buttons:[],draggable:!0,aroundArea:!1,beforeRemove:function(){return!0}},t),r=$("body"),i=$('<div class="popup-draggable '.concat(n.className,'"></div>'));r.append(i);var a=$('<div class="around-pop-up"></div>');n.aroundArea&&r.append(a);var s=$('<div class="pop-up-close"></div>');if(i.append(s),n.heading){var o=$('<div class="popup-heading"></div>');o.append(n.heading),i.append(o)}var l=$('<div class="popup-content pop-mess-cont"></div>');if(l.append(e),i.append(l),n.buttons&&n.buttons.length>0){var c=$('<div class="popup-buttons"></div>');n.buttons.forEach(function(e){c.append(e)}),i.append(c)}function u(){n.beforeRemove(),i.remove(),a.remove()}i.css({left:($(window).width()-i.width())/2,top:$(window).scrollTop()+n.top}),s.on("click",u),a.on("click",u);var d={};return $(".popup-heading",i).length&&(d={handle:".popup-heading"}),n.draggable&&i.draggable(d),i}},function(e,t,n){var r=n(13),i=n(14),a=n(15);e.exports=function(e,t){return r(e)||i(e,t)||a()}},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(1),s=n.n(a),o=n(2);function l(e,t){var n={};n.NS=t,n.svgEditor=e,n.main=$("<div></div>"),n.heading=$("<div>".concat(window.tr.TEXT_GALLERY_IMAGE,"</div>"));var r=$('<span class="btn btn-cancel">'.concat(window.tr.IMAGE_CANCEL,"</span>"));n.popup=Object(o.a)(n.main,{heading:n.heading,buttons:[r],className:"fullscreen-popup",top:10,draggable:!1}),r.on("click",function(){n.popup.remove()}),function(e){e.imageSource=$('\n        <div class="form-source">\n            <div class="label">Choose source</div>\n            <div class="field">\n                <select>\n                    <option value="gallery">Image gallery</option>\n                    <option value="product">Product images</option>\n                    <option value="category">Category images</option>\n                </select>\n            </div>\n        </div>\n        '),e.heading.append(e.imageSource)}(n),function(e){e.search=$('\n        <div class="form-search">\n            <div class="label">Search</div>\n            <div class="field"><input type="text"></div>\n        </div>\n        '),e.heading.append(e.search)}(n),function(e){e.gallery=$('<div class="gallery"></div>'),e.gallery.on("click",".item-general, .product-image",function(){!function(e,t){var n=document.getElementById("svgcanvas").ownerDocument,r=e.svgEditor.canvas,i=r.getElem("svgcontent"),a=$(i).find(".layer"),s=n.createElementNS(e.NS.SVG,"image");r.setHref(s,t),$(a).append(s),r.selectOnly([s],!0);var o=r.contentW,l=r.contentH,c=l/o;$(new Image).on("load",function(){o>10*this.width&&l>10*this.height?$(s).attr({width:o/10,height:o/10*(this.height/this.width)}):o>this.width&&l>this.height?$(s).attr({width:this.width,height:this.height}):c<this.height/this.width?$(s).attr({width:l/(this.height/this.width),height:l}):c>this.height/this.width&&$(s).attr({width:o,height:o*(this.height/this.width)}),r.selectorManager.requestSelector(s).resize()}).attr("src",t)}(e,$(this).data("src")),e.popup.remove()}),e.gallery.on("click",".product-item",function(){$.get("banner_manager/product-images",{id:$(this).data("id")},function(t){for(var n in e.gallery.html(""),t)for(var r in t[n].image)e.gallery.append((i=t[n].image[r],'\n<div class="product-image item" data-src="'.concat(i.url,'">\n    <div class="image"><img src="').concat(i.url,'"></div>\n    <div class="name">').concat(i.type,"<br>").concat(i.x,"x").concat(i.y,"</div>\n</div>\n    ")));var i},"json")}),e.main.append(e.gallery)}(n),function(e){e.uploadButton=$('<span class="btn">Upload image</span>'),e.heading.append(e.uploadButton)}(n),function(e){$("select",e.imageSource).on("change",function(){switch(e.gallery.html(""),$("input",e.search).off(),e.dropzoneArea={},$(this).val()){case"gallery":!function(e){var t="";e.uploadButton.show(),$.get("banner_manager/gallery",function(t){e.gallery.append(t)}),e.dropzoneBtn=e.uploadButton.dropzone({url:"banner_manager/upload",uploadMultiple:!0,previewTemplate:"<span data-dz-name></span>",init:function(){this.on("successmultiple",i),this.on("queuecomplete",a)}}),e.dropzoneArea=e.popup.dropzone({url:"banner_manager/upload",uploadMultiple:!0,previewTemplate:"<span data-dz-name></span>",clickable:!1,init:function(){this.on("successmultiple",i),this.on("queuecomplete",a)}});var n=0;e.dropzoneArea.on("dragenter",function(){2===++n&&e.popup.append('<div class="drop-area-over">Drop images here</div>'),r=0});var r=0;function i(e,n){var r=JSON.parse(n);$(".drop-area .drop-area-over").remove(),r.forEach(function(e){t+='<tr class="status-'+e.status+'"><td>'+e.file+"</td><td>"+e.text+"</td></tr>"})}function a(){alertMessage('<div>\n                <table class="table">\n                    <thead><tr><th>File</th><th>Status</th></tr></thead>\n                    '.concat(t,"\n                </table>\n                </div>")),t=""}e.dropzoneArea.on("dragleave",function(){2===++r&&$(".drop-area-over",e.popup).remove(),n=0}),$("input",e.search).on("keyup",function(){var t=$(this).val();$(".name",e.gallery).each(function(){var e=$(this).text();if(-1!==e.search(t)){var n=e.replace(t,'<span class="keywords">'.concat(t,"</span>"));$(this).html(n),$(this).closest(".item").show()}else $(this).closest(".item").hide(),$(this).html(e)}),t||$(".item",e.gallery).show()})}(e);break;case"product":!function(e){e.uploadButton.hide(),$("input",e.search).on("keyup",function(){var t=$(this).val();$.get("index/search-suggest",{keywords:t,no_click:!0,json:!0},function(t){e.gallery.html(""),t.forEach(function(t){e.gallery.append(function(e){var t;t=e.image?document.location.origin+e.image:"../themes/basic/img/na.png";var n="";e.special_price&&(n='<div class="special-price">'.concat(e.special_price,"</div>"));return e.value=e.value.replace("\\'","'"),'\n<div class="product-item box" data-id="'.concat(e.id,'">\n    <div class="image"><img src="').concat(t,'"></div>\n    <div class="name">').concat(e.value,'</div>\n    <div class="').concat(e.special_price?"old-":"",'price">').concat(e.price,"</div>\n    ").concat(n,"\n</div>\n    ")}(t))})},"json")})}(e);break;case"category":!function(e){e.uploadButton.hide()}(e)}}).trigger("change")}(n)}t.default={name:"tool_image",init:function(){var e=s()(i.a.mark(function e(t){var n,r,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.$,n=t.NS,a=(r=this).canvas,e.abrupt("return",{name:window.tr.TEXT_GALLERY_IMAGE,svgicons:r.curConfig.extIconsPath+"ext-image.xml",buttons:[{id:"tool_image",icon:r.curConfig.extIconsPath+"helloworld.png",type:"mode",title:window.tr.TEXT_GALLERY_IMAGE,events:{click:function(){a.setMode("select"),l(r,n)}}}],mouseDown:function(){},mouseUp:function(e){}});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(1),s=n.n(a),o=n(2);function l(e,t){var n={};n.NS=t,n.svgEditor=e;var r=e.canvas;n.main=$('<div class="canvas-size"></div>'),n.heading=$("<div>Canvas size</div>"),n.width=$('<input type="number">'),n.height=$('<input type="number">'),n.main.append("<span>".concat(window.tr.TEXT_WIDTH,"</span>")),n.main.append(n.width),n.main.append("<span>".concat(window.tr.TEXT_HEIGHT,"</span>")),n.main.append(n.height);var i=$('<span class="btn btn-cancel">'.concat(window.tr.IMAGE_CANCEL,"</span>")),a=$('<span class="btn btn-save">'.concat(window.tr.IMAGE_SAVE,"</span>"));n.popup=Object(o.a)(n.main,{heading:n.heading,buttons:[a,i],className:"default-popup"}),i.on("click",function(){n.popup.remove()}),a.on("click",function(){r.setResolution(n.width.val(),n.height.val()),e.updateCanvas(!0),n.popup.remove()});var s=r.getResolution();n.width.val(s.w),n.height.val(s.h)}t.default={name:"tool_size",init:function(){var e=s()(i.a.mark(function e(t){var n,r,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.$,n=t.NS,a=(r=this).canvas,e.abrupt("return",{name:"Canvas size",svgicons:r.curConfig.extIconsPath+"ext-size.xml",buttons:[{id:"tool_size",icon:r.curConfig.extIconsPath+"helloworld.png",type:"context",title:"Canvas size",panel:"editor_panel",events:{click:function(){a.setMode("select"),l(r,n)}}}],mouseDown:function(){},mouseUp:function(e){}});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},function(e,t,n){var r=function(){return this||"object"==typeof self&&self}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,a=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(7),i)r.regeneratorRuntime=a;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag",c="object"==typeof e,u=t.regeneratorRuntime;if(u)c&&(e.exports=u);else{(u=t.regeneratorRuntime=c?e.exports:{}).wrap=b;var d="suspendedStart",h="suspendedYield",p="executing",f="completed",g={},m={};m[s]=function(){return this};var _=Object.getPrototypeOf,y=_&&_(_(N([])));y&&y!==r&&i.call(y,s)&&(m=y);var v=k.prototype=w.prototype=Object.create(m);S.prototype=v.constructor=k,k.constructor=S,k[l]=S.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===S||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(v),e},u.awrap=function(e){return{__await:e}},C(A.prototype),A.prototype[o]=function(){return this},u.AsyncIterator=A,u.async=function(e,t,n,r){var i=new A(b(e,t,n,r));return u.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},C(v),v[l]="Generator",v[s]=function(){return this},v.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},u.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return o.type="throw",o.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var l=i.call(s,"catchLoc"),c=i.call(s,"finallyLoc");if(l&&c){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:N(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),g}}}function b(e,t,n,r){var i=t&&t.prototype instanceof w?t:w,a=Object.create(i.prototype),s=new I(r||[]);return a._invoke=function(e,t,n){var r=d;return function(i,a){if(r===p)throw new Error("Generator is already running");if(r===f){if("throw"===i)throw a;return T()}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var o=E(s,n);if(o){if(o===g)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var l=x(e,t,n);if("normal"===l.type){if(r=n.done?f:h,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=f,n.method="throw",n.arg=l.arg)}}}(e,n,s),a}function x(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function w(){}function S(){}function k(){}function C(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function A(e){var t;this._invoke=function(n,r){function a(){return new Promise(function(t,a){!function t(n,r,a,s){var o=x(e[n],e,r);if("throw"!==o.type){var l=o.arg,c=l.value;return c&&"object"==typeof c&&i.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,a,s)},function(e){t("throw",e,a,s)}):Promise.resolve(c).then(function(e){l.value=e,a(l)},function(e){return t("throw",e,a,s)})}s(o.arg)}(n,r,t,a)})}return t=t?t.then(a,a):a()}}function E(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,E(e,t),"throw"===t.method))return g;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var i=x(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,g;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,g):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function G(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(G,this),this.reset(!0)}function N(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return a.next=a}}return{next:T}}function T(){return{value:n,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t){(()=>{if(!("SVGPathSeg"in window)){class e{constructor(e,t,n){this.pathSegType=e,this.pathSegTypeAsLetter=t,this._owningPathSegList=n}_segmentChanged(){this._owningPathSegList&&this._owningPathSegList.segmentChanged(this)}}e.prototype.classname="SVGPathSeg",e.PATHSEG_UNKNOWN=0,e.PATHSEG_CLOSEPATH=1,e.PATHSEG_MOVETO_ABS=2,e.PATHSEG_MOVETO_REL=3,e.PATHSEG_LINETO_ABS=4,e.PATHSEG_LINETO_REL=5,e.PATHSEG_CURVETO_CUBIC_ABS=6,e.PATHSEG_CURVETO_CUBIC_REL=7,e.PATHSEG_CURVETO_QUADRATIC_ABS=8,e.PATHSEG_CURVETO_QUADRATIC_REL=9,e.PATHSEG_ARC_ABS=10,e.PATHSEG_ARC_REL=11,e.PATHSEG_LINETO_HORIZONTAL_ABS=12,e.PATHSEG_LINETO_HORIZONTAL_REL=13,e.PATHSEG_LINETO_VERTICAL_ABS=14,e.PATHSEG_LINETO_VERTICAL_REL=15,e.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS=16,e.PATHSEG_CURVETO_CUBIC_SMOOTH_REL=17,e.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS=18,e.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL=19;class t extends e{constructor(t){super(e.PATHSEG_CLOSEPATH,"z",t)}toString(){return"[object SVGPathSegClosePath]"}_asPathString(){return this.pathSegTypeAsLetter}clone(){return new t(void 0)}}class n extends e{constructor(t,n,r){super(e.PATHSEG_MOVETO_ABS,"M",t),this._x=n,this._y=r}toString(){return"[object SVGPathSegMovetoAbs]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y}clone(){return new n(void 0,this._x,this._y)}}Object.defineProperties(n.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0}});class r extends e{constructor(t,n,r){super(e.PATHSEG_MOVETO_REL,"m",t),this._x=n,this._y=r}toString(){return"[object SVGPathSegMovetoRel]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y}clone(){return new r(void 0,this._x,this._y)}}Object.defineProperties(r.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0}});class i extends e{constructor(t,n,r){super(e.PATHSEG_LINETO_ABS,"L",t),this._x=n,this._y=r}toString(){return"[object SVGPathSegLinetoAbs]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y}clone(){return new i(void 0,this._x,this._y)}}Object.defineProperties(i.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0}});class a extends e{constructor(t,n,r){super(e.PATHSEG_LINETO_REL,"l",t),this._x=n,this._y=r}toString(){return"[object SVGPathSegLinetoRel]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y}clone(){return new a(void 0,this._x,this._y)}}Object.defineProperties(a.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0}});class s extends e{constructor(t,n,r,i,a,s,o){super(e.PATHSEG_CURVETO_CUBIC_ABS,"C",t),this._x=n,this._y=r,this._x1=i,this._y1=a,this._x2=s,this._y2=o}toString(){return"[object SVGPathSegCurvetoCubicAbs]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y}clone(){return new s(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)}}Object.defineProperties(s.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0},x1:{get(){return this._x1},set(e){this._x1=e,this._segmentChanged()},enumerable:!0},y1:{get(){return this._y1},set(e){this._y1=e,this._segmentChanged()},enumerable:!0},x2:{get(){return this._x2},set(e){this._x2=e,this._segmentChanged()},enumerable:!0},y2:{get(){return this._y2},set(e){this._y2=e,this._segmentChanged()},enumerable:!0}});class o extends e{constructor(t,n,r,i,a,s,o){super(e.PATHSEG_CURVETO_CUBIC_REL,"c",t),this._x=n,this._y=r,this._x1=i,this._y1=a,this._x2=s,this._y2=o}toString(){return"[object SVGPathSegCurvetoCubicRel]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y}clone(){return new o(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)}}Object.defineProperties(o.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0},x1:{get(){return this._x1},set(e){this._x1=e,this._segmentChanged()},enumerable:!0},y1:{get(){return this._y1},set(e){this._y1=e,this._segmentChanged()},enumerable:!0},x2:{get(){return this._x2},set(e){this._x2=e,this._segmentChanged()},enumerable:!0},y2:{get(){return this._y2},set(e){this._y2=e,this._segmentChanged()},enumerable:!0}});class l extends e{constructor(t,n,r,i,a){super(e.PATHSEG_CURVETO_QUADRATIC_ABS,"Q",t),this._x=n,this._y=r,this._x1=i,this._y1=a}toString(){return"[object SVGPathSegCurvetoQuadraticAbs]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y}clone(){return new l(void 0,this._x,this._y,this._x1,this._y1)}}Object.defineProperties(l.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0},x1:{get(){return this._x1},set(e){this._x1=e,this._segmentChanged()},enumerable:!0},y1:{get(){return this._y1},set(e){this._y1=e,this._segmentChanged()},enumerable:!0}});class c extends e{constructor(t,n,r,i,a){super(e.PATHSEG_CURVETO_QUADRATIC_REL,"q",t),this._x=n,this._y=r,this._x1=i,this._y1=a}toString(){return"[object SVGPathSegCurvetoQuadraticRel]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y}clone(){return new c(void 0,this._x,this._y,this._x1,this._y1)}}Object.defineProperties(c.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0},x1:{get(){return this._x1},set(e){this._x1=e,this._segmentChanged()},enumerable:!0},y1:{get(){return this._y1},set(e){this._y1=e,this._segmentChanged()},enumerable:!0}});class u extends e{constructor(t,n,r,i,a,s,o,l){super(e.PATHSEG_ARC_ABS,"A",t),this._x=n,this._y=r,this._r1=i,this._r2=a,this._angle=s,this._largeArcFlag=o,this._sweepFlag=l}toString(){return"[object SVGPathSegArcAbs]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y}clone(){return new u(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)}}Object.defineProperties(u.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0},r1:{get(){return this._r1},set(e){this._r1=e,this._segmentChanged()},enumerable:!0},r2:{get(){return this._r2},set(e){this._r2=e,this._segmentChanged()},enumerable:!0},angle:{get(){return this._angle},set(e){this._angle=e,this._segmentChanged()},enumerable:!0},largeArcFlag:{get(){return this._largeArcFlag},set(e){this._largeArcFlag=e,this._segmentChanged()},enumerable:!0},sweepFlag:{get(){return this._sweepFlag},set(e){this._sweepFlag=e,this._segmentChanged()},enumerable:!0}});class d extends e{constructor(t,n,r,i,a,s,o,l){super(e.PATHSEG_ARC_REL,"a",t),this._x=n,this._y=r,this._r1=i,this._r2=a,this._angle=s,this._largeArcFlag=o,this._sweepFlag=l}toString(){return"[object SVGPathSegArcRel]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y}clone(){return new d(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)}}Object.defineProperties(d.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0},r1:{get(){return this._r1},set(e){this._r1=e,this._segmentChanged()},enumerable:!0},r2:{get(){return this._r2},set(e){this._r2=e,this._segmentChanged()},enumerable:!0},angle:{get(){return this._angle},set(e){this._angle=e,this._segmentChanged()},enumerable:!0},largeArcFlag:{get(){return this._largeArcFlag},set(e){this._largeArcFlag=e,this._segmentChanged()},enumerable:!0},sweepFlag:{get(){return this._sweepFlag},set(e){this._sweepFlag=e,this._segmentChanged()},enumerable:!0}});class h extends e{constructor(t,n){super(e.PATHSEG_LINETO_HORIZONTAL_ABS,"H",t),this._x=n}toString(){return"[object SVGPathSegLinetoHorizontalAbs]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x}clone(){return new h(void 0,this._x)}}Object.defineProperty(h.prototype,"x",{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0});class p extends e{constructor(t,n){super(e.PATHSEG_LINETO_HORIZONTAL_REL,"h",t),this._x=n}toString(){return"[object SVGPathSegLinetoHorizontalRel]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x}clone(){return new p(void 0,this._x)}}Object.defineProperty(p.prototype,"x",{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0});class f extends e{constructor(t,n){super(e.PATHSEG_LINETO_VERTICAL_ABS,"V",t),this._y=n}toString(){return"[object SVGPathSegLinetoVerticalAbs]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._y}clone(){return new f(void 0,this._y)}}Object.defineProperty(f.prototype,"y",{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0});class g extends e{constructor(t,n){super(e.PATHSEG_LINETO_VERTICAL_REL,"v",t),this._y=n}toString(){return"[object SVGPathSegLinetoVerticalRel]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._y}clone(){return new g(void 0,this._y)}}Object.defineProperty(g.prototype,"y",{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0});class m extends e{constructor(t,n,r,i,a){super(e.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS,"S",t),this._x=n,this._y=r,this._x2=i,this._y2=a}toString(){return"[object SVGPathSegCurvetoCubicSmoothAbs]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y}clone(){return new m(void 0,this._x,this._y,this._x2,this._y2)}}Object.defineProperties(m.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0},x2:{get(){return this._x2},set(e){this._x2=e,this._segmentChanged()},enumerable:!0},y2:{get(){return this._y2},set(e){this._y2=e,this._segmentChanged()},enumerable:!0}});class _ extends e{constructor(t,n,r,i,a){super(e.PATHSEG_CURVETO_CUBIC_SMOOTH_REL,"s",t),this._x=n,this._y=r,this._x2=i,this._y2=a}toString(){return"[object SVGPathSegCurvetoCubicSmoothRel]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y}clone(){return new _(void 0,this._x,this._y,this._x2,this._y2)}}Object.defineProperties(_.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0},x2:{get(){return this._x2},set(e){this._x2=e,this._segmentChanged()},enumerable:!0},y2:{get(){return this._y2},set(e){this._y2=e,this._segmentChanged()},enumerable:!0}});class y extends e{constructor(t,n,r){super(e.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS,"T",t),this._x=n,this._y=r}toString(){return"[object SVGPathSegCurvetoQuadraticSmoothAbs]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y}clone(){return new y(void 0,this._x,this._y)}}Object.defineProperties(y.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0}});class v extends e{constructor(t,n,r){super(e.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL,"t",t),this._x=n,this._y=r}toString(){return"[object SVGPathSegCurvetoQuadraticSmoothRel]"}_asPathString(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y}clone(){return new v(void 0,this._x,this._y)}}Object.defineProperties(v.prototype,{x:{get(){return this._x},set(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get(){return this._y},set(e){this._y=e,this._segmentChanged()},enumerable:!0}}),SVGPathElement.prototype.createSVGPathSegClosePath=function(){return new t(void 0)},SVGPathElement.prototype.createSVGPathSegMovetoAbs=function(e,t){return new n(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegMovetoRel=function(e,t){return new r(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegLinetoAbs=function(e,t){return new i(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegLinetoRel=function(e,t){return new a(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs=function(e,t,n,r,i,a){return new s(void 0,e,t,n,r,i,a)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel=function(e,t,n,r,i,a){return new o(void 0,e,t,n,r,i,a)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs=function(e,t,n,r){return new l(void 0,e,t,n,r)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel=function(e,t,n,r){return new c(void 0,e,t,n,r)},SVGPathElement.prototype.createSVGPathSegArcAbs=function(e,t,n,r,i,a,s){return new u(void 0,e,t,n,r,i,a,s)},SVGPathElement.prototype.createSVGPathSegArcRel=function(e,t,n,r,i,a,s){return new d(void 0,e,t,n,r,i,a,s)},SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs=function(e){return new h(void 0,e)},SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel=function(e){return new p(void 0,e)},SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs=function(e){return new f(void 0,e)},SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel=function(e){return new g(void 0,e)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs=function(e,t,n,r){return new m(void 0,e,t,n,r)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel=function(e,t,n,r){return new _(void 0,e,t,n,r)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs=function(e,t){return new y(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel=function(e,t){return new v(void 0,e,t)},"getPathSegAtLength"in SVGPathElement.prototype||(SVGPathElement.prototype.getPathSegAtLength=function(e){if(void 0===e||!isFinite(e))throw new Error("Invalid arguments.");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",this.getAttribute("d"));let n=t.pathSegList.numberOfItems-1;if(n<=0)return 0;do{if(t.pathSegList.removeItem(n),e>t.getTotalLength())break;n--}while(n>0);return n}),window.SVGPathSeg=e,window.SVGPathSegClosePath=t,window.SVGPathSegMovetoAbs=n,window.SVGPathSegMovetoRel=r,window.SVGPathSegLinetoAbs=i,window.SVGPathSegLinetoRel=a,window.SVGPathSegCurvetoCubicAbs=s,window.SVGPathSegCurvetoCubicRel=o,window.SVGPathSegCurvetoQuadraticAbs=l,window.SVGPathSegCurvetoQuadraticRel=c,window.SVGPathSegArcAbs=u,window.SVGPathSegArcRel=d,window.SVGPathSegLinetoHorizontalAbs=h,window.SVGPathSegLinetoHorizontalRel=p,window.SVGPathSegLinetoVerticalAbs=f,window.SVGPathSegLinetoVerticalRel=g,window.SVGPathSegCurvetoCubicSmoothAbs=m,window.SVGPathSegCurvetoCubicSmoothRel=_,window.SVGPathSegCurvetoQuadraticSmoothAbs=y,window.SVGPathSegCurvetoQuadraticSmoothRel=v}if(!("SVGPathSegList"in window&&"appendItem"in window.SVGPathSegList.prototype)){class e{constructor(e){this._pathElement=e,this._list=this._parsePath(this._pathElement.getAttribute("d")),this._mutationObserverConfig={attributes:!0,attributeFilter:["d"]},this._pathElementMutationObserver=new MutationObserver(this._updateListFromPathMutations.bind(this)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)}_checkPathSynchronizedToList(){this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords())}_updateListFromPathMutations(e){if(!this._pathElement)return;let t=!1;e.forEach(e=>{"d"===e.attributeName&&(t=!0)}),t&&(this._list=this._parsePath(this._pathElement.getAttribute("d")))}_writeListToPath(){this._pathElementMutationObserver.disconnect(),this._pathElement.setAttribute("d",e._pathSegArrayAsString(this._list)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)}segmentChanged(e){this._writeListToPath()}clear(){this._checkPathSynchronizedToList(),this._list.forEach(e=>{e._owningPathSegList=null}),this._list=[],this._writeListToPath()}initialize(e){return this._checkPathSynchronizedToList(),this._list=[e],e._owningPathSegList=this,this._writeListToPath(),e}_checkValidIndex(e){if(isNaN(e)||e<0||e>=this.numberOfItems)throw new Error("INDEX_SIZE_ERR")}getItem(e){return this._checkPathSynchronizedToList(),this._checkValidIndex(e),this._list[e]}insertItemBefore(e,t){return this._checkPathSynchronizedToList(),t>this.numberOfItems&&(t=this.numberOfItems),e._owningPathSegList&&(e=e.clone()),this._list.splice(t,0,e),e._owningPathSegList=this,this._writeListToPath(),e}replaceItem(e,t){return this._checkPathSynchronizedToList(),e._owningPathSegList&&(e=e.clone()),this._checkValidIndex(t),this._list[t]=e,e._owningPathSegList=this,this._writeListToPath(),e}removeItem(e){this._checkPathSynchronizedToList(),this._checkValidIndex(e);const t=this._list[e];return this._list.splice(e,1),this._writeListToPath(),t}appendItem(e){return this._checkPathSynchronizedToList(),e._owningPathSegList&&(e=e.clone()),this._list.push(e),e._owningPathSegList=this,this._writeListToPath(),e}_parsePath(e){if(!e||!e.length)return[];const t=this;const n=new class{constructor(){this.pathSegList=[]}appendSegment(e){this.pathSegList.push(e)}},r=new class{constructor(e){this._string=e,this._currentIndex=0,this._endIndex=this._string.length,this._previousCommand=SVGPathSeg.PATHSEG_UNKNOWN,this._skipOptionalSpaces()}_isCurrentSpace(){const e=this._string[this._currentIndex];return e<=" "&&(" "===e||"\n"===e||"\t"===e||"\r"===e||"\f"===e)}_skipOptionalSpaces(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex++;return this._currentIndex<this._endIndex}_skipOptionalSpacesOrDelimiter(){return!(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!==this._string.charAt(this._currentIndex))&&(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","===this._string.charAt(this._currentIndex)&&(this._currentIndex++,this._skipOptionalSpaces()),this._currentIndex<this._endIndex)}hasMoreData(){return this._currentIndex<this._endIndex}peekSegmentType(){const e=this._string[this._currentIndex];return this._pathSegTypeFromChar(e)}_pathSegTypeFromChar(e){switch(e){case"Z":case"z":return SVGPathSeg.PATHSEG_CLOSEPATH;case"M":return SVGPathSeg.PATHSEG_MOVETO_ABS;case"m":return SVGPathSeg.PATHSEG_MOVETO_REL;case"L":return SVGPathSeg.PATHSEG_LINETO_ABS;case"l":return SVGPathSeg.PATHSEG_LINETO_REL;case"C":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;case"c":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;case"Q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;case"q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;case"A":return SVGPathSeg.PATHSEG_ARC_ABS;case"a":return SVGPathSeg.PATHSEG_ARC_REL;case"H":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;case"h":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;case"V":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;case"v":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;case"S":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;case"s":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;case"T":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;case"t":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;default:return SVGPathSeg.PATHSEG_UNKNOWN}}_nextCommandHelper(e,t){return("+"===e||"-"===e||"."===e||e>="0"&&e<="9")&&t!==SVGPathSeg.PATHSEG_CLOSEPATH?t===SVGPathSeg.PATHSEG_MOVETO_ABS?SVGPathSeg.PATHSEG_LINETO_ABS:t===SVGPathSeg.PATHSEG_MOVETO_REL?SVGPathSeg.PATHSEG_LINETO_REL:t:SVGPathSeg.PATHSEG_UNKNOWN}initialCommandIsMoveTo(){if(!this.hasMoreData())return!0;const e=this.peekSegmentType();return e===SVGPathSeg.PATHSEG_MOVETO_ABS||e===SVGPathSeg.PATHSEG_MOVETO_REL}_parseNumber(){let e=0,t=0,n=1,r=0,i=1,a=1;const s=this._currentIndex;if(this._skipOptionalSpaces(),this._currentIndex<this._endIndex&&"+"===this._string.charAt(this._currentIndex)?this._currentIndex++:this._currentIndex<this._endIndex&&"-"===this._string.charAt(this._currentIndex)&&(this._currentIndex++,i=-1),this._currentIndex===this._endIndex||(this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")&&"."!==this._string.charAt(this._currentIndex))return;const o=this._currentIndex;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)this._currentIndex++;if(this._currentIndex!==o){let e=this._currentIndex-1,n=1;for(;e>=o;)t+=n*(this._string.charAt(e--)-"0"),n*=10}if(this._currentIndex<this._endIndex&&"."===this._string.charAt(this._currentIndex)){if(this._currentIndex++,this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)n*=10,r+=(this._string.charAt(this._currentIndex)-"0")/n,this._currentIndex+=1}if(this._currentIndex!==s&&this._currentIndex+1<this._endIndex&&("e"===this._string.charAt(this._currentIndex)||"E"===this._string.charAt(this._currentIndex))&&"x"!==this._string.charAt(this._currentIndex+1)&&"m"!==this._string.charAt(this._currentIndex+1)){if(this._currentIndex++,"+"===this._string.charAt(this._currentIndex)?this._currentIndex++:"-"===this._string.charAt(this._currentIndex)&&(this._currentIndex++,a=-1),this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)e*=10,e+=this._string.charAt(this._currentIndex)-"0",this._currentIndex++}let l=t+r;return l*=i,e&&(l*=10**(a*e)),s!==this._currentIndex?(this._skipOptionalSpacesOrDelimiter(),l):void 0}_parseArcFlag(){if(this._currentIndex>=this._endIndex)return;let e=!1;const t=this._string.charAt(this._currentIndex++);if("0"===t)e=!1;else{if("1"!==t)return;e=!0}return this._skipOptionalSpacesOrDelimiter(),e}parseSegment(){const e=this._string[this._currentIndex];let n=this._pathSegTypeFromChar(e);if(n===SVGPathSeg.PATHSEG_UNKNOWN){if(this._previousCommand===SVGPathSeg.PATHSEG_UNKNOWN)return null;if((n=this._nextCommandHelper(e,this._previousCommand))===SVGPathSeg.PATHSEG_UNKNOWN)return null}else this._currentIndex++;switch(this._previousCommand=n,n){case SVGPathSeg.PATHSEG_MOVETO_REL:return new SVGPathSegMovetoRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_MOVETO_ABS:return new SVGPathSegMovetoAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_REL:return new SVGPathSegLinetoRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_ABS:return new SVGPathSegLinetoAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:return new SVGPathSegLinetoHorizontalRel(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:return new SVGPathSegLinetoHorizontalAbs(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:return new SVGPathSegLinetoVerticalRel(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:return new SVGPathSegLinetoVerticalAbs(t,this._parseNumber());case SVGPathSeg.PATHSEG_CLOSEPATH:return this._skipOptionalSpaces(),new SVGPathSegClosePath(t);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:{const e={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicRel(t,e.x,e.y,e.x1,e.y1,e.x2,e.y2)}case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:{const e={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicAbs(t,e.x,e.y,e.x1,e.y1,e.x2,e.y2)}case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:{const e={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothRel(t,e.x,e.y,e.x2,e.y2)}case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:{const e={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothAbs(t,e.x,e.y,e.x2,e.y2)}case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:{const e={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticRel(t,e.x,e.y,e.x1,e.y1)}case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:{const e={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticAbs(t,e.x,e.y,e.x1,e.y1)}case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:return new SVGPathSegCurvetoQuadraticSmoothRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:return new SVGPathSegCurvetoQuadraticSmoothAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_ARC_REL:{const e={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcRel(t,e.x,e.y,e.x1,e.y1,e.arcAngle,e.arcLarge,e.arcSweep)}case SVGPathSeg.PATHSEG_ARC_ABS:{const e={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcAbs(t,e.x,e.y,e.x1,e.y1,e.arcAngle,e.arcLarge,e.arcSweep)}default:throw new Error("Unknown path seg type.")}}}(e);if(!r.initialCommandIsMoveTo())return[];for(;r.hasMoreData();){const e=r.parseSegment();if(!e)return[];n.appendSegment(e)}return n.pathSegList}}e.prototype.classname="SVGPathSegList",Object.defineProperty(e.prototype,"numberOfItems",{get(){return this._checkPathSynchronizedToList(),this._list.length},enumerable:!0}),e._pathSegArrayAsString=function(e){let t="",n=!0;return e.forEach(e=>{n?(n=!1,t+=e._asPathString()):t+=" "+e._asPathString()}),t},Object.defineProperties(SVGPathElement.prototype,{pathSegList:{get(){return this._pathSegList||(this._pathSegList=new e(this)),this._pathSegList},enumerable:!0},normalizedPathSegList:{get(){return this.pathSegList},enumerable:!0},animatedPathSegList:{get(){return this.pathSegList},enumerable:!0},animatedNormalizedPathSegList:{get(){return this.pathSegList},enumerable:!0}}),window.SVGPathSegList=e}})()},function(e,t,n){var r=n(16),i=n(17),a=n(18);e.exports=function(e){return r(e)||i(e)||a()}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return n}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t){function n(e){const{changedTouches:t}=e,n=t[0];let r="";switch(e.type){case"touchstart":r="mousedown";break;case"touchmove":r="mousemove";break;case"touchend":r="mouseup";break;default:return}const{screenX:i,screenY:a,clientX:s,clientY:o}=n,l=new MouseEvent(r,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:i,screenY:a,clientX:s,clientY:o,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});t.length<2&&(n.target.dispatchEvent(l),e.preventDefault())}document.addEventListener("touchstart",n,!0),document.addEventListener("touchmove",n,!0),document.addEventListener("touchend",n,!0),document.addEventListener("touchcancel",n,!0)},function(e,t,n){},,,function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"HistoryEventTypes",function(){return _e}),n.d(r,"MoveElementCommand",function(){return ve}),n.d(r,"InsertElementCommand",function(){return be}),n.d(r,"RemoveElementCommand",function(){return xe}),n.d(r,"ChangeElementCommand",function(){return we}),n.d(r,"BatchCommand",function(){return Se}),n.d(r,"UndoManager",function(){return ke});var i={};n.r(i),n.d(i,"setUiStrings",function(){return Re}),n.d(i,"setLinkControlPoints",function(){return Fe}),n.d(i,"path",function(){return He}),n.d(i,"init",function(){return qe}),n.d(i,"insertItemBefore",function(){return $e}),n.d(i,"ptObjToArr",function(){return Ye}),n.d(i,"getGripPt",function(){return Xe}),n.d(i,"getPointFromGrip",function(){return We}),n.d(i,"addPointGrip",function(){return Qe}),n.d(i,"getGripContainer",function(){return Ke}),n.d(i,"addCtrlGrip",function(){return Ze}),n.d(i,"getCtrlLine",function(){return Je}),n.d(i,"getPointGrip",function(){return et}),n.d(i,"getControlPoints",function(){return tt}),n.d(i,"replacePathSeg",function(){return nt}),n.d(i,"getSegSelector",function(){return rt}),n.d(i,"smoothControlPoints",function(){return it}),n.d(i,"Segment",function(){return at}),n.d(i,"Path",function(){return st}),n.d(i,"getPath_",function(){return ot}),n.d(i,"removePath_",function(){return lt}),n.d(i,"recalcRotatedPath",function(){return gt}),n.d(i,"clearData",function(){return mt}),n.d(i,"reorientGrads",function(){return _t}),n.d(i,"convertPath",function(){return vt}),n.d(i,"pathActions",function(){return xt});var a=n(11),s=n.n(a),o=n(12),l=n.n(o),c=n(3),u=n.n(c),d=n(9),h=n.n(d),p=n(10),f=n.n(p),g=n(0),m=n.n(g),_=n(1),y=n.n(_);n(19);
/**
 * Namespaces or tools therefor
 * @module namespaces
 * @license MIT
*/
const v={HTML:"http://www.w3.org/1999/xhtml",MATH:"http://www.w3.org/1998/Math/MathML",SE:"http://svg-edit.googlecode.com",SVG:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"},b=function(){const e={};return Object.entries(v).forEach(([t,n])=>{e[n]=t.toLowerCase()}),e};n(8);
/**
 * Browser detection
 * @module browser
 * @license MIT
 *
 * @copyright 2010 Jeff Schiller, 2010 Alexis Deveria
 */const x=jQuery,{userAgent:w}=(Boolean(document.createElementNS&&document.createElementNS(v.SVG,"svg").createSVGRect),navigator),S=document.createElementNS(v.SVG,"svg"),k=Boolean(window.opera),C=w.includes("AppleWebKit"),A=w.includes("Gecko/"),E=w.includes("MSIE"),G=w.includes("Chrome/"),P=(w.includes("Windows"),w.includes("Macintosh")),I="ontouchstart"in window,N=Boolean(S.querySelector),T=Boolean(document.evaluate),L=function(){const e=document.createElementNS(v.SVG,"path");e.setAttribute("d","M0,0 10,10");const t=e.pathSegList,n=e.createSVGPathSegLinetoAbs(5,5);try{return t.replaceItem(n,1),!0}catch(e){}return!1}(),M=function(){const e=document.createElementNS(v.SVG,"path");e.setAttribute("d","M0,0 10,10");const t=e.pathSegList,n=e.createSVGPathSegLinetoAbs(5,5);try{return t.insertItemBefore(n,1),!0}catch(e){}return!1}(),O=function(){const e=document.createElementNS(v.SVG,"svg"),t=document.createElementNS(v.SVG,"svg");document.documentElement.append(e),t.setAttribute("x",5),e.append(t);const n=document.createElementNS(v.SVG,"text");n.textContent="a",t.append(n);try{return 0===n.getStartPositionOfChar(0).x}catch(e){return!1}finally{e.remove()}}(),j=function(){const e=document.createElementNS(v.SVG,"svg");document.documentElement.append(e);const t=document.createElementNS(v.SVG,"path");t.setAttribute("d","M0,0 C0,0 10,10 10,0"),e.append(t);const n=t.getBBox();return e.remove(),n.height>4&&n.height<5}(),V=function(){const e=document.createElementNS(v.SVG,"svg");document.documentElement.append(e);const t=document.createElementNS(v.SVG,"path");t.setAttribute("d","M0,0 10,0");const n=document.createElementNS(v.SVG,"path");n.setAttribute("d","M5,0 15,0");const r=document.createElementNS(v.SVG,"g");r.append(t,n),e.append(r);const i=r.getBBox();return e.remove(),15===i.width}(),R=(function(){const e=document.createElementNS(v.SVG,"rect");e.setAttribute("x",.1);const t=!e.cloneNode(!1).getAttribute("x").includes(",");t||x.alert('NOTE: This version of Opera is known to contain bugs in SVG-edit.\nPlease upgrade to the <a href="http://opera.com">latest version</a> in which the problems have been fixed.')}(),function(){const e=document.createElementNS(v.SVG,"rect");return e.setAttribute("style","vector-effect:non-scaling-stroke"),"non-scaling-stroke"===e.style.vectorEffect}());let B=function(){const e=document.createElementNS(v.SVG,"rect").transform.baseVal,t=S.createSVGTransform();e.appendItem(t);const n=e.getItem(0),r=e=>e&&"object"==typeof e&&"function"==typeof e.setMatrix&&"angle"in e;return r(n)&&r(t)&&n.type===t.type&&n.angle===t.angle&&n.matrix.a===t.matrix.a&&n.matrix.b===t.matrix.b&&n.matrix.c===t.matrix.c&&n.matrix.d===t.matrix.d&&n.matrix.e===t.matrix.e&&n.matrix.f===t.matrix.f}();const D=()=>k,U=()=>C,F=()=>A,H=()=>E,z=()=>G,q=()=>P,Y=()=>I,X=()=>V,W=()=>O,Q=()=>R;
/**
 * jQuery module to work with SVG attributes
 * @module jQueryAttr
 * @license MIT
 */
function K(e){const t=e.fn.attr;return e.fn.attr=function(e,n){const r=this.length;if(!r)return t.call(this,e,n);for(let i=0;i<r;++i){const r=this[i];if("http://www.w3.org/2000/svg"!==r.namespaceURI)return t.call(this,e,n);if(void 0!==n)r.setAttribute(e,n);else if(Array.isArray(e)){const t={};let n=e.length;for(;n--;){const i=e[n];let a=r.getAttribute(i);(a||"0"===a)&&(a=isNaN(a)?a:a-0),t[i]=a}return t}if("object"!=typeof e){let t=r.getAttribute(e);return(t||"0"===t)&&(t=isNaN(t)?t:t-0),t}for(const[t,n]of Object.entries(e))r.setAttribute(t,n)}return this},e}
/**
 * Partial polyfill of `SVGTransformList`
 * @module SVGTransformList
 *
 * @license MIT
 *
 * @copyright 2010 Alexis Deveria, 2010 Jeff Schiller
 */const Z=document.createElementNS(v.SVG,"svg");function J(e){const t=e.matrix;let n="";switch(e.type){case 1:n="matrix("+[t.a,t.b,t.c,t.d,t.e,t.f].join(",")+")";break;case 2:n="translate("+t.e+","+t.f+")";break;case 3:n=t.a===t.d?"scale("+t.a+")":"scale("+t.a+","+t.d+")";break;case 4:{let r=0,i=0;if(0!==e.angle){const e=1-t.a;i=(e*t.f+t.b*t.e)/(e*e+t.b*t.b),r=(t.e-t.b*i)/e}n="rotate("+e.angle+" "+r+","+i+")";break}}return n}let ee={};class te{constructor(e){this._elem=e||null,this._xforms=[],this._update=function(){let e="";for(let t=0;t<this.numberOfItems;++t){e+=J(this._list.getItem(t))+" "}this._elem.setAttribute("transform",e)},this._list=this,this._init=function(){let e=this._elem.getAttribute("transform");if(!e)return;const t=/\s*((scale|matrix|rotate|translate)\s*\(.*?\))\s*,?\s*/;let n=!0;for(;n;)if(n=e.match(t),e=e.replace(t,""),n&&n[1]){const e=n[1].split(/\s*\(/),t=e[0],r=e[1].match(/\s*(.*?)\s*\)/);r[1]=r[1].replace(/(\d)-/g,"$1 -");const i=r[1].split(/[, ]+/),a="abcdef".split(""),s=Z.createSVGMatrix();Object.values(i).forEach(function(e,n){i[n]=parseFloat(e),"matrix"===t&&(s[a[n]]=i[n])});const o=Z.createSVGTransform(),l="set"+t.charAt(0).toUpperCase()+t.slice(1),c="matrix"===t?[s]:i;"scale"===t&&1===c.length?c.push(c[0]):"translate"===t&&1===c.length?c.push(0):"rotate"===t&&1===c.length&&c.push(0,0),o[l](...c),this._list.appendItem(o)}},this._removeFromOtherLists=function(e){e&&Object.values(ee).some(t=>{for(let n=0,r=t._xforms.length;n<r;++n)if(t._xforms[n]===e)return t.removeItem(n),!0;return!1})},this.numberOfItems=0}clear(){this.numberOfItems=0,this._xforms=[]}initialize(e){this.numberOfItems=1,this._removeFromOtherLists(e),this._xforms=[e]}getItem(e){if(e<this.numberOfItems&&e>=0)return this._xforms[e];const t=new Error("DOMException with code=INDEX_SIZE_ERR");throw t.code=1,t}insertItemBefore(e,t){let n=null;if(t>=0)if(t<this.numberOfItems){this._removeFromOtherLists(e);const r=new Array(this.numberOfItems+1);let i;for(i=0;i<t;++i)r[i]=this._xforms[i];r[i]=e;for(let e=i+1;i<this.numberOfItems;++e,++i)r[e]=this._xforms[i];this.numberOfItems++,this._xforms=r,n=e,this._list._update()}else n=this._list.appendItem(e);return n}replaceItem(e,t){let n=null;return t<this.numberOfItems&&t>=0&&(this._removeFromOtherLists(e),this._xforms[t]=e,n=e,this._list._update()),n}removeItem(e){if(e<this.numberOfItems&&e>=0){const t=this._xforms[e],n=new Array(this.numberOfItems-1);let r;for(r=0;r<e;++r)n[r]=this._xforms[r];for(let e=r;e<this.numberOfItems-1;++e,++r)n[e]=this._xforms[r+1];return this.numberOfItems--,this._xforms=n,this._list._update(),t}const t=new Error("DOMException with code=INDEX_SIZE_ERR");throw t.code=1,t}appendItem(e){return this._removeFromOtherLists(e),this._xforms.push(e),this.numberOfItems++,this._list._update(),e}}const ne=function(){ee={}};let re=function(e){e.id&&ee[e.id]&&delete ee[e.id]};const ie=function(e){if(!(()=>B)()){const t=e.id||"temp";let n=ee[t];return n&&"temp"!==t||(ee[t]=new te(e),ee[t]._init(),n=ee[t]),n}return e.transform?e.transform.baseVal:e.gradientTransform?e.gradientTransform.baseVal:e.patternTransform?e.patternTransform.baseVal:null},ae=["x","x1","cx","rx","width"],se=["y","y1","cy","ry","height"],oe=["r","radius",...ae,...se];let le,ce={};const ue=function(e){le=e;const t=document.createElementNS(v.SVG,"svg");document.body.append(t);const n=document.createElementNS(v.SVG,"rect");n.setAttribute("width","1em"),n.setAttribute("height","1ex"),n.setAttribute("x","1in"),t.append(n);const r=n.getBBox();t.remove();const i=r.x;ce={em:r.width,ex:r.height,in:i,cm:i/2.54,mm:i/25.4,pt:i/72,pc:i/6,px:1,"%":0}},de=function(){return ce},he=function(e){const t=le.getRoundDigits();return isNaN(e)?Array.isArray(e)?he(e[0])+","+he(e[1]):parseFloat(e).toFixed(t)-0:Number(Number(e).toFixed(t))},pe=function(e,t){return t=t||le.getBaseUnit(),he(e/ce[t])},fe=function(e,t,n){e.setAttribute(t,n)},ge=function(e,t){if(!isNaN(t))return t-0;if("%"===t.substr(-1)){const n=t.substr(0,t.length-1)/100,r=le.getWidth(),i=le.getHeight();return ae.includes(e)?n*r:se.includes(e)?n*i:n*Math.sqrt(r*r+i*i)/Math.sqrt(2)}const n=t.substr(-2);return t.substr(0,t.length-2)*ce[n]},me=function(e,t,n){if(oe.includes(e))return!isNaN(t)||(t=t.toLowerCase(),Object.keys(ce).some(e=>{return new RegExp("^-?[\\d\\.]+"+e+"$").test(t)}));if("id"===e){let e=!1;try{const r=le.getElement(t);e=gn(r)||r===n}catch(e){}return e}return!0},_e={BEFORE_APPLY:"before_apply",AFTER_APPLY:"after_apply",BEFORE_UNAPPLY:"before_unapply",AFTER_UNAPPLY:"after_unapply"};class ye{getText(){return this.text}}class ve extends ye{constructor(e,t,n,r){super(),this.elem=e,this.text=r?"Move "+e.tagName+" to "+r:"Move "+e.tagName,this.oldNextSibling=t,this.oldParent=n,this.newNextSibling=e.nextSibling,this.newParent=e.parentNode}type(){return"svgedit.history.MoveElementCommand"}apply(e){e&&e.handleHistoryEvent(_e.BEFORE_APPLY,this),this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling),e&&e.handleHistoryEvent(_e.AFTER_APPLY,this)}unapply(e){e&&e.handleHistoryEvent(_e.BEFORE_UNAPPLY,this),this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling),e&&e.handleHistoryEvent(_e.AFTER_UNAPPLY,this)}elements(){return[this.elem]}}ve.type=ve.prototype.type;class be extends ye{constructor(e,t){super(),this.elem=e,this.text=t||"Create "+e.tagName,this.parent=e.parentNode,this.nextSibling=this.elem.nextSibling}type(){return"svgedit.history.InsertElementCommand"}apply(e){e&&e.handleHistoryEvent(_e.BEFORE_APPLY,this),this.elem=this.parent.insertBefore(this.elem,this.nextSibling),e&&e.handleHistoryEvent(_e.AFTER_APPLY,this)}unapply(e){e&&e.handleHistoryEvent(_e.BEFORE_UNAPPLY,this),this.parent=this.elem.parentNode,this.elem=this.elem.parentNode.removeChild(this.elem),e&&e.handleHistoryEvent(_e.AFTER_UNAPPLY,this)}elements(){return[this.elem]}}be.type=be.prototype.type;class xe extends ye{constructor(e,t,n,r){super(),this.elem=e,this.text=r||"Delete "+e.tagName,this.nextSibling=t,this.parent=n,re(e)}type(){return"svgedit.history.RemoveElementCommand"}apply(e){e&&e.handleHistoryEvent(_e.BEFORE_APPLY,this),re(this.elem),this.parent=this.elem.parentNode,this.elem=this.parent.removeChild(this.elem),e&&e.handleHistoryEvent(_e.AFTER_APPLY,this)}unapply(e){e&&e.handleHistoryEvent(_e.BEFORE_UNAPPLY,this),re(this.elem),gn(this.nextSibling)&&window.console&&console.log("Error: reference element was lost"),this.parent.insertBefore(this.elem,this.nextSibling),e&&e.handleHistoryEvent(_e.AFTER_UNAPPLY,this)}elements(){return[this.elem]}}xe.type=xe.prototype.type;class we extends ye{constructor(e,t,n){super(),this.elem=e,this.text=n?"Change "+e.tagName+" "+n:"Change "+e.tagName,this.newValues={},this.oldValues=t;for(const n in t)this.newValues[n]="#text"===n?e.textContent:"#href"===n?Ht(e):e.getAttribute(n)}type(){return"svgedit.history.ChangeElementCommand"}apply(e){e&&e.handleHistoryEvent(_e.BEFORE_APPLY,this);let t=!1;if(Object.entries(this.newValues).forEach(([e,n])=>{n?"#text"===e?this.elem.textContent=n:"#href"===e?zt(this.elem,n):this.elem.setAttribute(e,n):"#text"===e?this.elem.textContent="":(this.elem.setAttribute(e,""),this.elem.removeAttribute(e)),"transform"===e&&(t=!0)}),!t){const e=on(this.elem);if(e){const t=this.elem.getBBox(),n=["rotate(",e," ",t.x+t.width/2,",",t.y+t.height/2,")"].join("");n!==this.elem.getAttribute("transform")&&this.elem.setAttribute("transform",n)}}return e&&e.handleHistoryEvent(_e.AFTER_APPLY,this),!0}unapply(e){e&&e.handleHistoryEvent(_e.BEFORE_UNAPPLY,this);let t=!1;if(Object.entries(this.oldValues).forEach(([e,n])=>{n?"#text"===e?this.elem.textContent=n:"#href"===e?zt(this.elem,n):this.elem.setAttribute(e,n):"#text"===e?this.elem.textContent="":this.elem.removeAttribute(e),"transform"===e&&(t=!0)}),!t){const e=on(this.elem);if(e){const t=this.elem.getBBox(),n=["rotate(",e," ",t.x+t.width/2,",",t.y+t.height/2,")"].join("");n!==this.elem.getAttribute("transform")&&this.elem.setAttribute("transform",n)}}return re(this.elem),e&&e.handleHistoryEvent(_e.AFTER_UNAPPLY,this),!0}elements(){return[this.elem]}}we.type=we.prototype.type;class Se extends ye{constructor(e){super(),this.text=e||"Batch Command",this.stack=[]}type(){return"svgedit.history.BatchCommand"}apply(e){e&&e.handleHistoryEvent(_e.BEFORE_APPLY,this);const t=this.stack.length;for(let n=0;n<t;++n)this.stack[n].apply(e);e&&e.handleHistoryEvent(_e.AFTER_APPLY,this)}unapply(e){e&&e.handleHistoryEvent(_e.BEFORE_UNAPPLY,this);for(let t=this.stack.length-1;t>=0;t--)this.stack[t].unapply(e);e&&e.handleHistoryEvent(_e.AFTER_UNAPPLY,this)}elements(){const e=[];let t=this.stack.length;for(;t--;){const n=this.stack[t].elements();let r=n.length;for(;r--;)e.includes(n[r])||e.push(n[r])}return e}addSubCommand(e){this.stack.push(e)}isEmpty(){return!this.stack.length}}Se.type=Se.prototype.type;class ke{constructor(e){this.handler_=e||null,this.undoStackPointer=0,this.undoStack=[],this.undoChangeStackPointer=-1,this.undoableChangeStack=[]}resetUndoStack(){this.undoStack=[],this.undoStackPointer=0}getUndoStackSize(){return this.undoStackPointer}getRedoStackSize(){return this.undoStack.length-this.undoStackPointer}getNextUndoCommandText(){return this.undoStackPointer>0?this.undoStack[this.undoStackPointer-1].getText():""}getNextRedoCommandText(){return this.undoStackPointer<this.undoStack.length?this.undoStack[this.undoStackPointer].getText():""}undo(){if(this.undoStackPointer>0){this.undoStack[--this.undoStackPointer].unapply(this.handler_)}}redo(){if(this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0){this.undoStack[this.undoStackPointer++].apply(this.handler_)}}addCommandToHistory(e){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&(this.undoStack=this.undoStack.splice(0,this.undoStackPointer)),this.undoStack.push(e),this.undoStackPointer=this.undoStack.length}beginUndoableChange(e,t){const n=++this.undoChangeStackPointer;let r=t.length;const i=new Array(r),a=new Array(r);for(;r--;){const n=t[r];gn(n)||(a[r]=n,i[r]=n.getAttribute(e))}this.undoableChangeStack[n]={attrName:e,oldValues:i,elements:a}}finishUndoableChange(){const e=this.undoChangeStackPointer--,t=this.undoableChangeStack[e],{attrName:n}=t,r=new Se("Change "+n);let i=t.elements.length;for(;i--;){const e=t.elements[i];if(gn(e))continue;const a={};a[n]=t.oldValues[i],a[n]!==e.getAttribute(n)&&r.addSubCommand(new we(e,a,n))}return this.undoableChangeStack[e]=null,r}}
/**
 * Mathematical utilities
 * @module math
 * @license MIT
 *
 * @copyright 2010 Alexis Deveria, 2010 Jeff Schiller
 */const Ce=document.createElementNS(v.SVG,"svg"),Ae=function(e,t,n){return{x:n.a*e+n.c*t+n.e,y:n.b*e+n.d*t+n.f}},Ee=function(e){return 1===e.a&&0===e.b&&0===e.c&&1===e.d&&0===e.e&&0===e.f},Ge=function(...e){const t=e.reduceRight((e,t)=>t.multiply(e));return Math.abs(t.a)<1e-14&&(t.a=0),Math.abs(t.b)<1e-14&&(t.b=0),Math.abs(t.c)<1e-14&&(t.c=0),Math.abs(t.d)<1e-14&&(t.d=0),Math.abs(t.e)<1e-14&&(t.e=0),Math.abs(t.f)<1e-14&&(t.f=0),t},Pe=function(e){if(!e)return!1;let t=e.numberOfItems;for(;t--;){const n=e.getItem(t);if(1===n.type&&!Ee(n.matrix))return!0}return!1},Ie=function(e,t,n,r,i){const a=Ae(e,t,i),s=Ae(e+n,t,i),o=Ae(e,t+r,i),l=Ae(e+n,t+r,i),c=Math.min(a.x,s.x,o.x,l.x),u=Math.max(a.x,s.x,o.x,l.x),d=Math.min(a.y,s.y,o.y,l.y);return{tl:a,tr:s,bl:o,br:l,aabox:{x:c,y:d,width:u-c,height:Math.max(a.y,s.y,o.y,l.y)-d}}},Ne=function(e,t,n){if(gn(e))return Ce.createSVGTransformFromMatrix(Ce.createSVGMatrix());if(t=t||0,n=n||e.numberOfItems-1,(t=parseInt(t))>(n=parseInt(n))){const e=n;n=t,t=e}let r=Ce.createSVGMatrix();for(let i=t;i<=n;++i){const t=i>=0&&i<e.numberOfItems?e.getItem(i).matrix:Ce.createSVGMatrix();r=Ge(r,t)}return Ce.createSVGTransformFromMatrix(r)},Te=function(e){const t=ie(e);return Ne(t).matrix},Le=function(e,t,n,r){const i=Math.PI/4,a=n-e,s=r-t,o=Math.atan2(s,a),l=Math.sqrt(a*a+s*s),c=Math.round(o/i)*i;return{x:e+l*Math.cos(c),y:t+l*Math.sin(c),a:c}},Me=function(e,t){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y},Oe=jQuery,je={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"],16:["x","y","x2","y2"],18:["x","y"]},Ve={},Re=function(e){Object.assign(Ve,e.ui)};let Be=[],De=!0,Ue={};const Fe=function(e){De=e};let He=null,ze=null;const qe=function(e){ze=e,Be=[0,"ClosePath"];Oe.each(["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"],function(e,t){Be.push(t+"Abs"),Be.push(t+"Rel")})},$e=function(e,t,n){const r=e.pathSegList;if((()=>M)())return void r.insertItemBefore(t,n);const i=r.numberOfItems,a=[];for(let e=0;e<i;e++){const t=r.getItem(e);a.push(t)}r.clear();for(let e=0;e<i;e++)e===n&&r.appendItem(t),r.appendItem(a[e])},Ye=function(e,t){return je[e].map(e=>t[e])},Xe=function(e,t){const{path:n}=e;let r={x:t?t.x:e.item.x,y:t?t.y:e.item.y};if(n.matrix){r=Ae(r.x,r.y,n.matrix)}const i=ze.getCurrentZoom();return r.x*=i,r.y*=i,r},We=function(e,t){const n={x:e.x,y:e.y};t.matrix&&(e=Ae(n.x,n.y,t.imatrix),n.x=e.x,n.y=e.y);const r=ze.getCurrentZoom();return n.x/=r,n.y/=r,n},Qe=function(e,t,n){const r=Ke();let i=cn("pathpointgrip_"+e);if(!i){i=document.createElementNS(v.SVG,"circle");const t={id:"pathpointgrip_"+e,display:"none",r:4,fill:"#0FF",stroke:"#00F","stroke-width":2,cursor:"move",style:"pointer-events:all"};"pathNodeTooltip"in Ve&&(t["xlink:title"]=Ve.pathNodeTooltip),un(i,t),i=r.appendChild(i),Oe("#pathpointgrip_"+e).dblclick(function(){He&&He.setSegType()})}return t&&n&&un(i,{cx:t,cy:n,display:"inline"}),i},Ke=function(){let e=cn("pathpointgrip_container");if(!e){(e=cn("selectorParentGroup").appendChild(document.createElementNS(v.SVG,"g"))).id="pathpointgrip_container"}return e},Ze=function(e){let t=cn("ctrlpointgrip_"+e);if(t)return t;t=document.createElementNS(v.SVG,"circle");const n={id:"ctrlpointgrip_"+e,display:"none",r:4,fill:"#0FF",stroke:"#55F","stroke-width":1,cursor:"move",style:"pointer-events:all"};return"pathCtrlPtTooltip"in Ve&&(n["xlink:title"]=Ve.pathCtrlPtTooltip),un(t,n),Ke().append(t),t},Je=function(e){let t=cn("ctrlLine_"+e);return t||(t=document.createElementNS(v.SVG,"line"),un(t,{id:"ctrlLine_"+e,stroke:"#555","stroke-width":1,style:"pointer-events:none"}),Ke().append(t),t)},et=function(e,t){const{index:n}=e,r=Qe(n);if(t){const t=Xe(e);un(r,{cx:t.x,cy:t.y,display:"inline"})}return r},tt=function(e){const{item:t,index:n}=e;if(!("x1"in t&&"x2"in t))return null;const r={};Ke();const i=[He.segs[n-1].item,t];for(let a=1;a<3;a++){const s=n+"c"+a,o=r["c"+a+"_line"]=Je(s),l=Xe(e,{x:t["x"+a],y:t["y"+a]}),c=Xe(e,{x:i[a-1].x,y:i[a-1].y});un(o,{x1:l.x,y1:l.y,x2:c.x,y2:c.y,display:"inline"}),r["c"+a+"_line"]=o;const u=r["c"+a]=Ze(s);un(u,{cx:l.x,cy:l.y,display:"inline"}),r["c"+a]=u}return r},nt=function(e,t,n,r){const i=r||He.elem,a=i["createSVGPathSeg"+Be[e]](...n);if((()=>L)())i.pathSegList.replaceItem(a,t);else{const e=i.pathSegList,n=e.numberOfItems,r=[];for(let t=0;t<n;t++){const n=e.getItem(t);r.push(n)}e.clear();for(let i=0;i<n;i++)i===t?e.appendItem(a):e.appendItem(r[i])}},rt=function(e,t){const{index:n}=e;let r=cn("segline_"+n);if(!r){const e=Ke();r=document.createElementNS(v.SVG,"path"),un(r,{id:"segline_"+n,display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",d:"M0,0 0,0"}),e.append(r)}if(t){const{prev:t}=e;if(!t)return r.setAttribute("display","none"),r;const n=Xe(t);nt(2,0,[n.x,n.y],r);const i=Ye(e.type,e.item);for(let t=0;t<i.length;t+=2){const n=Xe(e,{x:i[t],y:i[t+1]});i[t]=n.x,i[t+1]=n.y}nt(e.type,1,i,r)}return r},it=function(e,t,n){const r=e.x-n.x,i=e.y-n.y,a=t.x-n.x,s=t.y-n.y;if(!(0===r&&0===i||0===a&&0===s)){const e=Math.sqrt(r*r+i*i),t=Math.sqrt(a*a+s*s),o=ze.getSVGRoot().createSVGPoint(),l=ze.getSVGRoot().createSVGPoint();let c=Math.atan2(i,r),u=Math.atan2(s,a);c<0&&(c+=2*Math.PI),u<0&&(u+=2*Math.PI);const d=Math.abs(c-u),h=Math.abs(Math.PI-d)/2;let p,f;return c-u>0?(p=d<Math.PI?c+h:c-h,f=d<Math.PI?u-h:u+h):(p=d<Math.PI?c-h:c+h,f=d<Math.PI?u+h:u-h),o.x=e*Math.cos(p)+n.x,o.y=e*Math.sin(p)+n.y,l.x=t*Math.cos(f)+n.x,l.y=t*Math.sin(f)+n.y,[o,l]}};class at{constructor(e,t){this.selected=!1,this.index=e,this.item=t,this.type=t.pathSegType,this.ctrlpts=[],this.ptgrip=null,this.segsel=null}showCtrlPts(e){for(const t in this.ctrlpts)({}).hasOwnProperty.call(this.ctrlpts,t)&&this.ctrlpts[t].setAttribute("display",e?"inline":"none")}selectCtrls(e){Oe("#ctrlpointgrip_"+this.index+"c1, #ctrlpointgrip_"+this.index+"c2").attr("fill",e?"#0FF":"#EEE")}show(e){this.ptgrip&&(this.ptgrip.setAttribute("display",e?"inline":"none"),this.segsel.setAttribute("display",e?"inline":"none"),this.showCtrlPts(e))}select(e){this.ptgrip&&(this.ptgrip.setAttribute("stroke",e?"#0FF":"#00F"),this.segsel.setAttribute("display",e?"inline":"none"),this.ctrlpts&&this.selectCtrls(e),this.selected=e)}addGrip(){this.ptgrip=et(this,!0),this.ctrlpts=tt(this),this.segsel=rt(this,!0)}update(e){if(this.ptgrip){const t=Xe(this);un(this.ptgrip,{cx:t.x,cy:t.y}),rt(this,!0),this.ctrlpts&&(e&&(this.item=He.elem.pathSegList.getItem(this.index),this.type=this.item.pathSegType),tt(this))}}move(e,t){const{item:n}=this,r=this.ctrlpts?[n.x+=e,n.y+=t,n.x1,n.y1,n.x2+=e,n.y2+=t]:[n.x+=e,n.y+=t];if(nt(this.type,this.index,r),this.next&&this.next.ctrlpts){const n=this.next.item,r=[n.x,n.y,n.x1+=e,n.y1+=t,n.x2,n.y2];nt(this.next.type,this.next.index,r)}if(this.mate){const{item:n}=this.mate,r=[n.x+=e,n.y+=t];nt(this.mate.type,this.mate.index,r)}this.update(!0),this.next&&this.next.update(!0)}setLinked(e){let t,n,r;if(2===e){if(n=1,!(t=this.next))return;r=this.item}else{if(n=2,!(t=this.prev))return;r=t.item}const{item:i}=t;i["x"+n]=r.x+(r.x-this.item["x"+e]),i["y"+n]=r.y+(r.y-this.item["y"+e]);const a=[i.x,i.y,i.x1,i.y1,i.x2,i.y2];nt(t.type,t.index,a),t.update(!0)}moveCtrl(e,t,n){const{item:r}=this;r["x"+e]+=t,r["y"+e]+=n;const i=[r.x,r.y,r.x1,r.y1,r.x2,r.y2];nt(this.type,this.index,i),this.update(!0)}setType(e,t){nt(e,this.index,t),this.type=e,this.item=He.elem.pathSegList.getItem(this.index),this.showCtrlPts(6===e),this.ctrlpts=tt(this),this.update(!0)}}class st{constructor(e){if(!e||"path"!==e.tagName)throw new Error("svgedit.path.Path constructed without a <path> element");this.elem=e,this.segs=[],this.selected_pts=[],He=this,this.init()}init(){Oe(Ke()).find("*").each(function(){Oe(this).attr("display","none")});const e=this.elem.pathSegList,t=e.numberOfItems;this.segs=[],this.selected_pts=[],this.first_seg=null;for(let n=0;n<t;n++){const t=e.getItem(n),r=new at(n,t);r.path=this,this.segs.push(r)}const{segs:n}=this;let r=null;for(let e=0;e<t;e++){const i=n[e],a=e+1>=t?null:n[e+1],s=e-1<0?null:n[e-1];if(2===i.type){if(s&&1!==s.type){const e=n[r];e.next=n[r+1],e.next.prev=e,e.addGrip()}r=e}else if(a&&1===a.type)i.next=n[r+1],i.next.prev=i,i.mate=n[r],i.addGrip(),gn(this.first_seg)&&(this.first_seg=i);else if(a)1!==i.type&&(i.addGrip(),a&&2!==a.type&&(i.next=a,i.next.prev=i));else if(1!==i.type){const e=n[r];e.next=n[r+1],e.next.prev=e,e.addGrip(),i.addGrip(),this.first_seg||(this.first_seg=n[r])}}return this}eachSeg(e){const t=this.segs.length;for(let n=0;n<t;n++){if(!1===e.call(this.segs[n],n))break}}addSeg(e){const t=this.segs[e];if(!t.prev)return;const{prev:n}=t;let r,i,a;switch(t.item.pathSegType){case 4:i=(t.item.x+n.item.x)/2,a=(t.item.y+n.item.y)/2,r=this.elem.createSVGPathSegLinetoAbs(i,a);break;case 6:{const s=(n.item.x+t.item.x1)/2,o=(t.item.x1+t.item.x2)/2,l=(t.item.x2+t.item.x)/2,c=(s+o)/2,u=(o+l)/2;i=(c+u)/2;const d=(n.item.y+t.item.y1)/2,h=(t.item.y1+t.item.y2)/2,p=(t.item.y2+t.item.y)/2,f=(d+h)/2,g=(h+p)/2;a=(f+g)/2,r=this.elem.createSVGPathSegCurvetoCubicAbs(i,a,s,d,c,f);const m=[t.item.x,t.item.y,u,g,l,p];nt(t.type,e,m);break}}$e(this.elem,r,e)}deleteSeg(e){const t=this.segs[e],n=this.elem.pathSegList;t.show(!1);const{next:r}=t;if(t.mate){const e=[r.item.x,r.item.y];nt(2,r.index,e),nt(4,t.index,e),n.removeItem(t.mate.index)}else if(t.prev)n.removeItem(e);else{const i=[r.item.x,r.item.y];nt(2,t.next.index,i),n.removeItem(e)}}removePtFromSelection(e){const t=this.selected_pts.indexOf(e);-1!==t&&(this.segs[e].select(!1),this.selected_pts.splice(t,1))}clearSelection(){this.eachSeg(function(){this.select(!1)}),this.selected_pts=[]}storeD(){this.last_d=this.elem.getAttribute("d")}show(e){return this.eachSeg(function(){this.show(e)}),e&&this.selectPt(this.first_seg.index),this}movePts(e,t){let n=this.selected_pts.length;for(;n--;){this.segs[this.selected_pts[n]].move(e,t)}}moveCtrl(e,t){const n=this.segs[this.selected_pts[0]];n.moveCtrl(this.dragctrl,e,t),De&&n.setLinked(this.dragctrl)}setSegType(e){this.storeD();let t,n=this.selected_pts.length;for(;n--;){const r=this.selected_pts[n],i=this.segs[r],{prev:a}=i;if(!a)continue;if(!e){t="Toggle Path Segment Type",e=6===i.type?4:6}e=Number(e);const s=i.item.x,o=i.item.y,l=a.item.x,c=a.item.y;let u;switch(e){case 6:if(i.olditem){const e=i.olditem;u=[s,o,e.x1,e.y1,e.x2,e.y2]}else{const e=s-l,t=o-c;u=[s,o,l+e/3,c+t/3,s-e/3,o-t/3]}break;case 4:u=[s,o],i.olditem=i.item}i.setType(e,u)}He.endChanges(t)}selectPt(e,t){this.clearSelection(),gn(e)&&this.eachSeg(function(t){this.prev&&(e=t)}),this.addPtsToSelection(e),t&&(this.dragctrl=t,De&&this.segs[e].setLinked(t))}update(){const{elem:e}=this;return on(e)?(this.matrix=Te(e),this.imatrix=this.matrix.inverse()):(this.matrix=null,this.imatrix=null),this.eachSeg(function(t){this.item=e.pathSegList.getItem(t),this.update()}),this}endChanges(e){U()&&ze.resetD(this.elem);const t=new we(this.elem,{d:this.last_d},e);ze.endChanges({cmd:t,elem:this.elem})}addPtsToSelection(e){Array.isArray(e)||(e=[e]);for(let t=0;t<e.length;t++){const n=e[t];this.segs[n].ptgrip&&!this.selected_pts.includes(n)&&n>=0&&this.selected_pts.push(n)}this.selected_pts.sort();let t=this.selected_pts.length;const n=[];for(n.length=t;t--;){const e=this.selected_pts[t],r=this.segs[e];r.select(!0),n[t]=r.ptgrip}const r=st.subpathIsClosed(this.selected_pts[0]);ze.addPtsToSelection({grips:n,closedSubpath:r})}}st.subpathIsClosed=function(e){let t=!1;return He.eachSeg(function(n){return n<=e||2!==this.type&&(1!==this.type||(t=!0,!1))}),t};const ot=function(e){let t=Ue[e.id];return t||(t=Ue[e.id]=new st(e)),t},lt=function(e){e in Ue&&delete Ue[e]};let ct,ut,dt,ht,pt;const ft=function(e,t){let n=e-dt,r=t-ht,i=Math.sqrt(n*n+r*r),a=Math.atan2(r,n)+pt;return n=i*Math.cos(a)+dt,r=i*Math.sin(a)+ht,n-=ct,r-=ut,i=Math.sqrt(n*n+r*r),a=Math.atan2(r,n)-pt,{x:i*Math.cos(a)+ct,y:i*Math.sin(a)+ut}},gt=function(){const e=He.elem;if(!(pt=on(e,!0)))return;const t=He.oldbbox;dt=t.x+t.width/2,ht=t.y+t.height/2;const n=Xt(e);ct=n.x+n.width/2,ut=n.y+n.height/2;const r=ct-dt,i=ut-ht,a=Math.sqrt(r*r+i*i),s=Math.atan2(i,r)+pt;ct=a*Math.cos(s)+dt,ut=a*Math.sin(s)+ht;const o=e.pathSegList;let l=o.numberOfItems;for(;l;){l-=1;const e=o.getItem(l),t=e.pathSegType;if(1===t)continue;const n=ft(e.x,e.y),r=[n.x,n.y];if(!gn(e.x1)&&!gn(e.x2)){const t=ft(e.x1,e.y1),n=ft(e.x2,e.y2);r.splice(r.length,0,t.x,t.y,n.x,n.y)}nt(t,l,r)}Xt(e);const c=ze.getSVGRoot().createSVGTransform(),u=ie(e);c.setRotate(180*pt/Math.PI,ct,ut),u.replaceItem(c,0)},mt=function(){Ue={}},_t=function(e,t){const n=Xt(e);for(let r=0;r<2;r++){const i=0===r?"fill":"stroke",a=e.getAttribute(i);if(a&&a.startsWith("url(")){const r=ln(a);if("linearGradient"===r.tagName){let a=r.getAttribute("x1")||0,s=r.getAttribute("y1")||0,o=r.getAttribute("x2")||1,l=r.getAttribute("y2")||0;a=n.width*a+n.x,s=n.height*s+n.y,o=n.width*o+n.x,l=n.height*l+n.y;const c=Ae(a,s,t),u=Ae(o,l,t),d={};d.x1=(c.x-n.x)/n.width,d.y1=(c.y-n.y)/n.height,d.x2=(u.x-n.x)/n.width,d.y2=(u.y-n.y)/n.height;const h=r.cloneNode(!0);Oe(h).attr(d),h.id=ze.getNextId(),qt().append(h),e.setAttribute(i,"url(#"+h.id+")")}}}},yt=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],vt=function(e,t){const{pathSegList:n}=e,r=n.numberOfItems;let i=0,a=0,s="",o=null;for(let e=0;e<r;++e){const r=n.getItem(e);let l=r.x||0,c=r.y||0,u=r.x1||0,d=r.y1||0,h=r.x2||0,p=r.y2||0;const f=r.pathSegType;let g=yt[f]["to"+(t?"Lower":"Upper")+"Case"]();switch(f){case 1:s+="z",o&&!t&&(i=o[0],a=o[1]);break;case 12:l-=i;case 13:t?(i+=l,g="l"):(i=l+=i,g="L"),s+=bt(g,[[l,a]]);break;case 14:c-=a;case 15:t?(a+=c,g="l"):(a=c+=a,g="L"),s+=bt(g,[[i,c]]);break;case 2:case 4:case 18:l-=i,c-=a;case 5:case 3:case 19:t?(i+=l,a+=c):(i=l+=i,a=c+=a),2!==f&&3!==f||(o=[i,a]),s+=bt(g,[[l,c]]);break;case 6:l-=i,u-=i,h-=i,c-=a,d-=a,p-=a;case 7:t?(i+=l,a+=c):(u+=i,h+=i,d+=a,p+=a,i=l+=i,a=c+=a),s+=bt(g,[[u,d],[h,p],[l,c]]);break;case 8:l-=i,u-=i,c-=a,d-=a;case 9:t?(i+=l,a+=c):(u+=i,d+=a,i=l+=i,a=c+=a),s+=bt(g,[[u,d],[l,c]]);break;case 10:l-=i,c-=a;case 11:t?(i+=l,a+=c):(i=l+=i,a=c+=a),s+=bt(g,[[r.r1,r.r2]],[r.angle,r.largeArcFlag?1:0,r.sweepFlag?1:0],[l,c]);break;case 16:l-=i,h-=i,c-=a,p-=a;case 17:t?(i+=l,a+=c):(h+=i,p+=a,i=l+=i,a=c+=a),s+=bt(g,[[h,p],[l,c]])}}return s};function bt(e,t,n,r){Oe.each(t,function(e,n){t[e]=he(n)});let i=e+t.join(" ");return n&&(i+=" "+n.join(" ")),r&&(i+=" "+he(r)),i}const xt=function(){let e,t,n=!1,r=null,i=!1;return{mouseDown(t,r,i,a){let s,o;if("path"!==ze.getCurrentMode()){if(He){if(He.storeD(),({id:s}=t.target),"pathpointgrip_"===s.substr(0,14)){o=He.cur_pt=parseInt(s.substr(14)),He.dragging=[i,a];const e=He.segs[o];t.shiftKey?e.selected?He.removePtFromSelection(o):He.addPtsToSelection(o):((He.selected_pts.length<=1||!e.selected)&&He.clearSelection(),He.addPtsToSelection(o))}else if(s.startsWith("ctrlpointgrip_")){He.dragging=[i,a];const e=s.split("_")[1].split("c");o=Number(e[0]);const t=Number(e[1]);He.selectPt(o,t)}if(!He.dragging){let e=ze.getRubberBox();gn(e)&&(e=ze.setRubberBox(ze.selectorManager.getRubberBandBox()));const t=ze.getCurrentZoom();un(e,{x:i*t,y:a*t,width:0,height:0,display:"inline"},100)}}}else{let r=i,o=a;const l=ze.getCurrentZoom();let c=r/l,u=o/l,d=cn("path_stretch_line");e=[c,u],ze.getGridSnapping()&&(c=hn(c),u=hn(u),r=hn(r),o=hn(o)),d||(d=document.createElementNS(v.SVG,"path"),un(d,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5",fill:"none"}),d=cn("selectorParentGroup").appendChild(d)),d.setAttribute("display","inline");let h,p=null;const f=ze.getDrawnPath();if(f){const e=f.pathSegList;let r=e.numberOfItems;const i=6/l;let a=!1;for(;r;){r--;const t=e.getItem(r),n=t.x,s=t.y;if(c>=n-i&&c<=n+i&&u>=s-i&&u<=s+i){a=!0;break}}s=ze.getId(),lt(s);const o=cn(s);let g,m;const _=e.numberOfItems;if(a){if(r<=1&&_>=2){const t=e.getItem(0).x,n=e.getItem(0).y;g=4===(m=d.pathSegList.getItem(1)).pathSegType?f.createSVGPathSegLinetoAbs(t,n):f.createSVGPathSegCurvetoCubicAbs(t,n,m.x1/l,m.y1/l,t,n);const r=f.createSVGPathSegClosePath();e.appendItem(g),e.appendItem(r)}else if(_<3)return p=!1;if(Oe(d).remove(),ze.setDrawnPath(null),ze.setStarted(!1),n){He.matrix&&ze.remapElement(o,{},He.matrix.inverse());const e=o.getAttribute("d"),t=Oe(He.elem).attr("d");return Oe(He.elem).attr("d",t+e),Oe(o).remove(),He.matrix&&gt(),qe(),xt.toEditMode(He.elem),He.selectPt(),!1}}else{if(!Oe.contains(ze.getContainer(),ze.getMouseTarget(t)))return!1;const e=f.pathSegList.numberOfItems,r=f.pathSegList.getItem(e-1),i=r.x,a=r.y;if(t.shiftKey){const e=Le(i,a,c,u);({x:c,y:u}=e)}g=4===(m=d.pathSegList.getItem(1)).pathSegType?f.createSVGPathSegLinetoAbs(ze.round(c),ze.round(u)):f.createSVGPathSegCurvetoCubicAbs(ze.round(c),ze.round(u),m.x1/l,m.y1/l,m.x2/l,m.y2/l),f.pathSegList.appendItem(g),c*=l,u*=l,d.setAttribute("d",["M",c,u,c,u].join(" ")),h=e,n&&(h+=He.segs.length),Qe(h,c,u)}}else{const e="M"+c+","+u+" ";ze.setDrawnPath(ze.addSVGElementFromJson({element:"path",curStyles:!0,attr:{d:e,id:ze.getNextId(),opacity:ze.getOpacity()/2}})),d.setAttribute("d",["M",r,o,r,o].join(" ")),h=n?He.segs.length:0,Qe(h,r,o)}}},mouseMove(n,r){const a=ze.getCurrentZoom();i=!0;const s=ze.getDrawnPath();if("path"!==ze.getCurrentMode())if(He.dragging){const e=We({x:He.dragging[0],y:He.dragging[1]},He),t=We({x:n,y:r},He),i=t.x-e.x,a=t.y-e.y;He.dragging=[n,r],He.dragctrl?He.moveCtrl(i,a):He.movePts(i,a)}else He.selected_pts=[],He.eachSeg(function(e){const t=this;if(!t.next&&!t.prev)return;const n=ze.getRubberBox().getBBox(),r=Xe(t),i={x:r.x,y:r.y,width:0,height:0},a=Me(n,i);this.select(a),a&&He.selected_pts.push(t.index)});else{if(!s)return;const i=s.pathSegList,o=i.numberOfItems-1;if(e){const l=Ze("1c1"),c=Ze("0c2");l.setAttribute("cx",n),l.setAttribute("cy",r),l.setAttribute("display","inline");const u=e[0],d=e[1],h=u+(u-n/a),p=d+(d-r/a);c.setAttribute("cx",h*a),c.setAttribute("cy",p*a),c.setAttribute("display","inline");const f=Je(1);if(un(f,{x1:n,y1:r,x2:h*a,y2:p*a,display:"inline"}),0===o)t=[n,r];else{const e=i.getItem(o-1);let n=e.x,r=e.y;6===e.pathSegType?(n+=n-e.x2,r+=r-e.y2):t&&(n=t[0]/a,r=t[1]/a),nt(6,o,[u,d,n,r,h,p],s)}}else{const e=cn("path_stretch_line");if(e){const s=i.getItem(o);if(6===s.pathSegType){const t=s.x+(s.x-s.x2),i=s.y+(s.y-s.y2);nt(6,1,[n,r,t*a,i*a,n,r],e)}else t?nt(6,1,[n,r,t[0],t[1],n,r],e):nt(4,1,[n,r],e)}}}},mouseUp(n,r,a,s){const o=ze.getDrawnPath();if("path"===ze.getCurrentMode())return e=null,o||(r=cn(ze.getId()),ze.setStarted(!1),t=null),{keep:!0,element:r};const l=ze.getRubberBox();if(He.dragging){const e=He.cur_pt;He.dragging=!1,He.dragctrl=!1,He.update(),i&&He.endChanges("Move path point(s)"),n.shiftKey||i||He.selectPt(e)}else l&&"none"!==l.getAttribute("display")?(l.setAttribute("display","none"),l.getAttribute("width")<=2&&l.getAttribute("height")<=2&&xt.toSelectMode(n.target)):xt.toSelectMode(n.target);i=!1},toEditMode(e){He=ot(e),ze.setCurrentMode("pathedit"),ze.clearSelection(),He.show(!0).update(),He.oldbbox=Xt(He.elem),n=!1},toSelectMode(e){const t=e===He.elem;ze.setCurrentMode("select"),He.show(!1),r=!1,ze.clearSelection(),He.matrix&&gt(),t&&(ze.call("selected",[e]),ze.addToSelection([e],!0))},addSubPath(e){e?(ze.setCurrentMode("path"),n=!0):(xt.clear(!0),xt.toEditMode(He.elem))},select(e){r===e?(xt.toEditMode(e),ze.setCurrentMode("pathedit")):r=e},reorient(){const e=ze.getSelectedElements()[0];if(!e)return;if(0===on(e))return;const t=new Se("Reorient path"),n={d:e.getAttribute("d"),transform:e.getAttribute("transform")};t.addSubCommand(new we(e,n)),ze.clearSelection(),this.resetOrientation(e),ze.addCommandToHistory(t),ot(e).show(!1).matrix=null,this.clear(),ze.addToSelection([e],!0),ze.call("changed",ze.getSelectedElements())},clear(e){const n=ze.getDrawnPath();if(r=null,n){const e=cn(ze.getId());Oe(cn("path_stretch_line")).remove(),Oe(e).remove(),Oe(cn("pathpointgrip_container")).find("*").attr("display","none"),t=null,ze.setDrawnPath(null),ze.setStarted(!1)}else"pathedit"===ze.getCurrentMode()&&this.toSelectMode();He&&He.init().show(!1)},resetOrientation(e){if(gn(e)||"path"!==e.nodeName)return!1;const t=ie(e),n=Ne(t).matrix;t.clear(),e.removeAttribute("transform");const r=e.pathSegList,i=r.numberOfItems;for(let t=0;t<i;++t){const i=r.getItem(t),a=i.pathSegType;if(1===a)continue;const s=[];Oe.each(["",1,2],function(e,t){const r=i["x"+t],a=i["y"+t];if(void 0!==r&&void 0!==a){const e=Ae(r,a,n);s.splice(s.length,0,e.x,e.y)}}),nt(a,t,s,e)}_t(e,n)},zoomChange(){"pathedit"===ze.getCurrentMode()&&He.update()},getNodePoint(){const e=He.selected_pts.length?He.selected_pts[0]:1,t=He.segs[e];return{x:t.item.x,y:t.item.y,type:t.type}},linkControlPoints(e){Fe(e)},clonePathNode(){He.storeD();const e=He.selected_pts;let t=e.length;const n=[];for(;t--;){const r=e[t];He.addSeg(r),n.push(r+t),n.push(r+t+1)}He.init().addPtsToSelection(n),He.endChanges("Clone path node(s)")},opencloseSubPath(){const e=He.selected_pts;if(1!==e.length)return;const{elem:t}=He,n=t.pathSegList,r=e[0];let i=null,a=null;if(He.eachSeg(function(e){return 2===this.type&&e<=r&&(a=this.item),e<=r||(2===this.type?(i=e,!1):1!==this.type||(i=!1,!1))}),gn(i)&&(i=He.segs.length-1),!1!==i){const e=t.createSVGPathSegLinetoAbs(a.x,a.y),r=t.createSVGPathSegClosePath();return i===He.segs.length-1?(n.appendItem(e),n.appendItem(r)):($e(t,r,i),$e(t,e,i)),void He.init().selectPt(i+1)}if(He.segs[r].mate)return n.removeItem(r),n.removeItem(r),void He.init().selectPt(r-1);let s,o;for(let e=0;e<n.numberOfItems;e++){const t=n.getItem(e);if(2===t.pathSegType)s=e;else if(e===r)n.removeItem(s);else if(1===t.pathSegType&&r<e){o=e-1,n.removeItem(e);break}}let l=r-s-1;for(;l--;)$e(t,n.getItem(s),o);const c=n.getItem(s);nt(2,s,[c.x,c.y]),He.init().selectPt(0)},deletePathNode(){if(!xt.canDeleteNodes)return;He.storeD();const e=He.selected_pts;let t=e.length;for(;t--;){const n=e[t];He.deleteSeg(n)}const n=function(){const e=He.elem.pathSegList;let t=e.numberOfItems;const r=function(t,n){for(;n--;)e.removeItem(t)};if(t<=1)return!0;for(;t--;){const i=e.getItem(t);if(1===i.pathSegType){const i=e.getItem(t-1),a=e.getItem(t-2);if(2===i.pathSegType){r(t-1,2),n();break}if(2===a.pathSegType){r(t-2,3),n();break}}else if(2===i.pathSegType&&t>0){const i=e.getItem(t-1).pathSegType;if(2===i){r(t-1,1),n();break}if(1===i&&e.numberOfItems-1===t){r(t,1),n();break}}}return!1};if(n(),He.elem.pathSegList.numberOfItems<=1)return xt.toSelectMode(He.elem),void ze.canvas.deleteSelectedElements();if(He.init(),He.clearSelection(),window.opera){const e=Oe(He.elem);e.attr("d",e.attr("d"))}He.endChanges("Delete path node(s)")},smoothPolylineIntoPath:function(e){let t;const{points:n}=e,r=n.numberOfItems;if(r>=4){let i=n.getItem(0),a=null,s=[];for(s.push(["M",i.x,",",i.y," C"].join("")),t=1;t<=r-4;t+=3){let e=n.getItem(t);const r=n.getItem(t+1),o=n.getItem(t+2);if(a){const t=it(a,e,i);if(t&&2===t.length){const n=s[s.length-1].split(",");n[2]=t[0].x,n[3]=t[0].y,s[s.length-1]=n.join(","),e=t[1]}}s.push([e.x,e.y,r.x,r.y,o.x,o.y].join(",")),i=o,a=r}for(s.push("L");t<r;){const e=n.getItem(t);s.push([e.x,e.y].join(",")),t++}s=s.join(" "),e=ze.addSVGElementFromJson({element:"path",curStyles:!0,attr:{id:ze.getId(),d:s,fill:"none"}})}return e},setSegType(e){He.setSegType(e)},moveNode(e,t){const n=He.selected_pts;if(!n.length)return;He.storeD();const r=He.segs[n[0]],i={x:0,y:0};i[e]=t-r.item[e],r.move(i.x,i.y),He.endChanges("Move path point")},fixEnd(e){const t=e.pathSegList,n=t.numberOfItems;let r;for(let i=0;i<n;++i){const n=t.getItem(i);if(2===n.pathSegType&&(r=n),1===n.pathSegType){const n=t.getItem(i-1);if(n.x!==r.x||n.y!==r.y){const t=e.createSVGPathSegLinetoAbs(r.x,r.y);$e(e,t,i),xt.fixEnd(e);break}}}U()&&ze.resetD(e)},convertPath:vt}}(),wt=K(jQuery),St="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",kt="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(",");
/**
 * Miscellaneous utilities
 * @module utilities
 * @license MIT
 *
 * @copyright 2010 Alexis Deveria, 2010 Jeff Schiller
 */let Ct=null,At=null,Et=null,Gt=null;const Pt=function(e){Ct=e,At=e.getDOMDocument(),Et=e.getDOMContainer(),Gt=e.getSVGRoot()},It=e=>e.replace(/(<!DOCTYPE\s+\w*\s*\[).*(\?\]>)/,"$1$2"),Nt=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")};function Tt(e){if(e=Ot(e),window.btoa)return window.btoa(e);const t=new Array(4*Math.floor((e.length+2)/3));let n=0,r=0;do{const i=e.charCodeAt(n++),a=e.charCodeAt(n++),s=e.charCodeAt(n++),o=i>>2,l=(3&i)<<4|a>>4;let c=(15&a)<<2|s>>6,u=63&s;isNaN(a)?(c=64,u=64):isNaN(s)&&(u=64),t[r++]=St.charAt(o),t[r++]=St.charAt(l),t[r++]=St.charAt(c),t[r++]=St.charAt(u)}while(n<e.length);return t.join("")}function Lt(e){if(window.atob)return Mt(window.atob(e));e=e.replace(/[^A-Za-z0-9+\/=]/g,"");let t="",n=0;do{const r=St.indexOf(e.charAt(n++)),i=St.indexOf(e.charAt(n++)),a=St.indexOf(e.charAt(n++)),s=St.indexOf(e.charAt(n++)),o=r<<2|i>>4,l=(15&i)<<4|a>>2,c=(3&a)<<6|s;t+=String.fromCharCode(o),64!==a&&(t+=String.fromCharCode(l)),64!==s&&(t+=String.fromCharCode(c))}while(n<e.length);return Mt(t)}function Mt(e){return decodeURIComponent(escape(e))}const Ot=function(e){return unescape(encodeURIComponent(e))},jt=function(e){if("undefined"==typeof Uint8Array||"undefined"==typeof Blob||"undefined"==typeof URL||!URL.createObjectURL)return"";const t=e.split(","),n=t[0].match(/:(.*?);/)[1],r=atob(t[1]);let i=r.length;const a=new Uint8Array(i);for(;i--;)a[i]=r.charCodeAt(i);const s=new Blob([a],{type:n});return URL.createObjectURL(s)},Vt=function(e){return e&&"undefined"!=typeof URL&&URL.createObjectURL?URL.createObjectURL(e):""},Rt=function(){if("undefined"==typeof Blob)return"";const e=new Blob(["<html><head><title>SVG-edit</title></head><body>&nbsp;</body></html>"],{type:"text/html"});return Vt(e)}(),Bt=function(e){let t,n;e.includes("<svg:svg")&&(e=e.replace(/<(\/?)svg:/g,"<$1").replace("xmlns:svg","xmlns"));try{(n=window.DOMParser?new DOMParser:new window.ActiveXObject("Microsoft.XMLDOM")).async=!1}catch(e){throw new Error("XML Parser could not be instantiated")}try{t=n.loadXML?!!n.loadXML(e)&&n:n.parseFromString(e,"text/xml")}catch(e){throw new Error("Error parsing XML string")}return t},Dt=function(e,t){if(e&&1===e.nodeType){t(e);let n=e.childNodes.length;for(;n--;)Dt(e.childNodes.item(n),t)}},Ut=function(e,t){if(e&&1===e.nodeType){let n=e.childNodes.length;for(;n--;)Dt(e.childNodes.item(n),t);t(e)}},Ft=function(e){if(e){if(e.startsWith('url("'))return e.substring(5,e.indexOf('"',6));if(e.startsWith("url('"))return e.substring(5,e.indexOf("'",6));if(e.startsWith("url("))return e.substring(4,e.indexOf(")"))}return null};let Ht=function(e){return e.getAttributeNS(v.XLINK,"href")},zt=function(e,t){e.setAttributeNS(v.XLINK,"xlink:href",t)};const qt=function(){const e=Ct.getSVGContent();let t=e.getElementsByTagNameNS(v.SVG,"defs");return t.length>0?t=t[0]:(t=e.ownerDocument.createElementNS(v.SVG,"defs"),e.firstChild?e.insertBefore(t,e.firstChild.nextSibling):e.append(t)),t},$t=function(e){const t=e.pathSegList,n=t.numberOfItems,r=[[],[]],i=t.getItem(0);let a=[i.x,i.y];const s=function(e,t,n,r){return function(i){return 1-i**3*a[e]+3-i**2*i*t[e]+3*(1-i)*i**2*n[e]+i**3*r[e]}};for(let e=0;e<n;e++){const n=t.getItem(e);if(void 0!==n.x)if(r[0].push(a[0]),r[1].push(a[1]),n.x1){const e=[n.x1,n.y1],t=[n.x2,n.y2],i=[n.x,n.y];for(let n=0;n<2;n++){const o=s(n,e,t,i),l=6*a[n]-12*e[n]+6*t[n],c=-3*a[n]+9*e[n]-9*t[n]+3*i[n],u=3*e[n]-3*a[n];if(0===c){if(0===l)continue;const e=-u/l;e>0&&e<1&&r[n].push(o(e));continue}const d=l**2-4*u*c;if(d<0)continue;const h=(-l+Math.sqrt(d))/(2*c);h>0&&h<1&&r[n].push(o(h));const p=(-l-Math.sqrt(d))/(2*c);p>0&&p<1&&r[n].push(o(p))}a=i}else r[0].push(n.x),r[1].push(n.y)}const o=Math.min.apply(null,r[0]),l=Math.max.apply(null,r[0])-o,c=Math.min.apply(null,r[1]);return{x:o,y:c,width:l,height:Math.max.apply(null,r[1])-c}};function Yt(e){if(X())try{return e.getBBox()}catch(e){}const t=wt.data(e,"ref");let n,r,i=null;t?(r=wt(t).children().clone().attr("visibility","hidden"),wt(Gt).append(r),i=r.filter("line, path")):i=wt(e).find("line, path");let a=!1;if(i.length)if(i.each(function(){const e=this.getBBox();e.width&&e.height||(a=!0)}),a){const i=t?r:wt(e).children();n=nn(i)}else n=e.getBBox();else n=e.getBBox();return t&&r.remove(),n}const Xt=function(e){const t=e||Ct.geSelectedElements()[0];if(1!==e.nodeType)return null;const n=t.nodeName;let r=null;switch(n){case"text":""===t.textContent?(t.textContent="a",r=t.getBBox(),t.textContent=""):t.getBBox&&(r=t.getBBox());break;case"path":(()=>j)()?t.getBBox&&(r=t.getBBox()):r=$t(t);break;case"g":case"a":r=Yt(t);break;default:if("use"===n&&(r=Yt(t)),"use"===n||"foreignObject"===n&&U()){if(r||(r=t.getBBox()),!U()){const e={};e.width=r.width,e.height=r.height,e.x=r.x+parseFloat(t.getAttribute("x")||0),e.y=r.y+parseFloat(t.getAttribute("y")||0),r=e}}else if(kt.includes(n))if(t)try{r=t.getBBox()}catch(e){const n=t.getExtentOfChar(0),i=t.getComputedTextLength();r={x:n.x,y:n.y,width:i,height:n.height}}else{const e=wt(t).closest("foreignObject");e.length&&e[0].getBBox&&(r=e[0].getBBox())}}return r&&(r=function({x:e,y:t,width:n,height:r}){return{x:e,y:t,width:n,height:r}}(r)),r},Wt=function(e){let t="";return wt.each(e,function(e,[n,r]){t+=n;for(let e=0;e<r.length;e+=2)t+=r[e]+","+r[e+1]+" "}),t},Qt=function(e){let t,n,r,i,a=1.81;switch(e.tagName){case"ellipse":case"circle":{n=wt(e).attr(["rx","ry","cx","cy"]);const{cx:s,cy:o}=n;({rx:r,ry:i}=n),"circle"===e.tagName&&(r=i=wt(e).attr("r")),t=Wt([["M",[s-r,o]],["C",[s-r,o-i/a,s-r/a,o-i,s,o-i]],["C",[s+r/a,o-i,s+r,o-i/a,s+r,o]],["C",[s+r,o+i/a,s+r/a,o+i,s,o+i]],["C",[s-r/a,o+i,s-r,o+i/a,s-r,o]],["Z",[]]]);break}case"path":t=e.getAttribute("d");break;case"line":t="M"+(n=wt(e).attr(["x1","y1","x2","y2"])).x1+","+n.y1+"L"+n.x2+","+n.y2;break;case"polyline":t="M"+e.getAttribute("points");break;case"polygon":t="M"+e.getAttribute("points")+" Z";break;case"rect":{const n=wt(e).attr(["rx","ry"]);({rx:r,ry:i}=n);const s=e.getBBox(),{x:o,y:l}=s,c=s.width,u=s.height;a=4-a,t=Wt(r||i?[["M",[o,l+i]],["C",[o,l+i/a,o+r/a,l,o+r,l]],["L",[o+c-r,l]],["C",[o+c-r/a,l,o+c,l+i/a,o+c,l+i]],["L",[o+c,l+u-i]],["C",[o+c,l+u-i/a,o+c-r/a,l+u,o+c-r,l+u]],["L",[o+r,l+u]],["C",[o+r/a,l+u,o,l+u-i/a,o,l+u-i]],["L",[o,l+i]],["Z",[]]]:[["M",[o,l]],["L",[o+c,l]],["L",[o+c,l+u]],["L",[o,l+u]],["L",[o,l]],["Z",[]]]);break}}return t},Kt=function(e){const t={};return wt.each(["marker-start","marker-end","marker-mid","filter","clip-path"],function(){const n=e.getAttribute(this);n&&(t[this]=n)}),t},Zt=function(e,t,n){const r=t({element:"path",attr:Kt(e)}),i=e.getAttribute("transform");i&&r.setAttribute("transform",i);const{parentNode:a}=e;e.nextSibling?e.before(r):a.append(r);const s=Qt(e);s?r.setAttribute("d",s):r.remove(),n.resetOrientation(r);let o=!1;try{o=r.getBBox()}catch(e){}return r.remove(),o},Jt=function(e,t,n,r,i,a,s,o){const l=new s.BatchCommand("Convert element to Path"),c=n({element:"path",attr:t=wt.extend({},t,Kt(e))}),u=e.getAttribute("transform");u&&c.setAttribute("transform",u);const{id:d}=e,{parentNode:h}=e;e.nextSibling?e.before(c):h.append(c);const p=Qt(e);if(p){if(c.setAttribute("d",p),u){const e=ie(c);Pe(e)&&r.resetOrientation(c)}const{nextSibling:t}=e;return l.addSubCommand(new s.RemoveElementCommand(e,t,parent)),l.addSubCommand(new s.InsertElementCommand(c)),i(),e.remove(),c.setAttribute("id",d),c.removeAttribute("visibility"),a([c],!0),o(l),c}return c.remove(),null};const en=function(e,t,n){let r=Xt(e);if(!r)return null;const i=ie(e),a=sn(i),s=Pe(i);if(a||s){let o=!1;if(function(e,t){const n=e%90;return t||!(n>-.001&&n<.001||n<-89.99||n>89.99)}(a,s)){if(["ellipse","path","line","polyline","polygon"].includes(e.tagName))r=o=Zt(e,t,n);else if("rect"===e.tagName){const i=e.getAttribute("rx"),a=e.getAttribute("ry");(i||a)&&(r=o=Zt(e,t,n))}}if(!o){const{matrix:e}=Ne(i);r=Ie(r.x,r.y,r.width,r.height,e).aabox}}return r};function tn(e){const t=e.getAttribute("stroke-width");return isNaN(t)||"none"===e.getAttribute("stroke")?0:t/2}const nn=function(e,t,n){if(!e||!e.length)return!1;let r;if(wt.each(e,function(){r||this.parentNode&&(r=en(this,t,n))}),void 0===r)return null;let i=r.x+r.width,a=r.y+r.height,s=r.x,o=r.y;if(1===e.length){const t=tn(e[0]);s-=t,o-=t,i+=t,a+=t}else wt.each(e,function(e,r){const l=en(r,t,n);if(l){const e=tn(r);s=Math.min(s,l.x-e),o=Math.min(o,l.y-e),1===r.nodeType&&(i=Math.max(i,l.x+l.width+e),a=Math.max(a,l.y+l.height+e))}});return r.x=s,r.y=o,r.width=i-s,r.height=a-o,r},rn=function(e){e||(e=wt(Ct.getSVGContent()).children());const t=[];return wt(e).children().each(function(e,n){n.getBBox&&t.push(n)}),t.reverse()},an=function(e){return e||(e=rn()),nn(e,Ct.addSVGElementFromJson,Ct.pathActions)},sn=function(e,t){if(!e)return 0;const n=e.numberOfItems;for(let r=0;r<n;++r){const n=e.getItem(r);if(4===n.type)return t?n.angle*Math.PI/180:n.angle}return 0};let on=function(e,t){const n=e||Ct.getSelectedElements()[0],r=ie(n);return sn(r,t)};const ln=function(e){return cn(Ft(e).substr(1))},cn=(()=>N)()?function(e){return Gt.querySelector("#"+e)}:(()=>T)()?function(e){return At.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+e+'"]',Et,function(){return v.SVG},9,null).singleNodeValue}:function(e){return wt(Gt).find("[id="+e+"]")[0]},un=function(e,t,n,r){for(const[n,i]of Object.entries(t)){const t="xml:"===n.substr(0,4)?v.XML:"xlink:"===n.substr(0,6)?v.XLINK:null;t?e.setAttributeNS(t,n,i):r?fe(e,n,i):e.setAttribute(n,i)}},dn=function(e){const t={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter","stroke-linecap":"butt","stroke-opacity":1,"stroke-width":1,rx:0,ry:0};"ellipse"===e.nodeName&&(delete t.rx,delete t.ry),Object.entries(t).forEach(([t,n])=>{e.getAttribute(t)===String(n)&&e.removeAttribute(t)})},hn=function(e){const t=Ct.getBaseUnit();let n=Ct.getSnappingStep();return"px"!==t&&(n*=de()[t]),e=Math.round(e/n)*n},pn=function(e){wt(e).click(function(e){e.preventDefault()})},fn=function(e,t){const n=document.createElementNS(e.namespaceURI,e.nodeName);if(wt.each(e.attributes,function(e,t){"-moz-math-font-style"!==t.localName&&n.setAttributeNS(t.namespaceURI,t.nodeName,t.value)}),n.removeAttribute("id"),n.id=t(),U()&&"path"===e.nodeName){const t=vt(e);n.setAttribute("d",t)}if(wt.each(e.childNodes,function(e,r){switch(r.nodeType){case 1:n.append(fn(r,t));break;case 3:n.textContent=r.nodeValue}}),wt(e).data("gsvg"))wt(n).data("gsvg",n.firstChild);else if(wt(e).data("symbol")){const t=wt(e).data("symbol");wt(n).data("ref",t).data("symbol",t)}else"image"===n.tagName&&pn(n);return n},gn=e=>null==e,mn=jQuery;let _n={};const yn=function(){Object.values(_n).forEach(e=>{!function(e){Object.keys(_n).length||mn("#cmenu_canvas").append("<li class='separator'>");const t=e.shortcut||"";mn("#cmenu_canvas").append("<li class='disabled'><a href='#"+e.id+"'>"+e.label+"<span class='shortcut'>"+t+"</span></a></li>")}(e)})};function vn(e,t){["id","class","type"].forEach(n=>{n in t&&(e[n]=t[n])})}function bn(e,t){return xn(e,{...t,returnDefault:!0})}async function xn(e,{global:t,returnDefault:n}){return"svgEditor"in window&&window.svgEditor&&!1===window.svgEditor.modules?(await wn(e),window[t]):Sn(e,void 0,{returnDefault:n})}function wn(e,t={}){return Array.isArray(e)?Promise.all(e.map(e=>wn(e,t))):new Promise((n,r)=>{const i=document.createElement("script");function a(){r(new Error(`Failed to import: ${e}`)),o()}function s(){n(),o()}const o=()=>{i.removeEventListener("error",a),i.removeEventListener("load",s),i.remove(),i.src=""};i.defer="defer",vn(i,t),i.addEventListener("error",a),i.addEventListener("load",s),i.src=e,document.head.append(i)})}function Sn(e,t={},{returnDefault:n=!1}={}){return Array.isArray(e)?Promise.all(e.map(e=>Sn(e,t))):new Promise((r,i)=>{const a="$importModule$"+Math.random().toString(32).slice(2),s=document.createElement("script");function o(){i(new Error(`Failed to import: ${e}`)),c()}function l(){r(window[a]),c()}const c=()=>{delete window[a],s.removeEventListener("error",o),s.removeEventListener("load",l),s.remove(),URL.revokeObjectURL(s.src),s.src=""};vn(s,t),s.defer="defer",s.type="module",s.addEventListener("error",o),s.addEventListener("load",l);const u=`import * as m from '${function(e){const t=document.createElement("a");return t.setAttribute("href",e),t.cloneNode(!1).href}(e).replace(/'/g,"\\'")}'; window.${a} = ${n?"m.default || ":""}m;`,d=new Blob([u],{type:"text/javascript"});s.src=URL.createObjectURL(d),document.head.append(s)})}function kn(e,t={ok:"Ok",cancel:"Cancel"}){e("#dialog_container").draggable({cancel:"#dialog_content, #dialog_buttons *",containment:"window"}).css("position","absolute");const n=e("#dialog_box"),r=e("#dialog_buttons"),i=e("#dialog_content");function a(a,s,o,l,c,u){i.html("<p>"+s.replace(/\n/g,"</p><p>")+"</p>").toggleClass("prompt","prompt"===a),r.empty();const d=e('<input type="button" value="'+t.ok+'">').appendTo(r);return new Promise((s,h)=>{let p,f;if("alert"!==a&&e('<input type="button" value="'+t.cancel+'">').appendTo(r).click(function(){n.hide(),s(!1)}),"prompt"===a)(p=e('<input type="text">').prependTo(r)).val(o||""),p.bind("keydown","return",function(){d.click()});else if("select"===a){const t=e('<div style="text-align:center;">');if(p=e("<select>").appendTo(t),u){const n=e("<label>").text(u.label);(f=e('<input type="checkbox">').appendTo(n)).val(u.value),u.tooltip&&n.attr("title",u.tooltip),f.prop("checked",Boolean(u.checked)),t.append(e("<div>").append(n))}e.each(l||[],function(t,n){"object"==typeof n?p.append(e("<option>").val(n.value).html(n.text)):p.append(e("<option>").html(n))}),i.append(t),o&&p.val(o),c&&p.bind("change","return",c),p.bind("keydown","return",function(){d.click()})}else"process"===a&&d.hide();n.show(),d.click(function(){n.hide();const e="prompt"!==a&&"select"!==a||p.val();s(f?{response:e,checked:f.prop("checked")}:e)}).focus(),"prompt"!==a&&"select"!==a||p.focus()})}return e.alert=function(e){return a("alert",e)},e.confirm=function(e){return a("confirm",e)},e.process_cancel=function(e){return a("process",e)},e.prompt=function(e,t=""){return a("prompt",e,t)},e.select=function(e,t,n,r,i){return a("select",e,r,t,n,i)},e}
/**
 * Provides tools for the layer concept
 * @module layer
 * @license MIT
 *
 * @copyright 2011 Jeff Schiller, 2016 Flint O'Brien
 */const Cn=jQuery;class An{constructor(e,t,n){if(this.name_=e,this.group_=n?null:t,n){const r=n.ownerDocument;this.group_=r.createElementNS(v.SVG,"g");const i=r.createElementNS(v.SVG,"title");i.textContent=e,this.group_.append(i),t?Cn(t).after(this.group_):n.append(this.group_)}!function(e){const t=e.getAttribute("class");gn(t)||!t.length?e.setAttribute("class",An.CLASS_NAME):An.CLASS_REGEX.test(t)||e.setAttribute("class",t+" "+An.CLASS_NAME)}(this.group_),Dt(this.group_,function(e){e.setAttribute("style","pointer-events:inherit")}),this.group_.setAttribute("style",n?"pointer-events:all":"pointer-events:none")}getName(){return this.name_}getGroup(){return this.group_}activate(){this.group_.setAttribute("style","pointer-events:all")}deactivate(){this.group_.setAttribute("style","pointer-events:none")}setVisible(e){const t=void 0===e||e?"inline":"none";this.group_.getAttribute("display")!==t&&this.group_.setAttribute("display",t)}isVisible(){return"none"!==this.group_.getAttribute("display")}getOpacity(){const e=this.group_.getAttribute("opacity");return gn(e)?1:parseFloat(e)}setOpacity(e){"number"==typeof e&&e>=0&&e<=1&&this.group_.setAttribute("opacity",e)}appendChildren(e){for(let t=0;t<e.length;++t)this.group_.append(e[t])}getTitleElement(){const e=this.group_.childNodes.length;for(let t=0;t<e;++t){const e=this.group_.childNodes.item(t);if(e&&"title"===e.tagName)return e}return null}setName(e,t){const n=this.name_;e=Nt(e);const r=this.getTitleElement();return r?(Cn(r).empty(),r.textContent=e,this.name_=e,t&&t.changeElement(r,{"#text":n}),this.name_):null}removeGroup(){const e=this.group_.parentNode.removeChild(this.group_);return this.group_=void 0,e}}An.CLASS_NAME="layer",An.CLASS_REGEX=new RegExp("(\\s|^)"+An.CLASS_NAME+"(\\s|$)");var En=An;
/**
 * HistoryRecordingService component of history
 * @module history
 * @license MIT
 * @copyright 2016 Flint O'Brien
 */class Gn{constructor(e){this.undoManager_=e,this.currentBatchCommand_=null,this.batchCommandStack_=[]}startBatchCommand(e){return this.undoManager_?(this.currentBatchCommand_=new Se(e),this.batchCommandStack_.push(this.currentBatchCommand_),this):this}endBatchCommand(){if(!this.undoManager_)return this;if(this.currentBatchCommand_){const e=this.currentBatchCommand_;this.batchCommandStack_.pop();const{length:t}=this.batchCommandStack_;this.currentBatchCommand_=t?this.batchCommandStack_[t-1]:null,this.addCommand_(e)}return this}moveElement(e,t,n,r){return this.undoManager_?(this.addCommand_(new ve(e,t,n,r)),this):this}insertElement(e,t){return this.undoManager_?(this.addCommand_(new be(e,t)),this):this}removeElement(e,t,n,r){return this.undoManager_?(this.addCommand_(new xe(e,t,n,r)),this):this}changeElement(e,t,n){return this.undoManager_?(this.addCommand_(new we(e,t,n)),this):this}addCommand_(e){if(!this.undoManager_)return this;this.currentBatchCommand_?this.currentBatchCommand_.addSubCommand(e):this.undoManager_.addCommandToHistory(e)}}Gn.NO_HISTORY=new Gn;var Pn=Gn;
/**
 * Tools for drawing
 * @module draw
 * @license MIT
 * @copyright 2011 Jeff Schiller
 */const In=jQuery,Nn="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),Tn={LET_DOCUMENT_DECIDE:0,ALWAYS_RANDOMIZE:1,NEVER_RANDOMIZE:2};let Ln=Tn.LET_DOCUMENT_DECIDE,Mn=[];function On(e){return e||new Pn(Bn.undoMgr)}function jn(e){let t=1;for(;e.includes("Layer "+t);)t++;return"Layer "+t}class Vn{constructor(e,t){if(!e||!e.tagName||!e.namespaceURI||"svg"!==e.tagName||e.namespaceURI!==v.SVG)throw new Error("Error: svgedit.draw.Drawing instance initialized without a <svg> element");this.svgElem_=e,this.obj_num=0,this.idPrefix=t||"svg_",this.releasedNums=[],this.all_layers=[],this.layer_map={},this.current_layer=null,this.nonce_="";const n=this.svgElem_.getAttributeNS(v.SE,"nonce");n&&Ln!==Tn.NEVER_RANDOMIZE?this.nonce_=n:Ln===Tn.ALWAYS_RANDOMIZE&&this.setNonce(Math.floor(100001*Math.random()))}getElem_(e){return this.svgElem_.querySelector?this.svgElem_.querySelector("#"+e):In(this.svgElem_).find("[id="+e+"]")[0]}getSvgElem(){return this.svgElem_}getNonce(){return this.nonce_}setNonce(e){this.svgElem_.setAttributeNS(v.XMLNS,"xmlns:se",v.SE),this.svgElem_.setAttributeNS(v.SE,"se:nonce",e),this.nonce_=e}clearNonce(){this.nonce_=""}getId(){return this.nonce_?this.idPrefix+this.nonce_+"_"+this.obj_num:this.idPrefix+this.obj_num}getNextId(){const e=this.obj_num;let t=!1;this.releasedNums.length>0?(this.obj_num=this.releasedNums.pop(),t=!0):this.obj_num++;let n=this.getId();for(;this.getElem_(n);)t&&(this.obj_num=e,t=!1),this.obj_num++,n=this.getId();return t&&(this.obj_num=e),n}releaseId(e){const t=this.idPrefix+(this.nonce_?this.nonce_+"_":"");if("string"!=typeof e||!e.startsWith(t))return!1;const n=parseInt(e.substr(t.length));return!("number"!=typeof n||n<=0||this.releasedNums.includes(n))&&(this.releasedNums.push(n),!0)}getNumLayers(){return this.all_layers.length}hasLayer(e){return void 0!==this.layer_map[e]}getLayerName(e){return e>=0&&e<this.getNumLayers()?this.all_layers[e].getName():""}getCurrentLayer(){return this.current_layer?this.current_layer.getGroup():null}getLayerByName(e){const t=this.layer_map[e];return t?t.getGroup():null}getCurrentLayerName(){return this.current_layer?this.current_layer.getName():""}setCurrentLayerName(e,t){let n=null;if(this.current_layer){const r=this.current_layer.getName();(n=this.current_layer.setName(e,t))&&(delete this.layer_map[r],this.layer_map[n]=this.current_layer)}return n}setCurrentLayerPosition(e){const t=this.getNumLayers();if(!this.current_layer||e<0||e>=t)return null;let n;for(n=0;n<t&&this.all_layers[n]!==this.current_layer;++n);if(n===t)return null;if(n!==e){const r=this.current_layer.getGroup(),i=r.nextSibling;let a=null;return e>n?e<t-1&&(a=this.all_layers[e+1].getGroup()):a=this.all_layers[e].getGroup(),this.svgElem_.insertBefore(r,a),this.identifyLayers(),this.setCurrentLayer(this.getLayerName(e)),{currentGroup:r,oldNextSibling:i}}return null}mergeLayer(e){const t=this.current_layer.getGroup(),n=In(t).prev()[0];if(!n)return;e.startBatchCommand("Merge Layer");const r=t.nextSibling;for(e.removeElement(t,r,this.svgElem_);t.firstChild;){const r=t.firstChild;if("title"===r.localName){e.removeElement(r,r.nextSibling,t),r.remove();continue}const i=r.nextSibling;n.append(r),e.moveElement(r,i,t)}this.current_layer.removeGroup();const i=this.all_layers.indexOf(this.current_layer);if(i>0){const e=this.current_layer.getName();this.current_layer=this.all_layers[i-1],this.all_layers.splice(i,1),delete this.layer_map[e]}e.endBatchCommand()}mergeAllLayers(e){for(this.current_layer=this.all_layers[this.all_layers.length-1],e.startBatchCommand("Merge all Layers");this.all_layers.length>1;)this.mergeLayer(e);e.endBatchCommand()}setCurrentLayer(e){const t=this.layer_map[e];return!!t&&(this.current_layer&&this.current_layer.deactivate(),this.current_layer=t,this.current_layer.activate(),!0)}deleteCurrentLayer(){if(this.current_layer&&this.getNumLayers()>1){const e=this.current_layer.removeGroup();return this.identifyLayers(),e}return null}identifyLayers(){this.all_layers=[],this.layer_map={};const e=this.svgElem_.childNodes.length,t=[],n=[];let r=null,i=!1;for(let s=0;s<e;++s){const e=this.svgElem_.childNodes.item(s);if(e&&1===e.nodeType)if("g"===e.tagName){i=!0;const s=In("title",a=e).text()||(D()&&a.querySelectorAll?In(a.querySelectorAll("title")).text():"");s?(n.push(s),r=new En(s,e),this.all_layers.push(r),this.layer_map[s]=r):t.push(e)}else Nn.includes(e.nodeName)&&t.push(e)}var a;t.length>0||!i?((r=new En(jn(n),null,this.svgElem_)).appendChildren(t),this.all_layers.push(r),this.layer_map[name]=r):r.activate(),this.current_layer=r}createLayer(e,t){this.current_layer&&this.current_layer.deactivate(),(null==e||""===e||this.layer_map[e])&&(e=jn(Object.keys(this.layer_map)));const n=new En(e,null,this.svgElem_);return t&&(t.startBatchCommand("Create Layer"),t.insertElement(n.getGroup()),t.endBatchCommand()),this.all_layers.push(n),this.layer_map[e]=n,this.current_layer=n,n.getGroup()}cloneLayer(e,t){if(!this.current_layer)return null;this.current_layer.deactivate(),(null==e||""===e||this.layer_map[e])&&(e=jn(Object.keys(this.layer_map)));const n=this.current_layer.getGroup(),r=new En(e,n,this.svgElem_),i=r.getGroup(),a=n.childNodes;for(let e=0;e<a.length;e++){const t=a[e];"title"!==t.localName&&i.append(this.copyElem(t))}t&&(t.startBatchCommand("Duplicate Layer"),t.insertElement(i),t.endBatchCommand());const s=this.all_layers.indexOf(this.current_layer);return s>=0?this.all_layers.splice(s+1,0,r):this.all_layers.push(r),this.layer_map[e]=r,this.current_layer=r,i}getLayerVisibility(e){const t=this.layer_map[e];return!!t&&t.isVisible()}setLayerVisibility(e,t){if("boolean"!=typeof t)return null;const n=this.layer_map[e];return n?(n.setVisible(t),n.getGroup()):null}getLayerOpacity(e){const t=this.layer_map[e];return t?t.getOpacity():null}setLayerOpacity(e,t){if("number"!=typeof t||t<0||t>1)return;const n=this.layer_map[e];n&&n.setOpacity(t)}copyElem(e){const t=this;return fn(e,function(){return t.getNextId()})}}const Rn=function(e,t){(Ln=!1===e?Tn.NEVER_RANDOMIZE:Tn.ALWAYS_RANDOMIZE)!==Tn.ALWAYS_RANDOMIZE||t.getNonce()?Ln===Tn.NEVER_RANDOMIZE&&t.getNonce()&&t.clearNonce():t.setNonce(Math.floor(100001*Math.random()))};let Bn;const Dn=function(e){Bn=e},Un=function(){Zn(),Bn.getCurrentDrawing().identifyLayers()},Fn=function(e,t){const n=Bn.getCurrentDrawing().createLayer(e,On(t));Bn.clearSelection(),Bn.call("changed",[n])},Hn=function(e,t){const n=Bn.getCurrentDrawing().cloneLayer(e,On(t));Bn.clearSelection(),Zn(),Bn.call("changed",[n])},zn=function(){let e=Bn.getCurrentDrawing().getCurrentLayer();const{nextSibling:t}=e,n=e.parentNode;if(e=Bn.getCurrentDrawing().deleteCurrentLayer()){const r=new Se("Delete Layer");return r.addSubCommand(new xe(e,t,n)),Bn.addCommandToHistory(r),Bn.clearSelection(),Bn.call("changed",[n]),!0}return!1},qn=function(e){const t=Bn.getCurrentDrawing().setCurrentLayer(Nt(e));return t&&Bn.clearSelection(),t},$n=function(e){const t=Bn.getCurrentDrawing(),n=t.getCurrentLayer();if(n){if(t.setCurrentLayerName(e,On()))return Bn.call("changed",[n]),!0}return!1},Yn=function(e){const t=Bn.getCurrentDrawing().setCurrentLayerPosition(e);return!!t&&(Bn.addCommandToHistory(new ve(t.currentGroup,t.oldNextSibling,Bn.getSVGContent())),!0)},Xn=function(e,t){const n=Bn.getCurrentDrawing(),r=n.getLayerVisibility(e),i=n.setLayerVisibility(e,t);if(!i)return!1;{const e=r?"inline":"none";Bn.addCommandToHistory(new we(i,{display:e},"Layer Visibility"))}return i===n.getCurrentLayer()&&(Bn.clearSelection(),Bn.pathActions.clear()),!0},Wn=function(e){const t=Bn.getCurrentDrawing().getLayerByName(e);if(!t)return!1;const n=new Se("Move Elements to Layer"),r=Bn.getSelectedElements();let i=r.length;for(;i--;){const e=r[i];if(!e)continue;const a=e.nextSibling,s=e.parentNode;t.append(e),n.addSubCommand(new ve(e,a,s))}return Bn.addCommandToHistory(n),!0},Qn=function(e){Bn.getCurrentDrawing().mergeLayer(On(e)),Bn.clearSelection(),Zn(),Bn.changeSVGContent()},Kn=function(e){Bn.getCurrentDrawing().mergeAllLayers(On(e)),Bn.clearSelection(),Zn(),Bn.changeSVGContent()},Zn=function(){const e=Mn.length;if(e){for(let t=0;t<e;t++){const e=Mn[t],n=Bn.elData(e,"orig_opac");1!==n?e.setAttribute("opacity",n):e.removeAttribute("opacity"),e.setAttribute("style","pointer-events: inherit")}Mn=[],Bn.clearSelection(!0),Bn.call("contextset",null)}Bn.setCurrentGroup(null)},Jn=function(e){Zn(),"string"==typeof e&&(e=cn(e)),Bn.setCurrentGroup(e),In(e).parentsUntil("#svgcontent").andSelf().siblings().each(function(){const e=this.getAttribute("opacity")||1;Bn.elData(this,"orig_opac",e),this.setAttribute("opacity",.33*e),this.setAttribute("style","pointer-events: none"),Mn.push(this)}),Bn.clearSelection(),Bn.call("contextset",Bn.getCurrentGroup())},er=b(),tr={a:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","mask","opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","xlink:href","xlink:title"],circle:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","r","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],clipPath:["class","clipPathUnits","id"],defs:[],style:["type"],desc:[],ellipse:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],feGaussianBlur:["class","color-interpolation-filters","id","requiredFeatures","stdDeviation"],filter:["class","color-interpolation-filters","filterRes","filterUnits","height","id","primitiveUnits","requiredFeatures","width","x","xlink:href","y"],foreignObject:["class","font-size","height","id","opacity","requiredFeatures","style","transform","width","x","y"],g:["class","clip-path","clip-rule","id","display","fill","fill-opacity","fill-rule","filter","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","font-family","font-size","font-style","font-weight","text-anchor"],image:["class","clip-path","clip-rule","filter","height","id","mask","opacity","requiredFeatures","style","systemLanguage","transform","width","x","xlink:href","xlink:title","y"],line:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","x1","x2","y1","y2"],linearGradient:["class","id","gradientTransform","gradientUnits","requiredFeatures","spreadMethod","systemLanguage","x1","x2","xlink:href","y1","y2"],marker:["id","class","markerHeight","markerUnits","markerWidth","orient","preserveAspectRatio","refX","refY","systemLanguage","viewBox"],mask:["class","height","id","maskContentUnits","maskUnits","width","x","y"],metadata:["class","id"],path:["class","clip-path","clip-rule","d","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],pattern:["class","height","id","patternContentUnits","patternTransform","patternUnits","requiredFeatures","style","systemLanguage","viewBox","width","x","xlink:href","y"],polygon:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","id","class","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],polyline:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],radialGradient:["class","cx","cy","fx","fy","gradientTransform","gradientUnits","id","r","requiredFeatures","spreadMethod","systemLanguage","xlink:href"],rect:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","width","x","y"],stop:["class","id","offset","requiredFeatures","stop-color","stop-opacity","style","systemLanguage"],svg:["class","clip-path","clip-rule","filter","id","height","mask","preserveAspectRatio","requiredFeatures","style","systemLanguage","viewBox","width","x","xmlns","xmlns:se","xmlns:xlink","y"],switch:["class","id","requiredFeatures","systemLanguage"],symbol:["class","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","opacity","preserveAspectRatio","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","viewBox"],text:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","transform","x","xml:space","y"],textPath:["class","id","method","requiredFeatures","spacing","startOffset","style","systemLanguage","transform","xlink:href"],title:[],tspan:["class","clip-path","clip-rule","dx","dy","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","rotate","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","textLength","transform","x","xml:space","y"],use:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","transform","width","x","xlink:href","y"],annotation:["encoding"],"annotation-xml":["encoding"],maction:["actiontype","other","selection"],math:["class","id","display","xmlns"],menclose:["notation"],merror:[],mfrac:["linethickness"],mi:["mathvariant"],mmultiscripts:[],mn:[],mo:["fence","lspace","maxsize","minsize","rspace","stretchy"],mover:[],mpadded:["lspace","width","height","depth","voffset"],mphantom:[],mprescripts:[],mroot:[],mrow:["xlink:href","xlink:type","xmlns:xlink"],mspace:["depth","height","width"],msqrt:[],mstyle:["displaystyle","mathbackground","mathcolor","mathvariant","scriptlevel"],msub:[],msubsup:[],msup:[],mtable:["align","columnalign","columnlines","columnspacing","displaystyle","equalcolumns","equalrows","frame","rowalign","rowlines","rowspacing","width"],mtd:["columnalign","columnspan","rowalign","rowspan"],mtext:[],mtr:["columnalign","rowalign"],munder:[],munderover:[],none:[],semantics:[]},nr={};Object.entries(tr).forEach(function([e,t]){const n={};Object.entries(t).forEach(function([e,t]){if(t.includes(":")){const e=t.split(":");n[e[1]]=v[e[0].toUpperCase()]}else n[t]="xmlns"===t?v.XMLNS:null}),nr[e]=n});const rr=function(e){if(3===e.nodeType&&(e.nodeValue=e.nodeValue.replace(/^\s+|\s+$/g,""),e.nodeValue.length||e.remove()),1!==e.nodeType)return;const t=e.ownerDocument,n=e.parentNode;if(!t||!n)return;const r=tr[e.nodeName],i=nr[e.nodeName];if(void 0!==r){const t=[];let n=e.attributes.length;for(;n--;){const a=e.attributes.item(n),s=a.nodeName,o=a.localName,l=a.namespaceURI;if({}.hasOwnProperty.call(i,o)&&l===i[o]&&l!==v.XMLNS||l===v.XMLNS&&er[a.value]||((s.startsWith("se:")||s.startsWith("data-"))&&t.push([s,a.value]),e.removeAttributeNS(l,o)),F())switch(s){case"transform":case"gradientTransform":case"patternTransform":{const t=a.value.replace(/(\d)-/g,"$1 -");e.setAttribute(s,t);break}}if("style"===s){const t=a.value.split(";");let n=t.length;for(;n--;){const[i,a]=t[n].split(":"),s=(i||"").trim(),o=(a||"").trim();r.includes(s)&&e.setAttribute(s,o)}e.removeAttribute("style")}}Object.values(t).forEach(([t,n])=>{e.setAttributeNS(v.SE,t,n)});const a=Ht(e);if(a&&["filter","linearGradient","pattern","radialGradient","textPath","use"].includes(e.nodeName)&&"#"!==a[0]&&(zt(e,""),e.removeAttributeNS(v.XLINK,"href")),"use"===e.nodeName&&!Ht(e))return void e.remove();for(Object.values(["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],function(t){let n=e.getAttribute(t);n&&(n=Ft(n))&&"#"!==n[0]&&(e.setAttribute(t,""),e.removeAttribute(t))}),n=e.childNodes.length;n--;)rr(e.childNodes.item(n))}else{const t=[];for(;e.hasChildNodes();)t.push(n.insertBefore(e.firstChild,e));e.remove();let r=t.length;for(;r--;)rr(t[r])}},ir=jQuery,ar=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"];
/**
 * Manipulating coordinates
 * @module coords
 * @license MIT
 */let sr=null;const or=function(e){sr=e},lr=function(e,t,n){const r=function(e,t){return Ae(e,t,n)},i=function(e){return n.a*e},a=function(e){return n.d*e},s=sr.getGridSnapping()&&"svg"===e.parentNode.parentNode.localName,o=function(){s&&Object.entries(t).forEach(([e,n])=>{t[e]=hn(n)}),un(e,t,1e3,!0)},l=Xt(e);for(let t=0;t<2;t++){const r=0===t?"fill":"stroke",i=e.getAttribute(r);if(i&&i.startsWith("url(")&&(n.a<0||n.d<0)){const t=ln(i).cloneNode(!0);if(n.a<0){const e=t.getAttribute("x1"),n=t.getAttribute("x2");t.setAttribute("x1",-(e-1)),t.setAttribute("x2",-(n-1))}if(n.d<0){const e=t.getAttribute("y1"),n=t.getAttribute("y2");t.setAttribute("y1",-(e-1)),t.setAttribute("y2",-(n-1))}t.id=sr.getDrawing().getNextId(),qt().append(t),e.setAttribute(r,"url(#"+t.id+")")}}const c=e.tagName;if("g"===c||"text"===c||"tspan"===c||"use"===c)if(1!==n.a||0!==n.b||0!==n.c||1!==n.d||0===n.e&&0===n.f){const t=ie(e),r=sr.getSVGRoot().createSVGTransform();r.setMatrix(Ge(Ne(t).matrix,n)),t.clear(),t.appendItem(r)}else{const r=Ne(e).matrix,i=Ge(r.inverse(),n,r);t.x=parseFloat(t.x)+i.e,t.y=parseFloat(t.y)+i.f}switch(c){case"foreignObject":case"rect":case"image":if("image"===c&&(n.a<0||n.d<0)){const t=ie(e),r=sr.getSVGRoot().createSVGTransform();r.setMatrix(Ge(Ne(t).matrix,n)),t.clear(),t.appendItem(r)}else{const e=r(t.x,t.y);t.width=i(t.width),t.height=a(t.height),t.x=e.x+Math.min(0,t.width),t.y=e.y+Math.min(0,t.height),t.width=Math.abs(t.width),t.height=Math.abs(t.height)}o();break;case"ellipse":{const e=r(t.cx,t.cy);t.cx=e.x,t.cy=e.y,t.rx=i(t.rx),t.ry=a(t.ry),t.rx=Math.abs(t.rx),t.ry=Math.abs(t.ry),o();break}case"circle":{const e=r(t.cx,t.cy);t.cx=e.x,t.cy=e.y;const i=Ie(l.x,l.y,l.width,l.height,n),a=i.tr.x-i.tl.x,s=i.bl.y-i.tl.y;t.r=Math.min(a/2,s/2),t.r&&(t.r=Math.abs(t.r)),o();break}case"line":{const e=r(t.x1,t.y1),n=r(t.x2,t.y2);t.x1=e.x,t.y1=e.y,t.x2=n.x,t.y2=n.y}case"text":case"tspan":case"use":o();break;case"g":{const n=ir(e).data("gsvg");n&&un(n,t,1e3,!0);break}case"polyline":case"polygon":{const n=t.points.length;for(let e=0;e<n;++e){const n=t.points[e],{x:i,y:a}=r(n.x,n.y);t.points[e].x=i,t.points[e].y=a}let i="";for(let e=0;e<n;++e){const n=t.points[e];i+=n.x+","+n.y+" "}e.setAttribute("points",i);break}case"path":{const n=e.pathSegList;let s=n.numberOfItems;t.d=[];for(let e=0;e<s;++e){const r=n.getItem(e);t.d[e]={type:r.pathSegType,x:r.x,y:r.y,x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,r1:r.r1,r2:r.r2,angle:r.angle,largeArcFlag:r.largeArcFlag,sweepFlag:r.sweepFlag}}s=t.d.length;const o=t.d[0],l=r(o.x,o.y);t.d[0].x=l.x,t.d[0].y=l.y;for(let e=1;e<s;++e){const n=t.d[e],{type:s}=n;if(s%2==0){const e=r(void 0!==n.x?n.x:l.x,void 0!==n.y?n.y:l.y),t=r(n.x1,n.y1),s=r(n.x2,n.y2);n.x=e.x,n.y=e.y,n.x1=t.x,n.y1=t.y,n.x2=s.x,n.y2=s.y,n.r1=i(n.r1),n.r2=a(n.r2)}else n.x=i(n.x),n.y=a(n.y),n.x1=i(n.x1),n.y1=a(n.y1),n.x2=i(n.x2),n.y2=a(n.y2),n.r1=i(n.r1),n.r2=a(n.r2)}let c="";s=t.d.length;for(let e=0;e<s;++e){const n=t.d[e],{type:r}=n;switch(c+=ar[r],r){case 13:case 12:c+=n.x+" ";break;case 15:case 14:c+=n.y+" ";break;case 3:case 5:case 19:case 2:case 4:case 18:c+=n.x+","+n.y+" ";break;case 7:case 6:c+=n.x1+","+n.y1+" "+n.x2+","+n.y2+" "+n.x+","+n.y+" ";break;case 9:case 8:c+=n.x1+","+n.y1+" "+n.x+","+n.y+" ";break;case 11:case 10:c+=n.r1+","+n.r2+" "+n.angle+" "+Number(n.largeArcFlag)+" "+Number(n.sweepFlag)+" "+n.x+","+n.y+" ";break;case 17:case 16:c+=n.x2+","+n.y2+" "+n.x+","+n.y+" "}}e.setAttribute("d",c);break}}},cr=K(jQuery);let ur;const dr=function(e){ur=e},hr=function(e,t,n){const r=ln(e).firstChild,i=ie(r),a=ur.getSVGRoot().createSVGTransform();a.setTranslate(t,n),i.appendItem(a),pr(r)},pr=function(e){if(gn(e))return null;if("svg"===e.nodeName&&navigator.userAgent.includes("Firefox/20"))return null;const t=ur.getSVGRoot(),n=ie(e);if(n&&n.numberOfItems>0){let t=n.numberOfItems;const r=t;for(;t--;){const i=n.getItem(t);if(0===i.type)n.removeItem(t);else if(1===i.type){if(Ee(i.matrix)){if(1===r)return e.removeAttribute("transform"),null;n.removeItem(t)}}else 4===i.type&&0===i.angle&&n.removeItem(t)}if(1===n.numberOfItems&&on(e))return null}if(!n||0===n.numberOfItems)return e.setAttribute("transform",""),e.removeAttribute("transform"),null;if(n){let e=[],r=n.numberOfItems;for(;r--;){const t=n.getItem(r);1===t.type?e.push([t.matrix,r]):e.length&&(e=[])}if(2===e.length){const r=t.createSVGTransformFromMatrix(Ge(e[1][0],e[0][0]));n.removeItem(e[0][1]),n.removeItem(e[1][1]),n.insertItemBefore(r,e[1][1])}if((r=n.numberOfItems)>=2&&1===n.getItem(r-2).type&&2===n.getItem(r-1).type){const e=t.createSVGTransform(),i=Ge(n.getItem(r-2).matrix,n.getItem(r-1).matrix);e.setMatrix(i),n.removeItem(r-2),n.removeItem(r-2),n.appendItem(e)}}switch(e.tagName){case"line":case"polyline":case"polygon":case"path":break;default:if(1===n.numberOfItems&&1===n.getItem(0).type||2===n.numberOfItems&&1===n.getItem(0).type&&4===n.getItem(0).type)return null}const r=cr(e).data("gsvg"),i=new Se("Transform");let a,s,o={},l=null,c=[];switch(e.tagName){case"line":c=["x1","y1","x2","y2"];break;case"circle":c=["cx","cy","r"];break;case"ellipse":c=["cx","cy","rx","ry"];break;case"foreignObject":case"rect":case"image":c=["width","height","x","y"];break;case"use":case"text":case"tspan":c=["x","y"];break;case"polygon":case"polyline":{(l={}).points=e.getAttribute("points");const t=e.points,n=t.numberOfItems;o.points=new Array(n);for(let e=0;e<n;++e){const n=t.getItem(e);o.points[e]={x:n.x,y:n.y}}break}case"path":(l={}).d=e.getAttribute("d"),o.d=e.getAttribute("d")}if(c.length?(o=cr(e).attr(c),cr.each(o,function(e,t){o[e]=ge(e,t)})):r&&(o={x:cr(r).attr("x")||0,y:cr(r).attr("y")||0}),gn(l)&&(l=cr.extend(!0,{},o),cr.each(l,function(e,t){l[e]=ge(e,t)})),l.transform=ur.getStartTransform()||"","g"===e.tagName&&!r||"a"===e.tagName){const r=Xt(e);a={x:r.x+r.width/2,y:r.y+r.height/2},s=Ae(r.x+r.width/2,r.y+r.height/2,Ne(n).matrix);const o=on(e);if(o){const e=o*Math.PI/180;let t;t=Math.abs(e)>1e-10?Math.sin(e)/(1-Math.cos(e)):2/e;for(let e=0;e<n.numberOfItems;++e){const r=n.getItem(e);if(4===r.type){const i=r.matrix;a.y=(t*i.e+i.f)/2,a.x=(i.e-t*i.f)/2,n.removeItem(e);break}}}const l=n.numberOfItems;let c,u,d=0,h=0,p=0;if(l&&(c=n.getItem(0).matrix),l>=3&&3===n.getItem(l-2).type&&2===n.getItem(l-3).type&&2===n.getItem(l-1).type){p=3;const r=n.getItem(l-3).matrix,a=n.getItem(l-2).matrix,s=n.getItem(l-1).matrix,o=e.childNodes;let c=o.length;for(;c--;){const e=o.item(c);if(d=0,h=0,1===e.nodeType){const n=ie(e);if(!n)continue;const o=Ne(n).matrix,l=on(e);u=ur.getStartTransform();const c=[];if(ur.setStartTransform(e.getAttribute("transform")),l||Pe(n)){const e=t.createSVGTransform();e.setMatrix(Ge(r,a,s,o)),n.clear(),n.appendItem(e),c.push(e)}else{const e=Ge(o.inverse(),s,o),i=t.createSVGMatrix();i.e=-e.e,i.f=-e.f;const l=Ge(i.inverse(),o.inverse(),r,a,s,o,e.inverse()),u=t.createSVGTransform(),d=t.createSVGTransform(),h=t.createSVGTransform();u.setTranslate(e.e,e.f),d.setScale(l.a,l.d),h.setTranslate(i.e,i.f),n.appendItem(h),n.appendItem(d),n.appendItem(u),c.push(h),c.push(d),c.push(u)}i.addSubCommand(pr(e)),ur.setStartTransform(u)}}n.removeItem(l-1),n.removeItem(l-2),n.removeItem(l-3)}else if(l>=3&&1===n.getItem(l-1).type){p=3;const e=Ne(n).matrix,r=t.createSVGTransform();r.setMatrix(e),n.clear(),n.appendItem(r)}else if((1===l||l>1&&3!==n.getItem(1).type)&&2===n.getItem(0).type){p=2;const r=Ne(n).matrix;n.removeItem(0);const a=Ne(n).matrix.inverse(),s=Ge(a,r);if(d=s.e,h=s.f,0!==d||0!==h){const n=e.childNodes;let r=n.length;const a=[];for(;r--;){const s=n.item(r);if(1===s.nodeType){if(s.getAttribute("clip-path")){const e=s.getAttribute("clip-path");a.includes(e)||(hr(e,d,h),a.push(e))}u=ur.getStartTransform(),ur.setStartTransform(s.getAttribute("transform"));const n=ie(s);if(n){const r=t.createSVGTransform();r.setTranslate(d,h),n.numberOfItems?n.insertItemBefore(r,0):n.appendItem(r),i.addSubCommand(pr(s));const a=e.getElementsByTagNameNS(v.SVG,"use"),o="#"+s.id;let l=a.length;for(;l--;){const e=a.item(l);if(o===Ht(e)){const n=t.createSVGTransform();n.setTranslate(-d,-h),ie(e).insertItemBefore(n,0),i.addSubCommand(pr(e))}}ur.setStartTransform(u)}}}ur.setStartTransform(u)}}else{if(1!==l||1!==n.getItem(0).type||o){if(o){const e=t.createSVGTransform();e.setRotate(o,s.x,s.y),n.numberOfItems?n.insertItemBefore(e,0):n.appendItem(e)}return 0===n.numberOfItems&&e.removeAttribute("transform"),null}{p=1;const r=n.getItem(0).matrix,a=e.childNodes;let s=a.length;for(;s--;){const e=a.item(s);if(1===e.nodeType){u=ur.getStartTransform(),ur.setStartTransform(e.getAttribute("transform"));const n=ie(e);if(!n)continue;const a=Ge(r,Ne(n).matrix),s=t.createSVGTransform();s.setMatrix(a),n.clear(),n.appendItem(s,0),i.addSubCommand(pr(e)),ur.setStartTransform(u);const o=e.getAttribute("stroke-width");if("none"!==e.getAttribute("stroke")&&!isNaN(o)){const t=(Math.abs(a.a)+Math.abs(a.d))/2;e.setAttribute("stroke-width",o*t)}}}n.clear()}}if(2===p){if(o){s={x:a.x+c.e,y:a.y+c.f};const e=t.createSVGTransform();e.setRotate(o,s.x,s.y),n.numberOfItems?n.insertItemBefore(e,0):n.appendItem(e)}}else if(3===p){const r=Ne(n).matrix,l=t.createSVGTransform();l.setRotate(o,a.x,a.y);const c=l.matrix,p=t.createSVGTransform();p.setRotate(o,s.x,s.y);const f=p.matrix.inverse(),g=r.inverse(),m=Ge(g,f,c,r);if(d=m.e,h=m.f,0!==d||0!==h){const n=e.childNodes;let r=n.length;for(;r--;){const e=n.item(r);if(1===e.nodeType){u=ur.getStartTransform(),ur.setStartTransform(e.getAttribute("transform"));const n=ie(e),r=t.createSVGTransform();r.setTranslate(d,h),n.numberOfItems?n.insertItemBefore(r,0):n.appendItem(r),i.addSubCommand(pr(e)),ur.setStartTransform(u)}}}o&&(n.numberOfItems?n.insertItemBefore(p,0):n.appendItem(p))}}else{const r=Xt(e);if(!r&&"path"!==e.tagName)return null;let i;const l=on(e);if(l){a={x:r.x+r.width/2,y:r.y+r.height/2},s=Ae(r.x+r.width/2,r.y+r.height/2,Ne(n).matrix);const e=l*Math.PI/180,t=Math.abs(e)>1e-10?Math.sin(e)/(1-Math.cos(e)):2/e;for(let e=0;e<n.numberOfItems;++e){const r=n.getItem(e);if(4===r.type){const i=r.matrix;a.y=(t*i.e+i.f)/2,a.x=(i.e-t*i.f)/2,n.removeItem(e);break}}}let c=0;const u=n.numberOfItems;if(!U()){const t=e.getAttribute("fill");if(t&&t.startsWith("url(")){const e=ln(t);let r="pattern";if(e.tagName!==r&&(r="gradient"),"userSpaceOnUse"===e.getAttribute(r+"Units")){i=Ne(n).matrix;const t=ie(e),a=Ne(t).matrix,s="matrix("+[(i=Ge(i,a)).a,i.b,i.c,i.d,i.e,i.f].join(",")+")";e.setAttribute(r+"Transform",s)}}}if(u>=3&&3===n.getItem(u-2).type&&2===n.getItem(u-3).type&&2===n.getItem(u-1).type)c=3,i=Ne(n,u-3,u-1).matrix,n.removeItem(u-1),n.removeItem(u-2),n.removeItem(u-3);else if(4===u&&1===n.getItem(u-1).type){c=3,i=Ne(n).matrix;const e=t.createSVGTransform();e.setMatrix(i),n.clear(),n.appendItem(e),i=t.createSVGMatrix()}else if((1===u||u>1&&3!==n.getItem(1).type)&&2===n.getItem(0).type){c=2;const e=n.getItem(0).matrix,t=Ne(n,1).matrix,r=t.inverse();i=Ge(r,e,t),n.removeItem(0)}else{if(1!==u||1!==n.getItem(0).type||l){if(l){const e=t.createSVGTransform();e.setRotate(l,s.x,s.y),n.numberOfItems?n.insertItemBefore(e,0):n.appendItem(e)}return 0===n.numberOfItems&&e.removeAttribute("transform"),null}switch(i=Ne(n).matrix,e.tagName){case"line":o=cr(e).attr(["x1","y1","x2","y2"]);case"polyline":case"polygon":if(o.points=e.getAttribute("points"),o.points){const t=e.points,n=t.numberOfItems;o.points=new Array(n);for(let e=0;e<n;++e){const n=t.getItem(e);o.points[e]={x:n.x,y:n.y}}}case"path":o.d=e.getAttribute("d"),c=1,n.clear()}}if(1!==c&&2!==c&&3!==c||lr(e,o,i),2===c){if(l){Pe(n)||(s={x:a.x+i.e,y:a.y+i.f});const e=t.createSVGTransform();e.setRotate(l,s.x,s.y),n.numberOfItems?n.insertItemBefore(e,0):n.appendItem(e)}if("text"===e.tagName){const t=e.childNodes;let n=t.length;for(;n--;){const e=t.item(n);if("tspan"===e.tagName){const t={x:cr(e).attr("x")||0,y:cr(e).attr("y")||0};lr(e,t,i)}}}}else if(3===c&&l){const{matrix:r}=Ne(n),i=t.createSVGTransform();i.setRotate(l,a.x,a.y);const c=i.matrix,u=t.createSVGTransform();u.setRotate(l,s.x,s.y);const d=u.matrix.inverse(),h=r.inverse(),p=Ge(h,d,c,r);lr(e,o,p),l&&(n.numberOfItems?n.insertItemBefore(u,0):n.appendItem(u))}}return 0===n.numberOfItems&&e.removeAttribute("transform"),i.addSubCommand(new we(e,l)),i},fr=jQuery;let gr,mr,_r;const yr=Y()?10:4;class vr{constructor(e,t,n){this.id=e,this.selectedElement=t,this.locked=!0,this.selectorGroup=gr.createSVGElement({element:"g",attr:{id:"selectorGroup"+this.id}}),this.selectorRect=this.selectorGroup.appendChild(gr.createSVGElement({element:"path",attr:{id:"selectedBox"+this.id,fill:"none",stroke:"#22C","stroke-width":"1","stroke-dasharray":"5,5",style:"pointer-events:none"}})),this.gripCoords={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null},this.reset(this.selectedElement,n)}reset(e,t){this.locked=!0,this.selectedElement=e,this.resize(t),this.selectorGroup.setAttribute("display","inline")}showGrips(e){const t=e?"inline":"none";_r.selectorGripsGroup.setAttribute("display",t);const n=this.selectedElement;this.hasGrips=e,n&&e&&(this.selectorGroup.append(_r.selectorGripsGroup),vr.updateGripCursors(on(n)))}resize(e){const t=this.selectorRect,n=_r,r=n.selectorGrips,i=this.selectedElement,a=i.getAttribute("stroke-width"),s=gr.getCurrentZoom();let o=1/s;"none"===i.getAttribute("stroke")||isNaN(a)||(o+=a/2);const{tagName:l}=i;"text"===l&&(o+=2/s);const c=ie(i),u=Ne(c).matrix;if(u.e*=s,u.f*=s,e||(e=Xt(i)),"g"===l&&!fr.data(i,"gsvg")){const t=nn([i.childNodes]);t&&(e=t)}const d=e.x,h=e.y,p=e.width,f=e.height;o*=s;const g=Ie(d*s,h*s,p*s,f*s,u),{aabox:m}=g;let _=m.x-o,y=m.y-o,v=m.width+2*o,b=m.height+2*o;const x=_+v/2,w=y+b/2,S=on(i);if(S){const e=gr.svgRoot().createSVGTransform();e.setRotate(-S,x,w);const t=e.matrix;g.tl=Ae(g.tl.x,g.tl.y,t),g.tr=Ae(g.tr.x,g.tr.y,t),g.bl=Ae(g.bl.x,g.bl.y,t),g.br=Ae(g.br.x,g.br.y,t);const{tl:n}=g;let r=n.x,i=n.y,a=n.x,s=n.y;const{min:l,max:c}=Math;_=r=l(r,l(g.tr.x,l(g.bl.x,g.br.x)))-o,y=i=l(i,l(g.tr.y,l(g.bl.y,g.br.y)))-o,v=(a=c(a,c(g.tr.x,c(g.bl.x,g.br.x)))+o)-r,b=(s=c(s,c(g.tr.y,c(g.bl.y,g.br.y)))+o)-i}const k="M"+_+","+y+" L"+(_+v)+","+y+" "+(_+v)+","+(y+b)+" "+_+","+(y+b)+"z";t.setAttribute("d",k);const C=S?"rotate("+[S,x,w].join(",")+")":"";this.selectorGroup.setAttribute("transform",C),this.gripCoords={nw:[_,y],ne:[_+v,y],sw:[_,y+b],se:[_+v,y+b],n:[_+v/2,y],w:[_,y+b/2],e:[_+v,y+b/2],s:[_+v/2,y+b]},Object.entries(this.gripCoords).forEach(([e,t])=>{r[e].setAttribute("cx",t[0]),r[e].setAttribute("cy",t[1])}),n.rotateGripConnector.setAttribute("x1",_+v/2),n.rotateGripConnector.setAttribute("y1",y),n.rotateGripConnector.setAttribute("x2",_+v/2),n.rotateGripConnector.setAttribute("y2",y-5*yr),n.rotateGrip.setAttribute("cx",_+v/2),n.rotateGrip.setAttribute("cy",y-5*yr)}}vr.updateGripCursors=function(e){const t=Object.keys(_r.selectorGrips);let n=Math.round(e/45);for(n<0&&(n+=8);n>0;)t.push(t.shift()),n--;Object.values(_r.selectorGrips).forEach((e,n)=>{e.setAttribute("style","cursor:"+t[n]+"-resize")})};class br{constructor(){this.selectorParentGroup=null,this.rubberBandBox=null,this.selectors=[],this.selectorMap={},this.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null},this.selectorGripsGroup=null,this.rotateGripConnector=null,this.rotateGrip=null,this.initGroup()}initGroup(){if(this.selectorParentGroup&&this.selectorParentGroup.parentNode&&this.selectorParentGroup.remove(),this.selectorParentGroup=gr.createSVGElement({element:"g",attr:{id:"selectorParentGroup"}}),this.selectorGripsGroup=gr.createSVGElement({element:"g",attr:{display:"none"}}),this.selectorParentGroup.append(this.selectorGripsGroup),gr.svgRoot().append(this.selectorParentGroup),this.selectorMap={},this.selectors=[],this.rubberBandBox=null,Object.keys(this.selectorGrips).forEach(e=>{const t=gr.createSVGElement({element:"circle",attr:{id:"selectorGrip_resize_"+e,fill:"#22C",r:yr,style:"cursor:"+e+"-resize","stroke-width":2,"pointer-events":"all"}});fr.data(t,"dir",e),fr.data(t,"type","resize"),this.selectorGrips[e]=this.selectorGripsGroup.appendChild(t)}),this.rotateGripConnector=this.selectorGripsGroup.appendChild(gr.createSVGElement({element:"line",attr:{id:"selectorGrip_rotateconnector",stroke:"#22C","stroke-width":"1"}})),this.rotateGrip=this.selectorGripsGroup.appendChild(gr.createSVGElement({element:"circle",attr:{id:"selectorGrip_rotate",fill:"lime",r:yr,stroke:"#22C","stroke-width":2,style:"cursor:url("+mr.imgPath+"rotate.png) 12 12, auto;"}})),fr.data(this.rotateGrip,"type","rotate"),fr("#canvasBackground").length)return;const[e,t]=mr.dimensions,n=gr.createSVGElement({element:"svg",attr:{id:"canvasBackground",width:e,height:t,x:0,y:0,overflow:U()?"none":"visible",style:"pointer-events:none"}}),r=gr.createSVGElement({element:"rect",attr:{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,stroke:"#000",fill:"#FFF",style:"pointer-events:none"}});n.append(r),gr.svgRoot().insertBefore(n,gr.svgContent())}requestSelector(e,t){if(gn(e))return null;const n=this.selectors.length;if("object"==typeof this.selectorMap[e.id])return this.selectorMap[e.id].locked=!0,this.selectorMap[e.id];for(let r=0;r<n;++r)if(this.selectors[r]&&!this.selectors[r].locked)return this.selectors[r].locked=!0,this.selectors[r].reset(e,t),this.selectorMap[e.id]=this.selectors[r],this.selectors[r];return this.selectors[n]=new vr(n,e,t),this.selectorParentGroup.append(this.selectors[n].selectorGroup),this.selectorMap[e.id]=this.selectors[n],this.selectors[n]}releaseSelector(e){if(gn(e))return;const t=this.selectors.length,n=this.selectorMap[e.id];n.locked||console.log("WARNING! selector was released but was already unlocked");for(let r=0;r<t;++r)if(this.selectors[r]&&this.selectors[r]===n){delete this.selectorMap[e.id],n.locked=!1,n.selectedElement=null,n.showGrips(!1);try{n.selectorGroup.setAttribute("display","none")}catch(e){}break}}getRubberBandBox(){return this.rubberBandBox||(this.rubberBandBox=this.selectorParentGroup.appendChild(gr.createSVGElement({element:"rect",attr:{id:"selectorRubberBand",fill:"#22C","fill-opacity":.15,stroke:"#22C","stroke-width":.5,display:"none",style:"pointer-events:none"}}))),this.rubberBandBox}}const xr=function(e,t){mr=e,gr=t,_r=new br},wr=()=>_r;
/**
 * Numerous tools for working with the editor's "canvas"
 * @module svgcanvas
 *
 * @license MIT
 *
 * @copyright 2010 Alexis Deveria, 2010 Pavol Rusnak, 2010 Jeff Schiller
 *
 */
let Sr=K(jQuery);const{MoveElementCommand:kr,InsertElementCommand:Cr,RemoveElementCommand:Ar,ChangeElementCommand:Er,BatchCommand:Gr,UndoManager:Pr,HistoryEventTypes:Ir}=r;window.console||(window.console={},window.console.log=function(e){},window.console.dir=function(e){}),window.opera&&(window.console.log=function(e){window.opera.postError(e)},window.console.dir=function(e){});var Nr=class{constructor(e,t){const n={show_outside_canvas:!0,selectNew:!0,dimensions:[640,480]};t&&Sr.extend(n,t);const{dimensions:a}=n,s=this,o=e.ownerDocument,l=o.importNode(Bt('<svg id="svgroot" xmlns="'+v.SVG+'" xlinkns="'+v.XLINK+'" width="'+a[0]+'" height="'+a[1]+'" x="'+a[0]+'" y="'+a[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,!0);e.append(l);let c=o.createElementNS(v.SVG,"svg");(s.clearSvgContentElement=function(){Sr(c).empty(),Sr(c).attr({id:"svgcontent",width:a[0],height:a[1],x:a[0],y:a[1],overflow:n.show_outside_canvas?"visible":"hidden",xmlns:v.SVG,"xmlns:se":v.SE,"xmlns:xlink":v.XLINK}).appendTo(l);const e=o.createComment(" Created with SVG-edit - https://github.com/SVG-Edit/svgedit");c.append(e)})();let u="svg_";s.setIdPrefix=function(e){u=e},s.current_drawing_=new Vn(c,u);const d=s.getCurrentDrawing=function(){return s.current_drawing_};let h=1,p=null;const f={shape:{fill:("none"===n.initFill.color?"":"#")+n.initFill.color,fill_paint:null,fill_opacity:n.initFill.opacity,stroke:"#"+n.initStroke.color,stroke_paint:null,stroke_opacity:n.initStroke.opacity,stroke_width:n.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:n.initOpacity}};f.text=Sr.extend(!0,{},f.shape),Sr.extend(f.text,{fill:"#000000",stroke_width:n.text&&n.text.stroke_width,font_size:n.text&&n.text.font_size,font_family:n.text&&n.text.font_family});const g=f.shape;let m=[];const _=this.getJsonFromSvgElement=function(e){if(3===e.nodeType)return e.nodeValue;const t={element:e.tagName,attr:{},children:[]};for(let n,r=0;n=e.attributes[r];r++)t.attr[n.name]=n.value;for(let n,r=0;n=e.childNodes[r];r++)t.children[r]=_(n);return t},y=this.addSVGElementFromJson=function(e){if("string"==typeof e)return o.createTextNode(e);let t=cn(e.attr.id);const n=d().getCurrentLayer();if(t&&e.element!==t.tagName&&(t.remove(),t=null),!t){const r=e.namespace||v.SVG;t=o.createElementNS(r,e.element),n&&(p||n).append(t)}return e.curStyles&&un(t,{fill:g.fill,stroke:g.stroke,"stroke-width":g.stroke_width,"stroke-dasharray":g.stroke_dasharray,"stroke-linejoin":g.stroke_linejoin,"stroke-linecap":g.stroke_linecap,"stroke-opacity":g.stroke_opacity,"fill-opacity":g.fill_opacity,opacity:g.opacity/2,style:"pointer-events:inherit"},100),un(t,e.attr,100),dn(t),e.children&&e.children.forEach(e=>{t.append(y(e))}),t};s.getTransformList=ie,s.matrixMultiply=Ge,s.hasMatrixTransform=Pe,s.transformListToTransform=Ne;const x=()=>n.baseUnit;ue({getBaseUnit:x,getElement:cn,getHeight:()=>c.getAttribute("height")/h,getWidth:()=>c.getAttribute("width")/h,getRoundDigits:()=>J.round_digits}),s.convertToNum=ge;const w=()=>c,S=this.getSelectedElems=function(){return m},{pathActions:k}=i,C=()=>l;Pt({pathActions:k,getSVGContent:w,addSVGElementFromJson:y,getSelectedElements:S,getDOMDocument:()=>o,getDOMContainer:()=>e,getSVGRoot:C,getBaseUnit:x,getSnappingStep:()=>n.snappingStep}),s.findDefs=qt,s.getUrlFromAttr=Ft,s.getHref=Ht,s.setHref=zt,s.getBBox=Xt,s.getRotationAngle=on,s.getElem=cn,s.getRefElem=ln,s.assignAttributes=un,this.cleanupElement=dn;const A=()=>n.gridSnapping;or({getDrawing:()=>d(),getSVGRoot:C,getGridSnapping:A}),this.remapElement=lr,dr({getSVGRoot:C,getStartTransform:()=>ce,setStartTransform(e){ce=e}}),this.recalculateDimensions=pr;const E=b();s.sanitizeSvg=rr;const G=s.undoMgr=new Pr({handleHistoryEvent(e,t){const n=Ir;if(e===n.BEFORE_UNAPPLY||e===n.BEFORE_APPLY)s.clearSelection();else if(e===n.AFTER_APPLY||e===n.AFTER_UNAPPLY){const r=t.elements();s.pathActions.clear(),O("changed",r);const i=t.type(),a=e===n.AFTER_APPLY;if(i===kr.type())(a?t.newParent:t.oldParent)===c&&Un();else if(i===Cr.type()||i===Ar.type())t.parent===c&&Un(),i===Cr.type()?a&&K(t.elem):a||K(t.elem),"use"===t.elem.tagName&&We(t.elem);else if(i===Er.type()){"title"===t.elem.tagName&&t.elem.parentNode.parentNode===c&&Un();const e=a?t.newValues:t.oldValues;e.stdDeviation&&s.setBlurOffsets(t.elem.parentNode,e.stdDeviation)}}}}),P=function(e){s.undoMgr.addCommandToHistory(e)},I=this.getZoom=function(){return h},N=this.round=function(e){return parseInt(e*h)/h};xr(n,{createSVGElement:e=>s.addSVGElementFromJson(e),svgRoot:()=>l,svgContent:()=>c,getCurrentZoom:I});const T=this.selectorManager=wr(),L=s.getNextId=function(){return d().getNextId()},M=s.getId=function(){return d().getId()},O=function(e,t){if(Oe[e])return Oe[e](window,t)},j=this.clearSelection=function(e){m.forEach(e=>{gn(e)||T.releaseSelector(e)}),m=[],e||O("selected",m)},V=this.addToSelection=function(e,t){if(!e.length)return;let n=0;for(;n<m.length&&!gn(m[n]);)++n;let r=e.length;for(;r--;){let t=e[r];if(!t)continue;const i=Xt(t);if(i&&("a"===t.tagName&&1===t.childNodes.length&&(t=t.firstChild),!m.includes(t))){m[n]=t,n++;const e=T.requestSelector(t,i);m.length>1&&e.showGrips(!1)}}for(O("selected",m),t||1===m.length?T.requestSelector(m[0]).showGrips(!0):T.requestSelector(m[0]).showGrips(!1),m.sort(function(e,t){return e&&t&&e.compareDocumentPosition?3-(6&t.compareDocumentPosition(e)):gn(e)?1:0});gn(m[0]);)m.shift(0)},R=function(){return g.opacity},B=this.getMouseTarget=function(t){if(gn(t))return null;let n=t.target;if(n.correspondingUseElement&&(n=n.correspondingUseElement),[v.MATH,v.HTML].includes(n.namespaceURI)&&"svgcanvas"!==n.id)for(;"foreignObject"!==n.nodeName;)if(!(n=n.parentNode))return l;const r=d().getCurrentLayer();if([l,e,c,r].includes(n))return l;if(Sr(n).closest("#selectorParentGroup").length)return T.selectorParentGroup;for(;n.parentNode!==(p||r);)n=n.parentNode;return n};s.pathActions=k,qe({selectorManager:T,canvas:s,call:O,resetD:function(e){e.setAttribute("d",k.convertPath(e))},round:N,clearSelection:j,addToSelection:V,addCommandToHistory:P,remapElement:lr,addSVGElementFromJson:y,getGridSnapping:A,getOpacity:R,getSelectedElements:S,getContainer:()=>e,setStarted(e){le=e},getRubberBox:()=>ve,setRubberBox:e=>ve=e,addPtsToSelection({closedSubpath:e,grips:t}){k.canDeleteNodes=!0,k.closed_subpath=e,O("pointsAdded",{closedSubpath:e,grips:t}),O("selected",t)},endChanges({cmd:e,elem:t}){P(e),O("changed",[t])},getCurrentZoom:I,getId:M,getNextId:L,getMouseTarget:B,getCurrentMode:()=>fe,setCurrentMode:e=>fe=e,getDrawnPath:()=>Fe,setDrawnPath:e=>Fe=e,getSVGRoot:C});const D={},q="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use",$=["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],Y=Sr.data,X=document.createElementNS(v.SVG,"animate");Sr(X).attr({attributeName:"opacity",begin:"indefinite",dur:1,fill:"freeze"}).appendTo(l);const K=function(e){const t=Sr(e).attr($);Object.values(t).forEach(e=>{if(e&&e.startsWith("url(")){const t=Ft(e).substr(1);cn(t)||(qt().append(se[t]),delete se[t])}});const n=e.getElementsByTagName("*");if(n.length)for(let e=0,t=n.length;e<t;e++)K(n[e])},Z={},J={round_digits:5},ee={},re=f.text,ae={},se={};let oe=n.imgPath+"logo.png",le=!1,ce=null,fe="select",me="none",_e=g,ye=null,ve=null,be=[],xe=null;this.runExtension=function(e,t,n){return this.runExtensions(t,n,!1,t=>t===e)};const we=this.runExtensions=function(e,t,n,r){let i=!!n&&[];return Sr.each(ae,function(a,s){r&&!r(a)||s&&e in s&&("function"==typeof t&&(t=t(a)),n?i.push(s[e](t)):i=s[e](t))}),i};this.addExtension=async function(e,t,{$:n,importLocale:r}){if("function"!=typeof t)throw new TypeError("Function argument expected for `svgcanvas.addExtension`");if(e in ae)throw new Error('Cannot add extension "'+e+'", an extension by that name already exists.');const i=Sr.extend(s.getPrivateMethods(),{$:n,importLocale:r,svgroot:l,svgcontent:c,nonce:d().getNonce(),selectorManager:T}),a=await t(i);return a&&(a.name=e),ae[e]=a,O("extension_added",a)};const Se=this.getIntersectionList=function(e){if(gn(ve))return null;const t=p||d().getCurrentLayer();let n;if(e)(n=c.createSVGRect()).x=e.x,n.y=e.y,n.width=e.width,n.height=e.height;else{n=ve.getBBox();const e=c.createSVGRect();["x","y","width","height","top","right","bottom","left"].forEach(t=>{e[t]=n[t]/h}),n=e}let r=null;if(H||"function"==typeof l.getIntersectionList&&(n.x+=parseInt(c.getAttribute("x")),n.y+=parseInt(c.getAttribute("y")),r=l.getIntersectionList(n,t)),gn(r)||"function"!=typeof r.item){r=[],be.length||(be=ke(t));let e=be.length;for(;e--;)n.width&&Me(n,be[e].bbox)&&r.push(be[e].elem)}return r};this.getStrokedBBox=an,this.getVisibleElements=rn;const ke=this.getVisibleElementsAndBBoxes=function(e){e||(e=Sr(c).children());const t=[];return Sr(e).children().each(function(e,n){n.getBBox&&t.push({elem:n,bbox:an([n])})}),t.reverse()},Ce=this.groupSvgElem=function(e){const t=document.createElementNS(v.SVG,"g");e.replaceWith(t),Sr(t).append(e).data("gsvg",e)[0].id=L()},Oe={};s.call=O,s.bind=function(e,t){const n=Oe[e];return Oe[e]=t,n},this.prepareSvg=function(e){this.sanitizeSvg(e.documentElement),[...e.getElementsByTagNameNS(v.SVG,"path")].forEach(e=>{e.setAttribute("d",k.convertPath(e)),k.fixEnd(e)})};const je=function(e){if(!F())return e;const t=e.cloneNode(!0);return e.before(t),e.remove(),T.releaseSelector(e),m[0]=t,T.requestSelector(t).showGrips(!0),t};this.setRotationAngle=function(e,t){e=parseFloat(e);const n=m[0],r=n.getAttribute("transform"),i=Xt(n),a=i.x+i.width/2,s=i.y+i.height/2,o=ie(n);if(o.numberOfItems>0&&4===o.getItem(0).type&&o.removeItem(0),0!==e){const t=Ae(a,s,Ne(o).matrix),n=l.createSVGTransform();n.setRotate(e,t.x,t.y),o.numberOfItems?o.insertItemBefore(n,0):o.appendItem(n)}else 0===o.numberOfItems&&n.removeAttribute("transform");if(!t){const e=n.getAttribute("transform");n.setAttribute("transform",r),it("transform",e,m),O("changed",m)}T.requestSelector(m[0]).resize(),vr.updateGripCursors(e)};const Ve=this.recalculateAllSelectedDimensions=function(){const e=new Gr("none"===me?"position":"size");let t=m.length;for(;t--;){const n=m[t],r=pr(n);r&&e.addSubCommand(r)}e.isEmpty()||(P(e),O("changed",m))},Be=function(e){console.log([e.a,e.b,e.c,e.d,e.e,e.f])};let De=null;const Ue=this.selectOnly=function(e,t){j(!0),V(e,t)};this.removeFromSelection=function(e){if(gn(m[0]))return;if(!e.length)return;const t=[],n=m.length;for(let r=0;r<n;++r){const n=m[r];n&&(e.includes(n)?T.releaseSelector(n):t.push(n))}m=t},this.selectAllInCurrentLayer=function(){const e=d().getCurrentLayer();e&&(fe="select",Ue(Sr(p||e).children()))};let Fe=null;!function(){const t={minx:null,miny:null,maxx:null,maxy:null};let r,a,o=null,u=null,f=null,_=null,v=null,b={},x=0,w={x:0,y:0},S={x:0,y:0},C={x:0,y:0},A={x:0,y:0},E={x:0,y:0},G={x:0,y:0};const I=function(e){const t={x:0,y:0},n=w,r=S,i=C,a=A,s=e*e,o=s*e,l=[[-1,3,-3,1],[3,-6,3,0],[-3,0,3,0],[1,4,1,0]];return t.x=1/6*((n.x*l[0][0]+r.x*l[0][1]+i.x*l[0][2]+a.x*l[0][3])*o+(n.x*l[1][0]+r.x*l[1][1]+i.x*l[1][2]+a.x*l[1][3])*s+(n.x*l[2][0]+r.x*l[2][1]+i.x*l[2][2]+a.x*l[2][3])*e+(n.x*l[3][0]+r.x*l[3][1]+i.x*l[3][2]+a.x*l[3][3])),t.y=1/6*((n.y*l[0][0]+r.y*l[0][1]+i.y*l[0][2]+a.y*l[0][3])*o+(n.y*l[1][0]+r.y*l[1][1]+i.y*l[1][2]+a.y*l[1][3])*s+(n.y*l[2][0]+r.y*l[2][1]+i.y*l[2][2]+a.y*l[2][3])*e+(n.y*l[3][0]+r.y*l[3][1]+i.y*l[3][2]+a.y*l[3][3])),{x:t.x,y:t.y}};Sr(e).mousedown(function(e){if(s.spaceKey||1===e.button)return;const r=2===e.button;e.altKey&&s.cloneSelectedElements(0,0),De=Sr("#svgcontent g")[0].getScreenCTM().inverse();const i=Ae(e.pageX,e.pageY,De),a=i.x*h,c=i.y*h;e.preventDefault(),r&&(fe="select",xe=i);let d=a/h,p=c/h,x=B(e);"a"===x.tagName&&1===x.childNodes.length&&(x=x.firstChild);const w=d;_=u=d;const S=p;if(v=f=p,n.gridSnapping&&(d=hn(d),p=hn(p),u=hn(u),f=hn(f)),x===T.selectorParentGroup&&!gn(m[0])){const t=e.target,n=Y(t,"type");"rotate"===n?fe="rotate":"resize"===n&&(fe="resize",me=Y(t,"dir")),x=m[0]}ce=x.getAttribute("transform");const A=ie(x);switch(fe){case"select":if(le=!0,me="none",r&&(le=!1),x!==l){if(m.includes(x)||(e.shiftKey||j(!0),V([x]),ye=x,k.clear()),!r)for(let e=0;e<m.length;++e){if(gn(m[e]))continue;const t=ie(m[e]);t.numberOfItems?t.insertItemBefore(l.createSVGTransform(),0):t.appendItem(l.createSVGTransform())}}else r||(j(),fe="multiselect",gn(ve)&&(ve=T.getRubberBandBox()),un(ve,{x:_*=h,y:v*=h,width:0,height:0,display:"inline"},100));break;case"zoom":le=!0,gn(ve)&&(ve=T.getRubberBandBox()),un(ve,{x:w*h,y:w*h,width:0,height:0,display:"inline"},100);break;case"resize":{le=!0,u=d,f=p,b=Xt(Sr("#selectedBox0")[0]);const e={};Sr.each(b,function(t,n){e[t]=n/h}),b=e;const t=on(x)?1:0;if(Pe(A))A.insertItemBefore(l.createSVGTransform(),t),A.insertItemBefore(l.createSVGTransform(),t),A.insertItemBefore(l.createSVGTransform(),t);else if(A.appendItem(l.createSVGTransform()),A.appendItem(l.createSVGTransform()),A.appendItem(l.createSVGTransform()),Q()){const e=U();let t;e&&(t=function(e){const t=e.getAttribute("stroke");e.removeAttribute("stroke"),null!==t&&setTimeout(function(){e.setAttribute("stroke",t)},0)}),x.style.vectorEffect="non-scaling-stroke",e&&t(x);const n=x.getElementsByTagName("*"),r=n.length;for(let i=0;i<r;i++)n[i].style&&(n[i].style.vectorEffect="non-scaling-stroke",e&&t(n[i]))}break}case"fhellipse":case"fhrect":case"fhpath":C.x=w,C.y=S,le=!0,y({element:"polyline",curStyles:!0,attr:{points:o=w+","+S+" ",id:L(),fill:"none",opacity:g.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}}),t.minx=w,t.maxx=w,t.miny=S,t.maxy=S;break;case"image":{le=!0;const e=y({element:"image",attr:{x:d,y:p,width:0,height:0,id:L(),opacity:g.opacity/2,style:"pointer-events:inherit"}});zt(e,oe),pn(e);break}case"square":case"rect":le=!0,u=d,f=p,y({element:"rect",curStyles:!0,attr:{x:d,y:p,width:0,height:0,id:L(),opacity:g.opacity/2}});break;case"line":{le=!0;const e=0===Number(g.stroke_width)?1:g.stroke_width;y({element:"line",curStyles:!0,attr:{x1:d,y1:p,x2:d,y2:p,id:L(),stroke:g.stroke,"stroke-width":e,"stroke-dasharray":g.stroke_dasharray,"stroke-linejoin":g.stroke_linejoin,"stroke-linecap":g.stroke_linecap,"stroke-opacity":g.stroke_opacity,fill:"none",opacity:g.opacity/2,style:"pointer-events:none"}});break}case"circle":le=!0,y({element:"circle",curStyles:!0,attr:{cx:d,cy:p,r:0,id:L(),opacity:g.opacity/2}});break;case"ellipse":le=!0,y({element:"ellipse",curStyles:!0,attr:{cx:d,cy:p,rx:0,ry:0,id:L(),opacity:g.opacity/2}});break;case"text":le=!0,y({element:"text",curStyles:!0,attr:{x:d,y:p,id:L(),fill:re.fill,"stroke-width":re.stroke_width,"font-size":re.font_size,"font-family":re.font_family,"text-anchor":"middle","xml:space":"preserve",opacity:g.opacity}});break;case"path":case"pathedit":u*=h,f*=h,k.mouseDown(e,x,u,f),le=!0;break;case"textedit":u*=h,f*=h,He.mouseDown(e,x,u,f),le=!0;break;case"rotate":le=!0,s.undoMgr.beginUndoableChange("transform",m)}const E=we("mouseDown",{event:e,start_x:u,start_y:f,selectedElements:m},!0);Sr.each(E,function(e,t){t&&t.started&&(le=!0)})}).mousemove(function(e){if(!le)return;if(1===e.button||s.spaceKey)return;let o,d,p,g,y,P,N,L,j,V,R=m[0];const B=Ae(e.pageX,e.pageY,De),D=B.x*h,U=B.y*h,F=cn(M());let H,z=D/h,q=z,$=U/h,Y=$;switch(n.gridSnapping&&(q=hn(q),Y=hn(Y)),e.preventDefault(),fe){case"select":if(null!==m[0]&&(P=q-u,N=Y-f,n.gridSnapping&&(P=hn(P),N=hn(N)),0!==P||0!==N)){for(L=m.length,o=0;o<L&&(R=m[o],!gn(R));++o){const e=l.createSVGTransform();H=ie(R),e.setTranslate(P,N),H.numberOfItems?H.replaceItem(e,0):H.appendItem(e),T.requestSelector(R).resize()}O("transition",m)}break;case"multiselect":{z*=h,$*=h,un(ve,{x:Math.min(_,z),y:Math.min(v,$),width:Math.abs(z-_),height:Math.abs($-v)},100);const e=m.slice(),t=[],n=Se();for(L=n.length,o=0;o<L;++o){const r=n[o];m.includes(r)||t.push(r);const i=e.indexOf(r);-1!==i&&e.splice(i,1)}e.length>0&&s.removeFromSelection(e),t.length>0&&s.addToSelection(t);break}case"resize":{H=ie(R);const t=Pe(H);let r=(V=t?b:Xt(R)).x,i=V.y,{width:a,height:s}=V;if(P=q-u,N=Y-f,n.gridSnapping&&(P=hn(P),N=hn(N),s=hn(s),a=hn(a)),j=on(R)){const e=Math.sqrt(P*P+N*N),t=Math.atan2(N,P)-j*Math.PI/180;P=e*Math.cos(t),N=e*Math.sin(t)}me.includes("n")||me.includes("s")||(N=0),me.includes("e")||me.includes("w")||(P=0);let o=0,c=0,d=s?(s+N)/s:1,h=a?(a+P)/a:1;me.includes("n")&&(d=s?(s-N)/s:1,c=s),me.includes("w")&&(h=a?(a-P)/a:1,o=a);const p=l.createSVGTransform(),g=l.createSVGTransform(),_=l.createSVGTransform();if(n.gridSnapping&&(r=hn(r),o=hn(o),i=hn(i),c=hn(c)),p.setTranslate(-(r+o),-(i+c)),e.shiftKey&&(1===h?h=d:d=h),g.setScale(h,d),_.setTranslate(r+o,i+c),t){const e=j?1:0;H.replaceItem(p,2+e),H.replaceItem(g,1+e),H.replaceItem(_,Number(e))}else{const e=H.numberOfItems;H.replaceItem(_,e-3),H.replaceItem(g,e-2),H.replaceItem(p,e-1)}T.requestSelector(R).resize(),O("transition",m);break}case"zoom":z*=h,$*=h,un(ve,{x:Math.min(_*h,z),y:Math.min(v*h,$),width:Math.abs(z-_*h),height:Math.abs($-v*h)},100);break;case"text":un(F,{x:q,y:Y},1e3);break;case"line":{n.gridSnapping&&(q=hn(q),Y=hn(Y));let t=q,r=Y;e.shiftKey&&(t=(d=Le(u,f,t,r)).x,r=d.y),F.setAttribute("x2",t),F.setAttribute("y2",r);break}case"foreignObject":case"square":case"rect":case"image":{const t="square"===fe||e.shiftKey;let r,i,a=Math.abs(q-u),s=Math.abs(Y-f);t?(a=s=Math.max(a,s),r=u<q?u:u-a,i=f<Y?f:f-s):(r=Math.min(u,q),i=Math.min(f,Y)),n.gridSnapping&&(a=hn(a),s=hn(s),r=hn(r),i=hn(i)),un(F,{width:a,height:s,x:r,y:i},1e3);break}case"circle":{p=Sr(F).attr(["cx","cy"]),({cx:g,cy:y}=p);let e=Math.sqrt((q-g)*(q-g)+(Y-y)*(Y-y));n.gridSnapping&&(e=hn(e)),F.setAttribute("r",e);break}case"ellipse":{p=Sr(F).attr(["cx","cy"]),({cx:g,cy:y}=p),n.gridSnapping&&(q=hn(q),g=hn(g),Y=hn(Y),y=hn(y)),F.setAttribute("rx",Math.abs(q-g));const t=Math.abs(e.shiftKey?q-g:Y-y);F.setAttribute("ry",t);break}case"fhellipse":case"fhrect":t.minx=Math.min(z,t.minx),t.maxx=Math.max(z,t.maxx),t.miny=Math.min($,t.miny),t.maxy=Math.max($,t.maxy);case"fhpath":if(A.x=z,A.y=$,w.x&&w.y)for(o=0;o<9;o++)if(r=o/10,E=I(a=(o+1)/10),G=E,E=I(r),(x+=Math.sqrt((G.x-E.x)*(G.x-E.x)+(G.y-E.y)*(G.y-E.y)))>.8){x-=.8;const e=c.createSVGPoint();e.x=E.x,e.y=E.y,F.points.appendItem(e)}w={x:S.x,y:S.y},S={x:C.x,y:C.y},C={x:A.x,y:A.y};break;case"path":case"pathedit":if(q*=h,Y*=h,n.gridSnapping&&(q=hn(q),Y=hn(Y),u=hn(u),f=hn(f)),e.shiftKey){const{path:e}=i;let t,n;e?(t=e.dragging?e.dragging[0]:u,n=e.dragging?e.dragging[1]:f):(t=u,n=f),d=Le(t,n,q,Y),({x:q,y:Y}=d)}ve&&"none"!==ve.getAttribute("display")&&(z*=h,$*=h,un(ve,{x:Math.min(_*h,z),y:Math.min(v*h,$),width:Math.abs(z-_*h),height:Math.abs($-v*h)},100)),k.mouseMove(q,Y);break;case"textedit":q*=h,Y*=h,He.mouseMove(D,U);break;case"rotate":{g=(V=Xt(R)).x+V.width/2,y=V.y+V.height/2;const t=Te(R),r=Ae(g,y,t);if(g=r.x,y=r.y,j=(Math.atan2(y-Y,g-q)*(180/Math.PI)-90)%360,n.gridSnapping&&(j=hn(j)),e.shiftKey){const e=45;j=Math.round(j/e)*e}s.setRotationAngle(j<-180?360+j:j,!0),O("transition",m);break}}we("mouseMove",{event:e,mouse_x:D,mouse_y:U,selected:R})}).click(function(e){return e.preventDefault(),!1}).dblclick(function(e){const t=e.target.parentNode;if(t===p)return;let n=B(e);const{tagName:r}=n;if("text"===r&&"textedit"!==fe){const t=Ae(e.pageX,e.pageY,De);He.select(n,t.x,t.y)}"g"!==r&&"a"!==r||!on(n)||(at(n),n=m[0],j(!0)),p&&Zn(),"g"!==t.tagName&&"a"!==t.tagName||t===d().getCurrentLayer()||n===T.selectorParentGroup||Jn(n)}).mouseup(function(e){if(2===e.button)return;const r=ye;if(ye=null,!le)return;const i=Ae(e.pageX,e.pageY,De),a=i.x*h,o=i.y*h,l=a/h,c=o/h;let u=cn(M()),p=!1;const f=l,b=c;let E,G;switch(le=!1,fe){case"resize":case"multiselect":gn(ve)||(ve.setAttribute("display","none"),be=[]),fe="select";case"select":if(!gn(m[0])){if(gn(m[1])){const e=m[0];switch(e.tagName){case"g":case"use":case"image":case"foreignObject":break;default:_e.fill=e.getAttribute("fill"),_e.fill_opacity=e.getAttribute("fill-opacity"),_e.stroke=e.getAttribute("stroke"),_e.stroke_opacity=e.getAttribute("stroke-opacity"),_e.stroke_width=e.getAttribute("stroke-width"),_e.stroke_dasharray=e.getAttribute("stroke-dasharray"),_e.stroke_linejoin=e.getAttribute("stroke-linejoin"),_e.stroke_linecap=e.getAttribute("stroke-linecap")}"text"===e.tagName&&(re.font_size=e.getAttribute("font-size"),re.font_family=e.getAttribute("font-family")),T.requestSelector(e).showGrips(!0)}if(Ve(),f!==_||b!==v){const e=m.length;for(let t=0;t<e&&!gn(m[t]);++t)m[t].firstChild||T.requestSelector(m[t]).resize()}else G=e.target,"path"===m[0].nodeName&&gn(m[1])?k.select(m[0]):e.shiftKey&&r!==G&&s.removeFromSelection([G]);if(Q()){const e=m[0];e&&(e.removeAttribute("style"),Dt(e,function(e){e.removeAttribute("style")}))}}return;case"zoom":{gn(ve)||ve.setAttribute("display","none");const t=e.shiftKey?.5:2;return void O("zoomed",{x:Math.min(_,f),y:Math.min(v,b),width:Math.abs(f-_),height:Math.abs(b-v),factor:t})}case"fhpath":{x=0,w={x:0,y:0},S={x:0,y:0},C={x:0,y:0},A={x:0,y:0};const e=u.getAttribute("points"),t=e.indexOf(",");(p=t>=0?e.indexOf(",",t+1)>=0:e.indexOf(" ",e.indexOf(" ")+1)>=0)&&(u=k.smoothPolylineIntoPath(u));break}case"line":E=Sr(u).attr(["x1","x2","y1","y2"]),p=E.x1!==E.x2||E.y1!==E.y2;break;case"foreignObject":case"square":case"rect":case"image":E=Sr(u).attr(["width","height"]),p=E.width||E.height||"image"===fe;break;case"circle":p="0"!==u.getAttribute("r");break;case"ellipse":E=Sr(u).attr(["rx","ry"]),p=E.rx||E.ry;break;case"fhellipse":t.maxx-t.minx>0&&t.maxy-t.miny>0&&(u=y({element:"ellipse",curStyles:!0,attr:{cx:(t.minx+t.maxx)/2,cy:(t.miny+t.maxy)/2,rx:(t.maxx-t.minx)/2,ry:(t.maxy-t.miny)/2,id:M()}}),O("changed",[u]),p=!0);break;case"fhrect":t.maxx-t.minx>0&&t.maxy-t.miny>0&&(u=y({element:"rect",curStyles:!0,attr:{x:t.minx,y:t.miny,width:t.maxx-t.minx,height:t.maxy-t.miny,id:M()}}),O("changed",[u]),p=!0);break;case"text":p=!0,Ue([u]),He.start(u);break;case"path":{u=null,le=!0;const t=k.mouseUp(e,u,a,o);({element:u}=t),({keep:p}=t);break}case"pathedit":p=!0,u=null,k.mouseUp(e);break;case"textedit":p=!1,u=null,He.mouseUp(e,a,o);break;case"rotate":{p=!0,u=null,fe="select";const e=s.undoMgr.finishUndoableChange();e.isEmpty()||P(e),Ve(),O("changed",m);break}}const I=we("mouseUp",{event:e,mouse_x:a,mouse_y:o},!0);if(Sr.each(I,function(e,t){t&&(p=t.keep||p,({element:u}=t),le=t.started||le)}),p||gn(u)){if(!gn(u)){s.addedNew=!0;let e,t=.2;if(X.beginElement&&parseFloat(u.getAttribute("opacity"))!==g.opacity){e=Sr(X).clone().attr({to:g.opacity,dur:t}).appendTo(u);try{e[0].beginElement()}catch(e){}}else t=0;setTimeout(function(){e&&e.remove(),u.setAttribute("opacity",g.opacity),u.setAttribute("style","pointer-events:inherit"),dn(u),"path"===fe?k.toEditMode(u):n.selectNew&&Ue([u],!0),P(new Cr(u)),O("changed",[u])},1e3*t)}}else{for(d().releaseId(M()),u.remove(),u=null,G=e.target;G&&G.parentNode&&G.parentNode.parentNode&&"g"===G.parentNode.parentNode.tagName;)G=G.parentNode;"path"===fe&&Fe||!G||!G.parentNode||"selectorParentGroup"===G.parentNode.id||"svgcanvas"===G.id||"svgroot"===G.id||(s.setMode("select"),Ue([G],!0))}ce=null}),Sr(e).bind("mousewheel DOMMouseScroll",function(e){if(!e.shiftKey)return;e.preventDefault();const t=e.originalEvent;De=Sr("#svgcontent g")[0].getScreenCTM().inverse();const r=Sr("#workarea"),i=n.showRulers?16:0,a=Ae(t.pageX,t.pageY,De),o=r.width(),l=r.height(),c=o-15-i,u=l-15-i,d=c*De.a,p=u*De.d,f=r.offset(),g=f.left+i,m=f.top+i,_=t.wheelDelta?t.wheelDelta:t.detail?-t.detail:0;if(!_)return;let y,v,b=Math.max(.75,Math.min(4/3,_));b>1?(y=Math.ceil(c/d*b*100)/100,v=Math.ceil(u/p*b*100)/100):(y=Math.floor(c/d*b*100)/100,v=Math.floor(u/p*b*100)/100);let x=Math.min(y,v);if((x=Math.min(10,Math.max(.01,x)))===h)return;b=x/h;const w=Ae(g,m,De),S={x:(a.x-(a.x-w.x)/b)*x-i+o/2,y:(a.y-(a.y-w.y)/b)*x-i+l/2};s.setZoom(x),Sr("#zoom").val((100*x).toFixed(1)),O("updateCanvas",{center:!1,newCtr:S}),O("zoomDone")})}();const He=s.textActions=function(){let e,t,n,r,i,a,o,c,u,d,p=[];function f(e){const s=""===t.value;if(Sr(t).focus(),!arguments.length)if(s)e=0;else{if(t.selectionEnd!==t.selectionStart)return;e=t.selectionEnd}const o=p[e];s||t.setSelectionRange(e,e),(n=cn("text_cursor"))||(n=document.createElementNS(v.SVG,"line"),un(n,{id:"text_cursor",stroke:"#333","stroke-width":1}),n=cn("selectorParentGroup").appendChild(n)),i||(i=setInterval(function(){const e="none"===n.getAttribute("display");n.setAttribute("display",e?"inline":"none")},600));const l=w(o.x,a.y),c=w(o.x,a.y+a.height);un(n,{x1:l.x,y1:l.y,x2:c.x,y2:c.y,visibility:"visible",display:"inline"}),r&&r.setAttribute("d","")}function g(e,i,s){if(e===i)return void f(i);s||t.setSelectionRange(e,i),(r=cn("text_selectblock"))||(r=document.createElementNS(v.SVG,"path"),un(r,{id:"text_selectblock",fill:"green",opacity:.5,style:"pointer-events:none"}),cn("selectorParentGroup").append(r));const o=p[e],l=p[i];n.setAttribute("visibility","hidden");const c=w(o.x,a.y),u=w(o.x+(l.x-o.x),a.y),d=w(o.x,a.y+a.height),h=w(o.x+(l.x-o.x),a.y+a.height),g="M"+c.x+","+c.y+" L"+u.x+","+u.y+" "+h.x+","+h.y+" "+d.x+","+d.y+"z";un(r,{d:g,display:"inline"})}function _(t,n){const r=l.createSVGPoint();if(r.x=t,r.y=n,1===p.length)return 0;let i=e.getCharNumAtPosition(r);i<0?(i=p.length-2,t<=p[0].x&&(i=0)):i>=p.length-2&&(i=p.length-2);const a=p[i];return t>a.x+a.width/2&&i++,i}function y(e,t){f(_(e,t))}function b(e,n,r){const i=t.selectionStart,a=_(e,n);g(Math.min(i,a),Math.max(i,a),!r)}function x(e,t){const n={x:e,y:t};if(n.x/=h,n.y/=h,o){const e=Ae(n.x,n.y,o.inverse());n.x=e.x,n.y=e.y}return n}function w(e,t){const n={x:e,y:t};if(o){const e=Ae(n.x,n.y,o);n.x=e.x,n.y=e.y}return n.x*=h,n.y*=h,n}function S(t){g(0,e.textContent.length),Sr(this).unbind(t)}function k(t){if(!d||!e)return;const n=Ae(t.pageX,t.pageY,De),r=x(n.x*h,n.y*h),i=_(r.x,r.y),a=e.textContent,s=a.substr(0,i).replace(/[a-z0-9]+$/i,"").length,o=a.substr(i).match(/^[a-z0-9]+/i);g(s,(o?o[0].length:0)+i),Sr(t.target).click(S),setTimeout(function(){Sr(t.target).unbind("click",S)},300)}return{select(t,n,r){e=t,He.toEditMode(n,r)},start(t){e=t,He.toEditMode()},mouseDown(e,n,r,i){const a=x(r,i);t.focus(),y(a.x,a.y),c=r,u=i},mouseMove(e,t){const n=x(e,t);b(n.x,n.y)},mouseUp(t,n,r){const i=x(n,r);b(i.x,i.y,!0),t.target!==e&&n<c+2&&n>c-2&&r<u+2&&r>u-2&&He.toSelectMode(!0)},setCursor:f,toEditMode(t,n){if(d=!1,fe="textedit",T.requestSelector(e).showGrips(!1),T.requestSelector(e),He.init(),Sr(e).css("cursor","text"),arguments.length){const e=x(t,n);y(e.x,e.y)}else f();setTimeout(function(){d=!0},300)},toSelectMode(a){fe="select",clearInterval(i),i=null,r&&Sr(r).attr("display","none"),n&&Sr(n).attr("visibility","hidden"),Sr(e).css("cursor","move"),a&&(j(),Sr(e).css("cursor","move"),O("selected",[e]),V([e],!0)),e&&!e.textContent.length&&s.deleteSelectedElements(),Sr(t).blur(),e=!1},setInputElem(e){t=e},clear(){"textedit"===fe&&He.toSelectMode()},init(n){if(!e)return;let r,i;e.parentNode||(e=m[0],T.requestSelector(e).showGrips(!1));const l=e.textContent.length,c=e.getAttribute("transform");for(a=Xt(e),o=c?Te(e):null,(p=[]).length=l,t.focus(),Sr(e).unbind("dblclick",k).dblclick(k),l||(i={x:a.x+a.width/2,width:0}),r=0;r<l;r++){const t=e.getStartPositionOfChar(r);if(i=e.getEndPositionOfChar(r),!W()){const e=s.contentW*h;t.x-=e,i.x-=e,t.x/=h,i.x/=h}p[r]={x:t.x,y:a.y,width:i.x-t.x,height:a.height}}p.push({x:i.x,width:0}),g(t.selectionStart,t.selectionEnd,!0)}}}(),ze=this.removeUnusedDefElems=function(){const e=c.getElementsByTagNameNS(v.SVG,"defs");if(!e||!e.length)return 0;const t=[];let n=0;const r=["fill","stroke","filter","marker-start","marker-mid","marker-end"],i=r.length,a=c.getElementsByTagNameNS(v.SVG,"*"),s=a.length;let o,l;for(o=0;o<s;o++){const e=a[o];for(l=0;l<i;l++){const n=Ft(e.getAttribute(r[l]));n&&t.push(n.substr(1))}const n=Ht(e);n&&n.startsWith("#")&&t.push(n.substr(1))}const u=Sr(e).find("linearGradient, radialGradient, filter, marker, svg, symbol");for(o=u.length;o--;){const e=u[o],{id:r}=e;t.includes(r)||(se[r]=e,e.remove(),n++)}return n};function $e(){j();const e=[],t=[],n={feGaussianBlur:D.exportNoBlur,foreignObject:D.exportNoforeignObject,"[stroke-dasharray]":D.exportNoDashArray},r=Sr(c);return"font"in Sr("<canvas>")[0].getContext("2d")||(n.text=D.exportNoText),Sr.each(n,function(n,i){r.find(n).length&&(t.push(n),e.push(i))}),{issues:e,issueCodes:t}}let Ye;this.svgCanvasToString=function(){for(;ze()>0;);k.clear(!0),Sr.each(c.childNodes,function(e,t){e&&8===t.nodeType&&t.data.includes("Created with")&&c.firstChild.before(t)}),p&&(Zn(),Ue([p]));const e=[];Sr(c).find("g:data(gsvg)").each(function(){const t=this.attributes;let n=t.length;for(let e=0;e<n;e++)"id"!==t[e].nodeName&&"style"!==t[e].nodeName||n--;if(n<=0){const t=this.firstChild;e.push(t),Sr(this).replaceWith(t)}});const t=this.svgToString(c,0);return e.length&&Sr(e).each(function(){Ce(this)}),t},this.svgToString=function(e,t){const r=[],i=n.baseUnit,a=new RegExp("^-?[\\d\\.]+"+i+"$");if(e){dn(e);const n=[...e.attributes],s=e.childNodes;n.sort((e,t)=>e.name>t.name?-1:1);for(let e=0;e<t;e++)r.push(" ");if(r.push("<"),r.push(e.nodeName),"svgcontent"===e.id){const t=Je(),a="";"px"!==i&&(t.w=pe(t.w,i)+i,t.h=pe(t.h,i)+i),r.push(' width="'+t.w+'" height="'+t.h+'"'+a+' xmlns="'+v.SVG+'"');const s={};Sr(e).find("*").andSelf().each(function(){const e=this.namespaceURI;e&&!s[e]&&E[e]&&"xmlns"!==E[e]&&"xml"!==E[e]&&(s[e]=!0,r.push(" xmlns:"+E[e]+'="'+e+'"')),Sr.each(this.attributes,function(e,t){const n=t.namespaceURI;n&&!s[n]&&"xmlns"!==E[n]&&"xml"!==E[n]&&(s[n]=!0,r.push(" xmlns:"+E[n]+'="'+n+'"'))})});let o=n.length;const l=["width","height","xmlns","x","y","viewBox","id","overflow"];for(;o--;){const e=n[o],t=Nt(e.value);e.nodeName.startsWith("xmlns:")||""===t||l.includes(e.localName)||e.namespaceURI&&!E[e.namespaceURI]||(r.push(" "),r.push(e.nodeName),r.push('="'),r.push(t),r.push('"'))}}else{if("defs"===e.nodeName&&!e.firstChild)return"";const t=["-moz-math-font-style","_moz-math-font-style"];for(let s=n.length-1;s>=0;s--){const o=n[s];let l=Nt(o.value);if(!t.includes(o.localName)&&""!==l){if(l.startsWith("pointer-events"))continue;if("class"===o.localName&&l.startsWith("se_"))continue;if(r.push(" "),"d"===o.localName&&(l=k.convertPath(e,!0)),isNaN(l)?a.test(l)&&(l=he(l)+i):l=he(l),J.apply&&"image"===e.nodeName&&"href"===o.localName&&J.images&&"embed"===J.images){const e=Z[l];e&&(l=e)}o.namespaceURI&&o.namespaceURI!==v.SVG&&!E[o.namespaceURI]||(r.push(o.nodeName),r.push('="'),r.push(l),r.push('"'))}}}if(e.hasChildNodes()){r.push(">"),t++;let n=!1;for(let e=0;e<s.length;e++){const i=s.item(e);switch(i.nodeType){case 1:r.push("\n"),r.push(this.svgToString(s.item(e),t));break;case 3:{const e=i.nodeValue.replace(/^\s+|\s+$/g,"");""!==e&&(n=!0,r.push(String(Nt(e))));break}case 4:r.push("\n"),r.push(new Array(t+1).join(" ")),r.push("<![CDATA["),r.push(i.nodeValue),r.push("]]>");break;case 8:r.push("\n"),r.push(new Array(t+1).join(" ")),r.push("\x3c!--"),r.push(i.data),r.push("--\x3e")}}if(t--,!n){r.push("\n");for(let e=0;e<t;e++)r.push(" ")}r.push("</"),r.push(e.nodeName),r.push(">")}else r.push("/>")}return r.join("")},this.embedImage=function(e){return new Promise(function(t,n){Sr(new Image).load(function(r,i,a){if("error"===i)return void n(new Error("Error loading image: "+a.status+" "+a.statusText));const s=document.createElement("canvas");s.width=this.width,s.height=this.height,s.getContext("2d").drawImage(this,0,0);try{let t=";svgedit_url="+encodeURIComponent(e);t=s.toDataURL().replace(";base64",t+";base64"),Z[e]=t}catch(t){Z[e]=!1}oe=e,t(Z[e])}).attr("src",e)})},this.setGoodImage=function(e){oe=e},this.open=function(){},this.save=function(e){j(),e&&Sr.extend(J,e),J.apply=!0;const t=this.svgCanvasToString();O("saved",t)},this.rasterExport=async function(e,t,r,i={}){const a="ICO"===e?"BMP":e||"PNG",o="image/"+a.toLowerCase(),{issues:l,issueCodes:c}=$e(),u=this.svgCanvasToString();Ye||({canvg:Ye}=await xn(n.canvgPath+"canvg.js",{global:"canvg"})),Sr("#export_canvas").length||Sr("<canvas>",{id:"export_canvas"}).hide().appendTo("body");const d=Sr("#export_canvas")[0];return d.width=s.contentW,d.height=s.contentH,await Ye(d,u),new Promise((n,s)=>{const h=a.toLowerCase(),p=t?d.toDataURL("image/"+h,t):d.toDataURL("image/"+h);let f;function g(){const a={datauri:p,bloburl:f,svg:u,issues:l,issueCodes:c,type:e,mimeType:o,quality:t,exportWindowName:r};i.avoidEvent||O("exported",a),n(a)}d.toBlob?d.toBlob(e=>{f=Vt(e),g()},o,t):(f=jt(p),g())})},this.exportPDF=async function(e,t=(z()?"save":void 0)){if(!window.jsPDF){await wn(["jspdf/underscore-min.js","jspdf/jspdf.min.js"]);const e=!("svgEditor"in window&&window.svgEditor&&!1===window.svgEditor.modules);await wn(n.jspdfPath+"jspdf.plugin.svgToPdf.js",{type:e?"module":"text/javascript"})}const r=Je(),i=r.w>r.h?"landscape":"portrait",a=jsPDF({orientation:i,unit:"pt",format:[r.w,r.h]}),s=et();a.setProperties({title:s});const{issues:o,issueCodes:l}=$e(),c=this.svgCanvasToString();a.addSVG(c,0,0);const u={svg:c,issues:o,issueCodes:l,exportWindowName:e,outputType:t=t||"dataurlstring"};return u.output=a.output(t,"save"===t?e||"svg.pdf":void 0),O("exportedPDF",u),u},this.getSvgString=function(){return J.apply=!1,this.svgCanvasToString()},this.randomizeIds=function(e){arguments.length>0&&!1===e?Rn(!1,d()):Rn(!0,d())};const Xe=this.uniquifyElems=function(e){const t={},n=["filter","linearGradient","pattern","radialGradient","symbol","textPath","use"];Dt(e,function(e){if(1===e.nodeType){e.id&&(e.id in t||(t[e.id]={elem:null,attrs:[],hrefs:[]}),t[e.id].elem=e),Sr.each($,function(n,r){const i=e.getAttributeNode(r);if(i){const e=Ft(i.value),n=e?e.substr(1):null;n&&(n in t||(t[n]={elem:null,attrs:[],hrefs:[]}),t[n].attrs.push(i))}});const r=Ht(e);if(r&&n.includes(e.nodeName)){const n=r.substr(1);n&&(n in t||(t[n]={elem:null,attrs:[],hrefs:[]}),t[n].hrefs.push(e))}}});for(const e in t){if(!e)continue;const{elem:n}=t[e];if(n){const r=L();n.id=r;const{attrs:i}=t[e];let a=i.length;for(;a--;){const e=i[a];e.ownerElement.setAttribute(e.name,"url(#"+r+")")}const s=t[e].hrefs;let o=s.length;for(;o--;){const e=s[o];zt(e,"#"+r)}}}},We=this.setUseData=function(e){let t=Sr(e);"use"!==e.tagName&&(t=t.find("use")),t.each(function(){const e=Ht(this).substr(1),t=cn(e);t&&(Sr(this).data("ref",t),"symbol"!==t.tagName&&"svg"!==t.tagName||Sr(this).data("symbol",t).data("ref",t))})},Qe=this.convertGradients=function(e){let t=Sr(e).find("linearGradient, radialGradient");!t.length&&U()&&(t=Sr(e).find("*").filter(function(){return this.tagName.includes("Gradient")})),t.each(function(){const e=this;if("userSpaceOnUse"===Sr(e).attr("gradientUnits")){const t=Sr(c).find('[fill="url(#'+e.id+')"],[stroke="url(#'+e.id+')"]');if(!t.length)return;const n=Xt(t[0]);if(!n)return;if("linearGradient"===e.tagName){const t=Sr(e).attr(["x1","y1","x2","y2"]),r=e.gradientTransform.baseVal;if(r&&r.numberOfItems>0){const n=Ne(r).matrix,i=Ae(t.x1,t.y1,n),a=Ae(t.x2,t.y2,n);t.x1=i.x,t.y1=i.y,t.x2=a.x,t.y2=a.y,e.removeAttribute("gradientTransform")}Sr(e).attr({x1:(t.x1-n.x)/n.width,y1:(t.y1-n.y)/n.height,x2:(t.x2-n.x)/n.width,y2:(t.y2-n.y)/n.height}),e.removeAttribute("gradientUnits")}}})},Ke=this.convertToGroup=function(e){e||(e=m[0]);const t=Sr(e),n=new Gr;let r;if(t.data("gsvg")){const t=e.firstChild,n=Sr(t).attr(["x","y"]);Sr(e.firstChild.firstChild).unwrap(),Sr(e).removeData("gsvg");const r=ie(e),i=l.createSVGTransform();i.setTranslate(n.x,n.y),r.appendItem(i),pr(e),O("selected",[e])}else if(t.data("symbol")){e=t.data("symbol"),r=t.attr("transform");const i=t.attr(["x","y"]),a=e.getAttribute("viewBox");if(a){const e=a.split(" ");i.x-=Number(e[0]),i.y-=Number(e[1])}r+=" translate("+(i.x||0)+","+(i.y||0)+")";const s=t.prev();n.addSubCommand(new Ar(t[0],t[0].nextSibling,t[0].parentNode)),t.remove();const l=Sr(c).find("use:data(symbol)").length,u=o.createElementNS(v.SVG,"g"),d=e.childNodes;let h;for(h=0;h<d.length;h++)u.append(d[h].cloneNode(!0));if(F()){const e=Sr(qt()).children("linearGradient,radialGradient,pattern").clone();Sr(u).append(e)}r&&u.setAttribute("transform",r);const p=e.parentNode;if(Xe(u),F()&&Sr(qt()).append(Sr(u).find("linearGradient,radialGradient,pattern")),u.id=L(),s.after(u),p){if(!l){const{nextSibling:t}=e;e.remove(),n.addSubCommand(new Ar(e,t,p))}n.addSubCommand(new Cr(u))}We(u),F()?Qe(qt()):Qe(u),Ut(u,function(e){try{pr(e)}catch(e){console.log(e)}}),Sr(u).find(q).each(function(){this.id||(this.id=L())}),Ue([u]);const f=at(u,!0);f&&n.addSubCommand(f),P(n)}else console.log("Unexpected element to ungroup:",e)};this.setSvgString=function(e,t){try{const r=Bt(e);if(r.firstElementChild&&r.firstElementChild.namespaceURI!==v.SVG)return!1;this.prepareSvg(r);const i=new Gr("Change Source"),{nextSibling:a}=c,p=l.removeChild(c);i.addSubCommand(new Ar(p,a,l)),c=o.adoptNode?o.adoptNode(r.documentElement):o.importNode(r.documentElement,!0),l.append(c);const f=Sr(c);s.current_drawing_=new Vn(c,u);const g=d().getNonce();g?O("setnonce",g):O("unsetnonce"),f.find("image").each(function(){const e=this;pn(e);const t=Ht(this);if(t){if(t.startsWith("data:")){const n=t.match(/svgedit_url=(.*?);/);if(n){const t=decodeURIComponent(n[1]);Sr(new Image).load(function(){e.setAttributeNS(v.XLINK,"xlink:href",t)}).attr("src",t)}}s.embedImage(t)}}),f.find("svg").each(function(){if(Sr(this).closest("defs").length)return;Xe(this);const e=this.parentNode;1===e.childNodes.length&&"g"===e.nodeName?(Sr(e).data("gsvg",this),e.id=e.id||L()):Ce(this)}),F()&&f.find("linearGradient, radialGradient, pattern").appendTo(qt()),We(f),Qe(f[0]);const m={id:"svgcontent",overflow:n.show_outside_canvas?"visible":"hidden"};let _=!1;if(f.attr("viewBox")){const e=f.attr("viewBox").split(" ");m.width=e[2],m.height=e[3]}else Sr.each(["width","height"],function(e,t){const n=f.attr(t)||"100%";"%"===String(n).substr(-1)?_=!0:m[t]=ge(t,n)});if(Un(),f.children().find(q).each(function(){this.id||(this.id=L())}),_){const e=an();m.width=e.width+e.x,m.height=e.height+e.y}m.width<=0&&(m.width=100),m.height<=0&&(m.height=100),f.attr(m),this.contentW=m.width,this.contentH=m.height,i.addSubCommand(new Cr(c));const y=f.attr(["width","height"]);i.addSubCommand(new Er(l,y)),h=1,ne(),j(),mt(),l.append(T.selectorParentGroup),t||P(i),O("changed",[c])}catch(e){return console.log(e),!1}return!0},this.importSvgString=function(e){let t,n,r;try{const i=Tt(e.length+e).substr(0,32);let a=!1;ee[i]&&Sr(ee[i].symbol).parents("#svgroot").length&&(a=!0);const s=new Gr("Import Image");let l;if(a)({symbol:l}=ee[i]),n=ee[i].xform;else{const r=Bt(e);let a;this.prepareSvg(r),a=o.adoptNode?o.adoptNode(r.documentElement):o.importNode(r.documentElement,!0),Xe(a);const u=ge("width",a.getAttribute("width")),d=ge("height",a.getAttribute("height")),h=a.getAttribute("viewBox"),p=h?h.split(" "):[0,0,u,d];for(t=0;t<4;++t)p[t]=Number(p[t]);const f=Number(c.getAttribute("height"));n="translate(0) "+(n=d>u?"scale("+f/3/p[3]+")":"scale("+f/3/p[2]+")")+" translate(0)",l=o.createElementNS(v.SVG,"symbol");const g=qt();for(F()&&Sr(a).find("linearGradient, radialGradient, pattern").appendTo(g);a.firstChild;){const e=a.firstChild;l.append(e)}const m=a.attributes;for(let e=0;e<m.length;e++){const t=m[e];l.setAttribute(t.nodeName,t.value)}l.id=L(),ee[i]={symbol:l,xform:n},qt().append(l),s.addSubCommand(new Cr(l))}(r=o.createElementNS(v.SVG,"use")).id=L(),zt(r,"#"+l.id),(p||d().getCurrentLayer()).append(r),s.addSubCommand(new Cr(r)),j(),r.setAttribute("transform",n),pr(r),Sr(r).data("symbol",l).data("ref",l),V([r]),P(s),O("changed",[c])}catch(e){return console.log(e),null}return r};const Ze={identifyLayers:Un,createLayer:Fn,cloneLayer:Hn,deleteCurrentLayer:zn,setCurrentLayer:qn,renameCurrentLayer:$n,setCurrentLayerPosition:Yn,setLayerVisibility:Xn,moveSelectedToLayer:Wn,mergeLayer:Qn,mergeAllLayers:Kn,leaveContext:Zn,setContext:Jn};Object.entries(Ze).forEach(([e,t])=>{s[e]=t}),Dn({pathActions:k,getCurrentGroup:()=>p,setCurrentGroup(e){p=e},getSelectedElements:S,getSVGContent:w,undoMgr:G,elData:Y,getCurrentDrawing:d,clearSelection:j,call:O,addCommandToHistory:P,changeSVGContent(){O("changed",[c])}}),this.clear=function(){k.clear(),j(),s.clearSvgContentElement(),s.current_drawing_=new Vn(c),s.createLayer("Layer 1"),s.undoMgr.resetUndoStack(),T.initGroup(),ve=T.getRubberBandBox(),O("cleared")},this.linkControlPoints=k.linkControlPoints,this.getContentElem=function(){return c},this.getRootElem=function(){return l};const Je=this.getResolution=function(){return{w:c.getAttribute("width")/h,h:c.getAttribute("height")/h,zoom:h}};this.getSnapToGrid=function(){return n.gridSnapping},this.getVersion=function(){return"svgcanvas.js ($Rev$)"},this.setUiStrings=function(e){Object.assign(D,e.notification),Sr=kn(Sr,e.common),Re(e)},this.setConfig=function(e){Object.assign(n,e)},this.getTitle=function(e){if(!(e=e||m[0]))return;const t=(e=Sr(e).data("gsvg")||Sr(e).data("symbol")||e).childNodes;for(let e=0;e<t.length;e++)if("title"===t[e].nodeName)return t[e].textContent;return""},this.setGroupTitle=function(e){let t=m[0];t=Sr(t).data("gsvg")||t;const n=Sr(t).children("title"),r=new Gr("Set Label");let i;if(e.length)n.length?(i=n[0],r.addSubCommand(new Er(i,{"#text":i.textContent})),i.textContent=e):((i=o.createElementNS(v.SVG,"title")).textContent=e,Sr(t).prepend(i),r.addSubCommand(new Cr(i)));else{const e=n.nextSibling;r.addSubCommand(new Ar(n[0],e,t)),n.remove()}P(r)};const et=this.getDocumentTitle=function(){return s.getTitle(c)};this.setDocumentTitle=function(e){const t=c.childNodes;let n=!1,r="";const i=new Gr("Change Image Title");for(let e=0;e<t.length;e++)if("title"===t[e].nodeName){r=(n=t[e]).textContent;break}n||(n=o.createElementNS(v.SVG,"title"),c.insertBefore(n,c.firstChild)),e.length?n.textContent=e:n.remove(),i.addSubCommand(new Er(n,{"#text":r})),P(i)},this.getEditorNS=function(e){return e&&c.setAttribute("xmlns:se",v.SE),v.SE},this.setResolution=function(e,t){const n=Je(),{w:r,h:i}=n;let a;if("fit"===e){const n=an();if(!n)return!1;{a=new Gr("Fit Canvas to Content");const r=rn();V(r);const i=[],o=[];Sr.each(r,function(e,t){i.push(-1*n.x),o.push(-1*n.y)});const l=s.moveSelectedElements(i,o,!0);a.addSubCommand(l),j(),e=Math.round(n.width),t=Math.round(n.height)}}return e===r&&t===i||(a||(a=new Gr("Change Image Dimensions")),e=ge("width",e),t=ge("height",t),c.setAttribute("width",e),c.setAttribute("height",t),this.contentW=e,this.contentH=t,a.addSubCommand(new Er(c,{width:r,height:i})),c.setAttribute("viewBox",[0,0,e/h,t/h].join(" ")),a.addSubCommand(new Er(c,{viewBox:["0 0",r,i].join(" ")})),P(a),O("changed",[c])),!0},this.getOffset=function(){return Sr(c).attr(["x","y"])},this.setBBoxZoom=function(e,t,n){let r,i=.85;const a=function(e){if(!e)return!1;const r=Math.round(t/e.width*100*i)/100,a=Math.round(n/e.height*100*i)/100,o=Math.min(r,a);return s.setZoom(o),{zoom:o,bbox:e}};if("object"==typeof e){if(0===(r=e).width||0===r.height){const e=r.zoom?r.zoom:h*r.factor;return s.setZoom(e),{zoom:h,bbox:r}}return a(r)}switch(e){case"selection":{if(!m[0])return;const e=Sr.map(m,function(e){if(e)return e});r=an(e);break}case"canvas":{const e=Je();i=.95,r={width:e.w,height:e.h,x:0,y:0};break}case"content":r=an();break;case"layer":r=an(rn(d().getCurrentLayer()));break;default:return}return a(r)},this.setZoom=function(e){const t=Je();c.setAttribute("viewBox","0 0 "+t.w/e+" "+t.h/e),h=e,Sr.each(m,function(e,t){t&&T.requestSelector(t).resize()}),k.zoomChange(),we("zoomChanged",e)},this.getMode=function(){return fe},this.setMode=function(e){k.clear(!0),He.clear(),_e=m[0]&&"text"===m[0].nodeName?re:g,fe=e},this.getColor=function(e){return _e[e]},this.setColor=function(e,t,n){g[e]=t,_e[e+"_paint"]={type:"solidColor"};const r=[];function i(e){"g"!==e.nodeName&&r.push(e)}let a=m.length;for(;a--;){const t=m[a];t&&("g"===t.tagName?Dt(t,i):"fill"===e?"polyline"!==t.tagName&&"line"!==t.tagName&&r.push(t):r.push(t))}r.length>0&&(n?rt(e,t,r):(it(e,t,r),O("changed",r)))};const tt=this.setGradient=function(e){if(!_e[e+"_paint"]||"solidColor"===_e[e+"_paint"].type)return;let t=s[e+"Grad"];const n=nt(t),r=qt();n?t=n:(t=r.appendChild(o.importNode(t,!0))).id=L(),s.setColor(e,"url(#"+t.id+")")},nt=function(e){const t=qt(),n=Sr(t).find("linearGradient, radialGradient");let r=n.length;const i=["r","cx","cy","fx","fy"];for(;r--;){const t=n[r];if("linearGradient"===e.tagName){if(e.getAttribute("x1")!==t.getAttribute("x1")||e.getAttribute("y1")!==t.getAttribute("y1")||e.getAttribute("x2")!==t.getAttribute("x2")||e.getAttribute("y2")!==t.getAttribute("y2"))continue}else{const n=Sr(e).attr(i),r=Sr(t).attr(i);let a=!1;if(Sr.each(i,function(e,t){n[t]!==r[t]&&(a=!0)}),a)continue}const a=e.getElementsByTagNameNS(v.SVG,"stop"),s=t.getElementsByTagNameNS(v.SVG,"stop");if(a.length!==s.length)continue;let o=a.length;for(;o--;){const e=a[o],t=s[o];if(e.getAttribute("offset")!==t.getAttribute("offset")||e.getAttribute("stop-opacity")!==t.getAttribute("stop-opacity")||e.getAttribute("stop-color")!==t.getAttribute("stop-color"))break}if(-1===o)return t}return null};this.setPaint=function(e,t){const n=new Sr.jGraduate.Paint(t);switch(this.setPaintOpacity(e,n.alpha/100,!0),_e[e+"_paint"]=n,n.type){case"solidColor":this.setColor(e,"none"!==n.solidColor?"#"+n.solidColor:"none");break;case"linearGradient":case"radialGradient":s[e+"Grad"]=n[n.type],tt(e)}},this.setStrokePaint=function(e){this.setPaint("stroke",e)},this.setFillPaint=function(e){this.setPaint("fill",e)},this.getStrokeWidth=function(){return _e.stroke_width},this.setStrokeWidth=function(e){if(0===e&&["line","path"].includes(fe))return void s.setStrokeWidth(1);_e.stroke_width=e;const t=[];function n(e){"g"!==e.nodeName&&t.push(e)}let r=m.length;for(;r--;){const e=m[r];e&&("g"===e.tagName?Dt(e,n):t.push(e))}t.length>0&&(it("stroke-width",e,t),O("changed",m))},this.setStrokeAttr=function(e,t){g[e.replace("-","_")]=t;const n=[];let r=m.length;for(;r--;){const e=m[r];e&&("g"===e.tagName?Dt(e,function(e){"g"!==e.nodeName&&n.push(e)}):n.push(e))}n.length>0&&(it(e,t,n),O("changed",m))},this.getStyle=function(){return g},this.getOpacity=R,this.setOpacity=function(e){g.opacity=e,it("opacity",e)},this.getFillOpacity=function(){return g.fill_opacity},this.getStrokeOpacity=function(){return g.stroke_opacity},this.setPaintOpacity=function(e,t,n){g[e+"_opacity"]=t,n?rt(e+"-opacity",t):it(e+"-opacity",t)},this.getPaintOpacity=function(e){return"fill"===e?this.getFillOpacity():this.getStrokeOpacity()},this.getBlur=function(e){let t=0;if(e&&e.getAttribute("filter")){const n=cn(e.id+"_blur");n&&(t=n.firstChild.getAttribute("stdDeviation"))}return t},function(){let e=null,t=null,n=!1;function r(){const n=s.undoMgr.finishUndoableChange();e.addSubCommand(n),P(e),e=null,t=null}s.setBlurNoUndo=function(e){if(t)if(0===e)rt("filter",""),n=!0;else{const r=m[0];n&&rt("filter","url(#"+r.id+"_blur)"),U()&&(r.removeAttribute("filter"),r.setAttribute("filter","url(#"+r.id+"_blur)")),rt("stdDeviation",e,[t.firstChild]),s.setBlurOffsets(t,e)}else s.setBlur(e)},s.setBlurOffsets=function(e,t){t>3?un(e,{x:"-50%",y:"-50%",width:"200%",height:"200%"},100):U()||(e.removeAttribute("x"),e.removeAttribute("y"),e.removeAttribute("width"),e.removeAttribute("height"))},s.setBlur=function(n,i){if(e)return void r();const a=m[0],o=a.id;t=cn(o+"_blur"),n-=0;const l=new Gr;if(t)0===n&&(t=null);else{const e=y({element:"feGaussianBlur",attr:{in:"SourceGraphic",stdDeviation:n}});(t=y({element:"filter",attr:{id:o+"_blur"}})).append(e),qt().append(t),l.addSubCommand(new Cr(t))}const c={filter:a.getAttribute("filter")};if(0===n)return a.removeAttribute("filter"),void l.addSubCommand(new Er(a,c));it("filter","url(#"+o+"_blur)"),l.addSubCommand(new Er(a,c)),s.setBlurOffsets(t,n),e=l,s.undoMgr.beginUndoableChange("stdDeviation",[t?t.firstChild:null]),i&&(s.setBlurNoUndo(n),r())}}(),this.getBold=function(){const e=m[0];return!(gn(e)||"text"!==e.tagName||!gn(m[1]))&&"bold"===e.getAttribute("font-weight")},this.setBold=function(e){const t=m[0];!gn(t)&&"text"===t.tagName&&gn(m[1])&&it("font-weight",e?"bold":"normal"),m[0].textContent||He.setCursor()},this.getItalic=function(){const e=m[0];return!(gn(e)||"text"!==e.tagName||!gn(m[1]))&&"italic"===e.getAttribute("font-style")},this.setItalic=function(e){const t=m[0];!gn(t)&&"text"===t.tagName&&gn(m[1])&&it("font-style",e?"italic":"normal"),m[0].textContent||He.setCursor()},this.getFontFamily=function(){return re.font_family},this.setFontFamily=function(e){re.font_family=e,it("font-family",e),m[0]&&!m[0].textContent&&He.setCursor()},this.setFontColor=function(e){re.fill=e,it("fill",e)},this.getFontColor=function(){return re.fill},this.getFontSize=function(){return re.font_size},this.setFontSize=function(e){re.font_size=e,it("font-size",e),m[0].textContent||He.setCursor()},this.getText=function(){const e=m[0];return gn(e)?"":e.textContent},this.setTextContent=function(e){it("#text",e),He.init(e),He.setCursor()},this.setImageURL=function(e){const t=m[0];if(!t)return;const n=Sr(t).attr(["width","height"]),r=!n.width||!n.height,i=Ht(t);if(i===e&&!r)return;const a=new Gr("Change Image URL");zt(t,e),a.addSubCommand(new Er(t,{"#href":i})),Sr(new Image).load(function(){const e=Sr(t).attr(["width","height"]);Sr(t).attr({width:this.width,height:this.height}),T.requestSelector(t).resize(),a.addSubCommand(new Er(t,e)),P(a),O("changed",[t])}).attr("src",e)},this.setLinkURL=function(e){let t=m[0];if(!t)return;if("a"!==t.tagName){const e=Sr(t).parents("a");if(!e.length)return;t=e[0]}const n=Ht(t);if(n===e)return;const r=new Gr("Change Link URL");zt(t,e),r.addSubCommand(new Er(t,{"#href":n})),P(r)},this.setRectRadius=function(e){const t=m[0];if(!gn(t)&&"rect"===t.tagName){const n=t.getAttribute("rx");n!==String(e)&&(t.setAttribute("rx",e),t.setAttribute("ry",e),P(new Er(t,{rx:n,ry:n},"Radius")),O("changed",[t]))}},this.makeHyperlink=function(e){s.groupSelectedElements("a",e)},this.removeHyperlink=function(){s.ungroupSelectedElement()},this.setSegType=function(e){k.setSegType(e)},this.convertToPath=function(e,t){if(gn(e)){const e=m;return void Sr.each(e,function(e,t){t&&s.convertToPath(t)})}if(t)return Zt(e,y,k);const n={fill:g.fill,"fill-opacity":g.fill_opacity,stroke:g.stroke,"stroke-width":g.stroke_width,"stroke-dasharray":g.stroke_dasharray,"stroke-linejoin":g.stroke_linejoin,"stroke-linecap":g.stroke_linecap,"stroke-opacity":g.stroke_opacity,opacity:g.opacity,visibility:"hidden"};return Jt(e,n,y,k,j,V,r,P)};const rt=function(e,t,n){"pathedit"===fe&&k.moveNode(e,t);let r=(n=n||m).length;const i=["g","polyline","path"];for(;r--;){let a=n[r];if(gn(a))continue;if(("x"===e||"y"===e)&&i.includes(a.tagName)){const n=an([a]),r="x"===e?t-n.x:0,i="y"===e?t-n.y:0;s.moveSelectedElements(r*h,i*h,!0);continue}let o="#text"===e?a.textContent:a.getAttribute(e);if(gn(o)&&(o=""),o!==String(t)){"#text"===e?(a.textContent=t,/rotate/.test(a.getAttribute("transform"))&&(a=je(a))):"#href"===e?zt(a,t):a.setAttribute(e,t),"textedit"===fe&&"#text"!==e&&a.textContent.length&&He.toSelectMode(a),F()&&"text"===a.nodeName&&/rotate/.test(a.getAttribute("transform"))&&(String(t).startsWith("url")||["font-size","font-family","x","y"].includes(e)&&a.textContent)&&(a=je(a)),m.includes(a)&&setTimeout(function(){a.parentNode&&T.requestSelector(a).resize()},0);const n=on(a);if(0!==n&&"transform"!==e){const e=ie(a);let t=e.numberOfItems;for(;t--;)if(4===e.getItem(t).type){e.removeItem(t);const r=Xt(a),i=Ae(r.x+r.width/2,r.y+r.height/2,Ne(e).matrix),s=i.x,o=i.y,c=l.createSVGTransform();c.setRotate(n,s,o),e.insertItemBefore(c,t);break}}}}},it=this.changeSelectedAttribute=function(e,t,n){n=n||m,s.undoMgr.beginUndoableChange(e,n),rt(e,t,n);const r=s.undoMgr.finishUndoableChange();r.isEmpty()||P(r)};this.deleteSelectedElements=function(){const e=new Gr("Delete Elements"),t=m.length,n=[];for(let r=0;r<t;++r){const t=m[r];if(gn(t))break;let i=t.parentNode,a=t;T.releaseSelector(a),lt(a.id),"a"===i.tagName&&1===i.childNodes.length&&(a=i,i=i.parentNode);const{nextSibling:s}=a,o=i.removeChild(a);n.push(t),e.addSubCommand(new Ar(o,s,i))}m=[],e.isEmpty()||P(e),O("changed",n),j()},this.cutSelectedElements=function(){s.copySelectedElements(),s.deleteSelectedElements()},this.copySelectedElements=function(){localStorage.setItem("svgedit_clipboard",JSON.stringify(m.map(function(e){return _(e)}))),Sr("#cmenu_canvas").enableContextMenuItems("#paste,#paste_in_place")},this.pasteElements=function(e,t,n){let r=JSON.parse(localStorage.getItem("svgedit_clipboard")),i=r.length;if(!i)return;const a=[],o=new Gr("Paste elements"),l={};for(r.forEach(function e(t){t.attr&&t.attr.id&&(l[t.attr.id]=L(),t.attr.id=l[t.attr.id]),t.children&&t.children.forEach(e)}),we("IDsUpdated",{elems:r,changes:l},!0).forEach(function(e){e&&"remove"in e&&e.remove.forEach(function(e){r=r.filter(function(t){return t.attr.id!==e})})});i--;){const e=r[i];if(!e)continue;const t=y(e);a.push(t),o.addSubCommand(new Cr(t)),K(t)}if(Ue(a),"in_place"!==e){let r,i;e?"point"===e&&(r=t,i=n):(r=xe.x,i=xe.y);const l=an(a),c=r-(l.x+l.width/2),u=i-(l.y+l.height/2),d=[],h=[];Sr.each(a,function(e,t){d.push(c),h.push(u)});const p=s.moveSelectedElements(d,h,!1);p&&o.addSubCommand(p)}P(o),O("changed",a)},this.groupSelectedElements=function(e,t){e||(e="g");let n,r="";switch(e){case"a":r="Make hyperlink",n=t||"";break;default:e="g",r="Group Elements"}const i=new Gr(r),a=y({element:e,attr:{id:L()}});"a"===e&&zt(a,n),i.addSubCommand(new Cr(a));let s=m.length;for(;s--;){let e=m[s];if(gn(e))continue;"a"===e.parentNode.tagName&&1===e.parentNode.childNodes.length&&(e=e.parentNode);const t=e.nextSibling,n=e.parentNode;a.append(e),i.addSubCommand(new kr(e,t,n))}i.isEmpty()||P(i),Ue([a],!0)};const at=this.pushGroupProperties=function(e,t){const n=e.childNodes,r=n.length,i=e.getAttribute("transform"),a=ie(e),o=Ne(a).matrix,c=new Gr("Push group properties"),u=on(e),h=Sr(e).attr(["filter","opacity"]);let p,f,g;const m=d();for(let t=0;t<r;t++){const r=n[t];if(1!==r.nodeType)continue;if(null!==h.opacity&&1!==h.opacity){const e=Math.round((r.getAttribute("opacity")||1)*h.opacity*100)/100;it("opacity",e,[r])}if(h.filter){let t=this.getBlur(r);const n=t;f||(f=this.getBlur(e)),t?t=Number(f)+Number(t):0===t&&(t=f),n?p=ln(r.getAttribute("filter")):p?(p=m.copyElem(p),qt().append(p)):p=ln(h.filter);const i="feGaussianBlur"===p.firstChild.tagName?"blur":"filter";p.id=r.id+"_"+i,it("filter","url(#"+p.id+")",[r]),t&&(it("stdDeviation",t,[p.firstChild]),s.setBlurOffsets(p,t))}let i=ie(r);if(r.tagName.includes("Gradient")&&(i=null),i&&"defs"!==r.tagName&&a.numberOfItems){if(u&&1===a.numberOfItems){const e=a.getItem(0).matrix;let t=l.createSVGMatrix();const n=on(r);n&&(t=i.getItem(0).matrix);const s=Xt(r),o=Ne(i).matrix,c=Ae(s.x+s.width/2,s.y+s.height/2,o),d=u+n,h=l.createSVGTransform();h.setRotate(d,c.x,c.y);const p=Ge(e,t,h.matrix.inverse());if(n&&i.removeItem(0),d&&(i.numberOfItems?i.insertItemBefore(h,0):i.appendItem(h)),p.e||p.f){const e=l.createSVGTransform();e.setTranslate(p.e,p.f),i.numberOfItems?i.insertItemBefore(e,0):i.appendItem(e)}}else{const e=r.getAttribute("transform");(g={}).transform=e||"";const t=l.createSVGTransform(),n=Ne(i).matrix,a=n.inverse(),s=Ge(a,o,n);t.setMatrix(s),i.appendItem(t)}const e=pr(r);e&&c.addSubCommand(e)}}if(i&&((g={}).transform=i,e.setAttribute("transform",""),e.removeAttribute("transform"),c.addSubCommand(new Er(e,g))),t&&!c.isEmpty())return c};this.ungroupSelectedElement=function(){let e=m[0];if(!e)return;if(Sr(e).data("gsvg")||Sr(e).data("symbol"))return void Ke(e);if("use"===e.tagName){const t=cn(Ht(e).substr(1));return Sr(e).data("symbol",t).data("ref",t),void Ke(e)}const t=Sr(e).parents("a");if(t.length&&(e=t[0]),"g"===e.tagName||"a"===e.tagName){const t=new Gr("Ungroup Elements"),n=at(e,!0);n&&t.addSubCommand(n);const r=e.parentNode,i=e.nextSibling,a=new Array(e.childNodes.length);let s=0;for(;e.firstChild;){let n=e.firstChild;const o=n.nextSibling,l=n.parentNode;if("title"!==n.tagName)a[s++]=n=r.insertBefore(n,i),t.addSubCommand(new kr(n,o,l));else{const{nextSibling:e}=n;t.addSubCommand(new Ar(n,e,l)),n.remove()}}j();const o=e.nextSibling;e=r.removeChild(e),t.addSubCommand(new Ar(e,o,r)),t.isEmpty()||P(t),V(a)}},this.moveToTopSelectedElement=function(){const[e]=m;if(!gn(e)){let t=e;const n=t.parentNode,r=t.nextSibling;r!==(t=t.parentNode.appendChild(t)).nextSibling&&(P(new kr(t,r,n,"top")),O("changed",[t]))}},this.moveToBottomSelectedElement=function(){const[e]=m;if(!gn(e)){let t=e;const n=t.parentNode,r=t.nextSibling;let{firstChild:i}=t.parentNode;"title"===i.tagName&&(i=i.nextSibling),"defs"===i.tagName&&(i=i.nextSibling),r!==(t=t.parentNode.insertBefore(t,i)).nextSibling&&(P(new kr(t,r,n,"bottom")),O("changed",[t]))}},this.moveUpDownSelected=function(e){const t=m[0];if(!t)return;let n,r;be=[];const i=Sr(Se(an([t]))).toArray();if("Down"===e&&i.reverse(),Sr.each(i,function(){return r?(n=this,!1):(this===t&&(r=!0),!0)}),!n)return;const a=t,s=a.parentNode,o=a.nextSibling;Sr(n)["Down"===e?"before":"after"](a),o!==a.nextSibling&&(P(new kr(a,o,s,"Move "+e)),O("changed",[a]))},this.moveSelectedElements=function(e,t,n){e.constructor!==Array&&(e/=h,t/=h),n=n||!0;const r=new Gr("position");let i=m.length;for(;i--;){const n=m[i];if(!gn(n)){const a=l.createSVGTransform(),s=ie(n);e.constructor===Array?a.setTranslate(e[i],t[i]):a.setTranslate(e,t),s.numberOfItems?s.insertItemBefore(a,0):s.appendItem(a);const o=pr(n);o&&r.addSubCommand(o),T.requestSelector(n).resize()}}if(!r.isEmpty())return n&&P(r),O("changed",m),r},this.cloneSelectedElements=function(e,t){let n,r;const i=new Gr("Clone Elements"),a=m.length;for(m.sort(function(e,t){return Sr(t).index()-Sr(e).index()}),n=0;n<a&&(r=m[n],!gn(r));++n);const s=m.slice(0,n);this.clearSelection(!0);const o=d();for(n=s.length;n--;)r=s[n]=o.copyElem(s[n]),(p||o.getCurrentLayer()).append(r),i.addSubCommand(new Cr(r));i.isEmpty()||(V(s.reverse()),this.moveSelectedElements(e,t,!1),P(i))},this.alignSelectedElements=function(e,t){const n=[],r=m.length;if(!r)return;let i=Number.MAX_VALUE,a=Number.MIN_VALUE,o=Number.MAX_VALUE,l=Number.MIN_VALUE,c=Number.MIN_VALUE,u=Number.MIN_VALUE;for(let s=0;s<r&&!gn(m[s]);++s){const r=m[s];switch(n[s]=an([r]),t){case"smallest":(("l"===e||"c"===e||"r"===e)&&(c===Number.MIN_VALUE||c>n[s].width)||("t"===e||"m"===e||"b"===e)&&(u===Number.MIN_VALUE||u>n[s].height))&&(i=n[s].x,o=n[s].y,a=n[s].x+n[s].width,l=n[s].y+n[s].height,c=n[s].width,u=n[s].height);break;case"largest":(("l"===e||"c"===e||"r"===e)&&(c===Number.MIN_VALUE||c<n[s].width)||("t"===e||"m"===e||"b"===e)&&(u===Number.MIN_VALUE||u<n[s].height))&&(i=n[s].x,o=n[s].y,a=n[s].x+n[s].width,l=n[s].y+n[s].height,c=n[s].width,u=n[s].height);break;default:n[s].x<i&&(i=n[s].x),n[s].y<o&&(o=n[s].y),n[s].x+n[s].width>a&&(a=n[s].x+n[s].width),n[s].y+n[s].height>l&&(l=n[s].y+n[s].height)}}"page"===t&&(i=0,o=0,a=s.contentW,l=s.contentH);const d=new Array(r),h=new Array(r);for(let t=0;t<r&&!gn(m[t]);++t){const r=n[t];switch(d[t]=0,h[t]=0,e){case"l":d[t]=i-r.x;break;case"c":d[t]=(i+a)/2-(r.x+r.width/2);break;case"r":d[t]=a-(r.x+r.width);break;case"t":h[t]=o-r.y;break;case"m":h[t]=(o+l)/2-(r.y+r.height/2);break;case"b":h[t]=l-(r.y+r.height)}}this.moveSelectedElements(d,h)},this.contentW=Je().w,this.contentH=Je().h,this.updateCanvas=function(e,t){l.setAttribute("width",e),l.setAttribute("height",t);const n=Sr("#canvasBackground")[0],r=c.getAttribute("x"),i=c.getAttribute("y"),a=(e-this.contentW*h)/2,s=(t-this.contentH*h)/2;un(c,{width:this.contentW*h,height:this.contentH*h,x:a,y:s,viewBox:"0 0 "+this.contentW+" "+this.contentH}),un(n,{width:c.getAttribute("width"),height:c.getAttribute("height"),x:a,y:s});const o=cn("background_image");return o&&un(o,{width:"100%",height:"100%"}),T.selectorParentGroup.setAttribute("transform","translate("+a+","+s+")"),we("canvasUpdated",{new_x:a,new_y:s,old_x:r,old_y:i,d_x:a-r,d_y:s-i}),{x:a,y:s,old_x:r,old_y:i,d_x:a-r,d_y:s-i}},this.setBackground=function(e,t){const n=cn("canvasBackground"),r=Sr(n).find("rect")[0];let i=cn("background_image");r.setAttribute("fill",e),t?(i||(i=o.createElementNS(v.SVG,"image"),un(i,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})),zt(i,t),n.append(i)):i&&i.remove()},this.cycleElement=function(e){let t;const n=m[0];let r=!1;const i=rn(p||d().getCurrentLayer());if(i.length){if(gn(n))r=i[t=e?i.length-1:0];else{let a=i.length;for(;a--;)if(i[a]===n){(t=e?a-1:a+1)>=i.length?t=0:t<0&&(t=i.length-1),r=i[t];break}}Ue([r],!0),O("selected",m)}},this.clear(),this.getPrivateMethods=function(){return{addCommandToHistory:P,BatchCommand:Gr,ChangeElementCommand:Er,decode64:Lt,dropXMLInteralSubset:It,encode64:Tt,ffClone:je,findDefs:qt,findDuplicateGradient:nt,getElem:cn,getPathBBox:$t,getTypeMap:de,getUrlFromAttr:Ft,identifyLayers:Un,InsertElementCommand:Cr,isChrome:z,isIdentity:Ee,isIE:H,logMatrix:Be,MoveElementCommand:kr,NS:v,preventClickDefault:pn,RemoveElementCommand:Ar,SVGEditTransformList:te,text2xml:Bt,transformBox:Ie,transformPoint:Ae,walkTree:Dt}}}};
/**
 * jGraduate 0.4
 *
 * jQuery Plugin for a gradient picker
 *
 * @module jGraduate
 * @copyright 2010 Jeff Schiller {@link http://blog.codedread.com/}, 2010 Alexis Deveria {@link http://a.deveria.com/}
 *
 * @license Apache-2.0
 * @example
 * // The Paint object is described below.
 * $.jGraduate.Paint() // constructs a 'none' color
 * @example $.jGraduate.Paint({copy: o}) // creates a copy of the paint o
 * @example $.jGraduate.Paint({hex: '#rrggbb'}) // creates a solid color paint with hex = "#rrggbb"
 * @example $.jGraduate.Paint({linearGradient: o, a: 50}) // creates a linear gradient paint with opacity=0.5
 * @example $.jGraduate.Paint({radialGradient: o, a: 7}) // creates a radial gradient paint with opacity=0.07
 * @example $.jGraduate.Paint({hex: '#rrggbb', linearGradient: o}) // throws an exception?
 *
*/
const Tr={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};
/**
 * jPicker (Adapted from version 1.1.6)
 *
 * jQuery Plugin for Photoshop style color picker
 *
 * @module jPicker
 * @copyright (c) 2010 Christopher T. Tillman
 * Digital Magic Productions, Inc. ({@link http://www.digitalmagicpro.com/})
 * FREE to use, alter, copy, sell, and especially ENHANCE
 * @license MIT
 *
 * Painstakingly ported from John Dyers' excellent work on his own color picker based on the Prototype framework.
 *
 * John Dyers' website: {@link http://johndyer.name}
 * Color Picker page: {@link http://johndyer.name/photoshop-like-javascript-color-picker/}
 */
function Lr(e,t){return void 0===t&&(t=0),Math.round(e*10**t)/10**t}window.console||(window.console={log(e){},dir(e){}});const Mr=e=>null==e;
/**
 * Localizing script for SVG-edit UI
 * @module locale
 * @license MIT
 *
 * @copyright 2010 Narendra Sisodya
 * @copyright 2010 Alexis Deveria
 *
 */
const Or=jQuery;let jr;const Vr=function(e,t,n){const r=Or("#svg_editor").parent();Object.entries(t).forEach(([t,i])=>{if(i||console.log(t),n&&(t="#"+t),r.find(t).length){const n=r.find(t)[0];switch(e){case"content":[...n.childNodes].some(e=>!(3!==e.nodeType||!e.textContent.trim())&&(e.textContent=i,!0));break;case"title":n.title=i}}else console.log("Missing element for localization: "+t)})};let Rr;const Br=async function(e){const t=await Rr.addLangData(jr);if(Or.each(t,function(t,n){n.data&&(e=Or.merge(e,n.data))}),!e.tools)return;const{tools:n,properties:r,config:i,layers:a,common:s,ui:o}=e;Vr("content",{curve_segments:r.curve_segments,fitToContent:n.fitToContent,fit_to_all:n.fit_to_all,fit_to_canvas:n.fit_to_canvas,fit_to_layer_content:n.fit_to_layer_content,fit_to_sel:n.fit_to_sel,icon_large:i.icon_large,icon_medium:i.icon_medium,icon_small:i.icon_small,icon_xlarge:i.icon_xlarge,image_opt_embed:i.image_opt_embed,image_opt_ref:i.image_opt_ref,includedImages:i.included_images,largest_object:n.largest_object,layersLabel:a.layers,page:n.page,relativeToLabel:n.relativeTo,selLayerLabel:a.move_elems_to,selectedPredefined:i.select_predefined,selected_objects:n.selected_objects,smallest_object:n.smallest_object,straight_segments:r.straight_segments,svginfo_bg_url:i.editor_img_url+":",svginfo_bg_note:i.editor_bg_note,svginfo_change_background:i.background,svginfo_dim:i.doc_dims,svginfo_editor_prefs:i.editor_prefs,svginfo_height:s.height,svginfo_icons:i.icon_size,svginfo_image_props:i.image_props,svginfo_lang:i.language,svginfo_title:i.doc_title,svginfo_width:s.width,tool_docprops_cancel:s.cancel,tool_docprops_save:s.ok,tool_source_cancel:s.cancel,tool_source_save:s.ok,tool_prefs_cancel:s.cancel,tool_prefs_save:s.ok,sidepanel_handle:a.layers.split("").join(" "),tool_clear:n.new_doc,tool_docprops:n.docprops,tool_export:n.export_img,tool_import:n.import_doc,tool_open:n.open_doc,tool_save:n.save_doc,svginfo_units_rulers:i.units_and_rulers,svginfo_rulers_onoff:i.show_rulers,svginfo_unit:i.base_unit,svginfo_grid_settings:i.grid,svginfo_snap_onoff:i.snapping_onoff,svginfo_snap_step:i.snapping_stepsize,svginfo_grid_color:i.grid_color},!0);const l={};return Or.each(["cut","copy","paste","paste_in_place","delete","group","ungroup","move_front","move_up","move_down","move_back"],function(){l['#cmenu_canvas a[href="#'+this+'"]']=n[this]}),Or.each(["dupe","merge_down","merge_all"],function(){l['#cmenu_layers a[href="#'+this+'"]']=a[this]}),l['#cmenu_layers a[href="#delete"]']=a.del,Vr("content",l),Vr("title",{align_relative_to:n.align_relative_to,circle_cx:r.circle_cx,circle_cy:r.circle_cy,circle_r:r.circle_r,cornerRadiusLabel:r.corner_radius,ellipse_cx:r.ellipse_cx,ellipse_cy:r.ellipse_cy,ellipse_rx:r.ellipse_rx,ellipse_ry:r.ellipse_ry,fill_color:r.fill_color,font_family:r.font_family,idLabel:r.id,image_height:r.image_height,image_url:r.image_url,image_width:r.image_width,layer_delete:a.del,layer_down:a.move_down,layer_new:a.new,layer_rename:a.rename,layer_moreopts:s.more_opts,layer_up:a.move_up,line_x1:r.line_x1,line_x2:r.line_x2,line_y1:r.line_y1,line_y2:r.line_y2,linecap_butt:r.linecap_butt,linecap_round:r.linecap_round,linecap_square:r.linecap_square,linejoin_bevel:r.linejoin_bevel,linejoin_miter:r.linejoin_miter,linejoin_round:r.linejoin_round,main_icon:n.main_menu,palette:o.palette_info,zoom_panel:o.zoom_level,path_node_x:r.node_x,path_node_y:r.node_y,rect_height_tool:r.rect_height,rect_width_tool:r.rect_width,seg_type:r.seg_type,selLayerNames:a.move_selected,selected_x:r.pos_x,selected_y:r.pos_y,stroke_color:r.stroke_color,stroke_style:r.stroke_style,stroke_width:r.stroke_width,svginfo_title:i.doc_title,text:r.text_contents,toggle_stroke_tools:o.toggle_stroke_tools,tool_add_subpath:n.add_subpath,tool_alignbottom:n.align_bottom,tool_aligncenter:n.align_center,tool_alignleft:n.align_left,tool_alignmiddle:n.align_middle,tool_alignright:n.align_right,tool_aligntop:n.align_top,tool_angle:r.angle,tool_blur:r.blur,tool_bold:r.bold,tool_circle:n.mode_circle,tool_clone:n.clone,tool_clone_multi:n.clone,tool_delete:n.del,tool_delete_multi:n.del,tool_ellipse:n.mode_ellipse,tool_fhellipse:n.mode_fhellipse,tool_fhpath:n.mode_fhpath,tool_fhrect:n.mode_fhrect,tool_font_size:r.font_size,tool_group_elements:n.group_elements,tool_make_link:n.make_link,tool_link_url:n.set_link_url,tool_image:n.mode_image,tool_italic:r.italic,tool_line:n.mode_line,tool_move_bottom:n.move_bottom,tool_move_top:n.move_top,tool_node_clone:n.node_clone,tool_node_delete:n.node_delete,tool_node_link:n.node_link,tool_opacity:r.opacity,tool_openclose_path:n.openclose_path,tool_path:n.mode_path,tool_position:n.align_to_page,tool_rect:n.mode_rect,tool_redo:n.redo,tool_reorient:n.reorient_path,tool_select:n.mode_select,tool_source:n.source_save,tool_square:n.mode_square,tool_text:n.mode_text,tool_topath:n.to_path,tool_undo:n.undo,tool_ungroup:n.ungroup,tool_wireframe:n.wireframe_mode,tool_zoom:n.mode_zoom,url_notice:n.no_embed},!0),{langParam:jr,langData:e}};var Dr=function(e,{before:t,after:n,favicon:r,canvas:i,image:a=!0,acceptErrors:s}={}){return e=Array.isArray(e)?e:[e],Promise.all(e.map(function(e){let o={};Array.isArray(e)&&([e,o={}]=e);let{favicon:l=r}=o;const{before:c=t,after:u=n,canvas:d=i,image:h=a}=o;function p(){c?c.before(f):u?u.after(f):document.head.appendChild(f)}const f=document.createElement("link");return new Promise((t,n)=>{let r=n;if(s&&(r="function"==typeof s?r=>{s({error:r,stylesheetURL:e,options:o,resolve:t,reject:n})}:t),e.endsWith(".css")?l=!1:e.endsWith(".ico")&&(l=!0),l){if(f.rel="shortcut icon",f.type="image/x-icon",!1===h)return f.href=e,p(),void t(f);const r=document.createElement("canvas");r.width=16,r.height=16;const i=r.getContext("2d"),a=document.createElement("img");return a.addEventListener("error",e=>{n(e)}),a.addEventListener("load",()=>{i.drawImage(a,0,0),f.href=d?r.toDataURL("image/x-icon"):e,p(),t(f)}),void(a.src=e)}f.rel="stylesheet",f.type="text/css",f.href=e,p(),f.addEventListener("error",e=>{r(e)}),f.addEventListener("load",()=>{t(f)})})}))},Ur={},Fr=[function(e){function t(t){if("string"==typeof t.data){var n=t.handler,r=t.data.toLowerCase().split(" ");t.handler=function(t){if(this===t.target||27===t.which||!/textarea|select/i.test(t.target.nodeName)&&"text"!==t.target.type){var i="keypress"!==t.type&&e.hotkeys.specialKeys[t.which],a=String.fromCharCode(t.which).toLowerCase(),s="",o={};t.altKey&&"alt"!==i&&(s+="alt+"),t.ctrlKey&&"ctrl"!==i&&(s+="ctrl+"),t.metaKey&&!t.ctrlKey&&"meta"!==i&&(s+="meta+"),t.shiftKey&&"shift"!==i&&(s+="shift+"),i?o[s+i]=!0:(o[s+a]=!0,o[s+e.hotkeys.shiftNums[a]]=!0,"shift+"===s&&(o[e.hotkeys.shiftNums[a]]=!0));for(var l=0,c=r.length;l<c;l++)if(o[r[l]])return n.apply(this,arguments)}}}}return e.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta",219:"[",221:"]"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},e.each(["keydown","keyup","keypress"],function(){e.event.special[this]={add:t}}),e},function(e){return function(e,t){var n,r,i,a,s,o,l,c,u=Array.prototype.slice,d=decodeURIComponent,h=e.param,p=e.bbq=e.bbq||{},f=e.event.special,g="hashchange",m="querystring",_="fragment",y="elemUrlAttr",v="location",b="href",x="src",w=/^.*\?|#.*$/g,S=/^.*\#/,k={};function C(e){return"string"==typeof e}function A(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}}function E(r,a,s,o,l){var u,p,f,g,y;return o!==n?(y=(f=s.match(r?/^([^#]*)\#?(.*)$/:/^([^#?]*)\??([^#]*)(#?.*)/))[3]||"",2===l&&C(o)?p=o.replace(r?S:w,""):(g=i(f[2]),o=C(o)?i[r?_:m](o):o,p=2===l?o:1===l?e.extend({},o,g):e.extend({},g,o),p=h(p),r&&(p=p.replace(c,d))),u=f[1]+(r?"#":p||!f[1]?"?":"")+p+y):u=a(s!==n?s:t[v][b]),u}function G(e,t,r){return t===n||"boolean"==typeof t?(r=t,t=h[e?_:m]()):t=C(t)?t.replace(e?S:w,""):t,i(t,r)}function P(t,r,i,a){return C(i)||"object"==typeof i||(a=i,i=r,r=n),this.each(function(){var n=e(this),s=r||l()[(this.nodeName||"").toLowerCase()]||"",o=s&&n.attr(s)||"";n.attr(s,h[t](o,i,a))})}h[m]=A(E,0,function(e){return e.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}),h[_]=r=A(E,1,function(e){return e.replace(/^[^#]*#?(.*)$/,"$1")}),r.noEscape=function(t){t=t||"";var n=e.map(t.split(""),encodeURIComponent);c=new RegExp(n.join("|"),"g")},r.noEscape(",/"),e.deparam=i=function(t,r){var i={},a={true:!0,false:!1,null:null};return e.each(t.replace(/\+/g," ").split("&"),function(t,s){var o,l=s.split("="),c=d(l[0]),u=i,h=0,p=c.split("]["),f=p.length-1;if(/\[/.test(p[0])&&/\]$/.test(p[f])?(p[f]=p[f].replace(/\]$/,""),f=(p=p.shift().split("[").concat(p)).length-1):f=0,2===l.length)if(o=d(l[1]),r&&(o=o&&!isNaN(o)?+o:"undefined"===o?n:a[o]!==n?a[o]:o),f)for(;h<=f;h++)u=u[c=""===p[h]?u.length:p[h]]=h<f?u[c]||(p[h+1]&&isNaN(p[h+1])?{}:[]):o;else e.isArray(i[c])?i[c].push(o):i[c]!==n?i[c]=[i[c],o]:i[c]=o;else c&&(i[c]=r?n:"")}),i},i[m]=A(G,0),i[_]=a=A(G,1),e[y]||(e[y]=function(t){return e.extend(k,t)})({a:b,base:b,iframe:x,img:x,input:x,form:"action",link:b,script:x}),l=e[y],e.fn[m]=A(P,m),e.fn[_]=A(P,_),p.pushState=s=function(e,i){C(e)&&/^#/.test(e)&&i===n&&(i=2);var a=e!==n,s=r(t[v][b],a?e:{},a?i:2);t[v][b]=s+(/#/.test(s)?"":"#")},p.getState=o=function(e,t){return e===n||"boolean"==typeof e?a(e):a(t)[e]},p.removeState=function(t){var r={};t!==n&&(r=o(),e.each(e.isArray(t)?t:arguments,function(e,t){delete r[t]})),s(r,2)},f[g]=e.extend(f[g],{add:function(t){var a;function s(e){var t=e[_]=r();e.getState=function(e,r){return e===n||"boolean"==typeof e?i(t,e):i(t,r)[e]},a.apply(this,arguments)}if(e.isFunction(t))return a=t,s;a=t.handler,t.handler=s}})}(e,window),function(e,t,n){var r,i,a,s,o,l,c=e.event.special,u="location",d="hashchange",h="href",p=e.browser,f=document.documentMode,g=p.msie&&(void 0===f||f<8),m="on"+d in t&&!g;function _(e){return(e=e||t[u][h]).replace(/^[^#]*#?(.*)$/,"$1")}e[d+"Delay"]=100,c[d]=e.extend(c[d],{setup:function(){if(m)return!1;e(r.start)},teardown:function(){if(m)return!1;e(r.stop)}}),(l={}).start=function(){if(!i){var n=_();s||(s=o=function(e){return e},g&&(a=e('<iframe src="javascript:0"/>').hide().insertAfter("body")[0].contentWindow,o=function(){return _(a.document[u][h])},(s=function(e,t){if(e!==t){var n=a.document;n.open().close(),n[u].hash="#"+e}})(_()))),function r(){var a=_(),l=o(n);a!==n?(s(n=a,l),e(t).trigger(d)):l!==n&&(t[u][h]=t[u][h].replace(/#.*/,"")+"#"+l),i=setTimeout(r,e[d+"Delay"])}()}},l.stop=function(){a||(i&&clearTimeout(i),i=0)},r=l}(e,window),e},
/**
 * SVG Icon Loader 2.0
 *
 * jQuery Plugin for loading SVG icons from a single file
 *
 * Adds {@link external:jQuery.svgIcons}, {@link external:jQuery.getSvgIcon}, {@link external:jQuery.resizeSvgIcons}
 *
 * How to use:

1. Create the SVG master file that includes all icons:

The master SVG icon-containing file is an SVG file that contains
`<g>` elements. Each `<g>` element should contain the markup of an SVG
icon. The `<g>` element has an ID that should
correspond with the ID of the HTML element used on the page that should contain
or optionally be replaced by the icon. Additionally, one empty element should be
added at the end with id "svg_eof".

2. Optionally create fallback raster images for each SVG icon.

3. Include the jQuery and the SVG Icon Loader scripts on your page.

4. Run `$.svgIcons()` when the document is ready. See its signature

5. To access an icon at a later point without using the callback, use this:
  `$.getSvgIcon(id (string), uniqueClone (boolean))`;

This will return the icon (as jQuery object) with a given ID.

6. To resize icons at a later point without using the callback, use this:
  `$.resizeSvgIcons(resizeOptions)` (use the same way as the "resize" parameter)
 *
 * @module jQuerySVGIcons
 * @license MIT
 * @copyright (c) 2009 Alexis Deveria
 * {@link http://a.deveria.com}
 * @example usage #1:

$(function() {
  $.svgIcons('my_icon_set.svg'); // The SVG file that contains all icons
  // No options have been set, so all icons will automatically be inserted
  // into HTML elements that match the same IDs.
});

* @example usage #2:

$(function() {
  $.svgIcons('my_icon_set.svg', { // The SVG file that contains all icons
    callback (icons) { // Custom callback function that sets click
                  // events for each icon
      $.each(icons, function(id, icon) {
        icon.click(function() {
          alert('You clicked on the icon with id ' + id);
        });
      });
    }
  }); //The SVG file that contains all icons
});

* @example usage #3:

$(function() {
  $.svgIcons('my_icon_set.svgz', { // The SVGZ file that contains all icons
    w: 32,  // All icons will be 32px wide
    h: 32,  // All icons will be 32px high
    fallback_path: 'icons/',  // All fallback files can be found here
    fallback: {
      '#open_icon': 'open.png',  // The "open.png" will be appended to the
                    // HTML element with ID "open_icon"
      '#close_icon': 'close.png',
      '#save_icon': 'save.png'
    },
    placement: {'.open_icon','open'}, // The "open" icon will be added
                    // to all elements with class "open_icon"
    resize () {
      '#save_icon .svg_icon': 64  // The "save" icon will be resized to 64 x 64px
    },

    callback (icons) { // Sets background color for "close" icon
      icons['close'].css('background','red');
    },

    svgz: true // Indicates that an SVGZ file is being used

  })
});
*/
function(e){const t={};let n;return e.svgIcons=function(r,i={}){const a="http://www.w3.org/2000/svg",s="http://www.w3.org/1999/xlink",o=i.w||24,l=i.h||24;let c,u,d,h=!1,p=!1,f=0;const g=Boolean(window.opera),m="data:image/svg+xml;charset=utf-8;base64,";let _,y;if(i.svgz){_=e('<object data="'+r+'" type=image/svg+xml>').appendTo("body").hide();try{u=_[0].contentDocument,_.load(v),v(0,!0)}catch(e){S()}}else{const t=new DOMParser;e.ajax({url:r,dataType:"string",success(n){n?(u=t.parseFromString(n,"text/xml"),e(function(){v("ajax")})):e(S)},error(n){window.opera?e(function(){S()}):n.responseText?((u=t.parseFromString(n.responseText,"text/xml")).childNodes.length||e(S),e(function(){v("ajax")})):e(S)}})}function v(t,n){if("ajax"!==t){if(p)return;const e=(u=_[0].contentDocument)&&u.getElementById("svg_eof");if(!(e||n&&e))return void(++f<50?setTimeout(v,20):(S(),p=!0));p=!0}if(c=e(u.firstChild).children(),i.no_img)setTimeout(function(){h||w()},500);else{const t=m+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNzUiIGhlaWdodD0iMjc1Ij48L3N2Zz4%3D";d=e(new Image).attr({src:t,width:0,height:0}).appendTo("body").load(function(){w(!0)}).error(function(){w()})}}function b(e,t,n,r){if(g&&t.css("visibility","hidden"),i.replace){r&&t.attr("id",n);const i=e.attr("class");i&&t.attr("class","svg_icon "+i),e.replaceWith(t)}else e.append(t);g&&setTimeout(function(){t.removeAttr("style")},1)}function x(e,n){void 0!==i.id_match&&!1===i.id_match||b(y,e,n,!0),t[n]=e}function w(r=!1,u){if(h)return;let p;if(i.no_img&&(r=!1),r&&(p=e(document.createElement("div"))).hide().appendTo("body"),u){const t=i.fallback_path||"";e.each(u,function(n,r){y=e("#"+n),x(e(new Image).attr({class:"svg_icon",src:t+r,width:o,height:l,alt:"icon"}),n)})}else{const t=c.length;for(let i=0;i<t;i++){const t=c[i],{id:u}=t;if("svg_eof"===u)break;y=e("#"+u);const d=document.createElementNS(a,"svg");d.setAttribute("viewBox",[0,0,o,l].join(" "));let h=t.getElementsByTagNameNS(a,"svg")[0];const f=h.getAttribute("width"),_=h.getAttribute("height");let v;if(h.removeAttribute("width"),h.removeAttribute("height"),h.getAttribute("viewBox")||h.setAttribute("viewBox",[0,0,f,_].join(" ")),d.setAttribute("xmlns",a),d.setAttribute("width",o),d.setAttribute("height",l),d.setAttribute("xmlns:xlink",s),d.setAttribute("class","svg_icon"),g||(h=h.cloneNode(!0)),d.append(h),r){p.empty().append(d);const t=m+Tt(unescape(encodeURIComponent((new XMLSerializer).serializeToString(d))));v=e(new Image).attr({class:"svg_icon",src:t})}else v=n(e(d),i);x(v,u)}}i.placement&&e.each(i.placement,function(i,a){t[a]&&e(i).each(function(i){let s=t[a].clone();i>0&&!r&&(s=n(s,i,!0)),b(e(this),s,a)})}),u||(r&&p.remove(),_&&_.remove(),d&&d.remove()),i.resize&&e.resizeSvgIcons(i.resize),h=!0,i.callback&&i.callback(t)}function S(){if(r.includes(".svgz")){const t=r.replace(".svgz",".svg");window.console&&console.log(".svgz failed, trying with .svg"),e.svgIcons(t,i)}else i.fallback&&w(!1,i.fallback)}n=function(e,t,n){const r=e.find("defs");if(!r.length)return e;let i;i=g?r.find("*").filter(function(){return Boolean(this.id)}):r.find("[id]");const a=e[0].getElementsByTagName("*"),s=a.length;return i.each(function(e){const{id:n}=this,r="x"+n+t+e;this.id=r;const i="url(#"+n+")",o="url(#"+r+")";for(e=0;e<s;e++){const t=a[e];t.getAttribute("fill")===i&&t.setAttribute("fill",o),t.getAttribute("stroke")===i&&t.setAttribute("stroke",o),t.getAttribute("filter")===i&&t.setAttribute("filter",o)}}),e}},e.getSvgIcon=function(e,r){let i=t[e];return r&&i&&(i=n(i,0,!0).clone(!0)),i},e.resizeSvgIcons=function(t){const n=!e(".svg_icon:first").length;e.each(t,function(t,r){const i=Array.isArray(r),a=i?r[0]:r,s=i?r[1]:r;n&&(t=t.replace(/\.svg_icon/g,"svg")),e(t).each(function(){this.setAttribute("width",a),this.setAttribute("height",s),window.opera&&window.widget&&(this.parentNode.style.width=a+"px",this.parentNode.style.height=s+"px")})})},e},function(e){e.loadingStylesheets||(e.loadingStylesheets=[]),e.loadingStylesheets.includes("jgraduate/css/jGraduate.css")||e.loadingStylesheets.push("jgraduate/css/jGraduate.css"),e.jGraduate={Paint:class{constructor(e){const t=e||{};if(this.alpha=isNaN(t.alpha)?100:t.alpha,t.copy)switch(this.type=t.copy.type,this.alpha=t.copy.alpha,this.solidColor=null,this.linearGradient=null,this.radialGradient=null,this.type){case"none":break;case"solidColor":this.solidColor=t.copy.solidColor;break;case"linearGradient":this.linearGradient=t.copy.linearGradient.cloneNode(!0);break;case"radialGradient":this.radialGradient=t.copy.radialGradient.cloneNode(!0)}else t.linearGradient?(this.type="linearGradient",this.solidColor=null,this.radialGradient=null,this.linearGradient=t.linearGradient.cloneNode(!0)):t.radialGradient?(this.type="radialGradient",this.solidColor=null,this.linearGradient=null,this.radialGradient=t.radialGradient.cloneNode(!0)):t.solidColor?(this.type="solidColor",this.solidColor=t.solidColor):(this.type="none",this.solidColor=null,this.linearGradient=null,this.radialGradient=null)}}},e.fn.jGraduateDefaults={paint:new e.jGraduate.Paint,window:{pickerTitle:"Drag markers to pick a paint"},images:{clientPath:"images/"},newstop:"inverse"};const t=navigator.userAgent.includes("Gecko/");function n(e,n,r){const i=document.createElementNS(Tr.svg,e);return function(e,n){t?Object.entries(n).forEach(([t,n])=>{e.setAttribute(t,n)}):Object.entries(n).forEach(([t,n])=>{const r=e[t];r&&"SVGLength"===r.constructor?r.baseVal.value=n:e.setAttribute(t,n)})}(i,n),r&&r.append(i),i}return e.fn.jGraduate=function(t,r,i){return this.each(function(){const a=e(this),s=e.extend(!0,{},e.fn.jGraduateDefaults,t||{}),o=a.attr("id"),l="#"+a.attr("id")+" ";if(!l)return void e.alert("Container element must have an id attribute to maintain unique id strings for sub-elements.");const c=function(){switch(a.paint.type){case"radialGradient":a.paint.linearGradient=null;break;case"linearGradient":a.paint.radialGradient=null;break;case"solidColor":a.paint.radialGradient=a.paint.linearGradient=null}"function"==typeof a.okCallback&&a.okCallback(a.paint),a.hide()},u=function(){"function"==typeof a.cancelCallback&&a.cancelCallback(),a.hide()};e.extend(!0,a,{paint:new e.jGraduate.Paint({copy:s.paint}),okCallback:"function"==typeof r?r:null,cancelCallback:"function"==typeof i?i:null});let d=null;const h=e(window);"none"===a.paint.type&&(a.paint=new e.jGraduate.Paint({solidColor:"ffffff"})),a.addClass("jGraduate_Picker"),a.html('<ul class="jGraduate_tabs"><li class="jGraduate_tab_color jGraduate_tab_current" data-type="col">Solid Color</li><li class="jGraduate_tab_lingrad" data-type="lg">Linear Gradient</li><li class="jGraduate_tab_radgrad" data-type="rg">Radial Gradient</li></ul><div class="jGraduate_colPick"></div><div class="jGraduate_gradPick"></div><div class="jGraduate_LightBox"></div><div id="'+o+'_jGraduate_stopPicker" class="jGraduate_stopPicker"></div>');const p=e(l+"> .jGraduate_colPick"),f=e(l+"> .jGraduate_gradPick");f.html('<div id="'+o+'_jGraduate_Swatch" class="jGraduate_Swatch"><h2 class="jGraduate_Title">'+s.window.pickerTitle+'</h2><div id="'+o+'_jGraduate_GradContainer" class="jGraduate_GradContainer"></div><div id="'+o+'_jGraduate_StopSlider" class="jGraduate_StopSlider"></div></div><div class="jGraduate_Form jGraduate_Points jGraduate_lg_field"><div class="jGraduate_StopSection"><label class="jGraduate_Form_Heading">Begin Point</label><div class="jGraduate_Form_Section"><label>x:</label><input type="text" id="'+o+'_jGraduate_x1" size="3" title="Enter starting x value between 0.0 and 1.0"/><label>y:</label><input type="text" id="'+o+'_jGraduate_y1" size="3" title="Enter starting y value between 0.0 and 1.0"/></div></div><div class="jGraduate_StopSection"><label class="jGraduate_Form_Heading">End Point</label><div class="jGraduate_Form_Section"><label>x:</label><input type="text" id="'+o+'_jGraduate_x2" size="3" title="Enter ending x value between 0.0 and 1.0"/><label>y:</label><input type="text" id="'+o+'_jGraduate_y2" size="3" title="Enter ending y value between 0.0 and 1.0"/></div></div></div><div class="jGraduate_Form jGraduate_Points jGraduate_rg_field"><div class="jGraduate_StopSection"><label class="jGraduate_Form_Heading">Center Point</label><div class="jGraduate_Form_Section"><label>x:</label><input type="text" id="'+o+'_jGraduate_cx" size="3" title="Enter x value between 0.0 and 1.0"/><label>y:</label><input type="text" id="'+o+'_jGraduate_cy" size="3" title="Enter y value between 0.0 and 1.0"/></div></div><div class="jGraduate_StopSection"><label class="jGraduate_Form_Heading">Focal Point</label><div class="jGraduate_Form_Section"><label>Match center: <input type="checkbox" checked="checked" id="'+o+'_jGraduate_match_ctr"/></label><br/><label>x:</label><input type="text" id="'+o+'_jGraduate_fx" size="3" title="Enter x value between 0.0 and 1.0"/><label>y:</label><input type="text" id="'+o+'_jGraduate_fy" size="3" title="Enter y value between 0.0 and 1.0"/></div></div></div><div class="jGraduate_StopSection jGraduate_SpreadMethod"><label class="jGraduate_Form_Heading">Spread method</label><div class="jGraduate_Form_Section"><select class="jGraduate_spreadMethod"><option value=pad selected>Pad</option><option value=reflect>Reflect</option><option value=repeat>Repeat</option></select></div></div><div class="jGraduate_Form"><div class="jGraduate_Slider jGraduate_RadiusField jGraduate_rg_field"><label class="prelabel">Radius:</label><div id="'+o+'_jGraduate_Radius" class="jGraduate_SliderBar jGraduate_Radius" title="Click to set radius"><img id="'+o+'_jGraduate_RadiusArrows" class="jGraduate_RadiusArrows" src="'+s.images.clientPath+'rangearrows2.gif"></div><label><input type="text" id="'+o+'_jGraduate_RadiusInput" size="3" value="100"/>%</label></div><div class="jGraduate_Slider jGraduate_EllipField jGraduate_rg_field"><label class="prelabel">Ellip:</label><div id="'+o+'_jGraduate_Ellip" class="jGraduate_SliderBar jGraduate_Ellip" title="Click to set Ellip"><img id="'+o+'_jGraduate_EllipArrows" class="jGraduate_EllipArrows" src="'+s.images.clientPath+'rangearrows2.gif"></div><label><input type="text" id="'+o+'_jGraduate_EllipInput" size="3" value="0"/>%</label></div><div class="jGraduate_Slider jGraduate_AngleField jGraduate_rg_field"><label class="prelabel">Angle:</label><div id="'+o+'_jGraduate_Angle" class="jGraduate_SliderBar jGraduate_Angle" title="Click to set Angle"><img id="'+o+'_jGraduate_AngleArrows" class="jGraduate_AngleArrows" src="'+s.images.clientPath+'rangearrows2.gif"></div><label><input type="text" id="'+o+'_jGraduate_AngleInput" size="3" value="0"/>deg</label></div><div class="jGraduate_Slider jGraduate_OpacField"><label class="prelabel">Opac:</label><div id="'+o+'_jGraduate_Opac" class="jGraduate_SliderBar jGraduate_Opac" title="Click to set Opac"><img id="'+o+'_jGraduate_OpacArrows" class="jGraduate_OpacArrows" src="'+s.images.clientPath+'rangearrows2.gif"></div><label><input type="text" id="'+o+'_jGraduate_OpacInput" size="3" value="100"/>%</label></div></div><div class="jGraduate_OkCancel"><input type="button" id="'+o+'_jGraduate_Ok" class="jGraduate_Ok" value="OK"/><input type="button" id="'+o+'_jGraduate_Cancel" class="jGraduate_Cancel" value="Cancel"/></div>');const g=256,m=g-0,_=g-0,y={};e(".jGraduate_SliderBar").width(145);const v=e("#"+o+"_jGraduate_GradContainer")[0],b=n("svg",{id:o+"_jgraduate_svg",width:g,height:g,xmlns:Tr.svg},v);let x=a.paint.type,w=a.paint[x],S=w;const k=a.paint.alpha,C="solidColor"===x;switch(x){case"solidColor":case"linearGradient":if(C||(S.id=o+"_lg_jgraduate_grad",w=S=b.appendChild(S)),n("radialGradient",{id:o+"_rg_jgraduate_grad"},b),"linearGradient"===x)break;case"radialGradient":C||(S.id=o+"_rg_jgraduate_grad",w=S=b.appendChild(S)),n("linearGradient",{id:o+"_lg_jgraduate_grad"},b)}let A;if(C){w=S=e("#"+o+"_lg_jgraduate_grad")[0],U(0,"#"+(d=a.paint[x]),1);const t=typeof s.newstop;if("string"===t)switch(s.newstop){case"same":U(1,"#"+d,1);break;case"inverse":{let e="";for(let t=0;t<6;t+=2){let n=(255-parseInt(d.substr(t,2),16)).toString(16);n.length<2&&(n=0+n),e+=n}U(1,"#"+e,1);break}case"white":U(1,"#ffffff",1);break;case"black":U(1,"#000000",1)}else if("object"===t){const e="opac"in s.newstop?s.newstop.opac:1;U(1,s.newstop.color||"#"+d,e)}}const E=parseFloat(w.getAttribute("x1")||0),G=parseFloat(w.getAttribute("y1")||0),P=parseFloat(w.getAttribute("x2")||1),I=parseFloat(w.getAttribute("y2")||0),N=parseFloat(w.getAttribute("cx")||.5),T=parseFloat(w.getAttribute("cy")||.5),L=parseFloat(w.getAttribute("fx")||N),M=parseFloat(w.getAttribute("fy")||T),O=n("rect",{id:o+"_jgraduate_rect",x:0,y:0,width:m,height:_,fill:"url(#"+o+"_jgraduate_grad)","fill-opacity":k/100},b),j=e("<div/>").attr({class:"grad_coord jGraduate_lg_field",title:"Begin Stop"}).text(1).css({top:G*g,left:E*g}).data("coord","start").appendTo(v),V=j.clone().text(2).css({top:I*g,left:P*g}).attr("title","End stop").data("coord","end").appendTo(v),R=e("<div/>").attr({class:"grad_coord jGraduate_rg_field",title:"Center stop"}).text("C").css({top:T*g,left:N*g}).data("coord","center").appendTo(v),B=R.clone().text("F").css({top:M*g,left:L*g,display:"none"}).attr("title","Focus point").data("coord","focus").appendTo(v);let D;function U(t,r,i,a,l){const c=l||n("stop",{"stop-color":r,"stop-opacity":i,offset:t},S);l?(r=l.getAttribute("stop-color"),i=l.getAttribute("stop-opacity"),t=l.getAttribute("offset")):S.append(c),null===i&&(i=1);const u="M-6.2,0.9c3.6-4,6.7-4.3,6.7-12.4c-0.2,7.9,3.1,8.8,6.5,12.4c3.5,3.8,2.9,9.6,0,12.3c-3.1,2.8-10.4,2.7-13.2,0C-9.6,9.9-9.4,4.4-6.2,0.9z",d=n("path",{d:u,fill:"url(#jGraduate_trans)",transform:"translate("+(10+t*g)+", 26)"},A),p=n("path",{d:u,fill:r,"fill-opacity":i,transform:"translate("+(10+t*g)+", 26)",stroke:"#000","stroke-width":1.5},A);return e(p).mousedown(function(e){return Y(this),q=z,h.mousemove(ne).mouseup(W),X=F.offset(),e.preventDefault(),!1}).data("stop",c).data("bg",d).dblclick(function(){e("div.jGraduate_LightBox").show();const t=this;let n=Number(c.getAttribute("stop-opacity"))||1,i=c.getAttribute("stop-color")||1,a=(255*parseFloat(n)).toString(16);for(;a.length<2;)a="0"+a;r=i.substr(1)+a,e("#"+o+"_jGraduate_stopPicker").css({left:100,bottom:15}).jPicker({window:{title:"Pick the start color and opacity for the gradient"},images:{clientPath:s.images.clientPath},color:{active:r,alphaSupport:!0}},function(r,a){i=r.val("hex")?"#"+r.val("hex"):"none",n=null!==r.val("a")?r.val("a")/256:1,t.setAttribute("fill",i),t.setAttribute("fill-opacity",n),c.setAttribute("stop-color",i),c.setAttribute("stop-opacity",n),e("div.jGraduate_LightBox").hide(),e("#"+o+"_jGraduate_stopPicker").hide()},null,function(){e("div.jGraduate_LightBox").hide(),e("#"+o+"_jGraduate_stopPicker").hide()})}),e(S).find("stop").each(function(){const n=e(this);if(Number(this.getAttribute("offset"))>t){if(!r){const e=this.getAttribute("stop-color"),t=this.getAttribute("stop-opacity");c.setAttribute("stop-color",e),p.setAttribute("fill",e),c.setAttribute("stop-opacity",null===t?1:t),p.setAttribute("fill-opacity",null===t?1:t)}return n.before(c),!1}return!0}),a&&Y(p),c}B[0].id=o+"_jGraduate_focusCoord",e.each(["x1","y1","x2","y2","cx","cy","fx","fy"],function(t,n){const r=isNaN(n[1]);let i=S.getAttribute(n);i||(i=r?"0.5":"x2"===n?"1.0":"0.0"),y[n]=e("#"+o+"_jGraduate_"+n).val(i).change(function(){isNaN(parseFloat(this.value))||this.value<0?this.value=0:this.value>1&&(this.value=1),("f"!==n[0]||D)&&(r&&"radialGradient"===x||!r&&"linearGradient"===x)&&S.setAttribute(n,this.value);const e=r?"c"===n[0]?R:B:"1"===n[1]?j:V,t=n.includes("x")?"left":"top";e.css(t,this.value*g)}).change()});const F=e("#"+o+"_jGraduate_StopSlider");let H,z,q;const $=n("path",{d:"m9.75,-6l-19.5,19.5m0,-19.5l19.5,19.5",fill:"none",stroke:"#D00","stroke-width":5,display:"none"},void 0);function Y(e){z&&z.setAttribute("stroke","#000"),e.setAttribute("stroke","blue"),(z=e).parentNode.append(z)}let X;function W(){h.unbind("mousemove",ne),"none"!==$.getAttribute("display")&&function(){$.setAttribute("display","none");const t=e(z),n=t.data("stop"),r=t.data("bg");e([z,n,r]).remove()}(),q=null}let Q=1,K=1,Z=0,J=N,ee=T;function te(){const e=Z?"rotate("+Z+","+J+","+ee+") ":"";if(1===Q&&1===K)S.removeAttribute("gradientTransform");else{const t=-J*(Q-1),n=-ee*(K-1);S.setAttribute("gradientTransform",e+"translate("+t+","+n+") scale("+Q+","+K+")")}}function ne(t){let n=t.pageX-X.left;const r=t.pageY-X.top,i="translate("+(n=n<10?10:n>g+10?g+10:n)+", 26)";r<-60||r>130?($.setAttribute("display","block"),$.setAttribute("transform",i)):$.setAttribute("display","none"),q.setAttribute("transform",i),e.data(q,"bg").setAttribute("transform",i);const a=e.data(q,"stop"),s=(n-10)/g;a.setAttribute("offset",s);let o=0;e(S).find("stop").each(function(t){const n=this.getAttribute("offset"),r=e(this);n<o&&(r.prev().before(r),H=e(S).find("stop")),o=n})}const re=n("svg",{width:"100%",height:45},F[0]),ie=n("pattern",{width:16,height:16,patternUnits:"userSpaceOnUse",id:"jGraduate_trans"},re),ae=n("image",{width:16,height:16},ie),se=s.images.clientPath+"map-opacity.png";ae.setAttributeNS(Tr.xlink,"xlink:href",se),e(re).click(function(e){X=F.offset();const{target:t}=e;if("path"===t.tagName)return;let n=e.pageX-X.left-8;U((n=n<10?10:n>g+10?g+10:n)/g,0,0,!0),e.stopPropagation()}),e(re).mouseover(function(){re.append($)}),A=n("g",{},re),n("line",{x1:10,y1:15,x2:g+10,y2:15,"stroke-width":2,stroke:"#000"},re);const oe=f.find(".jGraduate_spreadMethod").change(function(){S.setAttribute("spreadMethod",e(this).val())});let le=null;const ce=function(e){let t=e.pageX-de.left,n=e.pageY-de.top;t=t<0?0:t>g?g:t,n=n<0?0:n>g?g:n,le.css("left",t).css("top",n);const r=t/m,i=n/_,a=le.data("coord"),s=S;switch(a){case"start":y.x1.val(r),y.y1.val(i),s.setAttribute("x1",r),s.setAttribute("y1",i);break;case"end":y.x2.val(r),y.y2.val(i),s.setAttribute("x2",r),s.setAttribute("y2",i);break;case"center":y.cx.val(r),y.cy.val(i),s.setAttribute("cx",r),s.setAttribute("cy",i),J=r,ee=i,te();break;case"focus":y.fx.val(r),y.fy.val(i),s.setAttribute("fx",r),s.setAttribute("fy",i),te()}e.preventDefault()},ue=function(){le=null,h.unbind("mousemove",ce).unbind("mouseup",ue)};let de,he,pe,fe,ge=(H=S.getElementsByTagNameNS(Tr.svg,"stop")).length;if(ge<2){for(;ge<2;)S.append(document.createElementNS(Tr.svg,"stop")),++ge;H=S.getElementsByTagNameNS(Tr.svg,"stop")}for(let e=0;e<ge;e++)U(0,0,0,0,H[e]);if(oe.val(S.getAttribute("spreadMethod")||"pad"),D=!1,O.setAttribute("fill-opacity",k/100),e("#"+o+" div.grad_coord").mousedown(function(t){t.preventDefault(),le=e(this),de=le.parent().offset(),h.mousemove(ce).mouseup(ue)}),e("#"+o+"_jGraduate_Ok").bind("click",function(){a.paint.type=x,a.paint[x]=S.cloneNode(!0),a.paint.solidColor=null,c()}),e("#"+o+"_jGraduate_Cancel").bind("click",function(e){u()}),"radialGradient"===x&&(D?B.show():(B.hide(),y.fx.val(""),y.fy.val(""))),e("#"+o+"_jGraduate_match_ctr")[0].checked=!D,e("#"+o+"_jGraduate_match_ctr").change(function(){D=!this.checked,B.toggle(D),y.fx.val(""),y.fy.val("");const e=S;if(D){const t=he||.5,n=pe||.5;e.setAttribute("fx",t),e.setAttribute("fy",n),y.fx.val(t),y.fy.val(n)}else he=e.getAttribute("fx"),pe=e.getAttribute("fy"),e.removeAttribute("fx"),e.removeAttribute("fy")}),(ge=(H=S.getElementsByTagNameNS(Tr.svg,"stop")).length)<2){for(;ge<2;)S.append(document.createElementNS(Tr.svg,"stop")),++ge;H=S.getElementsByTagNameNS(Tr.svg,"stop")}let me=0,_e=0;if("radialGradient"===x){const e=S.gradientTransform.baseVal;if(2===e.numberOfItems){const t=e.getItem(0),n=e.getItem(1);if(2===t.type&&3===n.type){const e=n.matrix;1!==e.a?me=Math.round(100*-(1-e.a)):1!==e.d&&(me=Math.round(100*(1-e.d)))}}else if(3===e.numberOfItems){const t=e.getItem(0),n=e.getItem(1),r=e.getItem(2);if(4===t.type&&2===n.type&&3===r.type){_e=Math.round(t.angle);const e=r.matrix;1!==e.a?me=Math.round(100*-(1-e.a)):1!==e.d&&(me=Math.round(100*(1-e.d)))}}}const ye={radius:{handle:"#"+o+"_jGraduate_RadiusArrows",input:"#"+o+"_jGraduate_RadiusInput",val:100*(S.getAttribute("r")||.5)},opacity:{handle:"#"+o+"_jGraduate_OpacArrows",input:"#"+o+"_jGraduate_OpacInput",val:a.paint.alpha||100},ellip:{handle:"#"+o+"_jGraduate_EllipArrows",input:"#"+o+"_jGraduate_EllipInput",val:me},angle:{handle:"#"+o+"_jGraduate_AngleArrows",input:"#"+o+"_jGraduate_AngleInput",val:_e}};e.each(ye,function(t,n){const r=e(n.handle);r.mousedown(function(i){const a=r.parent();fe={type:t,elem:r,input:e(n.input),parent:a,offset:a.offset()},h.mousemove(ve).mouseup(be),i.preventDefault()}),e(n.input).val(n.val).change(function(){const e="radialGradient"===x;let n=Number(this.value),i=0;switch(t){case"radius":e&&S.setAttribute("r",n/100),i=(n/100)**.4/2*145;break;case"opacity":a.paint.alpha=n,O.setAttribute("fill-opacity",n/100),i=1.45*n;break;case"ellip":if(Q=K=1,0===n){i=72.5;break}n>99.5&&(n=99.5),n>0?K=1-n/100:Q=-n/100-1,i=(n+100)/2*145/100,e&&te();break;case"angle":i=(Z=n)/180,i+=.5,i*=145,e&&te()}i>145?i=145:i<0&&(i=0),r.css({"margin-left":i-5})}).change()});const ve=function(e){!function(e){const{offset:{left:t}}=fe,n=fe.parent;let r=e.pageX-t-parseInt(n.css("border-left-width"));r>145&&(r=145),r<=0&&(r=0);const i=r-5;switch(r/=145,fe.type){case"radius":(r=(2*r)**2.5)>.98&&r<1.02&&(r=1),r<=.01&&(r=.01),S.setAttribute("r",r);break;case"opacity":a.paint.alpha=parseInt(100*r),O.setAttribute("fill-opacity",r);break;case"ellip":Q=1,K=1,r<.5?Q=(r/=.5)<=0?.01:r:r>.5&&(K=(r=2-(r/=.5))<=0?.01:r),te(),K===1+(r-=1)&&(r=Math.abs(r));break;case"angle":r-=.5,Z=r*=180,te(),r/=100}fe.elem.css({"margin-left":i}),r=Math.round(100*r),fe.input.val(r)}(e),e.preventDefault()},be=function(e){h.unbind("mousemove",ve).unbind("mouseup",be),fe=null};let xe=(255*a.paint.alpha/100).toString(16);for(;xe.length<2;)xe="0"+xe;xe=xe.split(".")[0],d="none"===a.paint.solidColor?"":a.paint.solidColor+xe,C||(d=H[0].getAttribute("stop-color")),e.extend(e.fn.jPicker.defaults.window,{alphaSupport:!0,effects:{type:"show",speed:0}}),p.jPicker({window:{title:s.window.pickerTitle},images:{clientPath:s.images.clientPath},color:{active:d,alphaSupport:!0}},function(e){a.paint.type="solidColor",a.paint.alpha=e.val("ahex")?Math.round(e.val("a")/255*100):100,a.paint.solidColor=e.val("hex")?e.val("hex"):"none",a.paint.radialGradient=null,c()},null,function(){u()});const we=e(l+" .jGraduate_tabs li");let Se;switch(we.click(function(){we.removeClass("jGraduate_tab_current"),e(this).addClass("jGraduate_tab_current"),e(l+" > div").hide();const t=e(this).attr("data-type");if(e(l+" .jGraduate_gradPick").show(),"rg"===t||"lg"===t){e(".jGraduate_"+t+"_field").show(),e(".jGraduate_"+("lg"===t?"rg":"lg")+"_field").hide(),e("#"+o+"_jgraduate_rect")[0].setAttribute("fill","url(#"+o+"_"+t+"_jgraduate_grad)"),x="lg"===t?"linearGradient":"radialGradient",e("#"+o+"_jGraduate_OpacInput").val(a.paint.alpha).change();const n=e("#"+o+"_"+t+"_jgraduate_grad")[0];if(S!==n){const t=e(S).find("stop");e(n).empty().append(t),S=n;const r=oe.val();S.setAttribute("spreadMethod",r)}D="rg"===t&&null!==S.getAttribute("fx")&&!(N===L&&T===M),e("#"+o+"_jGraduate_focusCoord").toggle(D),D&&(e("#"+o+"_jGraduate_match_ctr")[0].checked=!1)}else e(l+" .jGraduate_gradPick").hide(),e(l+" .jGraduate_colPick").show()}),e(l+" > div").hide(),we.removeClass("jGraduate_tab_current"),a.paint.type){case"linearGradient":Se=e(l+" .jGraduate_tab_lingrad");break;case"radialGradient":Se=e(l+" .jGraduate_tab_radgrad");break;default:Se=e(l+" .jGraduate_tab_color")}a.show(),setTimeout(()=>{Se.addClass("jGraduate_tab_current").click()},10)})},e},function(e){return e.loadingStylesheets||(e.loadingStylesheets=[]),e.loadingStylesheets.includes("spinbtn/jQuery.SpinButton.css")||e.loadingStylesheets.push("spinbtn/jQuery.SpinButton.css"),e.fn.SpinButton=function(t){function n(t,n){const r=document.body;let i=t[n];for(;(t=t.offsetParent)&&t!==r;)e.browser.msie&&"relative"===t.currentStyle.position||(i+=t[n]);return i}return t=t||{},this.each(function(){this.repeating=!1,this.spinCfg={min:isNaN(parseFloat(t.min))?null:Number(t.min),max:isNaN(parseFloat(t.max))?null:Number(t.max),step:t.step?Number(t.step):1,stepfunc:t.stepfunc||!1,page:t.page?Number(t.page):10,upClass:t.upClass||"up",downClass:t.downClass||"down",reset:t.reset||this.value,delay:t.delay?Number(t.delay):500,interval:t.interval?Number(t.interval):100,_btn_width:20,_direction:null,_delay:null,_repeat:null,callback:t.callback||null},this.spinCfg.smallStep=t.smallStep||this.spinCfg.step/2,this.adjustValue=function(e){let t;t=isNaN(this.value)?this.spinCfg.reset:"function"==typeof this.spinCfg.stepfunc?this.spinCfg.stepfunc(this,e):Number((Number(this.value)+Number(e)).toFixed(5)),null!==this.spinCfg.min&&(t=Math.max(t,this.spinCfg.min)),null!==this.spinCfg.max&&(t=Math.min(t,this.spinCfg.max)),this.value=t,"function"==typeof this.spinCfg.callback&&this.spinCfg.callback(this)},e(this).addClass(t.spinClass||"spin-button").mousemove(function(r){const i=r.pageX||r.x,a=r.pageY||r.y,s=r.target,o=t.stateObj.tool_scale||1,l=e(s).height()/2,c=i>n(s,"offsetLeft")+s.offsetWidth*o-this.spinCfg._btn_width?a<n(s,"offsetTop")+l*o?1:-1:0;if(c!==this.spinCfg._direction){switch(c){case 1:e(this).removeClass(this.spinCfg.downClass).addClass(this.spinCfg.upClass);break;case-1:e(this).removeClass(this.spinCfg.upClass).addClass(this.spinCfg.downClass);break;default:e(this).removeClass(this.spinCfg.upClass).removeClass(this.spinCfg.downClass)}this.spinCfg._direction=c}}).mouseout(function(){e(this).removeClass(this.spinCfg.upClass).removeClass(this.spinCfg.downClass),this.spinCfg._direction=null,window.clearInterval(this.spinCfg._repeat),window.clearTimeout(this.spinCfg._delay)}).mousedown(function(e){if(0===e.button&&0!==this.spinCfg._direction){const t=e.shiftKey?this.spinCfg.smallStep:this.spinCfg.step,n=()=>{this.adjustValue(this.spinCfg._direction*t)};n(),this.spinCfg._delay=window.setTimeout(()=>{n(),this.spinCfg._repeat=window.setInterval(n,this.spinCfg.interval)},this.spinCfg.delay)}}).mouseup(function(e){window.clearInterval(this.spinCfg._repeat),window.clearTimeout(this.spinCfg._delay)}).dblclick(function(t){e.browser.msie&&this.adjustValue(this.spinCfg._direction*this.spinCfg.step)}).keydown(function(e){switch(e.keyCode){case 38:this.adjustValue(this.spinCfg.step);break;case 40:this.adjustValue(-this.spinCfg.step);break;case 33:this.adjustValue(this.spinCfg.page);break;case 34:this.adjustValue(-this.spinCfg.page)}}).keypress(function(e){if(this.repeating)switch(e.keyCode){case 38:this.adjustValue(this.spinCfg.step);break;case 40:this.adjustValue(-this.spinCfg.step);break;case 33:this.adjustValue(this.spinCfg.page);break;case 34:this.adjustValue(-this.spinCfg.page)}else this.repeating=!0}).keyup(function(e){switch(this.repeating=!1,e.keyCode){case 38:case 40:case 33:case 34:case 13:this.adjustValue(0)}}).bind("mousewheel",function(e){e.wheelDelta>=120?this.adjustValue(this.spinCfg.step):e.wheelDelta<=-120&&this.adjustValue(-this.spinCfg.step),e.preventDefault()}).change(function(e){this.adjustValue(0)}),this.addEventListener&&this.addEventListener("DOMMouseScroll",function(e){e.detail>0?this.adjustValue(-this.spinCfg.step):e.detail<0&&this.adjustValue(this.spinCfg.step),e.preventDefault()})})},e}
/**
 * jQuery Context Menu Plugin
 * Cory S.N. LaViska
 * A Beautiful Site ({@link https://abeautifulsite.net/})
 * Modified by Alexis Deveria
 *
 * More info: {@link https://abeautifulsite.net/2008/09/jquery-context-menu-plugin/}
 *
 * @module jQueryContextMenu
 * @todo Update to latest version and adapt (and needs jQuery update as well): {@link https://github.com/swisnl/jQuery-contextMenu}
 * @version 1.01
 *
 * @license
 * Terms of Use
 *
 * This plugin is dual-licensed under the GNU General Public License
 *   and the MIT License and is copyright A Beautiful Site, LLC.
 *
*/,K,function(e){const t=e(window),n=e(document);return e.extend(e.fn,{contextMenu(r,i){return void 0!==r.menu&&(void 0===r.inSpeed&&(r.inSpeed=150),void 0===r.outSpeed&&(r.outSpeed=75),0===r.inSpeed&&(r.inSpeed=-1),0===r.outSpeed&&(r.outSpeed=-1),e(this).each(function(){const a=e(this),s=e(a).offset(),o=e("#"+r.menu);o.addClass("contextMenu"),e(this).bind("mousedown",function(l){e(this).mouseup(function(c){const u=e(this);if(u.unbind("mouseup"),!(2===l.button||r.allowLeft||l.ctrlKey&&q()))return;if(c.stopPropagation(),e(".contextMenu").hide(),a.hasClass("disabled"))return!1;let d=c.pageX,h=c.pageY;const p=t.width()-o.width(),f=t.height()-o.height();d>p-15&&(d=p-15),h>f-30&&(h=f-30),n.unbind("click"),o.css({top:h,left:d}).fadeIn(r.inSpeed),o.find("A").mouseover(function(){o.find("LI.hover").removeClass("hover"),e(this).parent().addClass("hover")}).mouseout(function(){o.find("LI.hover").removeClass("hover")}),n.keypress(function(e){switch(e.keyCode){case 38:o.find("LI.hover").length?(o.find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover"),o.find("LI.hover").length||o.find("LI:last").addClass("hover")):o.find("LI:last").addClass("hover");break;case 40:o.find("LI.hover").length?(o.find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover"),o.find("LI.hover").length||o.find("LI:first").addClass("hover")):o.find("LI:first").addClass("hover");break;case 13:o.find("LI.hover A").trigger("click");break;case 27:n.trigger("click")}}),o.find("A").unbind("mouseup"),o.find("LI:not(.disabled) A").mouseup(function(){return n.unbind("click").unbind("keypress"),e(".contextMenu").hide(),i&&i(e(this).attr("href").substr(1),e(u),{x:d-s.left,y:h-s.top,docX:d,docY:h}),!1}),setTimeout(function(){n.click(function(){return n.unbind("click").unbind("keypress"),o.fadeOut(r.outSpeed),!1})},0)})}),e.browser.mozilla?e("#"+r.menu).each(function(){e(this).css({MozUserSelect:"none"})}):e.browser.msie?e("#"+r.menu).each(function(){e(this).bind("selectstart.disableTextSelect",function(){return!1})}):e("#"+r.menu).each(function(){e(this).bind("mousedown.disableTextSelect",function(){return!1})}),e(a).add(e("UL.contextMenu")).bind("contextmenu",function(){return!1})}),e(this))},disableContextMenuItems(t){return void 0===t?(e(this).find("LI").addClass("disabled"),e(this)):(e(this).each(function(){if(void 0!==t){const n=t.split(",");for(let t=0;t<n.length;t++)e(this).find('A[href="'+n[t]+'"]').parent().addClass("disabled")}}),e(this))},enableContextMenuItems(t){return void 0===t?(e(this).find("LI.disabled").removeClass("disabled"),e(this)):(e(this).each(function(){if(void 0!==t){const n=t.split(",");for(let t=0;t<n.length;t++)e(this).find('A[href="'+n[t]+'"]').parent().removeClass("disabled")}}),e(this))},disableContextMenu(){return e(this).each(function(){e(this).addClass("disabled")}),e(this)},enableContextMenu(){return e(this).each(function(){e(this).removeClass("disabled")}),e(this)},destroyContextMenu(){return e(this).each(function(){e(this).unbind("mousedown").unbind("mouseup")}),e(this)}}),e},function(e){e.loadingStylesheets||(e.loadingStylesheets=[]);e.loadingStylesheets.includes("jgraduate/css/jPicker.css")||e.loadingStylesheets.push("jgraduate/css/jPicker.css");class t{constructor(t,n){const r=this;function i(n){const i=t.offset();u={l:0|i.left,t:0|i.top},clearTimeout(d),d=setTimeout(function(){o.call(r,n)},0),e(document).bind("mousemove",a).bind("mouseup",s),n.preventDefault()}function a(e){return clearTimeout(d),d=setTimeout(function(){o.call(r,e)},0),e.stopPropagation(),e.preventDefault(),!1}function s(t){return e(document).unbind("mouseup",s).unbind("mousemove",a),t.stopPropagation(),t.preventDefault(),!1}function o(e){const n=t.w,i=t.h;let a=e.pageX-u.l,s=e.pageY-u.t;a<0?a=0:a>n&&(a=n),s<0?s=0:s>i&&(s=i),l.call(r,"xy",{x:a/n*m+f,y:s/i*v+_})}function l(e,t,n){if(void 0===t)switch(Mr(e)&&(e="xy"),e.toLowerCase()){case"x":return h;case"y":return p;case"xy":default:return{x:h,y:p}}if(!Mr(n)&&n===r)return;let i,a,s=!1;switch(Mr(e)&&(e="xy"),e.toLowerCase()){case"x":i=t&&(t.x&&0|t.x||0|t)||0;break;case"y":a=t&&(t.y&&0|t.y||0|t)||0;break;case"xy":default:i=t&&t.x&&0|t.x||0,a=t&&t.y&&0|t.y||0}Mr(i)||(i<f?i=f:i>g&&(i=g),h!==i&&(h=i,s=!0)),Mr(a)||(a<_?a=_:a>y&&(a=y),p!==a&&(p=a,s=!0)),s&&function(e){x.forEach(t=>{t.call(r,r,e)})}.call(r,n||r)}function c(e){"function"==typeof e&&x.push(e)}let u,d,h=0,p=0,f=0,g=100,m=100,_=0,y=100,v=100,b=t.find("img:first"),x=[];e.extend(!0,r,{val:l,range:function(e,t){if(void 0===t)switch(Mr(e)&&(e="all"),e.toLowerCase()){case"minx":return f;case"maxx":return g;case"rangex":return{minX:f,maxX:g,rangeX:m};case"miny":return _;case"maxy":return y;case"rangey":return{minY:_,maxY:y,rangeY:v};case"all":default:return{minX:f,maxX:g,rangeX:m,minY:_,maxY:y,rangeY:v}}let n,r,i,a;switch(Mr(e)&&(e="all"),e.toLowerCase()){case"minx":n=t&&(t.minX&&0|t.minX||0|t)||0;break;case"maxx":r=t&&(t.maxX&&0|t.maxX||0|t)||0;break;case"rangex":n=t&&t.minX&&0|t.minX||0,r=t&&t.maxX&&0|t.maxX||0;break;case"miny":i=t&&(t.minY&&0|t.minY||0|t)||0;break;case"maxy":a=t&&(t.maxY&&0|t.maxY||0|t)||0;break;case"rangey":i=t&&t.minY&&0|t.minY||0,a=t&&t.maxY&&0|t.maxY||0;break;case"all":default:n=t&&t.minX&&0|t.minX||0,r=t&&t.maxX&&0|t.maxX||0,i=t&&t.minY&&0|t.minY||0,a=t&&t.maxY&&0|t.maxY||0}Mr(n)||f===n||(m=g-(f=n)),Mr(r)||g===r||(m=(g=r)-f),Mr(i)||_===i||(v=y-(_=i)),Mr(a)||y===a||(v=(y=a)-_)},bind:c,unbind:function(e){if("function"!=typeof e)return;let t;for(;t=x.includes(e);)x.splice(t,1)},destroy:function(){e(document).unbind("mouseup",s).unbind("mousemove",a),t.unbind("mousedown",i),t=null,b=null,x=null}}),b.src=n.arrow&&n.arrow.image,b.w=n.arrow&&n.arrow.width||b.width(),b.h=n.arrow&&n.arrow.height||b.height(),t.w=n.map&&n.map.width||t.width(),t.h=n.map&&n.map.height||t.height(),t.bind("mousedown",i),c.call(r,function(){const e=t.w,n=t.h,r=b.w,i=b.h;let a=0,s=0;setTimeout(function(){m>0&&(a=h===g?e:h/m*e|0),v>0&&(s=p===y?n:p/v*n|0),r>=e?a=(e>>1)-(r>>1):a-=r>>1,i>=n?s=(n>>1)-(i>>1):s-=i>>1,b.css({left:a+"px",top:s+"px"})})})}}class n{constructor(t,n,r,i){const a=this,s=t.find("td.Text input");function o(e){if(""!==e.target.value||e.target===b.get(0)||(Mr(r)||e.target===r.get(0))&&!Mr(r)){if(!u(e))return e;switch(e.target){case p.get(0):switch(e.keyCode){case 38:return p.val(d.call(a,1+(p.val()<<0),0,255)),n.val("r",p.val(),e.target),!1;case 40:return p.val(d.call(a,(p.val()<<0)-1,0,255)),n.val("r",p.val(),e.target),!1}break;case f.get(0):switch(e.keyCode){case 38:return f.val(d.call(a,1+(f.val()<<0),0,255)),n.val("g",f.val(),e.target),!1;case 40:return f.val(d.call(a,(f.val()<<0)-1,0,255)),n.val("g",f.val(),e.target),!1}break;case g.get(0):switch(e.keyCode){case 38:return g.val(d.call(a,1+(g.val()<<0),0,255)),n.val("b",g.val(),e.target),!1;case 40:return g.val(d.call(a,(g.val()<<0)-1,0,255)),n.val("b",g.val(),e.target),!1}break;case m&&m.get(0):switch(e.keyCode){case 38:return m.val(d.call(a,parseFloat(m.val())+1,0,100)),n.val("a",Lr(255*m.val()/100,i),e.target),!1;case 40:return m.val(d.call(a,parseFloat(m.val())-1,0,100)),n.val("a",Lr(255*m.val()/100,i),e.target),!1}break;case _.get(0):switch(e.keyCode){case 38:return _.val(d.call(a,1+(_.val()<<0),0,360)),n.val("h",_.val(),e.target),!1;case 40:return _.val(d.call(a,(_.val()<<0)-1,0,360)),n.val("h",_.val(),e.target),!1}break;case y.get(0):switch(e.keyCode){case 38:return y.val(d.call(a,1+(y.val()<<0),0,100)),n.val("s",y.val(),e.target),!1;case 40:return y.val(d.call(a,(y.val()<<0)-1,0,100)),n.val("s",y.val(),e.target),!1}break;case v.get(0):switch(e.keyCode){case 38:return v.val(d.call(a,1+(v.val()<<0),0,100)),n.val("v",v.val(),e.target),!1;case 40:return v.val(d.call(a,(v.val()<<0)-1,0,100)),n.val("v",v.val(),e.target),!1}}}}function l(e){if(""!==e.target.value||e.target===b.get(0)||(Mr(r)||e.target===r.get(0))&&!Mr(r)){if(!u(e))return e;switch(e.target){case p.get(0):p.val(d.call(a,p.val(),0,255)),n.val("r",p.val(),e.target);break;case f.get(0):f.val(d.call(a,f.val(),0,255)),n.val("g",f.val(),e.target);break;case g.get(0):g.val(d.call(a,g.val(),0,255)),n.val("b",g.val(),e.target);break;case m&&m.get(0):m.val(d.call(a,m.val(),0,100)),n.val("a",Lr(255*m.val()/100,i),e.target);break;case _.get(0):_.val(d.call(a,_.val(),0,360)),n.val("h",_.val(),e.target);break;case y.get(0):y.val(d.call(a,y.val(),0,100)),n.val("s",y.val(),e.target);break;case v.get(0):v.val(d.call(a,v.val(),0,100)),n.val("v",v.val(),e.target);break;case b.get(0):b.val(b.val().replace(/[^a-fA-F0-9]/g,"").toLowerCase().substring(0,6)),r&&r.val(b.val()),n.val("hex",""!==b.val()?b.val():null,e.target);break;case r&&r.get(0):r.val(r.val().replace(/[^a-fA-F0-9]/g,"").toLowerCase().substring(0,6)),b.val(r.val()),n.val("hex",""!==r.val()?r.val():null,e.target);break;case x&&x.get(0):x.val(x.val().replace(/[^a-fA-F0-9]/g,"").toLowerCase().substring(0,2)),n.val("a",Mr(x.val())?null:parseInt(x.val(),16),e.target)}}}function c(e){if(!Mr(n.val()))switch(e.target){case p.get(0):p.val(n.val("r"));break;case f.get(0):f.val(n.val("g"));break;case g.get(0):g.val(n.val("b"));break;case m&&m.get(0):m.val(Lr(100*n.val("a")/255,i));break;case _.get(0):_.val(n.val("h"));break;case y.get(0):y.val(n.val("s"));break;case v.get(0):v.val(n.val("v"));break;case b.get(0):case r&&r.get(0):b.val(n.val("hex")),r&&r.val(n.val("hex"));break;case x&&x.get(0):x.val(n.val("ahex").substring(6))}}function u(e){switch(e.keyCode){case 9:case 16:case 29:case 37:case 39:return!1;case"c".charCodeAt():case"v".charCodeAt():if(e.ctrlKey)return!1}return!0}function d(e,t,n){return""===e||isNaN(e)?t:e>n?n:e<t?t:e}function h(e,t){const n=e.val("all");t!==p.get(0)&&p.val(Mr(n)?"":n.r),t!==f.get(0)&&f.val(Mr(n)?"":n.g),t!==g.get(0)&&g.val(Mr(n)?"":n.b),m&&t!==m.get(0)&&m.val(Mr(n)?"":Lr(100*n.a/255,i)),t!==_.get(0)&&_.val(Mr(n)?"":n.h),t!==y.get(0)&&y.val(Mr(n)?"":n.s),t!==v.get(0)&&v.val(Mr(n)?"":n.v),t!==b.get(0)&&(r&&t!==r.get(0)||!r)&&b.val(Mr(n)?"":n.hex),r&&t!==r.get(0)&&t!==b.get(0)&&r.val(Mr(n)?"":n.hex),x&&t!==x.get(0)&&x.val(Mr(n)?"":n.ahex.substring(6))}let p=s.eq(3),f=s.eq(4),g=s.eq(5),m=s.length>7?s.eq(6):null,_=s.eq(0),y=s.eq(1),v=s.eq(2),b=s.eq(s.length>7?7:6),x=s.length>7?s.eq(8):null;e.extend(!0,a,{destroy:function(){p.add(f).add(g).add(m).add(_).add(y).add(v).add(b).add(r).add(x).unbind("keyup",l).unbind("blur",c),p.add(f).add(g).add(m).add(_).add(y).add(v).unbind("keydown",o),n.unbind(h),p=null,f=null,g=null,m=null,_=null,y=null,v=null,b=null,x=null}}),p.add(f).add(g).add(m).add(_).add(y).add(v).add(b).add(r).add(x).bind("keyup",l).bind("blur",c),p.add(f).add(g).add(m).add(_).add(y).add(v).bind("keydown",o),n.bind(h)}}e.jPicker={List:[],Color:function(t){const n=this;function r(e){for(let t=0;t<p.length;t++)p[t].call(n,n,e)}function i(e,t,p){const f=Boolean(t);if(f&&""===t.ahex&&(t.ahex="00000000"),!f){let t;if((Mr(e)||""===e)&&(e="all"),Mr(s))return null;switch(e.toLowerCase()){case"ahex":return a.rgbaToHex({r:s,g:o,b:l,a:c});case"hex":return i("ahex").substring(0,6);case"all":return{r:s,g:o,b:l,a:c,h:u,s:d,v:h,hex:i.call(n,"hex"),ahex:i.call(n,"ahex")};default:{t={};const n=e.length;[...e].forEach(e=>{switch(e){case"r":1===n?t=s:t.r=s;break;case"g":1===n?t=o:t.g=o;break;case"b":1===n?t=l:t.b=l;break;case"a":1===n?t=c:t.a=c;break;case"h":1===n?t=u:t.h=u;break;case"s":1===n?t=d:t.s=d;break;case"v":1===n?t=h:t.v=h}})}}return"object"!=typeof t||Object.keys(t).length?t:i.call(n,"all")}if(!Mr(p)&&p===n)return;Mr(e)&&(e="");let g=!1;if(Mr(t))return Mr(s)||(s=null,g=!0),Mr(o)||(o=null,g=!0),Mr(l)||(l=null,g=!0),Mr(c)||(c=null,g=!0),Mr(u)||(u=null,g=!0),Mr(d)||(d=null,g=!0),Mr(h)||(h=null,g=!0),void(g&&r.call(n,p||n));switch(e.toLowerCase()){case"ahex":case"hex":{const r=a.hexToRgba(t&&(t.ahex||t.hex)||t||"none");i.call(n,"rgba",{r:r.r,g:r.g,b:r.b,a:"ahex"===e?r.a:Mr(c)?255:c},p);break}default:{if(t&&(!Mr(t.ahex)||!Mr(t.hex)))return void i.call(n,"ahex",t.ahex||t.hex||"00000000",p);const f={};let m=!1,_=!1;if(void 0===t.r||e.includes("r")||(e+="r"),void 0===t.g||e.includes("g")||(e+="g"),void 0===t.b||e.includes("b")||(e+="b"),void 0===t.a||e.includes("a")||(e+="a"),void 0===t.h||e.includes("h")||(e+="h"),void 0===t.s||e.includes("s")||(e+="s"),void 0===t.v||e.includes("v")||(e+="v"),[...e].forEach(e=>{switch(e){case"r":if(_)return;m=!0,f.r=t.r&&0|t.r||0|t||0,f.r<0?f.r=0:f.r>255&&(f.r=255),s!==f.r&&(({r:s}=f),g=!0);break;case"g":if(_)return;m=!0,f.g=t&&t.g&&0|t.g||t&&0|t||0,f.g<0?f.g=0:f.g>255&&(f.g=255),o!==f.g&&(({g:o}=f),g=!0);break;case"b":if(_)return;m=!0,f.b=t&&t.b&&0|t.b||t&&0|t||0,f.b<0?f.b=0:f.b>255&&(f.b=255),l!==f.b&&(({b:l}=f),g=!0);break;case"a":f.a=t&&!Mr(t.a)?0|t.a:0|t,f.a<0?f.a=0:f.a>255&&(f.a=255),c!==f.a&&(({a:c}=f),g=!0);break;case"h":if(m)return;_=!0,f.h=t&&t.h&&0|t.h||t&&0|t||0,f.h<0?f.h=0:f.h>360&&(f.h=360),u!==f.h&&(({h:u}=f),g=!0);break;case"s":if(m)return;_=!0,f.s=Mr(t.s)?0|t:0|t.s,f.s<0?f.s=0:f.s>100&&(f.s=100),d!==f.s&&(({s:d}=f),g=!0);break;case"v":if(m)return;_=!0,f.v=Mr(t.v)?0|t:0|t.v,f.v<0?f.v=0:f.v>100&&(f.v=100),h!==f.v&&(({v:h}=f),g=!0)}}),g){if(m){s=s||0,o=o||0,l=l||0;const e=a.rgbToHsv({r:s,g:o,b:l});({h:u,s:d,v:h}=e)}else if(_){u=u||0,d=Mr(d)?100:d,h=Mr(h)?100:h;const e=a.hsvToRgb({h:u,s:d,v:h});({r:s,g:o,b:l}=e)}c=Mr(c)?255:c,r.call(n,p||n)}break}}}let s,o,l,c,u,d,h,p=[];e.extend(!0,n,{val:i,bind:function(e){"function"==typeof e&&p.push(e)},unbind:function(e){if("function"!=typeof e)return;let t;for(;t=p.includes(e);)p.splice(t,1)},destroy:function(){p=null}}),t&&(Mr(t.ahex)?Mr(t.hex)?Mr(t.r)||Mr(t.g)||Mr(t.b)?Mr(t.h)||Mr(t.s)||Mr(t.v)||i("hsv"+(Mr(t.a)?"":"a"),t):i("rgb"+(Mr(t.a)?"":"a"),t):i((Mr(t.a)?"":"a")+"hex",Mr(t.a)?t:{ahex:t.hex+a.intToHex(t.a)}):i("ahex",t))},ColorMethods:{hexToRgba(e){if(""===e||"none"===e)return{r:null,g:null,b:null,a:null};let t="00",n="00",r="00",i="255";return 6===(e=this.validateHex(e)).length&&(e+="ff"),e.length>6?(t=e.substring(0,2),n=e.substring(2,4),r=e.substring(4,6),i=e.substring(6,e.length)):(e.length>4&&(t=e.substring(4,e.length),e=e.substring(0,4)),e.length>2&&(n=e.substring(2,e.length),e=e.substring(0,2)),e.length>0&&(r=e.substring(0,e.length))),{r:this.hexToInt(t),g:this.hexToInt(n),b:this.hexToInt(r),a:this.hexToInt(i)}},validateHex:e=>((e=e.toLowerCase().replace(/[^a-f0-9]/g,"")).length>8&&(e=e.substring(0,8)),e),rgbaToHex(e){return this.intToHex(e.r)+this.intToHex(e.g)+this.intToHex(e.b)+this.intToHex(e.a)},intToHex(e){let t=(0|e).toString(16);return 1===t.length&&(t="0"+t),t.toLowerCase()},hexToInt:e=>parseInt(e,16),rgbToHsv(e){const t=e.r/255,n=e.g/255,r=e.b/255,i={h:0,s:0,v:0};let a,s=0,o=0;return t>=n&&t>=r?(o=t,s=n>r?r:n):n>=r&&n>=t?(o=n,s=t>r?r:t):(o=r,s=n>t?t:n),i.v=o,i.s=o?(o-s)/o:0,i.s?(a=o-s,i.h=t===o?(n-r)/a:n===o?2+(r-t)/a:4+(t-n)/a,i.h=parseInt(60*i.h),i.h<0&&(i.h+=360)):i.h=0,i.s=100*i.s|0,i.v=100*i.v|0,i},hsvToRgb(e){const t={r:0,g:0,b:0,a:100};let{h:n,s:r,v:i}=e;if(0===r)t.r=t.g=t.b=0===i?0:255*i/100|0;else{360===n&&(n=0);const e=0|(n/=60),a=n-e,s=(i/=100)*(1-(r/=100)),o=i*(1-r*a),l=i*(1-r*(1-a));switch(e){case 0:t.r=i,t.g=l,t.b=s;break;case 1:t.r=o,t.g=i,t.b=s;break;case 2:t.r=s,t.g=i,t.b=l;break;case 3:t.r=s,t.g=o,t.b=i;break;case 4:t.r=l,t.g=s,t.b=i;break;case 5:t.r=i,t.g=s,t.b=o}t.r=255*t.r|0,t.g=255*t.g|0,t.b=255*t.b|0}return t}}};const{Color:r,List:i,ColorMethods:a}=e.jPicker;return e.fn.jPicker=function(s,o,l,c){return this.each(function(){const u=this,d=e.extend(!0,{},e.fn.jPicker.defaults,s);"input"===e(u).get(0).nodeName.toLowerCase()&&(e.extend(!0,d,{window:{bindToInput:!0,expandable:!0,input:e(u)}}),""===e(u).val()?(d.color.active=new r({hex:null}),d.color.current=new r({hex:null})):a.validateHex(e(u).val())&&(d.color.active=new r({hex:e(u).val(),a:d.color.active.val("a")}),d.color.current=new r({hex:e(u).val(),a:d.color.active.val("a")}))),d.window.expandable?e(u).after('<span class="jPicker"><span class="Icon"><span class="Color">&nbsp;</span><span class="Alpha">&nbsp;</span><span class="Image" title="Click To Open Color Picker">&nbsp;</span><span class="Container">&nbsp;</span></span></span>'):d.window.liveUpdate=!1;const h=parseFloat(navigator.appVersion.split("MSIE")[1])<7&&document.body.filters;function p(e){const{active:t}=V,n=t.val("hex");let r,i;switch(d.color.mode=e,e){case"h":if(setTimeout(function(){_.call(u,H,"transparent"),v.call(u,q,0),b.call(u,q,100),v.call(u,$,260),b.call(u,$,100),_.call(u,z,"transparent"),v.call(u,X,0),b.call(u,X,100),v.call(u,W,260),b.call(u,W,100),v.call(u,Q,260),b.call(u,Q,100),v.call(u,K,260),b.call(u,K,100),v.call(u,J,260),b.call(u,J,100)},0),ee.range("all",{minX:0,maxX:100,minY:0,maxY:100}),te.range("rangeY",{minY:0,maxY:360}),Mr(t.val("ahex")))break;ee.val("xy",{x:t.val("s"),y:100-t.val("v")},ee),te.val("y",360-t.val("h"),te);break;case"s":if(setTimeout(function(){_.call(u,H,"transparent"),v.call(u,q,-260),v.call(u,$,-520),v.call(u,X,-260),v.call(u,W,-520),v.call(u,J,260),b.call(u,J,100)},0),ee.range("all",{minX:0,maxX:360,minY:0,maxY:100}),te.range("rangeY",{minY:0,maxY:100}),Mr(t.val("ahex")))break;ee.val("xy",{x:t.val("h"),y:100-t.val("v")},ee),te.val("y",100-t.val("s"),te);break;case"v":if(setTimeout(function(){_.call(u,H,"000000"),v.call(u,q,-780),v.call(u,$,260),_.call(u,z,n),v.call(u,X,-520),v.call(u,W,260),b.call(u,W,100),v.call(u,J,260),b.call(u,J,100)},0),ee.range("all",{minX:0,maxX:360,minY:0,maxY:100}),te.range("rangeY",{minY:0,maxY:100}),Mr(t.val("ahex")))break;ee.val("xy",{x:t.val("h"),y:100-t.val("s")},ee),te.val("y",100-t.val("v"),te);break;case"r":if(r=-1040,i=-780,ee.range("all",{minX:0,maxX:255,minY:0,maxY:255}),te.range("rangeY",{minY:0,maxY:255}),Mr(t.val("ahex")))break;ee.val("xy",{x:t.val("b"),y:255-t.val("g")},ee),te.val("y",255-t.val("r"),te);break;case"g":if(r=-1560,i=-1820,ee.range("all",{minX:0,maxX:255,minY:0,maxY:255}),te.range("rangeY",{minY:0,maxY:255}),Mr(t.val("ahex")))break;ee.val("xy",{x:t.val("b"),y:255-t.val("r")},ee),te.val("y",255-t.val("g"),te);break;case"b":if(r=-2080,i=-2860,ee.range("all",{minX:0,maxX:255,minY:0,maxY:255}),te.range("rangeY",{minY:0,maxY:255}),Mr(t.val("ahex")))break;ee.val("xy",{x:t.val("r"),y:255-t.val("g")},ee),te.val("y",255-t.val("b"),te);break;case"a":if(setTimeout(function(){_.call(u,H,"transparent"),v.call(u,q,-260),v.call(u,$,-520),v.call(u,X,260),v.call(u,W,260),b.call(u,W,100),v.call(u,J,0),b.call(u,J,100)},0),ee.range("all",{minX:0,maxX:360,minY:0,maxY:100}),te.range("rangeY",{minY:0,maxY:255}),Mr(t.val("ahex")))break;ee.val("xy",{x:t.val("h"),y:100-t.val("v")},ee),te.val("y",255-t.val("a"),te);break;default:throw new Error("Invalid Mode")}switch(e){case"h":break;case"s":case"v":case"a":setTimeout(function(){b.call(u,q,100),b.call(u,X,100),v.call(u,Q,260),b.call(u,Q,100),v.call(u,K,260),b.call(u,K,100)},0);break;case"r":case"g":case"b":setTimeout(function(){_.call(u,H,"transparent"),_.call(u,z,"transparent"),b.call(u,X,100),b.call(u,q,100),v.call(u,q,r),v.call(u,$,r-260),v.call(u,X,i-780),v.call(u,W,i-520),v.call(u,Q,i),v.call(u,K,i-260),v.call(u,J,260),b.call(u,J,100)},0)}Mr(t.val("ahex"))||f.call(u,t)}function f(e,t){(Mr(t)||t!==te&&t!==ee)&&function(e,t){if(t!==ee)switch(d.color.mode){case"h":{const n=e.val("sv");ee.val("xy",{x:Mr(n)?100:n.s,y:100-(Mr(n)?100:n.v)},t);break}case"s":case"a":{const n=e.val("hv");ee.val("xy",{x:n&&n.h||0,y:100-(Mr(n)?100:n.v)},t);break}case"v":{const n=e.val("hs");ee.val("xy",{x:n&&n.h||0,y:100-(Mr(n)?100:n.s)},t);break}case"r":{const n=e.val("bg");ee.val("xy",{x:n&&n.b||0,y:255-(n&&n.g||0)},t);break}case"g":{const n=e.val("br");ee.val("xy",{x:n&&n.b||0,y:255-(n&&n.r||0)},t);break}case"b":{const n=e.val("rg");ee.val("xy",{x:n&&n.r||0,y:255-(n&&n.g||0)},t);break}}if(t!==te)switch(d.color.mode){case"h":te.val("y",360-(e.val("h")||0),t);break;case"s":{const n=e.val("s");te.val("y",100-(Mr(n)?100:n),t);break}case"v":{const n=e.val("v");te.val("y",100-(Mr(n)?100:n),t);break}case"r":te.val("y",255-(e.val("r")||0),t);break;case"g":te.val("y",255-(e.val("g")||0),t);break;case"b":te.val("y",255-(e.val("b")||0),t);break;case"a":{const n=e.val("a");te.val("y",255-(Mr(n)?255:n),t);break}}}.call(u,e,t),setTimeout(function(){(function(e){try{const t=e.val("all");re.css({backgroundColor:t&&"#"+t.hex||"transparent"}),b.call(u,re,t&&Lr(100*t.a/255,4)||0)}catch(e){}}).call(u,e),function(e){switch(d.color.mode){case"h":_.call(u,H,new r({h:e.val("h")||0,s:100,v:100}).val("hex"));break;case"s":case"a":{const t=e.val("s");b.call(u,$,100-(Mr(t)?100:t));break}case"v":{const t=e.val("v");b.call(u,q,Mr(t)?100:t);break}case"r":b.call(u,$,Lr((e.val("r")||0)/255*100,4));break;case"g":b.call(u,$,Lr((e.val("g")||0)/255*100,4));break;case"b":b.call(u,$,Lr((e.val("b")||0)/255*100))}const t=e.val("a");b.call(u,Y,Lr(100*(255-(t||0))/255,4))}.call(u,e),function(e){switch(d.color.mode){case"h":{const t=e.val("a");b.call(u,Z,Lr(100*(255-(t||0))/255,4));break}case"s":{const t=e.val("hva"),n=new r({h:t&&t.h||0,s:100,v:Mr(t)?100:t.v});_.call(u,z,n.val("hex")),b.call(u,W,100-(Mr(t)?100:t.v)),b.call(u,Z,Lr(100*(255-(t&&t.a||0))/255,4));break}case"v":{const t=e.val("hsa"),n=new r({h:t&&t.h||0,s:Mr(t)?100:t.s,v:100});_.call(u,z,n.val("hex")),b.call(u,Z,Lr(100*(255-(t&&t.a||0))/255,4));break}case"r":case"g":case"b":{const t=e.val("rgba");let n=0,r=0;"r"===d.color.mode?(n=t&&t.b||0,r=t&&t.g||0):"g"===d.color.mode?(n=t&&t.b||0,r=t&&t.r||0):"b"===d.color.mode&&(n=t&&t.r||0,r=t&&t.g||0);const i=r>n?n:r;b.call(u,W,n>r?Lr((n-r)/(255-r)*100,4):0),b.call(u,Q,r>n?Lr((r-n)/(255-n)*100,4):0),b.call(u,K,Lr(i/255*100,4)),b.call(u,Z,Lr(100*(255-(t&&t.a||0))/255,4));break}case"a":{const t=e.val("a");_.call(u,z,e.val("hex")||"000000"),b.call(u,Z,Mr(t)?100:0),b.call(u,J,Mr(t)?0:100);break}}}.call(u,e)},0)}function g(e,t){const{active:n}=V;if(t!==ee&&Mr(n.val()))return;const r=e.val("all");switch(d.color.mode){case"h":n.val("sv",{s:r.x,v:100-r.y},t);break;case"s":case"a":n.val("hv",{h:r.x,v:100-r.y},t);break;case"v":n.val("hs",{h:r.x,s:100-r.y},t);break;case"r":n.val("gb",{g:255-r.y,b:r.x},t);break;case"g":n.val("rb",{r:255-r.y,b:r.x},t);break;case"b":n.val("rg",{r:r.x,g:255-r.y},t)}}function m(e,t){const{active:n}=V;if(t===te||!Mr(n.val()))switch(d.color.mode){case"h":n.val("h",{h:360-e.val("y")},t);break;case"s":n.val("s",{s:100-e.val("y")},t);break;case"v":n.val("v",{v:100-e.val("y")},t);break;case"r":n.val("r",{r:255-e.val("y")},t);break;case"g":n.val("g",{g:255-e.val("y")},t);break;case"b":n.val("b",{b:255-e.val("y")},t);break;case"a":n.val("a",255-e.val("y"),t)}}function _(e,t){e.css({backgroundColor:t&&6===t.length&&"#"+t||"transparent"})}function y(e,t){h&&(t.includes("AlphaBar.png")||t.includes("Bars.png")||t.includes("Maps.png"))?(e.attr("pngSrc",t),e.css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale')"})):e.css({backgroundImage:"url('"+t+"')"})}function v(e,t){e.css({top:t+"px"})}function b(e,t){if(e.css({visibility:t>0?"visible":"hidden"}),t>0&&t<100)if(h){const n=e.attr("pngSrc");!Mr(n)&&(n.includes("AlphaBar.png")||n.includes("Bars.png")||n.includes("Maps.png"))?e.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+n+"', sizingMethod='scale') progid:DXImageTransform.Microsoft.Alpha(opacity="+t+")"}):e.css({opacity:Lr(t/100,4)})}else e.css({opacity:Lr(t/100,4)});else if(0===t||100===t)if(h){const t=e.attr("pngSrc");!Mr(t)&&(t.includes("AlphaBar.png")||t.includes("Bars.png")||t.includes("Maps.png"))?e.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale')"}):e.css({opacity:""})}else e.css({opacity:""})}function x(){V.active.val("ahex",V.current.val("ahex"))}function w(t){e(this).parents("tbody:first").find('input:radio[value!="'+t.target.value+'"]').removeAttr("checked"),p.call(u,t.target.value)}function S(){x.call(u)}function k(){x.call(u),d.window.expandable&&M.call(u),"function"==typeof c&&c.call(u,V.active,se)}function C(){(function(){V.current.val("ahex",V.active.val("ahex"))}).call(u),d.window.expandable&&M.call(u),"function"==typeof o&&o.call(u,V.active,ae)}function A(){L.call(u)}function E(e){const t=e.val("hex");ie.css({backgroundColor:t&&"#"+t||"transparent"}),b.call(u,ie,Lr(100*(e.val("a")||0)/255,4))}function G(e){const t=e.val("hex"),n=e.val("va");le.css({backgroundColor:t&&"#"+t||"transparent"}),b.call(u,ce,Lr(100*(255-(n&&n.a||0))/255,4)),d.window.bindToInput&&d.window.updateInputColor&&d.window.input.css({backgroundColor:t&&"#"+t||"transparent",color:Mr(n)||n.v>75?"#000000":"#ffffff"})}function P(t){R=parseInt(F.css("left")),B=parseInt(F.css("top")),D=t.pageX,U=t.pageY,e(document).bind("mousemove",I).bind("mouseup",N),t.preventDefault()}function I(t){return F.css({left:R-(D-t.pageX)+"px",top:B-(U-t.pageY)+"px"}),d.window.expandable&&!e.support.boxModel&&F.prev().css({left:F.css("left"),top:F.css("top")}),t.stopPropagation(),t.preventDefault(),!1}function N(t){return e(document).unbind("mousemove",I).unbind("mouseup",N),t.stopPropagation(),t.preventDefault(),!1}function T(t){return t.preventDefault(),t.stopPropagation(),V.active.val("ahex",e(this).attr("title")||null,t.target),!1}function L(){function t(){if(!d.window.expandable||e.support.boxModel)return;const t=F.find("table:first");F.before("<iframe/>"),F.prev().css({width:t.width(),height:F.height(),opacity:0,position:"absolute",left:F.css("left"),top:F.css("top")})}switch(V.current.val("ahex",V.active.val("ahex")),d.window.expandable&&(e(document.body).children("div.jPicker.Container").css({zIndex:10}),F.css({zIndex:20})),d.window.effects.type){case"fade":F.fadeIn(d.window.effects.speed.show,t);break;case"slide":F.slideDown(d.window.effects.speed.show,t);break;case"show":default:F.show(d.window.effects.speed.show,t)}}function M(){function t(){d.window.expandable&&F.css({zIndex:10}),d.window.expandable&&!e.support.boxModel&&F.prev().remove()}switch(d.window.effects.type){case"fade":F.fadeOut(d.window.effects.speed.hide,t);break;case"slide":F.slideUp(d.window.effects.speed.hide,t);break;case"show":default:F.hide(d.window.effects.speed.hide,t)}}const{images:O,localization:j}=d,V={active:"string"===(typeof d.color.active).toString().toLowerCase()?new r({ahex:!d.window.alphaSupport&&d.color.active?d.color.active.substring(0,6)+"ff":d.color.active}):new r({ahex:!d.window.alphaSupport&&d.color.active.val("ahex")?d.color.active.val("ahex").substring(0,6)+"ff":d.color.active.val("ahex")}),current:"string"===(typeof d.color.active).toString().toLowerCase()?new r({ahex:!d.window.alphaSupport&&d.color.active?d.color.active.substring(0,6)+"ff":d.color.active}):new r({ahex:!d.window.alphaSupport&&d.color.active.val("ahex")?d.color.active.val("ahex").substring(0,6)+"ff":d.color.active.val("ahex")}),quickList:d.color.quickList};"function"!=typeof o&&(o=null),"function"!=typeof l&&(l=null),"function"!=typeof c&&(c=null);let R=null,B=null,D=null,U=null,F=null,H=null,z=null,q=null,$=null,Y=null,X=null,W=null,Q=null,K=null,Z=null,J=null,ee=null,te=null,ne=null,re=null,ie=null,ae=null,se=null,oe=null,le=null,ce=null,ue=null,de=null;e.extend(!0,u,{commitCallback:o,liveCallback:l,cancelCallback:c,color:V,show:L,hide:M,destroy:function(){F.find("td.Radio input").unbind("click",w),ie.unbind("click",S),se.unbind("click",k),ae.unbind("click",C),d.window.expandable&&(ue.unbind("click",A),de.unbind("mousedown",P),u.icon=null),F.find(".QuickColor").unbind("click",T),H=null,z=null,q=null,$=null,Y=null,X=null,W=null,Q=null,K=null,Z=null,J=null,ee.destroy(),ee=null,te.destroy(),te=null,ne.destroy(),ne=null,re=null,ie=null,ae=null,se=null,oe=null,o=null,c=null,l=null,F.html("");for(let e=0;e<i.length;e++)i[e]===u&&i.splice(e,1)}}),i.push(u),setTimeout(function(){(function(){const i=d.window,a=i.expandable?e(u).next().find(".Container:first"):null;(F=i.expandable?e("<div/>"):e(u)).addClass("jPicker Container"),i.expandable&&F.hide(),F.get(0).onselectstart=function(e){return"input"===e.target.nodeName.toLowerCase()};const s=V.active.val("all");i.alphaPrecision<0?i.alphaPrecision=0:i.alphaPrecision>2&&(i.alphaPrecision=2);const o=`<table class="jPicker" cellpadding="0" cellspacing="0">\n          <tbody>\n            ${i.expandable?'<tr><td class="Move" colspan="5">&nbsp;</td></tr>':""}\n            <tr>\n              <td rowspan="9"><h2 class="Title">${i.title||j.text.title}</h2><div class="Map"><span class="Map1">&nbsp;</span><span class="Map2">&nbsp;</span><span class="Map3">&nbsp;</span><img src="${O.clientPath+O.colorMap.arrow.file}" class="Arrow"/></div></td>\n              <td rowspan="9"><div class="Bar"><span class="Map1">&nbsp;</span><span class="Map2">&nbsp;</span><span class="Map3">&nbsp;</span><span class="Map4">&nbsp;</span><span class="Map5">&nbsp;</span><span class="Map6">&nbsp;</span><img src="${O.clientPath+O.colorBar.arrow.file}" class="Arrow"/></div></td>\n              <td colspan="2" class="Preview">${j.text.newColor}<div><span class="Active" title="${j.tooltips.colors.newColor}">&nbsp;</span><span class="Current" title="${j.tooltips.colors.currentColor}">&nbsp;</span></div>${j.text.currentColor}</td>\n              <td rowspan="9" class="Button"><input type="button" class="Ok" value="${j.text.ok}" title="${j.tooltips.buttons.ok}"/><input type="button" class="Cancel" value="${j.text.cancel}" title="${j.tooltips.buttons.cancel}"/><hr/><div class="Grid">&nbsp;</div></td>\n            </tr>\n            <tr class="Hue">\n              <td class="Radio"><label title="${j.tooltips.hue.radio}"><input type="radio" value="h"${"h"===d.color.mode?' checked="checked"':""}/>H:</label></td>\n              <td class="Text"><input type="text" maxlength="3" value="${Mr(s)?"":s.h}" title="${j.tooltips.hue.textbox}"/>&nbsp;&deg;</td>\n            </tr>\n            <tr class="Saturation">\n              <td class="Radio"><label title="${j.tooltips.saturation.radio}"><input type="radio" value="s"${"s"===d.color.mode?' checked="checked"':""}/>S:</label></td>\n              <td class="Text"><input type="text" maxlength="3" value="${Mr(s)?"":s.s}" title="${j.tooltips.saturation.textbox}"/>&nbsp;%</td>\n            </tr>\n            <tr class="Value">\n              <td class="Radio"><label title="${j.tooltips.value.radio}"><input type="radio" value="v"${"v"===d.color.mode?' checked="checked"':""}/>V:</label><br/><br/></td>\n              <td class="Text"><input type="text" maxlength="3" value="${Mr(s)?"":s.v}" title="${j.tooltips.value.textbox}"/>&nbsp;%<br/><br/></td>\n            </tr>\n            <tr class="Red">\n              <td class="Radio"><label title="${j.tooltips.red.radio}"><input type="radio" value="r"${"r"===d.color.mode?' checked="checked"':""}/>R:</label></td>\n              <td class="Text"><input type="text" maxlength="3" value="${Mr(s)?"":s.r}" title="${j.tooltips.red.textbox}"/></td>\n            </tr>\n            <tr class="Green">\n              <td class="Radio"><label title="${j.tooltips.green.radio}"><input type="radio" value="g"${"g"===d.color.mode?' checked="checked"':""}/>G:</label></td>\n              <td class="Text"><input type="text" maxlength="3" value="${Mr(s)?"":s.g}" title="${j.tooltips.green.textbox}"/></td>\n            </tr>\n            <tr class="Blue">\n              <td class="Radio"><label title="${j.tooltips.blue.radio}"><input type="radio" value="b"${"b"===d.color.mode?' checked="checked"':""}/>B:</label></td>\n              <td class="Text"><input type="text" maxlength="3" value="${Mr(s)?"":s.b}" title="${j.tooltips.blue.textbox}"/></td>\n            </tr>\n            <tr class="Alpha">\n              <td class="Radio">${i.alphaSupport?`<label title="${j.tooltips.alpha.radio}"><input type="radio" value="a"${"a"===d.color.mode?' checked="checked"':""}/>A:</label>`:"&nbsp;"}</td>\n              <td class="Text">${i.alphaSupport?`<input type="text" maxlength="${3+i.alphaPrecision}" value="${Mr(s)?"":Lr(100*s.a/255,i.alphaPrecision)}" title="${j.tooltips.alpha.textbox}"/>&nbsp;%`:"&nbsp;"}</td>\n            </tr>\n            <tr class="Hex">\n              <td colspan="2" class="Text"><label title="${j.tooltips.hex.textbox}">#:<input type="text" maxlength="6" class="Hex" value="${Mr(s)?"":s.hex}"/></label>${i.alphaSupport?`<input type="text" maxlength="2" class="AHex" value="${Mr(s)?"":s.ahex.substring(6)}" title="${j.tooltips.hex.alpha}"/></td>`:"&nbsp;"}\n            </tr>\n          </tbody></table>`;i.expandable?(F.html(o),e(document.body).children("div.jPicker.Container").length?e(document.body).children("div.jPicker.Container:last").after(F):e(document.body).prepend(F),F.mousedown(function(){e(document.body).children("div.jPicker.Container").css({zIndex:10}),F.css({zIndex:20})}),F.css({left:"left"===i.position.x?a.offset().left-530-("center"===i.position.y?25:0)+"px":"center"===i.position.x?a.offset().left-260+"px":"right"===i.position.x?a.offset().left-10+("center"===i.position.y?25:0)+"px":"screenCenter"===i.position.x?(e(document).width()>>1)-260+"px":a.offset().left+parseInt(i.position.x)+"px",position:"absolute",top:"top"===i.position.y?a.offset().top-312+"px":"center"===i.position.y?a.offset().top-156+"px":"bottom"===i.position.y?a.offset().top+25+"px":a.offset().top+parseInt(i.position.y)+"px"})):(F=e(u)).html(o);const c=F.find("tbody:first");H=c.find("div.Map:first"),z=c.find("div.Bar:first");const h=H.find("span"),_=z.find("span");q=h.filter(".Map1:first"),$=h.filter(".Map2:first"),Y=h.filter(".Map3:first"),X=_.filter(".Map1:first"),W=_.filter(".Map2:first"),Q=_.filter(".Map3:first"),K=_.filter(".Map4:first"),Z=_.filter(".Map5:first"),J=_.filter(".Map6:first"),(ee=new t(H,{map:{width:O.colorMap.width,height:O.colorMap.height},arrow:{image:O.clientPath+O.colorMap.arrow.file,width:O.colorMap.arrow.width,height:O.colorMap.arrow.height}})).bind(g),(te=new t(z,{map:{width:O.colorBar.width,height:O.colorBar.height},arrow:{image:O.clientPath+O.colorBar.arrow.file,width:O.colorBar.arrow.width,height:O.colorBar.arrow.height}})).bind(m),ne=new n(c,V.active,i.expandable&&i.bindToInput?i.input:null,i.alphaPrecision);const v=Mr(s)?null:s.hex,x=c.find(".Preview"),I=c.find(".Button");if(re=x.find(".Active:first").css({backgroundColor:v&&"#"+v||"transparent"}),ie=x.find(".Current:first").css({backgroundColor:v&&"#"+v||"transparent"}).bind("click",S),b.call(u,ie,Lr(100*V.current.val("a")/255,4)),ae=I.find(".Ok:first").bind("click",C),se=I.find(".Cancel:first").bind("click",k),oe=I.find(".Grid:first"),setTimeout(function(){y.call(u,q,O.clientPath+"Maps.png"),y.call(u,$,O.clientPath+"Maps.png"),y.call(u,Y,O.clientPath+"map-opacity.png"),y.call(u,X,O.clientPath+"Bars.png"),y.call(u,W,O.clientPath+"Bars.png"),y.call(u,Q,O.clientPath+"Bars.png"),y.call(u,K,O.clientPath+"Bars.png"),y.call(u,Z,O.clientPath+"bar-opacity.png"),y.call(u,J,O.clientPath+"AlphaBar.png"),y.call(u,x.find("div:first"),O.clientPath+"preview-opacity.png")},0),c.find("td.Radio input").bind("click",w),V.quickList&&V.quickList.length>0){let e="";for(let t=0;t<V.quickList.length;t++){"string"===(typeof V.quickList[t]).toString().toLowerCase()&&(V.quickList[t]=new r({hex:V.quickList[t]}));const n=V.quickList[t].val("a");let a=V.quickList[t].val("ahex");!i.alphaSupport&&a&&(a=a.substring(0,6)+"ff");const s=V.quickList[t].val("hex");a||(a="00000000"),e+='<span class="QuickColor" title="#'+a+'" style="background-color:'+(s&&"#"+s||"")+";"+(s?"":"background-image:url("+O.clientPath+"NoColor.png)")+(i.alphaSupport&&n&&n<255?";opacity:"+Lr(n/255,4)+";filter:Alpha(opacity="+Lr(n/2.55,4)+")":"")+'">&nbsp;</span>'}y.call(u,oe,O.clientPath+"bar-opacity.png"),oe.html(e),oe.find(".QuickColor").click(T)}p.call(u,d.color.mode),V.active.bind(f),"function"==typeof l&&V.active.bind(l),V.current.bind(E),i.expandable?(u.icon=a.parents(".Icon:first"),le=u.icon.find(".Color:first").css({backgroundColor:v&&"#"+v||"transparent"}),ce=u.icon.find(".Alpha:first"),y.call(u,ce,O.clientPath+"bar-opacity.png"),b.call(u,ce,Lr(100*(255-(Mr(s)?0:s.a))/255,4)),ue=u.icon.find(".Image:first").css({backgroundImage:"url('"+O.clientPath+O.picker.file+"')"}).bind("click",A),i.bindToInput&&i.updateInputColor&&i.input.css({backgroundColor:v&&"#"+v||"transparent",color:Mr(s)||s.v>75?"#000000":"#ffffff"}),de=c.find(".Move:first").bind("mousedown",P),V.active.bind(G)):L.call(u)}).call(u)},0)})},e.fn.jPicker.defaults={window:{title:null,effects:{type:"slide",speed:{show:"slow",hide:"fast"}},position:{x:"screenCenter",y:"top"},expandable:!1,liveUpdate:!0,alphaSupport:!1,alphaPrecision:0,updateInputColor:!0},color:{mode:"h",active:new r({ahex:"#ffcc00ff"}),quickList:[new r({h:360,s:33,v:100}),new r({h:360,s:66,v:100}),new r({h:360,s:100,v:100}),new r({h:360,s:100,v:75}),new r({h:360,s:100,v:50}),new r({h:180,s:0,v:100}),new r({h:30,s:33,v:100}),new r({h:30,s:66,v:100}),new r({h:30,s:100,v:100}),new r({h:30,s:100,v:75}),new r({h:30,s:100,v:50}),new r({h:180,s:0,v:90}),new r({h:60,s:33,v:100}),new r({h:60,s:66,v:100}),new r({h:60,s:100,v:100}),new r({h:60,s:100,v:75}),new r({h:60,s:100,v:50}),new r({h:180,s:0,v:80}),new r({h:90,s:33,v:100}),new r({h:90,s:66,v:100}),new r({h:90,s:100,v:100}),new r({h:90,s:100,v:75}),new r({h:90,s:100,v:50}),new r({h:180,s:0,v:70}),new r({h:120,s:33,v:100}),new r({h:120,s:66,v:100}),new r({h:120,s:100,v:100}),new r({h:120,s:100,v:75}),new r({h:120,s:100,v:50}),new r({h:180,s:0,v:60}),new r({h:150,s:33,v:100}),new r({h:150,s:66,v:100}),new r({h:150,s:100,v:100}),new r({h:150,s:100,v:75}),new r({h:150,s:100,v:50}),new r({h:180,s:0,v:50}),new r({h:180,s:33,v:100}),new r({h:180,s:66,v:100}),new r({h:180,s:100,v:100}),new r({h:180,s:100,v:75}),new r({h:180,s:100,v:50}),new r({h:180,s:0,v:40}),new r({h:210,s:33,v:100}),new r({h:210,s:66,v:100}),new r({h:210,s:100,v:100}),new r({h:210,s:100,v:75}),new r({h:210,s:100,v:50}),new r({h:180,s:0,v:30}),new r({h:240,s:33,v:100}),new r({h:240,s:66,v:100}),new r({h:240,s:100,v:100}),new r({h:240,s:100,v:75}),new r({h:240,s:100,v:50}),new r({h:180,s:0,v:20}),new r({h:270,s:33,v:100}),new r({h:270,s:66,v:100}),new r({h:270,s:100,v:100}),new r({h:270,s:100,v:75}),new r({h:270,s:100,v:50}),new r({h:180,s:0,v:10}),new r({h:300,s:33,v:100}),new r({h:300,s:66,v:100}),new r({h:300,s:100,v:100}),new r({h:300,s:100,v:75}),new r({h:300,s:100,v:50}),new r({h:180,s:0,v:0}),new r({h:330,s:33,v:100}),new r({h:330,s:66,v:100}),new r({h:330,s:100,v:100}),new r({h:330,s:100,v:75}),new r({h:330,s:100,v:50}),new r]},images:{clientPath:"/jPicker/images/",colorMap:{width:256,height:256,arrow:{file:"mappoint.gif",width:15,height:15}},colorBar:{width:20,height:256,arrow:{file:"rangearrows.gif",width:20,height:7}},picker:{file:"picker.gif",width:25,height:24}},localization:{text:{title:"Drag Markers To Pick A Color",newColor:"new",currentColor:"current",ok:"OK",cancel:"Cancel"},tooltips:{colors:{newColor:"New Color - Press &ldquo;OK&rdquo; To Commit",currentColor:"Click To Revert To Original Color"},buttons:{ok:"Commit To This Color Selection",cancel:"Cancel And Revert To Original Color"},hue:{radio:"Set To &ldquo;Hue&rdquo; Color Mode",textbox:"Enter A &ldquo;Hue&rdquo; Value (0-360&deg;)"},saturation:{radio:"Set To &ldquo;Saturation&rdquo; Color Mode",textbox:"Enter A &ldquo;Saturation&rdquo; Value (0-100%)"},value:{radio:"Set To &ldquo;Value&rdquo; Color Mode",textbox:"Enter A &ldquo;Value&rdquo; Value (0-100%)"},red:{radio:"Set To &ldquo;Red&rdquo; Color Mode",textbox:"Enter A &ldquo;Red&rdquo; Value (0-255)"},green:{radio:"Set To &ldquo;Green&rdquo; Color Mode",textbox:"Enter A &ldquo;Green&rdquo; Value (0-255)"},blue:{radio:"Set To &ldquo;Blue&rdquo; Color Mode",textbox:"Enter A &ldquo;Blue&rdquo; Value (0-255)"},alpha:{radio:"Set To &ldquo;Alpha&rdquo; Color Mode",textbox:"Enter A &ldquo;Alpha&rdquo; Value (0-100)"},hex:{textbox:"Enter A &ldquo;Hex&rdquo; Color Value (#000000-#ffffff)",alpha:"Enter A &ldquo;Alpha&rdquo; Value (#00-#ff)"}}}},e}].reduce(function(e,t){return t(e)},jQuery);
/**
* The main module for the visual SVG Editor
*
* @license MIT
*
* @copyright 2010 Alexis Deveria
* 2010 Pavol Rusnak
* 2010 Jeff Schiller
* 2010 Narendra Sisodiya
* 2014 Brett Zamir
* @exports module:SVGEditor
* @borrows module:locale.putLocale as putLocale
* @borrows module:locale.readLang as readLang
* @borrows module:locale.setStrings as setStrings
*/Fr.loadingStylesheets.includes("svg-editor.css")||Fr.loadingStylesheets.push("svg-editor.css");Fr.loadingStylesheets.some(function(e){return!Array.isArray(e)||"images/logo.png"!==e[0]})&&Fr.loadingStylesheets.push(["images/logo.png",{favicon:!0}]),Ur.tool_scale=1,Ur.exportWindowCt=0,Ur.langChanged=!1,Ur.showSaveWarning=!1,Ur.storagePromptState="ignore";var Hr,zr,qr=[],$r={lang:"",iconsize:"",bkgd_color:"#FFF",bkgd_url:"",img_save:"embed",save_notice_done:!1,export_notice_done:!1},Yr=["ext-connector.js","ext-eyedropper.js","ext-grid.js","ext-imagelib.js","ext-markers.js","ext-overview_window.js","ext-panning.js","ext-polygon.js","ext-shapes.js","ext-star.js","ext-storage.js"],Xr={canvasName:"default",canvas_expansion:3,initFill:{color:"FF0000",opacity:1},initStroke:{width:5,color:"000000",opacity:1},text:{stroke_width:0,font_size:24,font_family:"serif"},initOpacity:1,colorPickerCSS:null,initTool:"select",exportWindowType:"new",wireframe:!1,showlayers:!1,no_save_warning:!1,langPath:"locale/",extPath:"extensions/",canvgPath:"canvg/",jspdfPath:"jspdf/",imgPath:"images/",jGraduatePath:"jgraduate/images/",extIconsPath:"extensions/",dimensions:[640,480],gridSnapping:!1,gridColor:"#000",baseUnit:"px",snappingStep:10,showRulers:!0,preventAllURLConfig:!1,preventURLContentLoading:!1,lockExtensions:!1,noDefaultExtensions:!1,showGrid:!1,noStorageOnLoad:!1,forceStorage:!1,emptyStorageOnDecline:!1},Wr=Ur.uiStrings={},Qr=!1,Kr=!1,Zr=!1,Jr={},ei={extensions:[],stylesheets:[],allowedOrigins:[]};function ti(e){return ni.apply(this,arguments)}function ni(){return(ni=y()(m.a.mark(function e(t){var n,r,i=arguments;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},r=n.noAlert,!(!1!==Hr.setSvgString(t))){e.next=4;break}return e.abrupt("return");case 4:if(r){e.next=8;break}return e.next=7,Fr.alert(Wr.notification.errorLoadingSVG);case 7:return e.abrupt("return");case 8:throw new Error("Error loading SVG");case 9:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function ri(e){var t=e.defaultLang,n=e.defaultName;return function(){var e=y()(m.a.mark(function e(){var r,i,a,s,o,l,c=arguments;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(e){return bn("".concat(ei.extPath,"ext-locale/").concat(a,"/").concat(e,".js"),{global:"svgEditorExtensionLocale_".concat(a,"_").concat(e.replace(/-/g,"_"))})},r=c.length>0&&void 0!==c[0]?c[0]:{},i=r.name,a=void 0===i?n:i,s=r.lang,o=void 0===s?t:s,e.prev=2,e.next=5,l(o);case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",l("en"));case 11:case"end":return e.stop()}},e,this,[[2,8]])}));return function(){return e.apply(this,arguments)}}()}Fr.pref=function(e,t){return t?(Jr[e]=t,void(Ur.curPrefs=Jr)):e in Jr?Jr[e]:$r[e]},Ur.putLocale=async function(e,t,n){e?jr=e:((jr=Or.pref("lang"))||(navigator.userLanguage?jr=navigator.userLanguage:navigator.language&&(jr=navigator.language)),console.log("Lang: "+jr),t.includes(jr)||"test"===jr||(jr="en"));const r=n.langPath+"lang."+jr+".js";return Br(await bn(r,{global:"svgEditorLang_"+jr.replace(/-/g,"_")}))},Ur.readLang=Br,Ur.setStrings=Vr,Ur.loadContentAndPrefs=function(){if(ei.forceStorage||!ei.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)svgeditstore=(?:prefsAndContent|prefsOnly)/)){if(Ur.storage&&(ei.forceStorage||!ei.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)svgeditstore=prefsAndContent/))){var e="svgedit-"+ei.canvasName,t=Ur.storage.getItem(e);t&&Ur.loadFromString(t)}Object.keys($r).forEach(function(e){var t,n="svg-edit-"+e;if(Ur.storage){var r=Ur.storage.getItem(n);r&&($r[e]=String(r))}else if(window.widget)$r[e]=window.widget.preferenceForKey(n);else{var i=document.cookie.match(new RegExp("(?:^|;\\s*)"+(t=encodeURIComponent(n),String(t).replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g"),"\\$&"))+"=([^;]+)"));$r[e]=i?decodeURIComponent(i[1]):""}})}},Ur.setConfig=function(e,t){function n(e,t,n){e[t]&&"object"===f()(e[t])?Fr.extend(!0,e[t],n):e[t]=n}t=t||{},Fr.each(e,function(r,i){if({}.hasOwnProperty.call(e,r))if({}.hasOwnProperty.call($r,r)){if(!1===t.overwrite&&(ei.preventAllURLConfig||{}.hasOwnProperty.call(Jr,r)))return;!0===t.allowInitialUserOverride?$r[r]=i:Fr.pref(r,i)}else if(["extensions","stylesheets","allowedOrigins"].includes(r)){if(!1===t.overwrite&&(ei.preventAllURLConfig||["allowedOrigins","stylesheets"].includes(r)||"extensions"===r&&ei.lockExtensions))return;ei[r]=ei[r].concat(i)}else if({}.hasOwnProperty.call(Xr,r)){if(!1===t.overwrite&&(ei.preventAllURLConfig||{}.hasOwnProperty.call(ei,r)))return;if({}.hasOwnProperty.call(ei,r)){if(!1===t.overwrite)return;n(ei,r,i)}else!0===t.allowInitialUserOverride?n(Xr,r,i):Xr[r]&&"object"===f()(Xr[r])?(ei[r]={},Fr.extend(!0,ei[r],i)):ei[r]=i}}),Ur.curConfig=ei},Ur.setCustomHandlers=function(e){Ur.ready(function(){e.open&&(Fr('#tool_open > input[type="file"]').remove(),Fr("#tool_open").show(),Hr.open=e.open),e.save&&(Ur.showSaveWarning=!1,Hr.bind("saved",e.save)),e.exportImage&&(Kr=e.exportImage,Hr.bind("exported",Kr)),e.exportPDF&&(Zr=e.exportPDF,Hr.bind("exportedPDF",Zr))})},Ur.randomizeIds=function(e){return Hr.randomizeIds(e)},Ur.init=function(){!("svgEditor"in window&&window.svgEditor&&!1===window.svgEditor.modules)||Object.assign(Xr,{langPath:"../dist/locale/",extPath:"../dist/extensions/",canvgPath:"../dist/",jspdfPath:"../dist/"});try{"localStorage"in window&&(Ur.storage=localStorage)}catch(e){}var e=[];function t(){(ei=Fr.extend(!0,{},Xr,ei)).noDefaultExtensions||(ei.extensions=ei.extensions.concat(Yr)),["extensions","stylesheets","allowedOrigins"].forEach(function(e){ei[e]=Fr.grep(ei[e],function(t,n){return n===ei[e].indexOf(t)})}),Ur.curConfig=ei}Fr("#lang_select option").each(function(){e.push(this.value)}),function(){var e,n;if(zr=Fr.deparam.querystring(!0),Fr.isEmptyObject(zr))t(),Ur.loadContentAndPrefs();else{if(zr.dimensions&&(zr.dimensions=zr.dimensions.split(",")),zr.bkgd_color&&(zr.bkgd_color="#"+zr.bkgd_color),zr.extensions&&(zr.extensions=zr.extensions.match(/[:\/\\]/)?"":zr.extensions.split(",")),["langPath","extPath","canvgPath","jspdfPath","imgPath","jGraduatePath","extIconsPath"].forEach(function(e){zr[e]&&delete zr[e]}),Ur.setConfig(zr,{overwrite:!1}),t(),!ei.preventURLContentLoading){if(e=zr.source,n=Fr.param.querystring(),e||n.includes("source=data:")&&(e=n.match(/source=(data:[^&]*)/)[1]),e)return void(e.startsWith("data:")?Ur.loadFromDataURI(e):Ur.loadFromString(e));if(zr.url)return void Ur.loadFromURL(zr.url)}zr.noStorageOnLoad&&!ei.forceStorage||Ur.loadContentAndPrefs()}Jr=Fr.extend(!0,{},$r,Jr),Ur.curPrefs=Jr}();var n=Ur.setIcon=function(e,t,n){var r="string"==typeof t?Fr.getSvgIcon(t,!0):t.clone();r?Fr(e).empty().append(r):console.log("NOTE: Icon image missing: "+t)},r=function(){var t=y()(m.a.mark(function t(){var n,r,i,a,s,o;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ur.putLocale(null,e,ei);case 2:return n=t.sent,r=n.langParam,i=n.langData,t.next=7,An(r,i);case 7:return a=Wr.common,s=a.ok,o=a.cancel,kn(Fr,{ok:s,cancel:o}),t.prev=9,t.next=12,Promise.all(ei.extensions.map(function(){var e=y()(m.a.mark(function e(t){var n,i,a,s,o,l,c;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.match(/^ext-(.+)\.js/)){e.next=3;break}return e.abrupt("return",void 0);case 3:return i=ei.extPath+t,e.prev=4,e.next=7,bn(i,{global:"svgEditorExtension_"+n[1].replace(/-/g,"_")});case 7:return a=e.sent,s=a.name,o=void 0===s?n[1]:s,l=a.init,c=ri({defaultLang:r,defaultName:o}),e.abrupt("return",Ur.addExtension(o,l&&l.bind(Ur),{$:Fr,importLocale:c}));case 13:return e.prev=13,e.t0=e.catch(4),console.log(e.t0),console.error("Extension failed to load: "+t+"; "+e.t0),e.abrupt("return",void 0);case 18:case"end":return e.stop()}},e,this,[[4,13]])}));return function(t){return e.apply(this,arguments)}}()));case 12:Hr.bind("extensions_added",function(e,t){ii=!0,mn.setAll(),Fr(".flyout_arrow_horiz:empty").each(function(){Fr(this).append(Fr.getSvgIcon("arrow_right",!0).width(5).height(5))}),"ignore"===Ur.storagePromptState&&ee(!0),ai.forEach(function(e){Hr.call("message",e)})}),Hr.call("extensions_added"),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(9),console.log(t.t0);case 19:case"end":return t.stop()}},t,this,[[9,16]])}));return function(){return t.apply(this,arguments)}}(),i={tool_scale:Ur.tool_scale},a=function(){Fr(".tools_flyout").each(function(){var e=Fr("#"+this.id+"_show"),t=e.offset(),n=t.left,r=t.top,i=e.outerWidth();Fr(this).css({left:(n+i)*Ur.tool_scale,top:r})})},o=function(){var e=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,t=document.getElementsByTagName("script")[0];for(var n in t.style)if(e.test(n))return n.match(e)[0];return"WebkitOpacity"in t.style?"Webkit":"KhtmlOpacity"in t.style?"Khtml":""}(),c=Ur.setIconSize=function(e){var t="#tools_top .toolset, #editor_panel > *, #history_panel > *,        #main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,        #g_panel > *, #tool_font_size > *, .tools_flyout",n=Fr(t),r=1;if("number"==typeof e)r=e;else{r={s:.75,m:1,l:1.25,xl:1.5}[e]}i.tool_scale=Ur.tool_scale=r,a();var s=n.parents(":hidden");s.css("visibility","hidden").show(),function(e,t){var n=["top","left","bottom","right"];e.each(function(){for(var e=Fr(this),r=e.outerWidth()*(t-1),i=e.outerHeight()*(t-1),a=0;a<4;a++){var s=n[a],o=e.data("orig_margin-"+s);gn(o)&&(o=parseInt(e.css("margin-"+s)),e.data("orig_margin-"+s,o));var l=o*t;"right"===s?l+=r:"bottom"===s&&(l+=i),e.css("margin-"+s,l)}})}(n,r),s.css("visibility","visible").hide(),Fr.pref("iconsize",e),Fr("#iconsize").val(e);var l={"#tools_top":{left:50+Fr("#main_button").width(),height:72},"#tools_left":{width:31,top:74},"div#workarea":{left:38,top:74}},c=Fr("#tool_size_rules");if(c.length?c.empty():c=Fr('<style id="tool_size_rules"></style>').appendTo("head"),"m"!==e){var u="";Fr.each(l,function(t,n){t="#svg_editor "+t.replace(/,/g,", #svg_editor"),u+=t+"{",Fr.each(n,function(t,n){var i;"number"==typeof n?i=n*r+"px":(n[e]||n.all)&&(i=n[e]||n.all),u+=t+":"+i+";"}),u+="}"});var d="-"+o.toLowerCase()+"-";u+=t+"{"+d+"transform: scale("+r+");} #svg_editor div.toolset .toolset {"+d+"transform: scale(1); margin: 1px !important;} #svg_editor .ui-slider {"+d+"transform: scale("+1/r+");}",c.text(u)}a()};Fr.svgIcons(ei.imgPath+"svg_edit_icons.svg",{w:24,h:24,id_match:!1,no_img:!U(),fallback_path:ei.imgPath,fallback:{logo:"logo.png",select:"select.png",select_node:"select_node.png",square:"square.png",rect:"rect.png",fh_rect:"freehand-square.png",circle:"circle.png",ellipse:"ellipse.png",fh_ellipse:"freehand-circle.png",pencil:"fhpath.png",pen:"line.png",text:"text.png",path:"path.png",add_subpath:"add_subpath.png",close_path:"closepath.png",open_path:"openpath.png",image:"image.png",zoom:"zoom.png",arrow_right:"flyouth.png",arrow_right_big:"arrow_right_big.png",arrow_down:"dropdown.gif",fill:"fill.png",stroke:"stroke.png",opacity:"opacity.png",new_image:"clear.png",save:"save.png",export:"export.png",open:"open.png",import:"import.png",docprops:"document-properties.png",source:"source.png",wireframe:"wireframe.png",undo:"undo.png",redo:"redo.png",clone:"clone.png",delete:"delete.png",go_up:"go-up.png",go_down:"go-down.png",context_menu:"context_menu.png",move_bottom:"move_bottom.png",move_top:"move_top.png",to_path:"to_path.png",link_controls:"link_controls.png",reorient:"reorient.png",group_elements:"shape_group_elements.png",ungroup:"shape_ungroup.png",unlink_use:"unlink_use.png",width:"width.png",height:"height.png",c_radius:"c_radius.png",angle:"angle.png",blur:"blur.png",fontsize:"fontsize.png",align:"align.png",align_left:"align-left.png",align_center:"align-center.png",align_right:"align-right.png",align_top:"align-top.png",align_middle:"align-middle.png",align_bottom:"align-bottom.png",linecap_butt:"linecap_butt.png",linecap_square:"linecap_square.png",linecap_round:"linecap_round.png",linejoin_miter:"linejoin_miter.png",linejoin_bevel:"linejoin_bevel.png",linejoin_round:"linejoin_round.png",eye:"eye.png",no_color:"no_color.png",ok:"save.png",cancel:"cancel.png",warning:"warning.png",node_delete:"node_delete.png",node_clone:"node_clone.png",globe_link:"globe_link.png"},placement:{"#logo":"logo","#tool_clear div,#layer_new":"new_image","#tool_save div":"save","#tool_export div":"export","#tool_open div div":"open","#tool_import div div":"import","#tool_source":"source","#tool_docprops > div":"docprops","#tool_wireframe":"wireframe","#tool_undo":"undo","#tool_redo":"redo","#tool_select":"select","#tool_fhpath":"pencil","#tool_line":"pen","#tool_rect,#tools_rect_show":"rect","#tool_square":"square","#tool_fhrect":"fh_rect","#tool_ellipse,#tools_ellipse_show":"ellipse","#tool_circle":"circle","#tool_fhellipse":"fh_ellipse","#tool_path":"path","#tool_text,#layer_rename":"text","#tool_image":"image","#tool_zoom":"zoom","#tool_clone,#tool_clone_multi":"clone","#tool_node_clone":"node_clone","#layer_delete,#tool_delete,#tool_delete_multi":"delete","#tool_node_delete":"node_delete","#tool_add_subpath":"add_subpath","#tool_openclose_path":"open_path","#tool_move_top":"move_top","#tool_move_bottom":"move_bottom","#tool_topath":"to_path","#tool_node_link":"link_controls","#tool_reorient":"reorient","#tool_group_elements":"group_elements","#tool_ungroup":"ungroup","#tool_unlink_use":"unlink_use","#tool_alignleft, #tool_posleft":"align_left","#tool_aligncenter, #tool_poscenter":"align_center","#tool_alignright, #tool_posright":"align_right","#tool_aligntop, #tool_postop":"align_top","#tool_alignmiddle, #tool_posmiddle":"align_middle","#tool_alignbottom, #tool_posbottom":"align_bottom","#cur_position":"align","#linecap_butt,#cur_linecap":"linecap_butt","#linecap_round":"linecap_round","#linecap_square":"linecap_square","#linejoin_miter,#cur_linejoin":"linejoin_miter","#linejoin_round":"linejoin_round","#linejoin_bevel":"linejoin_bevel","#url_notice":"warning","#layer_up":"go_up","#layer_down":"go_down","#layer_moreopts":"context_menu","#layerlist td.layervis":"eye","#tool_source_save,#tool_docprops_save,#tool_prefs_save":"ok","#tool_source_cancel,#tool_docprops_cancel,#tool_prefs_cancel":"cancel","#rwidthLabel, #iwidthLabel":"width","#rheightLabel, #iheightLabel":"height","#cornerRadiusLabel span":"c_radius","#angleLabel":"angle","#linkLabel,#tool_make_link,#tool_make_link_multi":"globe_link","#zoomLabel":"zoom","#tool_fill label":"fill","#tool_stroke .icon_label":"stroke","#group_opacityLabel":"opacity","#blurLabel":"blur","#font_sizeLabel":"fontsize",".flyout_arrow_horiz":"arrow_right",".dropdown button, #main_button .dropdown":"arrow_down","#palette .palette_item:first, #fill_bg, #stroke_bg":"no_color"},resize:{"#logo .svg_icon":28,".flyout_arrow_horiz .svg_icon":5,".layer_button .svg_icon, #layerlist td.layervis .svg_icon":14,".dropdown button .svg_icon":7,"#main_button .dropdown .svg_icon":9,".palette_item:first .svg_icon":15,"#fill_bg .svg_icon, #stroke_bg .svg_icon":16,".toolbar_button button .svg_icon":16,".stroke_tool div div .svg_icon":20,"#tools_bottom label .svg_icon":18},callback:function(){var e=y()(m.a.mark(function e(t){var n,r,i,a,s,o,l;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){switch(e){case"jgraduate/css/jPicker.css":return 1;case"jgraduate/css/jGraduate.css":return 2;case"svg-editor.css":return 3;case"spinbtn/jQuery.SpinButton.css":return 4;default:return 1/0}},Fr(".toolbar_button button > svg, .toolbar_button button > img").each(function(){Fr(this).parent().prepend(this)}),(n=Fr("#tools_left")).length&&(r=n.offset().top+n.outerHeight()),i=Fr.pref("iconsize"),Ur.setIconSize(i||(Fr(window).height()<r?"s":"m")),Fr(".tools_flyout").each(function(){var e=Fr("#"+this.id+"_show"),t=e.attr("data-curopt");if(!e.children("svg, img").length){var n=Fr(t).children().clone();n.length&&(n[0].removeAttribute("style"),e.append(n))}}),s=Fr.loadingStylesheets.sort(function(e,t){var n=a(e),r=a(t);return n===r?0:n>r}),ei.stylesheets.length&&(s=h()(new Set(ei.stylesheets)),(o=s.indexOf("@default"))>-1&&(l=s).splice.apply(l,[o,1].concat(h()(Fr.loadingStylesheets)))),s=s.map(function(e){return"themes/basic/svg-editor/"+e}),e.next=12,Dr(s,{acceptErrors:function(e){var t=e.stylesheetURL,n=e.reject,r=e.resolve;Fr.loadingStylesheets.includes(t)?n(new Error("Missing expected stylesheet: ".concat(t))):r()}});case 12:return Fr("#svg_container")[0].style.visibility="visible",e.next=15,Ur.runCallbacks();case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}),Ur.canvas=Hr=new Nr(document.getElementById("svgcanvas"),ei);var d,p,f=q()?"meta+":"ctrl+",g=Hr.pathActions,_=Hr.undoMgr,b=Fr("#workarea"),x=Fr("#cmenu_canvas"),w={fill:null,stroke:null},S=null,k=ei.imgPath+"logo.png",C="crosshair",A="crosshair",E="toolbars";!function(){var e=window.opener||window.parent;if(e)try{var t=new e.CustomEvent("svgEditorReady",{bubbles:!0,cancelable:!0});e.document.documentElement.dispatchEvent(t)}catch(e){}}();for(var G=function(){var e=Fr(".tool_button_current");e.length&&"tool_select"!==e[0].id&&(e.removeClass("tool_button_current").addClass("tool_button"),Fr("#tool_select").addClass("tool_button_current").removeClass("tool_button"),Fr("#styleoverrides").text("\n        #svgcanvas svg * {\n          cursor: move;\n          pointer-events: all;\n        }\n        #svgcanvas svg {\n          cursor: default;\n        }\n      ")),Hr.setMode("select"),b.css("cursor","auto")},P=Fr("title:first").text(),I=[],N=.1;N<1e5;N*=10)I.push(N),I.push(2*N),I.push(5*N);var T=function(e){var t,n=[],r=Hr.getCurrentDrawing().getNumLayers();for(t=0;t<r;t++)n[t]=Hr.getCurrentDrawing().getLayerName(t);e?n.forEach(function(t){t!==e&&Hr.getCurrentDrawing().setLayerOpacity(t,.5)}):n.forEach(function(e){Hr.getCurrentDrawing().setLayerOpacity(e,1)})},L=function(){Hr.clearSelection();for(var e=Fr("#layerlist tbody").empty(),t=Fr("#selLayerNames").empty(),n=Hr.getCurrentDrawing(),r=n.getCurrentLayerName(),i=Fr.getSvgIcon("eye"),a=Hr.getCurrentDrawing().getNumLayers();a--;){var s=n.getLayerName(a),o=Fr('<tr class="layer">').toggleClass("layersel",s===r),l=Fr('<td class="layervis">').toggleClass("layerinvis",!n.getLayerVisibility(s)),c=Fr('<td class="layername">'+s+"</td>");e.append(o.append(l,c)),t.append('<option value="'+s+'">'+s+"</option>")}if(void 0!==i){var u=i.clone();Fr("td.layervis",e).append(u),Fr.resizeSvgIcons({"td.layervis .svg_icon":14})}Fr("#layerlist td.layername").mouseup(function(e){Fr("#layerlist tr.layer").removeClass("layersel"),Fr(this.parentNode).addClass("layersel"),Hr.setCurrentLayer(this.textContent),e.preventDefault()}).mouseover(function(){T(this.textContent)}).mouseout(function(){T()}),Fr("#layerlist td.layervis").click(function(){var e=Fr(this.parentNode).prevAll().length,t=Fr("#layerlist tr.layer:eq("+e+") td.layername").text(),n=Fr(this).hasClass("layerinvis");Hr.setLayerVisibility(t,n),Fr(this).toggleClass("layerinvis")});for(var d=5-Fr("#layerlist tr.layer").size();d-- >0;)e.append('<tr><td style="color:white">_</td><td/></tr>')},M=!1,O="",j=function(e,t){M||(M=!0,O=Hr.getSvgString(),Fr("#save_output_btns").toggle(Boolean(t)),Fr("#tool_source_back").toggle(!t),Fr("#svg_source_textarea").val(O),Fr("#svg_source_editor").fadeIn(),Fr("#svg_source_textarea").focus())},V=null,R=!1,B=function(){window.opera&&Fr("<p/>").hide().appendTo("body").remove()};function D(e,t){var r=e.id,i=r.split("_"),a=u()(i,2),s=a[0],o=a[1];t&&Hr.setStrokeAttr("stroke-"+s,o),B(),n("#cur_"+s,r,20),Fr(e).addClass("current").siblings().removeClass("current")}var $=Ur.toolButtonClick=function(e,t){if(Fr(e).hasClass("disabled"))return!1;if(Fr(e).parent().hasClass("tools_flyout"))return!0;return t||Fr(".tools_flyout").fadeOut("normal"),Fr("#styleoverrides").text(""),b.css("cursor","auto"),Fr(".tool_button_current").removeClass("tool_button_current").addClass("tool_button"),Fr(e).addClass("tool_button_current").removeClass("tool_button"),!0},X=Ur.clickSelect=function(){$("#tool_select")&&(Hr.setMode("select"),Fr("#styleoverrides").text("\n        #svgcanvas svg * {\n          cursor: move;\n          pointer-events: all;\n        }\n        #svgcanvas svg {\n          cursor: default;\n        }\n      "))},W=Ur.setImageURL=function(e){e||(e=k),Hr.setImageURL(e),Fr("#image_url").val(e),e.startsWith("data:")?(Fr("#image_url").hide(),Fr("#change_image_url").show()):(Hr.embedImage(e,function(t){Fr("#url_notice").toggle(!t),k=e}),Fr("#image_url").show(),Fr("#change_image_url").hide())};function Q(e,t){Fr.pref("bkgd_color",e),Fr.pref("bkgd_url",t),Hr.setBackground(e,t)}function K(){return Z.apply(this,arguments)}function Z(){return(Z=y()(m.a.mark(function e(){var t,n,r,i,a,s=arguments;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=t.cancelDeletes,r=void 0!==n&&n,i=(i=Hr.getHref(V)).startsWith("data:")?"":i,e.next=5,Fr.prompt(Wr.notification.enterNewImgURL,i);case 5:(a=e.sent)?W(a):r&&Hr.deleteSelectedElements();case 7:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function J(e,t){var n,r;t||(t=Hr.getZoom()),e||(e=Fr("#svgcanvas"));var i=Hr.getContentElem(),a=de()[ei.baseUnit];for(n=0;n<2;n++){var s=0===n,o=s?"x":"y",l=s?"width":"height",c=Number(i.getAttribute(o)),u=Fr("#ruler_"+o+" canvas:first"),d=u.clone();u.replaceWith(d);var h=d[0],p=e[l](),f=p;h.parentNode.style[l]=f+"px";var g=h.getContext("2d"),m=void 0,_=void 0,y=void 0;if(g.fillStyle="rgb(200,0,0)",g.fillRect(0,0,h.width,h.height),d.siblings().remove(),p>=3e4){y=parseInt(p/3e4)+1,(m=[])[0]=g;var v=void 0;for(r=1;r<y;r++)h[l]=3e4,v=h.cloneNode(!0),h.parentNode.append(v),m[r]=v.getContext("2d");v[l]=p%3e4,p=3e4}h[l]=p;var b=a*t,x=50/b,w=1;for(r=0;r<I.length&&(w=_=I[r],!(x<=_));r++);var S=w*b;g.font="9px sans-serif";for(var k=c/b%w*b,C=k-S,A=0;k<f;){C+=S;var E=Math.round(k)+.5;s?(g.moveTo(E,15),g.lineTo(E,0)):(g.moveTo(15,E),g.lineTo(0,E)),_=(C-c)/b;var G=void 0;if(w>=1)G=Math.round(_);else{var P=String(w).split(".")[1].length;G=_.toFixed(P)}if(0!==G&&1e3!==G&&G%1e3==0&&(G=G/1e3+"K"),s)g.fillText(G,k+2,8);else{var N=String(G).split("");for(r=0;r<N.length;r++)g.fillText(N[r],1,k+9+9*r)}var T=S/10;for(r=1;r<10;r++){var L=Math.round(k+T*r)+.5;if(m&&L>p){if(A++,g.stroke(),A>=y){r=10,k=f;continue}g=m[A],k-=3e4,L=Math.round(k+T*r)+.5}var M=r%2?12:10;s?(g.moveTo(L,15),g.lineTo(L,M)):(g.moveTo(15,L),g.lineTo(M,L))}k+=S}g.strokeStyle="#000",g.stroke()}}var ee=Ur.updateCanvas=function(e,t){var n=Hr.getZoom(),r=b,i=Fr("#svgcanvas"),a=b.width(),s=b.height(),o=a,l=s,c=r[0].scrollLeft+o/2,u=r[0].scrollTop+l/2,d=ei.canvas_expansion;a=Math.max(o,Hr.contentW*n*d),s=Math.max(l,Hr.contentH*n*d),a===o&&s===l?b.css("overflow","hidden"):b.css("overflow","scroll");var h=i.height()/2,p=i.width()/2;i.width(a).height(s);var f=s/2,g=a/2,m=Hr.updateCanvas(a,s),_=g/p,y=a/2-o/2,v=s/2-l/2;t?(t.x+=m.x,t.y+=m.y):t={x:g+(c-p)*_,y:f+(u-h)*_};e?Hr.contentW>r.width()?(b[0].scrollLeft=m.x-10,b[0].scrollTop=m.y-10):(r[0].scrollLeft=y,r[0].scrollTop=v):(r[0].scrollLeft=t.x-o/2,r[0].scrollTop=t.y-l/2),ei.showRulers&&(J(i,n),b.scroll()),!0!==zr.storagePrompt&&"ignore"===Ur.storagePromptState&&Fr("#dialog_box").hide()},te=function(){var e="none"===Hr.getColor("fill"),t="none"===Hr.getColor("stroke"),n=["#tool_fhpath","#tool_line"],r=["#tools_rect .tool_button","#tools_ellipse .tool_button","#tool_text","#tool_path"];t?n.forEach(function(e){Fr(e).hasClass("tool_button_current")&&X(),Fr(e).addClass("disabled")}):n.forEach(function(e){Fr(e).removeClass("disabled")}),t&&e?r.forEach(function(e){Fr(e).hasClass("tool_button_current")&&X(),Fr(e).addClass("disabled")}):r.forEach(function(e){Fr(e).removeClass("disabled")}),Hr.runExtensions("toolButtonStateUpdate",{nofill:e,nostroke:t}),Fr(".tools_flyout").each(function(){var e=Fr("#"+this.id+"_show"),t=!1;Fr(this).children().each(function(){Fr(this).hasClass("disabled")||(t=!0)}),e.toggleClass("disabled",!t)}),B()},ne=function(){var e=V;gn(e)||e.parentNode||(e=null);var t=Hr.getCurrentDrawing().getCurrentLayerName(),r=Hr.getMode(),i="px"!==ei.baseUnit?ei.baseUnit:null,a="pathedit"===r,s=Fr("#cmenu_canvas li");if(Fr("#selected_panel, #multiselected_panel, #g_panel, #rect_panel, #circle_panel,#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel, #use_panel, #a_panel").hide(),gn(e))R?(Fr("#multiselected_panel").show(),s.enableContextMenuItems("#group").disableContextMenuItems("#ungroup")):s.disableContextMenuItems("#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back");else{var o=e.nodeName,l=Hr.getRotationAngle(e);Fr("#angle").val(l);var c=Hr.getBlur(e);if(Fr("#blur").val(c),Fr("#blur_slider").slider("option","value",c),Hr.addedNew&&"image"===o&&"image"===Hr.getMode()&&(Hr.getHref(e).startsWith("data:")||K({cancelDeletes:!0})),a||"pathedit"===r){var u=g.getNodePoint();if(Fr("#tool_add_subpath").removeClass("push_button_pressed").addClass("tool_button"),Fr("#tool_node_delete").toggleClass("disabled",!g.canDeleteNodes),n("#tool_openclose_path",g.closed_subpath?"open_path":"close_path"),u){var d=Fr("#seg_type");i&&(u.x=pe(u.x),u.y=pe(u.y)),Fr("#path_node_x").val(u.x),Fr("#path_node_y").val(u.y),u.type?d.val(u.type).removeAttr("disabled"):d.val(4).attr("disabled","disabled")}return}if(Fr("#selected_panel").show(),["line","circle","ellipse"].includes(o))Fr("#xy_panel").hide();else{var h,p;if(["g","polyline","path"].includes(o)){var f=Hr.getStrokedBBox([e]);f&&(h=f.x,p=f.y)}else h=e.getAttribute("x"),p=e.getAttribute("y");i&&(h=pe(h),p=pe(p)),Fr("#selected_x").val(h||0),Fr("#selected_y").val(p||0),Fr("#xy_panel").show()}var m=!["image","text","path","g","use"].includes(o);Fr("#tool_topath").toggle(m),Fr("#tool_reorient").toggle("path"===o),Fr("#tool_reorient").toggleClass("disabled",0===l);var y={g:[],a:[],rect:["rx","width","height"],image:["width","height"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],line:["x1","y1","x2","y2"],text:[],use:[]},v=e.tagName,b=null;if("a"===v&&(b=Hr.getHref(e),Fr("#g_panel").show()),"a"===e.parentNode.tagName&&(Fr(e).siblings().length||(Fr("#a_panel").show(),b=Hr.getHref(e.parentNode))),Fr("#tool_make_link, #tool_make_link").toggle(!b),b&&Fr("#link_url").val(b),y[v]){var w=y[v];if(Fr("#"+v+"_panel").show(),Fr.each(w,function(t,n){var r=e.getAttribute(n);if("px"!==ei.baseUnit&&e[n]){var i=e[n].baseVal.value;r=pe(i)}Fr("#"+v+"_"+n).val(r||0)}),"text"===v)Fr("#text_panel").css("display","inline"),Fr("#tool_font_size").css("display","inline"),Hr.getItalic()?Fr("#tool_italic").addClass("push_button_pressed").removeClass("tool_button"):Fr("#tool_italic").removeClass("push_button_pressed").addClass("tool_button"),Hr.getBold()?Fr("#tool_bold").addClass("push_button_pressed").removeClass("tool_button"):Fr("#tool_bold").removeClass("push_button_pressed").addClass("tool_button"),Fr("#font_family").val(e.getAttribute("font-family")),Fr("#font_size").val(e.getAttribute("font-size")),Fr("#text").val(e.textContent),Hr.addedNew&&setTimeout(function(){Fr("#text").focus().select()},100);else if("image"===v&&"image"===Hr.getMode())W(Hr.getHref(e));else if("g"===v||"use"===v){Fr("#container_panel").show();var S=Hr.getTitle(),k=Fr("#g_title")[0];k.value=S,function(e){var t=Math.min(Math.max(12+6*e.value.length,50),300);Fr(e).width(t)}(k),Fr("#g_title").prop("disabled","use"===v)}}s[("g"===v?"en":"dis")+"ableContextMenuItems"]("#ungroup"),s[("g"!==v&&R?"en":"dis")+"ableContextMenuItems"]("#group")}Fr("#tool_undo").toggleClass("disabled",0===_.getUndoStackSize()),Fr("#tool_redo").toggleClass("disabled",0===_.getRedoStackSize()),Hr.addedNew=!1,e&&!a||R?(Fr("#selLayerNames").removeAttr("disabled").val(t),x.enableContextMenuItems("#delete,#cut,#copy,#move_front,#move_up,#move_down,#move_back")):Fr("#selLayerNames").attr("disabled","disabled")},re=function(){if(!Zt){var e="\n      #workarea.wireframe #svgcontent * {\n        stroke-width: ".concat(1/Hr.getZoom(),"px;\n      }\n    ");Fr("#wireframe_rules").text(b.hasClass("wireframe")?e:"")}},ie="",ae=function(e){e=e||Hr.getDocumentTitle();var t=P+(e?": "+e:"");Fr("title:first").text(t)};function se(e){return e&&"g"===e.tagName&&En.CLASS_REGEX.test(e.getAttribute("class"))}var oe=function(){re()},le=Hr.zoomChanged=function(e,t,n){var r=b,i=Hr.setBBoxZoom(t,r.width()-15,r.height()-15);if(i){var a=i.zoom,s=i.bbox;a<.001?ce({value:.1}):(Fr("#zoom").val((100*a).toFixed(1)),n?ee():ee(!1,{x:s.x*a+s.width*a/2,y:s.y*a+s.height*a/2}),"zoom"===Hr.getMode()&&s.width&&G(),oe())}},ce=function(e){var t=e.value/100;if(t<.001)e.value=.1;else{var n=Hr.getZoom(),r=b;le(window,{width:0,height:0,x:(r[0].scrollLeft+r.width()/2)/n,y:(r[0].scrollTop+r.height()/2)/n,zoom:t},!0)}};Fr("#cur_context_panel").delegate("a","click",function(){var e=Fr(this);return e.attr("data-root")?Hr.leaveContext():Hr.setContext(e.text()),Hr.clearSelection(),!1});var ue=function(){w.fill.prep(),w.stroke.prep()},he={},fe=function(){Fr(".tools_flyout").each(function(){var e=Fr("#"+this.id+"_show");if(!e.data("isLibrary")){var t=Fr(this).children().map(function(){return this.title}).get();e[0].title=t.join(" / ")}})},ge={},_e=function(e){Fr.each(e,function(t,n){var r;ge[t]||(ge[t]=[]),(r=ge[t]).push.apply(r,h()(n));var i,a=Fr(t).children().not(".tool_button_evt_handled"),s=t+"_show",o=Fr(s),l=!1;a.addClass("tool_button tool_button_evt_handled").unbind("click mousedown mouseup").each(function(){var t="#"+this.getAttribute("id"),r=Object.entries(n).find(function(e){var n=u()(e,2);n[0];return n[1].sel===t}),i=u()(r,2),a=i[0],c=i[1];he[c.sel]=c.fn,c.isDefault&&(l=a);var d=function(t){var n,r=c;if("keydown"===t.type){var i=Fr(r.parent+"_show").hasClass("tool_button_current"),a=Fr(r.parent+"_show").attr("data-curopt");Object.entries(e[c.parent]).some(function(n){var s=u()(n,2),o=s[0],l=s[1];return l.sel===a&&(t.shiftKey&&i?(o=parseInt(o),r=ge[c.parent][o+1]||e[c.parent][0]):r=l,!0)})}return!Fr(this).hasClass("disabled")&&($(s)&&r.fn(),(n=r.icon?Fr.getSvgIcon(r.icon,!0):Fr(r.sel).children().eq(0).clone())[0].setAttribute("width",o.width()),n[0].setAttribute("height",o.height()),o.children(":not(.flyout_arrow_horiz)").remove(),o.append(n).attr("data-curopt",r.sel),!0)};return Fr(this).mouseup(d),c.key&&Fr(document).bind("keydown",c.key[0]+" shift+"+c.key[0],d),!0}),l?o.attr("data-curopt",n[l].sel):o.attr("data-curopt")||o.attr("data-curopt",n[0].sel);var c=Fr(s).position();o.mousedown(function(e){if(o.hasClass("disabled"))return!1;var n=Fr(t),r=c.left+34,a=-1*n.width(),s=n.data("shown_popop")?200:0;return i=setTimeout(function(){o.data("isLibrary")?n.css("left",r).show():n.css("left",a).show().animate({left:r},150),n.data("shown_popop",!0)},s),e.preventDefault(),!0}).mouseup(function(e){clearTimeout(i);var t=Fr(this).attr("data-curopt");o.data("isLibrary")&&Fr(s.replace("_show","")).is(":visible")?$(s,!0):$(s)&&he[t]&&he[t]()})}),fe(),a()},ye=function(e,t){return Fr("<div>",{class:"tools_flyout",id:e}).appendTo("#svg_editor").append(t)},ve=function(e,t,r,i){var a=Fr(e),s=i.dropUp,o=Fr(t);s&&Fr(e).addClass("dropup"),o.find("li").bind("mouseup",function(){i.seticon&&(n("#cur_"+a[0].id,Fr(this).children()),Fr(this).addClass("current").siblings().removeClass("current"));for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];r.apply.apply(r,[this].concat(t))});var l=!1;Fr(window).mouseup(function(e){l||(a.removeClass("down"),o.hide(),o.css({top:0,left:0})),l=!1}),a.bind("mousedown",function(){var e=a.offset();s?(e.top-=o.height(),e.left+=8):e.top+=a.height(),o.offset(e),a.hasClass("down")?(o.hide(),o.css({top:0,left:0})):(o.show(),l=!0),a.toggleClass("down")}).hover(function(){l=!0}).mouseout(function(){l=!1}),i.multiclick&&o.mousedown(function(){l=!0})},be=[],xe=function(){var e=y()(m.a.mark(function e(t,n){var r,i,a,s,o,l,u,h,p,f;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=function(){d&&(clearTimeout(d),d=null),i||(d=setTimeout(function(){i=!0,c(Fr.pref("iconsize"))},50))},n){e.next=3;break}return e.abrupt("return",void 0);case 3:if(r=!1,i=!1,!n.langReady){e.next=14;break}if(!Ur.langChanged){e.next=13;break}return a=Fr.pref("lang"),e.next=10,n.langReady({lang:a,uiStrings:Wr,importLocale:ri({defaultLang:a,defaultName:n.name})});case 10:Cn.push(n.name),e.next=14;break;case 13:be.push(n);case 14:if(o=function(){n.callback&&!r&&(r=!0,n.callback.call(Ur))},l=[],n.context_tools&&Fr.each(n.context_tools,function(e,t){var n,r=t.container_id?' id="'+t.container_id+'"':"",i=Fr("#"+t.panel);switch(i.length||(i=Fr("<div>",{id:t.panel}).appendTo("#tools_top")),t.type){case"tool_button":n='<div class="tool_button">'+t.id+"</div>";var a=Fr(n).appendTo(i);t.events&&Fr.each(t.events,function(e,t){Fr(a).bind(e,t)});break;case"select":n="<label"+r+'><select id="'+t.id+'">',Fr.each(t.options,function(e,r){var i=e===t.defval?" selected":"";n+='<option value="'+e+'"'+i+">"+r+"</option>"});var s=Fr(n+="</select></label>").appendTo(i).find("select");Fr.each(t.events,function(e,t){Fr(s).bind(e,t)});break;case"button-select":n='<div id="'+t.id+'" class="dropdown toolset" title="'+t.title+'"><div id="cur_'+t.id+'" class="icon_label"></div><button></button></div>';var o=Fr('<ul id="'+t.id+'_opts"></ul>').appendTo("#option_lists");t.colnum&&o.addClass("optcols"+t.colnum),Fr(n).appendTo(i).children(),l.push({elem:"#"+t.id,list:"#"+t.id+"_opts",title:t.title,callback:t.events.change,cur:"#cur_"+t.id});break;case"input":n="<label"+r+'><span id="'+t.id+'_label">'+t.label+':</span><input id="'+t.id+'" title="'+t.title+'" size="'+(t.size||"4")+'" value="'+(t.defval||"")+'" type="text"/></label>';var c=Fr(n).appendTo(i).find("input");t.spindata&&c.SpinButton(t.spindata),t.events&&Fr.each(t.events,function(e,t){c.bind(e,t)})}}),u=n.svgicons,!n.buttons){e.next=24;break}if(h={},p={},f={},Fr.each(n.buttons,function(e,t){for(var n,r,i,a,s,o,l,c=t.id,d=e;Fr("#"+c).length;)c=t.id+"_"+ ++d;if(u){h[c]=t.icon;var g=t.svgicon||t.id;"app_menu"===t.type?p["#"+c+" > div"]=g:p["#"+c]=g}else n=Fr('<img src="'+t.icon+'">');switch(t.type){case"mode_flyout":case"mode":r="tool_button",i="#tools_left";break;case"context":r="tool_button",i="#"+t.panel,Fr(i).length||Fr("<div>",{id:t.panel}).appendTo("#tools_top");break;case"app_menu":r="",i="#main_menu ul"}var m,_=Fr(t.list||"app_menu"===t.type?"<li/>":"<div/>").attr("id",c).attr("title",t.title).addClass(r);if(t.includeWith||t.list){if(t.list){if(_.addClass("push_button"),Fr("#"+t.list+"_opts").append(_),t.isDefault){Fr("#cur_"+t.list).append(_.children().clone());var y=t.svgicon||t.id;p["#cur_"+t.list]=y}}else if(t.includeWith){var v,b=t.includeWith;a=(l=Fr(b.button)).parent(),l.parent().hasClass("tools_flyout")||(v=l[0].id.replace("tool_","tools_"),s=l.clone().attr("id",v+"_show").append(Fr("<div>",{class:"flyout_arrow_horiz"})),l.before(s),a=ye(v,l)),o=mn.getButtonData(b.button),b.isDefault&&(p["#"+v+"_show"]=t.id);var x=f["#"+a[0].id]=[{sel:"#"+c,fn:t.events.click,icon:t.id,key:t.key,isDefault:Boolean(t.includeWith&&t.includeWith.isDefault)},o],w="position"in b?b.position:"last",S=a.children().length;!isNaN(w)&&w>=0&&w<S?a.children().eq(w).before(_):(a.append(_),x.reverse())}}else"position"in t?Fr(i).children().eq(t.position).length?Fr(i).children().eq(t.position).before(_):Fr(i).children().last().before(_):_.appendTo(i),"mode_flyout"===t.type?(a=(l=Fr(_)).parent(),l.parent().hasClass("tools_flyout")||(m=l[0].id.replace("tool_","tools_"),s=l.clone().attr("id",m+"_show").append(Fr("<div>",{class:"flyout_arrow_horiz"})),l.before(s),(a=ye(m,l)).data("isLibrary",!0),s.data("isLibrary",!0)),p["#"+m+"_show"]=t.id,f["#"+a[0].id]=[{sel:"#"+c,fn:t.events.click,icon:t.id,isDefault:!0}]):"app_menu"===t.type&&_.append("<div>").append(t.title);u||_.append(n),t.list||Fr.each(t.events,function(e,n){"click"===e&&"mode"===t.type?(Y()&&"click"===e&&(e="mousedown"),t.includeWith?_.bind(e,n):_.bind(e,function(){$(_)&&n()}),t.key&&(Fr(document).bind("keydown",t.key,n),t.title&&_.attr("title",t.title+" ["+t.key+"]"))):_.bind(e,n)}),_e(f)}),Fr.each(l,function(){ve(this.elem,this.list,this.callback,{seticon:!0})}),!u){e.next=24;break}return e.abrupt("return",new Promise(function(e,t){Fr.svgIcons(u,{w:24,h:24,id_match:!1,no_img:!U(),fallback:h,placement:p,callback:function(t){"m"!==Fr.pref("iconsize")&&s(),o(),e()}})}));case 24:return e.abrupt("return",o());case 25:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}();Hr.bind("selected",function(e,t){var r=Hr.getMode();"select"===r&&G();var i="pathedit"===r;V=1===t.length||gn(t[1])?t[0]:null,R=t.length>=2&&!gn(t[1]),gn(V)||i||function(){var e,t;if(!gn(V))switch(V.tagName){case"use":case"image":case"foreignObject":break;case"g":case"a":var n=V.getElementsByTagName("*"),r=null;for(e=0,t=n.length;e<t;e++){var i=n[e].getAttribute("stroke-width");0===e?r=i:r!==i&&(r=null)}Fr("#stroke_width").val(null===r?"":r),w.fill.update(!0),w.stroke.update(!0);break;default:w.fill.update(!0),w.stroke.update(!0),Fr("#stroke_width").val(V.getAttribute("stroke-width")||1),Fr("#stroke_style").val(V.getAttribute("stroke-dasharray")||"none");var a=V.getAttribute("stroke-linejoin")||"miter";Fr("#linejoin_"+a).length&&D(Fr("#linejoin_"+a)[0]),a=V.getAttribute("stroke-linecap")||"butt",Fr("#linecap_"+a).length&&D(Fr("#linecap_"+a)[0])}if(!gn(V)){var s=100*(V.getAttribute("opacity")||1);Fr("#group_opacity").val(s),Fr("#opac_slider").slider("option","value",s),Fr("#elem_id").val(V.id),Fr("#elem_class").val(V.getAttribute("class"))}te()}(),function(e,t){Fr("#path_node_panel").toggle(e),Fr("#tools_bottom_2,#tools_bottom_3").toggle(!e),e?(Fr(".tool_button_current").removeClass("tool_button_current").addClass("tool_button"),Fr("#tool_select").addClass("tool_button_current").removeClass("tool_button"),n("#tool_select","select_node"),R=!1,t.length&&(V=t[0])):setTimeout(function(){n("#tool_select","select")},1e3)}(i,t),ne(),Hr.runExtensions("selectedChanged",{elems:t,selectedElement:V,multiselected:R})}),Hr.bind("transition",function(e,t){var n=Hr.getMode(),r=t[0];if(r){if(!(R=t.length>=2&&!gn(t[1])))switch(n){case"rotate":var i=Hr.getRotationAngle(r);Fr("#angle").val(i),Fr("#tool_reorient").toggleClass("disabled",0===i)}Hr.runExtensions("elementTransition",{elems:t})}}),Hr.bind("changed",function(e,t){var n=Hr.getMode();"select"===n&&G();for(var r=0;r<t.length;++r){var i=t[r],a=i&&"svg"===i.tagName;a||se(i)?(L(),a&&ee()):i&&V&&gn(V.parentNode)&&(V=i)}Ur.showSaveWarning=!0,ne(),V&&"select"===n&&(w.fill.update(),w.stroke.update()),Hr.runExtensions("elementChanged",{elems:t})}),Hr.bind("saved",function(e,t){if(Ur.showSaveWarning=!1,t='<?xml version="1.0"?>\n'+t,H())j(0,!0);else{var n=document.createElement("a");n.href="data:image/svg+xml;base64,"+Tt(t),n.download="icon.svg",n.style="display: none;",document.body.append(n),n.click();var r=Fr.pref("save_notice_done");if("all"!==r){var i=Wr.notification.saveFromBrowser.replace("%s","SVG");F()?t.includes("<defs")?(i+="\n\n"+Wr.notification.defsFailOnSave,Fr.pref("save_notice_done","all"),r="all"):Fr.pref("save_notice_done","part"):Fr.pref("save_notice_done","all"),"part"!==r&&Fr.alert(i)}}}),Hr.bind("exported",function(e,t){var n=t.issues,r=t.exportWindowName;if((S=window.open(Rt||"",r))&&!S.closed){if(S.location.href=t.bloburl||t.datauri,"all"!==Fr.pref("export_notice_done")){var i=Wr.notification.saveFromBrowser.replace("%s",t.type);n.length&&(i+="\n\n"+Wr.notification.noteTheseIssues+"\n • "+n.join("\n • ")),Fr.pref("export_notice_done","all"),S.alert(i)}}else Fr.alert(Wr.notification.popupWindowBlocked)}),Hr.bind("exportedPDF",function(e,t){if(t.output){var n=t.exportWindowName;n&&(S=window.open("",n)),S&&!S.closed?S.location.href=t.output:Fr.alert(Wr.notification.popupWindowBlocked)}}),Hr.bind("zoomed",le),Hr.bind("zoomDone",oe),Hr.bind("updateCanvas",function(e,t){var n=t.center,r=t.newCtr;ee(n,r)}),Hr.bind("contextset",function(e,t){var n="";if(t){var r="";n='<a href="#" data-root="y">'+Hr.getCurrentDrawing().getCurrentLayerName()+"</a>",Fr(t).parentsUntil("#svgcontent > g").andSelf().each(function(){this.id&&(r+=" > "+this.id,n+=this!==t?' > <a href="#">'+this.id+"</a>":" > "+this.id)}),ie=r}else ie=null;Fr("#cur_context_panel").toggle(Boolean(t)).html(n),ae()}),Hr.bind("extension_added",xe),Hr.textActions.setInputElem(Fr("#text")[0]);var we='<div class="palette_item" data-rgb="none"></div>';Fr.each(["#000000","#3f3f3f","#7f7f7f","#bfbfbf","#ffffff","#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f","#7f0000","#7f3f00","#7f7f00","#3f7f00","#007f00","#007f3f","#007f7f","#003f7f","#00007f","#3f007f","#7f007f","#7f003f","#ffaaaa","#ffd4aa","#ffffaa","#d4ffaa","#aaffaa","#aaffd4","#aaffff","#aad4ff","#aaaaff","#d4aaff","#ffaaff","#ffaad4"],function(e,t){we+='<div class="palette_item" style="background-color: '+t+';" data-rgb="'+t+'"></div>'}),Fr("#palette").append(we);we="",Fr.each(["#FFF","#888","#000"],function(){we+='<div class="color_block" style="background-color:'+this+';"></div>'}),Fr("#bg_blocks").append(we);var Se=Fr("#bg_blocks div"),ke="cur_background";Se.each(function(){Fr(this).click(function(){Se.removeClass(ke),Fr(this).addClass(ke)})}),Q(Fr.pref("bkgd_color"),Fr.pref("bkgd_url")),Fr("#image_save_opts input").val([Fr.pref("img_save")]);var Ce=function(e,t){gn(t)&&(t=e.value),Fr("#group_opacity").val(t),e&&e.handle||Fr("#opac_slider").slider("option","value",t),Hr.setOpacity(t/100)},Ae=function(e,t,n){gn(t)&&(t=e.value),Fr("#blur").val(t);var r=!1;e&&e.handle||(Fr("#blur_slider").slider("option","value",t),r=!0),n?Hr.setBlurNoUndo(t):Hr.setBlur(t,r)};Fr("#stroke_style").change(function(){Hr.setStrokeAttr("stroke-dasharray",Fr(this).val()),B()}),Fr("#stroke_linejoin").change(function(){Hr.setStrokeAttr("stroke-linejoin",Fr(this).val()),B()}),Fr("select").change(function(){Fr(this).blur()});var Ee,Ge,Pe,Ie,Ne,Te=!1;Fr("#selLayerNames").change(y()(m.a.mark(function e(){var t,n,r;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.options[this.selectedIndex].value,n=Wr.notification.QmoveElemsToLayer.replace("%s",t),r=function(e){e&&(Te=!0,Hr.moveSelectedToLayer(t),Hr.clearSelection(),L())},!t){e.next=14;break}if(!Te){e.next=8;break}r(!0),e.next=14;break;case 8:return e.next=10,Fr.confirm(n);case 10:if(e.sent){e.next=13;break}return e.abrupt("return");case 13:r(!0);case 14:case"end":return e.stop()}},e,this)}))),Fr("#font_family").change(function(){Hr.setFontFamily(this.value)}),Fr("#seg_type").change(function(){Hr.setSegType(Fr(this).val())}),Fr("#text").bind("keyup input",function(){Hr.setTextContent(this.value)}),Fr("#image_url").change(function(){W(this.value)}),Fr("#link_url").change(function(){this.value.length?Hr.setLinkURL(this.value):Hr.removeHyperlink()}),Fr("#g_title").change(function(){Hr.setGroupTitle(this.value)}),Fr(".attr_changer").change(function(){var e=this.getAttribute("data-attr"),t=this.value;if(!me(e,t,V))return this.value=V.getAttribute(e),Fr.alert(Wr.notification.invalidAttrValGiven),!1;if("id"!==e&&"class"!==e)if(isNaN(t))t=Hr.convertToNum(e,t);else if("px"!==ei.baseUnit){var n=de();(V[e]||"pathedit"===Hr.getMode()||"x"===e||"y"===e)&&(t*=n[ei.baseUnit])}if("id"===e){var r=V;Hr.clearSelection(),r.id=t,Hr.addToSelection([r],!0)}else Hr.changeSelectedAttribute(e,t);return this.blur(),!0}),Fr("#palette").mouseover(function(){var e=Fr('<input type="hidden">');Fr(this).append(e),e.focus().remove()}),Fr(".palette_item").mousedown(function(e){var t,n=e.shiftKey||2===e.button?"stroke":"fill",r=Fr(this).data("rgb");"none"===r||"transparent"===r||"initial"===r?(r="none",t=new Fr.jGraduate.Paint):t=new Fr.jGraduate.Paint({alpha:100,solidColor:r.substr(1)}),w[n].setPaint(t),Hr.setColor(n,r),"none"!==r&&1!==Hr.getPaintOpacity(n)&&Hr.setPaintOpacity(n,1),te()}).bind("contextmenu",function(e){e.preventDefault()}),Fr("#toggle_stroke_tools").on("click",function(){Fr("#tools_bottom").toggleClass("expanded")}),Ee=b[0],Ge=null,Pe=null,Ie=!1,Ne=!1,Fr("#svgcanvas").bind("mousemove mouseup",function(e){return!1===Ie||(Ee.scrollLeft-=e.clientX-Ge,Ee.scrollTop-=e.clientY-Pe,Ge=e.clientX,Pe=e.clientY,"mouseup"===e.type&&(Ie=!1),!1)}).mousedown(function(e){return 1!==e.button&&!0!==Ne||(Ie=!0,Ge=e.clientX,Pe=e.clientY,!1)}),Fr(window).mouseup(function(){Ie=!1}),Fr(document).bind("keydown","space",function(e){Hr.spaceKey=Ne=!0,e.preventDefault()}).bind("keyup","space",function(e){e.preventDefault(),Hr.spaceKey=Ne=!1}).bind("keydown","shift",function(e){"zoom"===Hr.getMode()&&b.css("cursor",A)}).bind("keyup","shift",function(e){"zoom"===Hr.getMode()&&b.css("cursor",C)}),Ur.setPanning=function(e){Hr.spaceKey=Ne=e},function(){var e=Fr("#main_icon"),t=Fr("#main_icon span"),n=Fr("#main_menu"),r=!1,i=0,a=!0,s=!1;Fr(window).mouseup(function(t){r||(e.removeClass("buttondown"),"INPUT"!==t.target.tagName?n.fadeOut(200):s||(s=!0,Fr(t.target).click(function(){n.css("margin-left","-9999px").show()}))),r=!1}).mousedown(function(e){Fr(e.target).closest("div.tools_flyout, .contextMenu").length||Fr(".tools_flyout:visible,.contextMenu").fadeOut(250)}),t.bind("mousedown",function(){e.hasClass("buttondown")?n.fadeOut(200):(n.css("margin-left",0).show(),i||(i=n.height()),n.css("height",0).animate({height:i},200),r=!0),e.toggleClass("buttondown buttonup")}).hover(function(){r=!0}).mouseout(function(){r=!1});var o=Fr("#main_menu li");o.mouseover(function(){a="rgba(0, 0, 0, 0)"===Fr(this).css("background-color"),o.unbind("mouseover"),a&&o.mouseover(function(){this.style.backgroundColor="#FFC"}).mouseout(function(){return this.style.backgroundColor="transparent",!0})})}(),Ur.addDropDown=function(e,t,n){if(Fr(e).length){var r=Fr(e).find("button"),i=Fr(e).find("ul").attr("id",Fr(e)[0].id+"-list");n?Fr(e).addClass("dropup"):Fr("#option_lists").append(i),i.find("li").bind("mouseup",t);var a=!1;Fr(window).mouseup(function(e){a||(r.removeClass("down"),i.hide()),a=!1}),r.bind("mousedown",function(){if(r.hasClass("down"))i.hide();else{if(!n){var t=Fr(e).position();i.css({top:t.top+24,left:t.left-10})}i.show(),a=!0}r.toggleClass("down")}).hover(function(){a=!0}).mouseout(function(){a=!1})}},Ur.addDropDown("#font_family_dropdown",function(){Fr("#font_family").val(Fr(this).text()).change()}),Ur.addDropDown("#opacity_dropdown",function(){if(!Fr(this).find("div").length){var e=parseInt(Fr(this).text().split("%")[0]);Ce(!1,e)}},!0),Fr("#opac_slider").slider({start:function(){Fr("#opacity_dropdown li:not(.special)").hide()},stop:function(){Fr("#opacity_dropdown li").show(),Fr(window).mouseup()},slide:function(e,t){Ce(t)}}),Ur.addDropDown("#blur_dropdown",Fr.noop);var Le,Me,Oe=!1;Fr("#blur_slider").slider({max:10,step:.1,stop:function(e,t){Oe=!1,Ae(t),Fr("#blur_dropdown li").show(),Fr(window).mouseup()},start:function(){Oe=!0},slide:function(e,t){Ae(t,null,Oe)}}),Ur.addDropDown("#zoom_dropdown",function(){var e=Fr(this),t=e.data("val");t?le(window,t):ce({value:parseFloat(e.text())})},!0),ve("#stroke_linecap","#linecap_opts",function(){D(this,!0)},{dropUp:!0}),ve("#stroke_linejoin","#linejoin_opts",function(){D(this,!0)},{dropUp:!0}),ve("#tool_position","#position_opts",function(){var e=this.id.replace("tool_pos","").charAt(0);Hr.alignSelectedElements(e,"page")},{multiclick:!0}),Me=function(){Fr(Le).blur()},Fr("#svg_editor").find("button, select, input:not(#text)").focus(function(){Le=this,E="toolbars",b.mousedown(Me)}).blur(function(){E="canvas",b.unbind("mousedown",Me),"textedit"===Hr.getMode()&&Fr("#text").focus()});var je,Ve=function(){$("#tool_fhpath")&&Hr.setMode("fhpath")},Re=function(){$("#tool_line")&&Hr.setMode("line")},Be=function(){$("#tool_square")&&Hr.setMode("square")},De=function(){$("#tool_rect")&&Hr.setMode("rect")},Ue=function(){$("#tool_fhrect")&&Hr.setMode("fhrect")},Fe=function(){$("#tool_circle")&&Hr.setMode("circle")},He=function(){$("#tool_ellipse")&&Hr.setMode("ellipse")},ze=function(){$("#tool_fhellipse")&&Hr.setMode("fhellipse")},qe=function(){$("#tool_image")&&Hr.setMode("image")},$e=function(){$("#tool_zoom")&&(Hr.setMode("zoom"),b.css("cursor",C))},Ye=function(e){var t=Hr.getResolution();e=e?t.zoom*e:1,Fr("#zoom").val(100*e),Hr.setZoom(e),oe(),ee(!0)},Xe=function(){$("#tool_zoom")&&(Ye(),G())},We=function(){$("#tool_text")&&Hr.setMode("text")},Qe=function(){$("#tool_path")&&Hr.setMode("path")},Ke=function(){gn(V)&&!R||Hr.deleteSelectedElements()},Ze=function(){gn(V)&&!R||Hr.cutSelectedElements()},Je=function(){gn(V)&&!R||Hr.copySelectedElements()},et=function(){var e=Hr.getZoom(),t=(b[0].scrollLeft+b.width()/2)/e-Hr.contentW,n=(b[0].scrollTop+b.height()/2)/e-Hr.contentH;Hr.pasteElements("point",t,n)},tt=function(){gn(V)||Hr.moveToTopSelectedElement()},nt=function(){gn(V)||Hr.moveToBottomSelectedElement()},rt=function(e){gn(V)||Hr.moveUpDownSelected(e)},it=function(){gn(V)||Hr.convertToPath()},at=function(){gn(V)||g.reorient()},st=function(){var e=y()(m.a.mark(function e(){var t;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(gn(V)&&!R){e.next=5;break}return e.next=3,Fr.prompt(Wr.notification.enterNewLinkURL,"http://");case 3:(t=e.sent)&&Hr.makeHyperlink(t);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),ot=function(e,t){if(!gn(V)||R){if(ei.gridSnapping){var n=Hr.getZoom()*ei.snappingStep;e*=n,t*=n}Hr.moveSelectedElements(e,t)}},lt=function(){Fr("#tool_node_link").toggleClass("push_button_pressed tool_button");var e=Fr("#tool_node_link").hasClass("push_button_pressed");g.linkControlPoints(e)},ct=function(){g.getNodePoint()&&g.clonePathNode()},ut=function(){g.getNodePoint()&&g.deletePathNode()},dt=function(){var e=Fr("#tool_add_subpath"),t=!e.hasClass("push_button_pressed");e.toggleClass("push_button_pressed tool_button"),g.addSubPath(t)},ht=function(){g.opencloseSubPath()},pt=function(){Hr.cycleElement(1)},ft=function(){Hr.cycleElement(0)},gt=function(e,t){if(!gn(V)&&!R){e||(t*=-1);var n=parseFloat(Fr("#angle").val())+t;Hr.setRotationAngle(n),ne()}},mt=function(){var e=y()(m.a.mark(function e(){var t,n,r;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=u()(ei.dimensions,2),n=t[0],r=t[1],e.next=3,Fr.confirm(Wr.notification.QwantToClear);case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:G(),Hr.clear(),Hr.setResolution(n,r),ee(!0),Ye(),L(),ne(),ue(),Hr.runExtensions("onNewDocument");case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),_t=function(){return Hr.setBold(!Hr.getBold()),ne(),!1},yt=function(){return Hr.setItalic(!Hr.getItalic()),ne(),!1},vt=function(){var e=y()(m.a.mark(function e(){var t,n,r,i,a;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){var e,t,r=Wr.notification.loadingImage;if("new"===ei.exportWindowType&&Ur.exportWindowCt++,n=ei.canvasName+Ur.exportWindowCt,je)t=je;else{if(e='<!DOCTYPE html><html>\n          <head>\n            <meta charset="utf-8">\n            <title>'.concat(r,"</title>\n          </head>\n          <body><h1>").concat(r,"</h1></body>\n        <html>"),"undefined"!=typeof URL&&URL.createObjectURL){var i=new Blob([e],{type:"text/html"});t=URL.createObjectURL(i)}else t="data:text/html;base64;charset=utf-8,"+Tt(e);je=t}S=window.open(t,n)},e.next=3,Fr.select("Select an image type for export: ",["PNG","JPEG","BMP","WEBP","PDF"],function(){var e=Fr(this);"JPEG"===e.val()||"WEBP"===e.val()?Fr("#image-slider").length||Fr("<div><label>".concat(Wr.ui.quality,'\n              <input id="image-slider"\n                type="range" min="1" max="100" value="92" />\n            </label></div>')).appendTo(e.parent()):Fr("#image-slider").parent().remove()});case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return");case 6:if(i=z(),"PDF"!==t){e.next=12;break}Zr||i||r(),Hr.exportPDF(n),e.next=16;break;case 12:return Kr||r(),a=parseInt(Fr("#image-slider").val())/100,e.next=16,Hr.rasterExport(t,a,n);case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),bt=function(){Hr.open()},xt=function(){},wt=function(){_.getUndoStackSize()>0&&(_.undo(),L())},St=function(){_.getRedoStackSize()>0&&(_.redo(),L())},kt=function(){R?Hr.groupSelectedElements():V&&Hr.ungroupSelectedElement()},Ct=function(){Hr.cloneSelectedElements(20,20)},At=function(){var e=this.id.replace("tool_align","").charAt(0);Hr.alignSelectedElements(e,Fr("#align_relative_to").val())},Et=function(){if(Fr("#tool_wireframe").toggleClass("push_button_pressed tool_button"),b.toggleClass("wireframe"),!Zt){var e=Fr("#wireframe_rules");e.length?e.empty():Fr('<style id="wireframe_rules"></style>').appendTo("head"),re()}};Fr("#svg_docprops_container, #svg_prefs_container").draggable({cancel:"button,fieldset",containment:"window"}).css("position","absolute");var Gt,Pt,It=!1,Nt=!1,Lt=function(){if(!It){It=!0,Fr("#image_save_opts input").val([Fr.pref("img_save")]);var e=Hr.getResolution();"px"!==ei.baseUnit&&(e.w=pe(e.w)+ei.baseUnit,e.h=pe(e.h)+ei.baseUnit),Fr("#canvas_width").val(e.w),Fr("#canvas_height").val(e.h),Fr("#canvas_title").val(Hr.getDocumentTitle()),Fr("#svg_docprops").show()}},Mt=function(){Fr("#svg_source_editor").hide(),M=!1,Fr("#svg_source_textarea").blur()},Ot=function(){var e=y()(m.a.mark(function e(){var t;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(M){e.next=2;break}return e.abrupt("return");case 2:if(t=function(){Hr.clearSelection(),Mt(),Ye(),L(),ae(),ue()},Hr.setSvgString(Fr("#svg_source_textarea").val())){e.next=11;break}return e.next=6,Fr.confirm(Wr.notification.QerrorsRevertToSource);case 6:if(e.sent){e.next=9;break}return e.abrupt("return");case 9:return t(),e.abrupt("return");case 11:t(),G();case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),jt=function(){Fr("#svg_docprops").hide(),Fr("#canvas_width,#canvas_height").removeAttr("disabled"),Fr("#resolution")[0].selectedIndex=0,Fr("#image_save_opts input").val([Fr.pref("img_save")]),It=!1},Vt=function(){Fr("#svg_prefs").hide(),Nt=!1},Bt=function(){var e=Fr("#canvas_title").val();ae(e),Hr.setDocumentTitle(e);var t=Fr("#canvas_width"),n=t.val(),r=Fr("#canvas_height"),i=r.val();return"fit"===n||me("width",n)?(t.parent().removeClass("error"),"fit"===i||me("height",i)?(r.parent().removeClass("error"),Hr.setResolution(n,i)?(Fr.pref("img_save",Fr("#image_save_opts :checked").val()),ee(),jt(),!0):(Fr.alert(Wr.notification.noContentToFitTo),!1)):(r.parent().addClass("error"),Fr.alert(Wr.notification.invalidAttrValGiven),!1)):(t.parent().addClass("error"),Fr.alert(Wr.notification.invalidAttrValGiven),!1)},Dt=Ur.savePreferences=y()(m.a.mark(function t(){var n,r,i,a;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Q(Fr("#bg_blocks div.cur_background").css("background-color")||"#FFF",Fr("#canvas_bg_url").val()),(n=Fr("#lang_select").val())===Fr.pref("lang")){t.next=11;break}return t.next=6,Ur.putLocale(n,e,ei);case 6:return r=t.sent,i=r.langParam,a=r.langData,t.next=11,An(i,a);case 11:c(Fr("#iconsize").val()),ei.gridSnapping=Fr("#grid_snapping_on")[0].checked,ei.snappingStep=Fr("#grid_snapping_step").val(),ei.gridColor=Fr("#grid_color").val(),ei.showRulers=Fr("#show_rulers")[0].checked,Fr("#rulers").toggle(ei.showRulers),ei.showRulers&&J(),ei.baseUnit=Fr("#base_unit").val(),Hr.setConfig(ei),ee(),Vt();case 22:case"end":return t.stop()}},t,this)})),Ut=Fr.noop,Ft=function(){var e=y()(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Fr("#dialog_box").hide(),M||It||Nt){e.next=4;break}return ie&&Hr.leaveContext(),e.abrupt("return");case 4:if(!M){e.next=15;break}if(O===Fr("#svg_source_textarea").val()){e.next=12;break}return e.next=8,Fr.confirm(Wr.notification.QignoreSourceChanges);case 8:e.sent&&Mt(),e.next=13;break;case 12:Mt();case 13:e.next=16;break;case 15:It?jt():Nt&&Vt();case 16:Ut();case 17:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),Ht={width:Fr(window).width(),height:Fr(window).height()};if(H()&&(Ut=function(){0===b[0].scrollLeft&&0===b[0].scrollTop&&(b[0].scrollLeft=p.left,b[0].scrollTop=p.top)},p={left:b[0].scrollLeft,top:b[0].scrollTop},Fr(window).resize(Ut),Ur.ready(function(){return new Promise(function(e,t){setTimeout(function(){Ut(),e()},500)})}),b.scroll(function(){p={left:b[0].scrollLeft,top:b[0].scrollTop}})),Fr(window).resize(function(e){Fr.each(Ht,function(e,t){var n=Fr(window)[e]();b[0]["scroll"+("width"===e?"Left":"Top")]-=(n-t)/2,Ht[e]=n}),a()}),b.scroll(function(){Fr("#ruler_x").length&&(Fr("#ruler_x")[0].scrollLeft=b[0].scrollLeft),Fr("#ruler_y").length&&(Fr("#ruler_y")[0].scrollTop=b[0].scrollTop)}),Fr("#url_notice").click(function(){Fr.alert(this.title)}),Fr("#change_image_url").click(K),Gt="tool_button_current",Pt="",Fr.each(["clear","open","save","source","delete","delete_multi","paste","clone","clone_multi","move_top","move_bottom"],function(e,t){Pt+=(e?",":"")+"#tool_"+t}),Fr(Pt).mousedown(function(){Fr(this).addClass(Gt)}).bind("mousedown mouseout",function(){Fr(this).removeClass(Gt)}),Fr("#tool_undo, #tool_redo").mousedown(function(){Fr(this).hasClass("disabled")||Fr(this).addClass(Gt)}).bind("mousedown mouseout",function(){Fr(this).removeClass(Gt)}),q()&&!window.opera)for(var zt=["tool_clear","tool_save","tool_source","tool_undo","tool_redo","tool_clone"],qt=zt.length;qt--;){var $t=document.getElementById(zt[qt]);if($t){var Yt=$t.title,Xt=Yt.indexOf("Ctrl+");$t.title=[Yt.substr(0,Xt),"Cmd+",Yt.substr(Xt+5)].join("")}}var Wt=function(e){var t="stroke_color"===e.attr("id")?"stroke":"fill",n="stroke"===t?Wr.ui.pick_stroke_paint_opacity:Wr.ui.pick_fill_paint_opacity,r=e.offset(),i=w[t].paint;Fr("#color_picker").draggable({cancel:".jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker",containment:"window"}).css(ei.colorPickerCSS||{left:r.left-140,bottom:40}).jGraduate({paint:i,window:{pickerTitle:n},images:{clientPath:ei.jGraduatePath},newstop:"inverse"},function(e){i=new Fr.jGraduate.Paint(e),w[t].setPaint(i),Hr.setPaint(t,i),Fr("#color_picker").hide()},function(){Fr("#color_picker").hide()})},Qt=function(){function e(t,n){s()(this,e);var r=ei["fill"===n?"initFill":"initStroke"],i=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg">\n          <rect width="16.5" height="16.5"\n            fill="#'.concat(r.color,'" opacity="').concat(r.opacity,'"/>\n          <defs><linearGradient id="gradbox_"/></defs>\n        </svg>'),"text/xml").documentElement;(i=Fr(t)[0].appendChild(document.importNode(i,!0))).setAttribute("width",16.5),this.rect=i.firstElementChild,this.defs=i.getElementsByTagName("defs")[0],this.grad=this.defs.firstElementChild,this.paint=new Fr.jGraduate.Paint({solidColor:r.color}),this.type=n}return l()(e,[{key:"setPaint",value:function(e,t){this.paint=e;var n=e.type,r=e.alpha/100,i="none";switch(n){case"solidColor":i="none"!==e[n]?"#"+e[n]:e[n];break;case"linearGradient":case"radialGradient":this.grad.remove(),this.grad=this.defs.appendChild(e[n]),i="url(#"+(this.grad.id="gradbox_"+this.type)+")"}this.rect.setAttribute("fill",i),this.rect.setAttribute("opacity",r),t&&(Hr.setColor(this.type,this._paintColor,!0),Hr.setPaintOpacity(this.type,this._paintOpacity,!0))}},{key:"update",value:function(e){if(V){var t=this.type;switch(V.tagName){case"use":case"image":case"foreignObject":return;case"g":case"a":for(var n=V.getElementsByTagName("*"),r=null,i=0,a=n.length;i<a;i++){var s=n[i].getAttribute(t);if(0===i)r=s;else if(r!==s){r=null;break}}if(null===r)return void(this._paintColor=null);this._paintColor=r,this._paintOpacity=1;break;default:this._paintOpacity=parseFloat(V.getAttribute(t+"-opacity")),isNaN(this._paintOpacity)&&(this._paintOpacity=1);var o="fill"===t?"black":"none";this._paintColor=V.getAttribute(t)||o}e&&(Hr.setColor(t,this._paintColor,!0),Hr.setPaintOpacity(t,this._paintOpacity,!0)),this._paintOpacity*=100;var l=function(e,t,n){var r={alpha:t};if(e.startsWith("url(#")){var i=Hr.getRefElem(e);r[(i=i?i.cloneNode(!0):Fr("#"+n+"_color defs *")[0]).tagName]=i}else e.startsWith("#")?r.solidColor=e.substr(1):r.solidColor="none";return new Fr.jGraduate.Paint(r)}(this._paintColor,this._paintOpacity,t);this.setPaint(l)}}},{key:"prep",value:function(){switch(this.paint.type){case"linearGradient":case"radialGradient":var e=new Fr.jGraduate.Paint({copy:this.paint});Hr.setPaint(this.type,e)}}}]),e}();w.fill=new Qt("#fill_color","fill"),w.stroke=new Qt("#stroke_color","stroke"),Fr("#stroke_width").val(ei.initStroke.width),Fr("#group_opacity").val(100*ei.initOpacity);var Kt=w.fill.rect.cloneNode(!1);Kt.setAttribute("style","vector-effect:non-scaling-stroke");var Zt="non-scaling-stroke"===Kt.style.vectorEffect;Kt.removeAttribute("style");var Jt,en,tn=w.fill.rect.ownerDocument.createElementNS(v.SVG,"feGaussianBlur");function nn(){Hr.deleteCurrentLayer()&&(ne(),L(),Fr("#layerlist tr.layer").removeClass("layersel"),Fr("#layerlist tr.layer:first").addClass("layersel"))}function rn(){return(rn=y()(m.a.mark(function e(){var t,n;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Hr.getCurrentDrawing().getCurrentLayerName()+" copy",e.next=3,Fr.prompt(Wr.notification.enterUniqueLayerName,t);case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return");case 6:if(!Hr.getCurrentDrawing().hasLayer(n)){e.next=9;break}return Fr.alert(Wr.notification.dupeLayerName),e.abrupt("return");case 9:Hr.cloneLayer(n),ne(),L();case 12:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function an(e){var t=Hr.getCurrentDrawing().getNumLayers(),n=Fr("#layerlist tr.layersel").index();(n>0||n<t-1)&&(n+=e,Hr.setCurrentLayerPosition(t-n-1),L())}void 0===tn.stdDeviationX&&Fr("#tool_blur").hide(),Fr(tn).remove(),Jt="-"+o.toLowerCase()+"-zoom-",en=Jt+"in",b.css("cursor",en),b.css("cursor")===en&&(C=en,A=Jt+"out"),b.css("cursor","auto"),setTimeout(function(){Hr.embedImage("images/logo.png",function(e){e||(Fr("#image_save_opts [value=embed]").attr("disabled","disabled"),Fr("#image_save_opts input").val(["ref"]),Fr.pref("img_save","ref"),Fr("#image_opt_embed").css("color","#666").attr("title",Wr.notification.featNotSupported))})},1e3),Fr("#fill_color, #tool_fill .icon_label").click(function(){Wt(Fr("#fill_color")),te()}),Fr("#stroke_color, #tool_stroke .icon_label").click(function(){Wt(Fr("#stroke_color")),te()}),Fr("#group_opacityLabel").click(function(){Fr("#opacity_dropdown button").mousedown(),Fr(window).mouseup()}),Fr("#zoomLabel").click(function(){Fr("#zoom_dropdown button").mousedown(),Fr(window).mouseup()}),Fr("#tool_move_top").mousedown(function(e){Fr("#tools_stacking").show(),e.preventDefault()}),Fr(".layer_button").mousedown(function(){Fr(this).addClass("layer_buttonpressed")}).mouseout(function(){Fr(this).removeClass("layer_buttonpressed")}).mouseup(function(){Fr(this).removeClass("layer_buttonpressed")}),Fr(".push_button").mousedown(function(){Fr(this).hasClass("disabled")||Fr(this).addClass("push_button_pressed").removeClass("push_button")}).mouseout(function(){Fr(this).removeClass("push_button_pressed").addClass("push_button")}).mouseup(function(){Fr(this).removeClass("push_button_pressed").addClass("push_button")}),Fr("#layer_new").click(y()(m.a.mark(function e(){var t,n,r;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=Hr.getCurrentDrawing().getNumLayers();do{t=Wr.layers.layer+" "+ ++n}while(Hr.getCurrentDrawing().hasLayer(t));return e.next=4,Fr.prompt(Wr.notification.enterUniqueLayerName,t);case 4:if(r=e.sent){e.next=7;break}return e.abrupt("return");case 7:if(!Hr.getCurrentDrawing().hasLayer(r)){e.next=10;break}return Fr.alert(Wr.notification.dupeLayerName),e.abrupt("return");case 10:Hr.createLayer(r),ne(),L();case 13:case"end":return e.stop()}},e,this)}))),Fr("#layer_delete").click(nn),Fr("#layer_up").click(function(){an(-1)}),Fr("#layer_down").click(function(){an(1)}),Fr("#layer_rename").click(y()(m.a.mark(function e(){var t,n;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Fr("#layerlist tr.layersel td.layername").text(),e.next=3,Fr.prompt(Wr.notification.enterNewLayerName,"");case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return");case 6:if(t!==n&&!Hr.getCurrentDrawing().hasLayer(n)){e.next=9;break}return Fr.alert(Wr.notification.layerHasThatName),e.abrupt("return");case 9:Hr.renameCurrentLayer(n),L();case 11:case"end":return e.stop()}},e,this)})));var sn=-1,on=!1,ln=!1,cn=function(e){var t=Fr("#ruler_x");Fr("#sidepanels").width("+="+e),Fr("#layerpanel").width("+="+e),t.css("right",parseInt(t.css("right"))+e),b.css("right",parseInt(b.css("right"))+e),Hr.runExtensions("workareaResized")},un=function(e){if(ln&&-1!==sn){on=!0;var t=sn-e.pageX,n=Fr("#sidepanels").width();n+t>300?t=300-n:n+t<2&&(t=2-n),0!==t&&(sn-=t,cn(t))}},dn=function(e){var t=window.devicePixelRatio||1,n=Fr("#sidepanels").width();cn(((t<1?n:n/t)>2||e?0:150*(t<1?1:t))-n)};Fr("#sidepanel_handle").mousedown(function(e){sn=e.pageX,Fr(window).mousemove(un),ln=!1,setTimeout(function(){ln=!0},20)}).mouseup(function(e){on||dn(),sn=-1,on=!1}),Fr(window).mouseup(function(){sn=-1,on=!1,Fr("#svg_editor").unbind("mousemove",un)}),L();Fr(window).bind("load resize",function(){b.css("line-height",b.height()+"px")}),Fr("#resolution").change(function(){var e=Fr("#canvas_width,#canvas_height");if(this.selectedIndex)if("content"===this.value)e.val("fit").attr("disabled","disabled");else{var t=this.value.split("x");Fr("#canvas_width").val(t[0]),Fr("#canvas_height").val(t[1]),e.removeAttr("disabled")}else"fit"===Fr("#canvas_width").val()&&e.removeAttr("disabled").val(100)}),Fr("input,select").attr("autocomplete","off");var hn,pn,fn=["#tool_source_cancel","#tool_docprops_cancel","#tool_prefs_cancel",".overlay"],mn=(hn=[{sel:"#tool_select",fn:X,evt:"click",key:["V",!0]},{sel:"#tool_fhpath",fn:Ve,evt:"click",key:["Q",!0]},{sel:"#tool_line",fn:Re,evt:"click",key:["L",!0],parent:"#tools_line",prepend:!0},{sel:"#tool_rect",fn:De,evt:"mouseup",key:["R",!0],parent:"#tools_rect",icon:"rect"},{sel:"#tool_square",fn:Be,evt:"mouseup",parent:"#tools_rect",icon:"square"},{sel:"#tool_fhrect",fn:Ue,evt:"mouseup",parent:"#tools_rect",icon:"fh_rect"},{sel:"#tool_ellipse",fn:He,evt:"mouseup",key:["E",!0],parent:"#tools_ellipse",icon:"ellipse"},{sel:"#tool_circle",fn:Fe,evt:"mouseup",parent:"#tools_ellipse",icon:"circle"},{sel:"#tool_fhellipse",fn:ze,evt:"mouseup",parent:"#tools_ellipse",icon:"fh_ellipse"},{sel:"#tool_path",fn:Qe,evt:"click",key:["P",!0]},{sel:"#tool_text",fn:We,evt:"click",key:["T",!0]},{sel:"#tool_image",fn:qe,evt:"mouseup"},{sel:"#tool_zoom",fn:$e,evt:"mouseup",key:["Z",!0]},{sel:"#tool_clear",fn:mt,evt:"mouseup",key:["N",!0]},{sel:"#tool_save",fn:function(){var e;M?Ot():(e={images:Fr.pref("img_save"),round_digits:6},Hr.save(e))},evt:"mouseup",key:["S",!0]},{sel:"#tool_export",fn:vt,evt:"mouseup"},{sel:"#tool_open",fn:bt,evt:"mouseup",key:["O",!0]},{sel:"#tool_import",fn:xt,evt:"mouseup"},{sel:"#tool_source",fn:j,evt:"click",key:["U",!0]},{sel:"#tool_wireframe",fn:Et,evt:"click",key:["F",!0]},{key:["esc",!1,!1],fn:function(){fn.every(function(e){return Fr(e+":hidden").length})&&Hr.clearSelection()},hidekey:!0},{sel:fn.join(","),fn:Ft,evt:"click",key:["esc",!1,!1],hidekey:!0},{sel:"#tool_source_save",fn:Ot,evt:"click"},{sel:"#tool_docprops_save",fn:Bt,evt:"click"},{sel:"#tool_docprops",fn:Lt,evt:"mouseup"},{sel:"#tool_prefs_save",fn:Dt,evt:"click"},{sel:"#tool_prefs_option",fn:function(){return function(){if(!Nt){Nt=!0,Fr("#main_menu").hide();var e=Jr.bkgd_color,t=Fr.pref("bkgd_url");Se.each(function(){var t=Fr(this),n=t.css("background-color")===e;t.toggleClass(ke,n),n&&Fr("#canvas_bg_url").removeClass(ke)}),e||Se.eq(0).addClass(ke),t&&Fr("#canvas_bg_url").val(t),Fr("#grid_snapping_on").prop("checked",ei.gridSnapping),Fr("#grid_snapping_step").attr("value",ei.snappingStep),Fr("#grid_color").attr("value",ei.gridColor),Fr("#svg_prefs").show()}}(),!1},evt:"mouseup"},{sel:"#tool_delete,#tool_delete_multi",fn:Ke,evt:"click",key:["del/backspace",!0]},{sel:"#tool_reorient",fn:at,evt:"click"},{sel:"#tool_node_link",fn:lt,evt:"click"},{sel:"#tool_node_clone",fn:ct,evt:"click"},{sel:"#tool_node_delete",fn:ut,evt:"click"},{sel:"#tool_openclose_path",fn:ht,evt:"click"},{sel:"#tool_add_subpath",fn:dt,evt:"click"},{sel:"#tool_move_top",fn:tt,evt:"click",key:"ctrl+shift+]"},{sel:"#tool_move_bottom",fn:nt,evt:"click",key:"ctrl+shift+["},{sel:"#tool_topath",fn:it,evt:"click"},{sel:"#tool_make_link,#tool_make_link_multi",fn:st,evt:"click"},{sel:"#tool_undo",fn:wt,evt:"click"},{sel:"#tool_redo",fn:St,evt:"click"},{sel:"#tool_clone,#tool_clone_multi",fn:Ct,evt:"click",key:["D",!0]},{sel:"#tool_group_elements",fn:kt,evt:"click",key:["G",!0]},{sel:"#tool_ungroup",fn:kt,evt:"click"},{sel:"#tool_unlink_use",fn:kt,evt:"click"},{sel:"[id^=tool_align]",fn:At,evt:"click"},{sel:"#tool_bold",fn:_t,evt:"mousedown"},{sel:"#tool_italic",fn:yt,evt:"mousedown"},{sel:"#sidepanel_handle",fn:dn,key:["X"]},{sel:"#copy_save_done",fn:Ft,evt:"click"},{key:"ctrl+left",fn:function(){gt(0,1)}},{key:"ctrl+right",fn:function(){gt(1,1)}},{key:"ctrl+shift+left",fn:function(){gt(0,5)}},{key:"ctrl+shift+right",fn:function(){gt(1,5)}},{key:"shift+O",fn:ft},{key:"shift+P",fn:pt},{key:[f+"up",!0],fn:function(){Ye(2)}},{key:[f+"down",!0],fn:function(){Ye(.5)}},{key:[f+"]",!0],fn:function(){rt("Up")}},{key:[f+"[",!0],fn:function(){rt("Down")}},{key:["up",!0],fn:function(){ot(0,-1)}},{key:["down",!0],fn:function(){ot(0,1)}},{key:["left",!0],fn:function(){ot(-1,0)}},{key:["right",!0],fn:function(){ot(1,0)}},{key:"shift+up",fn:function(){ot(0,-10)}},{key:"shift+down",fn:function(){ot(0,10)}},{key:"shift+left",fn:function(){ot(-10,0)}},{key:"shift+right",fn:function(){ot(10,0)}},{key:["alt+up",!0],fn:function(){Hr.cloneSelectedElements(0,-1)}},{key:["alt+down",!0],fn:function(){Hr.cloneSelectedElements(0,1)}},{key:["alt+left",!0],fn:function(){Hr.cloneSelectedElements(-1,0)}},{key:["alt+right",!0],fn:function(){Hr.cloneSelectedElements(1,0)}},{key:["alt+shift+up",!0],fn:function(){Hr.cloneSelectedElements(0,-10)}},{key:["alt+shift+down",!0],fn:function(){Hr.cloneSelectedElements(0,10)}},{key:["alt+shift+left",!0],fn:function(){Hr.cloneSelectedElements(-10,0)}},{key:["alt+shift+right",!0],fn:function(){Hr.cloneSelectedElements(10,0)}},{key:"a",fn:function(){Hr.selectAllInCurrentLayer()}},{key:f+"a",fn:function(){Hr.selectAllInCurrentLayer()}},{key:f+"z",fn:wt},{key:f+"shift+z",fn:St},{key:f+"y",fn:St},{key:f+"x",fn:Ze},{key:f+"c",fn:Je},{key:f+"v",fn:et}],pn={"4/Shift+4":"#tools_rect_show","5/Shift+5":"#tools_ellipse_show"},{setAll:function(){var e={};Fr.each(hn,function(t,n){var r;if(n.sel){if(!(r=Fr(n.sel)).length)return!0;if(n.evt&&(Y()&&"click"===n.evt&&(n.evt="mousedown"),r[n.evt](n.fn)),n.parent&&Fr(n.parent+"_show").length){var i=Fr(n.parent);i.length||(i=ye(n.parent.substr(1))),n.prepend&&(r[0].style.margin="initial"),i[n.prepend?"prepend":"append"](r),Array.isArray(e[n.parent])||(e[n.parent]=[]),e[n.parent].push(n)}}if(n.key){var a,s=!1;Array.isArray(n.key)?(a=n.key[0],n.key.length>1&&(s=n.key[1])):a=n.key,a=String(a);var o=n.fn;if(Fr.each(a.split("/"),function(e,t){Fr(document).bind("keydown",t,function(e){return o(),s&&e.preventDefault(),!1})}),n.sel&&!n.hidekey&&r.attr("title")){var l=r.attr("title").split("[")[0]+" ("+a+")";pn[a]=n.sel,r.parents("#main_menu").length||r.attr("title",l)}}return!0}),_e(e),Fr(".attr_changer, #image_url").bind("keydown","return",function(e){Fr(this).change(),e.preventDefault()}),Fr(window).bind("keydown","tab",function(e){"canvas"===E&&(e.preventDefault(),pt())}).bind("keydown","shift+tab",function(e){"canvas"===E&&(e.preventDefault(),ft())}),Fr("#tool_zoom").dblclick(Xe)},setTitles:function(){Fr.each(pn,function(e,t){var n=Fr(t).parents("#main_menu").length;Fr(t).each(function(){var t;t=n?Fr(this).text().split(" [")[0]:this.title.split(" [")[0];var r="";Fr.each(e.split("/"),function(e,t){var n=t.split("+"),i="";n.length>1&&(i=n[0]+"+",t=n[1]),r+=(e?"/":"")+i+(Wr["key_"+t]||t)}),n?this.lastChild.textContent=t+" ["+r+"]":this.title=t+" ["+r+"]"})})},getButtonData:function(e){return Object.values(hn).find(function(t){return t.sel===e})}});Ur.ready(function(){var e=ei.initTool,t=Fr("#tools_left, #svg_editor .tools_flyout"),n=t.find("#tool_"+e),r=t.find("#"+e);(n.length?n:r.length?r:Fr("#tool_select")).click().mouseup(),ei.wireframe&&Fr("#tool_wireframe").click(),ei.showlayers&&dn(),Fr("#rulers").toggle(Boolean(ei.showRulers)),ei.showRulers&&(Fr("#show_rulers")[0].checked=!0),ei.baseUnit&&Fr("#base_unit").val(ei.baseUnit),ei.gridSnapping&&(Fr("#grid_snapping_on")[0].checked=!0),ei.snappingStep&&Fr("#grid_snapping_step").val(ei.snappingStep),ei.gridColor&&Fr("#grid_color").val(ei.gridColor)}),Fr("#rect_rx").SpinButton({min:0,max:1e3,stateObj:i,callback:function(e){Hr.setRectRadius(e.value)}}),Fr("#stroke_width").SpinButton({min:0,max:99,smallStep:.1,stateObj:i,callback:function(e){var t=e.value;0===t&&V&&["line","polyline"].includes(V.nodeName)&&(t=e.value=1),Hr.setStrokeWidth(t)}}),Fr("#angle").SpinButton({min:-180,max:180,step:5,stateObj:i,callback:function(e){Hr.setRotationAngle(e.value),Fr("#tool_reorient").toggleClass("disabled",0===parseInt(e.value))}}),Fr("#font_size").SpinButton({min:.001,stepfunc:function(e,t){var n=Number(e.value),r=n+t,i=r>=n;return 0===t?n:n>=24?i?Math.round(1.1*n):Math.round(n/1.1):n<=1?i?2*n:n/2:r},stateObj:i,callback:function(e){Hr.setFontSize(e.value)}}),Fr("#group_opacity").SpinButton({min:0,max:100,step:5,stateObj:i,callback:Ce}),Fr("#blur").SpinButton({min:0,max:10,step:.1,stateObj:i,callback:Ae}),Fr("#zoom").SpinButton({min:.001,max:1e4,step:50,stepfunc:function(e,t){var n=Number(e.value);if(0===n)return 100;var r=n+t;return 0===t?n:n>=100?r:r>=n?2*n:n/2},stateObj:i,callback:ce}).val(100*Hr.getZoom()),Fr("#workarea").contextMenu({menu:"cmenu_canvas",inSpeed:0},function(e,t,n){switch(e){case"delete":Ke();break;case"cut":Ze();break;case"copy":Je();break;case"paste":Hr.pasteElements();break;case"paste_in_place":Hr.pasteElements("in_place");break;case"group":case"group_elements":Hr.groupSelectedElements();break;case"ungroup":Hr.ungroupSelectedElement();break;case"move_front":tt();break;case"move_up":rt("Up");break;case"move_down":rt("Down");break;case"move_back":nt();break;default:Boolean(_n[e])&&function(e){return _n[e].action}(e).call()}});var yn=function(e,t,n){switch(e){case"dupe":!function(){rn.apply(this,arguments)}();break;case"delete":nn();break;case"merge_down":Fr("#layerlist tr.layersel").index()!==Hr.getCurrentDrawing().getNumLayers()-1&&(Hr.mergeLayer(),ne(),L());break;case"merge_all":Hr.mergeAllLayers(),ne(),L()}};function vn(){var e;try{e=localStorage.getItem("svgedit_clipboard")}catch(e){}x[(e?"en":"dis")+"ableContextMenuItems"]("#paste,#paste_in_place")}if(Fr("#layerlist").contextMenu({menu:"cmenu_layers",inSpeed:0},yn),Fr("#layer_moreopts").contextMenu({menu:"cmenu_layers",inSpeed:0,allowLeft:!0},yn),Fr(".contextMenu li").mousedown(function(e){e.preventDefault()}),Fr("#cmenu_canvas li").disableContextMenu(),x.enableContextMenuItems("#delete,#cut,#copy"),vn(),window.addEventListener("storage",function(e){"svgedit_clipboard"===e.key&&vn()}),window.addEventListener("beforeunload",function(e){return 0===_.getUndoStackSize()&&(Ur.showSaveWarning=!1),!(!ei.no_save_warning&&Ur.showSaveWarning)||(e.returnValue=Wr.notification.unsavedChanges,Wr.notification.unsavedChanges)}),Ur.canvas.getUIStrings=function(){return Wr},Ur.openPrep=function(){return Fr("#main_menu").hide(),0===_.getUndoStackSize()||Fr.confirm(Wr.notification.QwantToOpen)},window.FileReader){var xn=function(e){Fr.process_cancel(Wr.notification.loadingImage),e.stopPropagation(),e.preventDefault(),Fr("#workarea").removeAttr("style"),Fr("#main_menu").hide();var t,n="drop"===e.type?e.dataTransfer.files[0]:this.files[0];n?n.type.includes("image")&&(n.type.includes("svg")?((t=new FileReader).onloadend=function(e){var t=Hr.importSvgString(e.target.result,!0);Hr.ungroupSelectedElement(),Hr.ungroupSelectedElement(),Hr.groupSelectedElements(),Hr.alignSelectedElements("m","page"),Hr.alignSelectedElements("c","page"),Hr.selectOnly([t]),Fr("#dialog_box").hide()},t.readAsText(n)):((t=new FileReader).onloadend=function(e){var t=e.target.result,n=100,r=100,i=new Image;i.style.opacity=0,i.addEventListener("load",function(){var e,a,s;n=i.offsetWidth||i.naturalWidth||i.width,r=i.offsetHeight||i.naturalHeight||i.height,e=n,a=r,s=Hr.addSVGElementFromJson({element:"image",attr:{x:0,y:0,width:e,height:a,id:Hr.getNextId(),style:"pointer-events:inherit"}}),Hr.setHref(s,t),Hr.selectOnly([s]),Hr.alignSelectedElements("m","page"),Hr.alignSelectedElements("c","page"),ne(),Fr("#dialog_box").hide()}),i.src=t},t.readAsDataURL(n))):Fr("#dialog_box").hide()};b[0].addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),b[0].addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()}),b[0].addEventListener("dragleave",function(e){e.stopPropagation(),e.preventDefault()}),b[0].addEventListener("drop",xn);var wn=Fr('<input type="file">').click(y()(m.a.mark(function e(){var t;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ur.openPrep();case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:Hr.clear(),1===this.files.length&&(Fr.process_cancel(Wr.notification.loadingImage),(t=new FileReader).onloadend=function(){var e=y()(m.a.mark(function e(t){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ti(t.target.result);case 2:ee();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.readAsText(this.files[0]));case 7:case"end":return e.stop()}},e,this)})));Fr("#tool_open").show().prepend(wn);var Sn=Fr('<input type="file">').change(xn);Fr("#tool_import").show().prepend(Sn)}ee(!0);var Cn=[],An=Ur.setLang=function(){var e=y()(m.a.mark(function e(t,n){var r,i,a,s=this;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Ur.langChanged=!0,Fr.pref("lang",t),Fr("#lang_select").val(t),n){e.next=5;break}return e.abrupt("return");case 5:if(Fr.extend(Wr,n),r=Fr("#layerlist tr.layersel td.layername").text(),i=r===Wr.common.layer+" 1",Hr.setUiStrings(n),mn.setTitles(),i&&(Hr.renameCurrentLayer(Wr.common.layer+" 1"),L()),!be.length){e.next=17;break}return e.next=14,Promise.all(be.map(function(e){return Cn.push(e.name),e.langReady({lang:t,uiStrings:Wr,importLocale:ri({defaultLang:t,defaultName:e.name})})}));case 14:be.length=0,e.next=18;break;case 17:Cn.forEach(function(e){s.runExtension(e,"langReady",{lang:t,uiStrings:Wr,importLocale:ri({defaultLang:t,defaultName:e})})});case 18:Hr.runExtensions("langChanged",t),fe(),a={"#stroke_color":"#tool_stroke .icon_label, #tool_stroke .color_block","#fill_color":"#tool_fill label, #tool_fill .color_block","#linejoin_miter":"#cur_linejoin","#linecap_butt":"#cur_linecap"},Fr.each(a,function(e,t){Fr(t).attr("title",Fr(e)[0].title)}),Fr("#multiselected_panel div[id^=tool_align]").each(function(){Fr("#tool_pos"+this.id.substr(10))[0].title=this.title});case 23:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}();(e=>{Rr=e})({addLangData:function(e){return Hr.runExtensions("addLangData",function(t){return{lang:e,importLocale:ri({defaultLang:e,defaultName:t})}},!0)},curConfig:ei}),"file:"===document.location.protocol?setTimeout(r,100):r()},Ur.ready=function(e){return new Promise(function(t,n){Qr?t(e()):qr.push([e,t,n])})},Ur.runCallbacks=y()(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all(qr.map(function(e){return(0,u()(e,1)[0])()}));case 3:e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(0),qr.forEach(function(e){(0,u()(e,3)[2])()}),e.t0;case 9:qr.forEach(function(e){(0,u()(e,2)[1])()}),Qr=!0;case 11:case"end":return e.stop()}},e,this,[[0,5]])})),Ur.loadFromString=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).noAlert;Ur.ready(y()(m.a.mark(function n(){return m.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,ti(e,{noAlert:t});case 3:n.next=9;break;case 5:if(n.prev=5,n.t0=n.catch(0),!t){n.next=9;break}throw n.t0;case 9:case"end":return n.stop()}},n,this,[[0,5]])})))},Ur.disableUI=function(e){},Ur.loadFromURL=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.cache,r=t.noAlert;return Ur.ready(function(){return new Promise(function(t,i){Fr.ajax({url:e,dataType:"text",cache:Boolean(n),beforeSend:function(){Fr.process_cancel(Wr.notification.loadingImage)},success:function(e){t(ti(e,{noAlert:r}))},error:function(e,n,a){404!==e.status&&e.responseText?t(ti(e.responseText,{noAlert:r})):r?i(new Error("URLLoadFail")):(Fr.alert(Wr.notification.URLLoadFail+": \n"+a),t())},complete:function(){Fr("#dialog_box").hide()}})})})},Ur.loadFromDataURI=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).noAlert;Ur.ready(function(){var n=!1,r=e.match(/^data:image\/svg\+xml;base64,/);r?n=!0:r=e.match(/^data:image\/svg\+xml(?:;|;utf8)?,/),r&&(r=r[0]);var i=e.slice(r.length);return ti(n?Lt(i):decodeURIComponent(i),{noAlert:t})})},Ur.addExtension=function(e,t,n){if(!Hr)throw new Error("Extension added too early");return Hr.addExtension.call(this,e,t,n)},Ur.ready(function(){yn()});var ii=!1,ai=[];window.addEventListener("message",function(e){var t={data:e.data,origin:e.origin};ii?Hr.call("message",t):ai.push(t)}),y()(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.resolve();case 3:Ur.init(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0);case 9:case"end":return e.stop()}},e,this,[[0,6]])}))();var si=Ur,oi=n(4),li=n(5);n(20);n.d(t,"svgEditor",function(){return si}),si.setConfig({}),si.setConfig({},{allowInitialUserOverride:!0}),si.setConfig({extensions:["ext-overview_window.js","ext-markers.js","ext-connector.js","ext-eyedropper.js","ext-shapes.js","ext-grid.js","ext-polygon.js","ext-star.js","ext-panning.js","ext-storage.js","ext-storage.js","ext-canvas-border.js"],noDefaultExtensions:!0}),si.setConfig({}),si.setConfig({canvas_expansion:3,no_save_warning:!0,imgPath:"themes/basic/svg-editor/images/",langPath:"themes/basic/svg-editor/locale/",extPath:"themes/basic/svg-editor/extensions/",extIconsPath:"themes/basic/svg-editor/extensions/",jGraduatePath:"themes/basic/svg-editor/jgraduate/images/",showRulers:!1,forceStorage:!0}),si.setConfig({lang:window.setLangKey}),si.setConfig({},{allowInitialUserOverride:!0}),$(function(){si.addExtension(oi.default.name,oi.default.init&&oi.default.init.bind(si),{$:$}),si.addExtension(li.default.name,li.default.init&&li.default.init.bind(si),{$:$})})}]);