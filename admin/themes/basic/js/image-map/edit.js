var imageMapAdmin=function(t){var e={};function o(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=2)}([function(t,e){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(e){return"function"==typeof Symbol&&"symbol"===o(Symbol.iterator)?t.exports=i=function(t){return o(t)}:t.exports=i=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":o(t)},i(e)}t.exports=i},function(t,e,o){},function(t,e,o){"use strict";o.r(e);o(1);var i=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i="";return o&&(i+='<div class="popup-heading">'.concat(o,"</div>")),i+='<div class="popup-content pop-mess-cont">'.concat(t,"</div>"),e.length>0&&(i+='<div class="popup-buttons">',e.forEach((function(t,e){i+='<span class="btn '.concat(t.class,'">').concat(t.name,"</span>")})),i+="</div>"),i},n=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{image:"",button:"",uploadUrl:"image-maps/upload",svg:""},e=function(){t.image.css({position:"absolute"});var e=t.image.height(),o=t.image.width();t.image.css({position:""});var i=t.svg.get(0);i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),i.setAttribute("viewBox","0 0 ".concat(o," ").concat(e))};e(),t.image.on("load",e);var o=function(o){t.image.css("display",""),t.image.attr("src","../images/maps/"+o),$(".popup-box-wrap:last").remove(),e(),t.image.on("load",e)};t.button.dropzone({url:t.uploadUrl,previewTemplate:"<span data-dz-name></span>",success:function(t,e){"ok"===(e=(e=JSON.parse(e))[0]).status&&o(e.file),"error"===e.status&&alertMessage(i(e.text)),"choice"===e.status&&(alertMessage(i(e.text,[{name:"ok",class:"btn-ok"},{name:"cancel",class:"btn-cancel"}])),$(".btn-ok").on("click",(function(){o(e.file)})))}})},r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{image:"",button:"",imageMap:"",form:"",saveUrl:"image-maps/save"},e=function(){var e=t.form.serializeArray();e.push({name:"image",value:t.image.attr("src").split("/").slice(-1)[0]}),e.push({name:"map",value:t.imageMap.toJSON()}),$.post(t.saveUrl,e,(function(e){var o=$('input[name="maps_id"]',t.form),n=o.val();o.val(e.maps_id),n!==e.maps_id&&window.history.pushState("","","image-maps/edit?maps_id="+e.maps_id),console.log(e),"ok"===e.status&&(alertMessage(i(e.text)),setTimeout((function(){$(".popup-box-wrap:last").remove()}),1e3))}),"json")};t.button.on("click",e),t.form.on("submit",e)},s=o(0),a=o.n(s),c=function(t){var e=$.extend({url:"index/search-suggest",suggestWrapClass:"search-product",suggestClass:"suggest",suggestItem:"a",itemTextBox:".td_name",suggestItemClick:function(t,e){}},t);return this.each((function(){var t=$(this),o=$('<div class="'.concat(e.suggestWrapClass,'"></div>')),i=$('<div class="'.concat(e.suggestClass,'"></div>'));t.after(o),o.append(i),i.hide(),t.on("keyup",(function(o){$.get(e.url,{keywords:t.val(),no_click:!0},(function(t){i.show().html(t)}))})),i.on("click",e.suggestItem,(function(o){return o.preventDefault(),t.val($(e.itemTextBox,this).text()),i.hide().html(""),e.suggestItemClick(t,$(this)),t.trigger("suggestItemClick",[t,$(this)]),!1})),t.on("blur",(function(){setTimeout((function(){i.hide()}),300)}))}))},d=function(t){var e=$.extend({url:"categories/all-list",suggestWrapClass:"search-category",suggestClass:"suggest",suggestItem:".item",itemTextBox:".name",suggestItemClick:function(t,e){}},t);return this.each((function(){var t=$(this),o=$('<div class="'.concat(e.suggestWrapClass,'"></div>')),i=$('<div class="'.concat(e.suggestClass,'"></div>'));t.after(o),o.append(i),i.hide(),t.on("focus",(function(o){$.get(e.url,{keywords:t.val(),no_click:!0},(function(t){for(var e in t)if(t.hasOwnProperty(e)){var o='<div class="item" data-id="'.concat(t[e].id,'">\n                                        <div class="name">').concat(t[e].text,'</div>\n                                        <div class="sub-categories" id="sc-').concat(t[e].id,'"></div>\n                                    </div>');0==t[e].parent_id?i.append(o):$("#sc-"+t[e].parent_id,i).append(o)}i.show()}),"json")})),t.on("keyup",(function(e){var o="("+t.val()+")",n=new RegExp(o,"gi");$(".item",i).each((function(){var t=$("> .name",this),e=t.text().trim(),o=e.replace(n,'<span class="keyword">$1</span>');t.html(o),e.length!==o.length?($(this).show(),$(this).parents(".item").show()):$(this).hide()}))})),i.on("click",e.suggestItem,(function(o){return o.preventDefault(),t.val($(e.itemTextBox,this).text()),i.hide().html(""),e.suggestItemClick(t,$(this)),t.trigger("suggestItemClick",[t,$(this)]),!1})),t.on("blur",(function(){setTimeout((function(){i.hide()}),300)}))}))},l=function(t){var e=$.extend({url:"information_manager/all-list",suggestWrapClass:"search-category",suggestClass:"suggest",suggestItem:".item",itemTextBox:".name",suggestItemClick:function(t,e){}},t);return this.each((function(){var t=$(this),o=$('<div class="'.concat(e.suggestWrapClass,'"></div>')),i=$('<div class="'.concat(e.suggestClass,'"></div>'));t.after(o),o.append(i),i.hide(),t.on("focus",(function(o){return o.preventDefault(),$.get(e.url,{keywords:t.val(),no_click:!0},(function(t){for(var e in t)if(t.hasOwnProperty(e)){var o='<div class="item" data-id="'.concat(t[e].id,'">\n                                        <div class="name">').concat(t[e].text,"</div>\n                                    </div>");i.append(o)}i.show()}),"json"),!1})),t.on("keyup",(function(e){var o="("+t.val()+")",n=new RegExp(o,"gi");$(".item",i).each((function(){var t=$("> .name",this),e=t.text().trim(),o=e.replace(n,'<span class="keyword">$1</span>');t.html(o),e.length!==o.length?$(this).show():$(this).hide()}))})),i.on("click",e.suggestItem,(function(o){return o.preventDefault(),t.val($(e.itemTextBox,this).text()),i.hide().html(""),e.suggestItemClick(t,$(this)),t.trigger("suggestItemClick",[t,$(this)]),!1})),t.on("blur",(function(){setTimeout((function(){i.hide()}),300)}))}))};$.fn.searchProduct=c,$.fn.searchCategory=d,$.fn.searchInfo=l,$.fn.cloneRow=function(){return this.each((function(){var t=this;$(this).addClass("cloned").append('<span class="remove"></span>'),$("input, select, textarea",this).each((function(){this.addEventListener("keydown",(function(t){t.stopPropagation()}),!1),$(this).val("")})),$(".remove",this).on("click",(function(){return $(t).remove()}))}))};var u=function(t,e,o){var i=$("#svg-item-attributes"),n=i.html();$('<a href="#svg-item-attributes"></a>').popUp({close:function(){$(".popup-box").on("click",".btn-cancel, .pop-up-close",(function(){return i.html(n),o(),!1}))},box_class:"widget-settings",loaded:function(){i.html("");var o=$(".popup-box form");$("input, select, textarea",o).each((function(){var e=$(this).attr("name"),i=t._attributes[$(this).attr("name")];if("object"===a()(i)){var n=$(".r-"+e.replace(/\[[0-9]+\]/,""));if(n.length!==i.length)for(var r=i.length-n.length,s=0;s<r;s++)n.after(n.clone().cloneRow());$('*[name="'+e+'"]',o).each((function(t){this.addEventListener("keydown",(function(t){t.stopPropagation()}),!1),"string"==typeof i[t]&&(i[t]=i[t].replace(/\&rsquo\;/g,"'").replace(/\&rdquo\;/g,'"')),$(this).val(i[t])}))}else this.addEventListener("keydown",(function(t){t.stopPropagation()}),!1),"string"==typeof i&&(i=i.replace(/\&rsquo\;/g,"'").replace(/\&rdquo\;/g,'"')),$(this).val(i)})),o.on("submit",(function(t){return t.preventDefault(),e(),!1})),$(".popup-tabs-wrap").addClass("tabbable tabbable-custom box-style-tab"),$(".popup-tabs").addClass("nav nav-tabs nav-tabs-scroll style-tabs"),$(".popup-tab-content").addClass("tab-content"),$(".popup-tab-pane").addClass("tab-pane"),$(".nav-tabs-scroll").scrollingTabs(),$(".nav-tabs a").on("click",(function(){$(".popup-tab-pane").removeClass("active");var t=$(this).attr("href");$(""+t).addClass("active")}));var n=$(".link-to-page"),r=$(".link-default"),s=$(".link-to-product"),c=$(".link-to-category"),d=$(".link-to-info"),l=$(".link-to-brand"),u=$(".link-to-delivery"),h=$(".link-to-common"),p=function(){switch($(this).val()||$(this).val("link-to-product"),n.hide(),$(this).val()){case"link-to-category":c.show();break;case"link-to-info":d.show();break;case"link-default":r.show();break;case"link-to-brand":l.show();break;case"link-to-delivery":u.show();break;case"link-to-common":h.show();break;case"link-to-product":s.show()}};$('select[name="link"]').each(p).on("change",p),r.show(),h.show(),setTimeout((function(){$('select[name="link"]').each(p)}),100),$(".product-name").searchProduct({suggestItemClick:function(t,e){$('input[name="products_id"]',t.closest(".row")).val(e.data("id"))}}),$(".category-name").searchCategory({suggestItemClick:function(t,e){$('input[name="categories_id"]',t.closest(".row")).val(e.data("id"))}}),$(".information-name").searchInfo({suggestItemClick:function(t,e){$('input[name="information_id"]',t.closest(".row")).val(e.data("id"))}}),$(".brand-name").searchInfo({url:"categories/brands-list",suggestItemClick:function(t,e){$('input[name="brand_id"]',t.closest(".row")).val(e.data("id"))}}),$(".delivery-name").searchCategory({url:"seo-delivery-location/all-list",suggestItemClick:function(t,e){$('input[name="delivery_id"]',t.closest(".row")).val(e.data("id"))}}),$(".btn-add-more").on("click",(function(){var t=$("."+$(this).data("repeat")+":last"),e=t.clone().cloneRow();$(".product-name",e).searchProduct({suggestItemClick:function(t,o){$('input[name="products_id"]',e).val(o.data("id"))}}),$(".category-name",e).searchCategory({suggestItemClick:function(t,o){$('input[name="categories_id"]',e).val(o.data("id"))}}),$(".information-name",e).searchInfo({suggestItemClick:function(t,o){$('input[name="information_id"]',e).val(o.data("id"))}}),$(".brand-name",e).searchInfo({suggestItemClick:function(t,o){$('input[name="brand_id"]',e).val(o.data("id"))}}),$(".delivery-name",e).searchCategory({url:"seo-delivery-location/all-list",suggestItemClick:function(t,o){$('input[name="delivery_id"]',e).val(o.data("id"))}}),t.after(e)}))}}).click(),$(window).on("popupUnload",(function(){n&&i.html(n)}))},h=function(){var t,e,o={getOffset:function(t){var e=t.getBoundingClientRect();return{x:Math.round(e.left+window.pageXOffset),y:Math.round(e.top+window.pageYOffset)}},getRightCoords:function(t,e){return{x:t-$("#image").offset().left,y:e-$("#image").offset().top}},id:function(t){return document.getElementById(t)},hide:function(t){return t.style.display="none",this},show:function(t){return t.style.display="block",this},encode:function(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")},foreach:function(t,e){for(var o=0,i=t.length;o<i;o++)e(t[o],o)},foreachReverse:function(t,e){for(var o=t.length-1;o>=0;o--)e(t[o],o)},debug:(e=document.getElementById("debug"),function(){e.innerHTML=[].join.call(arguments," ")}),stopEvent:function(t){return t.stopPropagation(),t.preventDefault(),this},extend:function(t,e){var o={};for(var i in t)t.hasOwnProperty(i)&&(o[i]=e[i]?e[i]:t[i]);return o},inherits:(t=function(){},function(e,o){t.prototype=o.prototype,e.prototype=new t,e.prototype.constructor=e})},i=function(){var t={wrapper:o.id("wrapper"),svg:o.id("svg"),img:o.id("img"),container:o.id("image"),map:null},e={offset:{x:0,y:0},appMode:null,currentType:null,editType:null,newArea:null,selectedArea:null,areas:[],events:[],isDraw:!1,image:{src:null,filename:null,width:0,height:0}},r={F1:112,ESC:27,TOP:38,BOTTOM:40,LEFT:37,RIGHT:39,DELETE:46,I:73,S:83,C:67};function a(){e.offset=o.getOffset(t.container)}window.addEventListener("resize",a,!1),t.container.addEventListener("mousedown",(function(t){t.preventDefault()}),!1),t.img.addEventListener("dragstart",(function(t){t.preventDefault()}),!1);var c,d=(c=o.id("coords"),{set:function(t){c.innerHTML="x: "+t.x+", y: "+t.y},empty:function(){c.innerHTML=""}});t.container.addEventListener("mousemove",(function(t){d.set(o.getRightCoords(t.pageX,t.pageY))}),!1),t.container.addEventListener("mouseleave",(function(){d.empty()}),!1),t.container.addEventListener("mousedown",(function(t){if("editing"===e.appMode)if("g"===t.target.parentNode.tagName)if(m.unload(),e.selectedArea=t.target.parentNode.obj,i.deselectAll(),e.selectedArea.select(),e.selectedArea.editingStartPoint={x:t.pageX,y:t.pageY},t.target.classList.contains("helper")){var o=t.target;e.editType=o.action,o.n>=0&&(e.selectedArea.selected_point=o.n),i.addEvent(i.domElements.container,"mousemove",e.selectedArea.onProcessEditing.bind(e.selectedArea)).addEvent(i.domElements.container,"mouseup",e.selectedArea.onStopEditing.bind(e.selectedArea))}else"rect"!==t.target.tagName&&"circle"!==t.target.tagName&&"polygon"!==t.target.tagName||(e.editType="move",i.addEvent(i.domElements.container,"mousemove",e.selectedArea.onProcessEditing.bind(e.selectedArea)).addEvent(i.domElements.container,"mouseup",e.selectedArea.onStopEditing.bind(e.selectedArea)));else i.deselectAll(),m.unload()}),!1),t.container.addEventListener("click",(function(t){"drawing"===e.appMode&&!e.isDraw&&e.currentType&&(f.hide(),i.setIsDraw(!0),e.newArea=s.CONSTRUCTORS[e.currentType].createAndStartDrawing(o.getRightCoords(t.pageX,t.pageY)))}),!1),t.container.addEventListener("dblclick",(function(t){"editing"===e.appMode&&("rect"!==t.target.tagName&&"circle"!==t.target.tagName&&"polygon"!==t.target.tagName||(e.selectedArea=t.target.parentNode.obj,m.load(e.selectedArea,t.pageX,t.pageY)))}),!1),document.addEventListener("keydown",(function(t){var o=t.ctrlKey||t.metaKey;switch(t.keyCode){case r.F1:g.show(),t.preventDefault();break;case r.ESC:g.hide(),e.isDraw?(e.isDraw=!1,e.newArea.remove(),e.areas.pop(),i.removeAllEvents()):"editing"===e.appMode&&(e.selectedArea.redraw(),i.removeAllEvents());break;case r.TOP:"editing"===e.appMode&&e.selectedArea&&(e.selectedArea.move(0,-1),t.preventDefault());break;case r.BOTTOM:"editing"===e.appMode&&e.selectedArea&&(e.selectedArea.move(0,1),t.preventDefault());break;case r.LEFT:"editing"===e.appMode&&e.selectedArea&&(e.selectedArea.move(-1,0),t.preventDefault());break;case r.RIGHT:"editing"===e.appMode&&e.selectedArea&&(e.selectedArea.move(1,0),t.preventDefault());break;case r.DELETE:"editing"===e.appMode&&e.selectedArea&&(i.removeObject(e.selectedArea),e.selectedArea=null,m.unload());break;case r.I:if("editing"===e.appMode&&e.selectedArea){var n=e.selectedArea.getCoordsForDisplayingInfo();m.load(e.selectedArea,n.x+i.getOffset("x"),n.y+i.getOffset("y"))}break;case r.S:o&&i.saveInLocalStorage();break;case r.C:"editing"===e.appMode&&e.selectedArea&&o&&(e.selectedArea=s.copy(e.selectedArea))}}),!1);var l=function(){var t={areas:[],img:e.image.src};return o.foreach(e.areas,(function(e){t.areas.push(e.toJSON())})),JSON.stringify(t)},u=function(t){var e=JSON.parse(t);o.foreach(e.areas,(function(t){s.fromJSON(t)}))},h={save:function(){var t=l();window.localStorage.setItem("ImageMap",t),console.info("Editor "+t+" saved"),alert("Saved")},restore:function(){u(window.localStorage.getItem("ImageMap"))}};return{toJSON:function(){var t={areas:[],img:e.image.src};return o.foreach(e.areas,(function(e){t.areas.push(e.toJSON())})),JSON.stringify(t)},domElements:t,saveInLocalStorage:h.save,loadFromLocalStorage:h.restore,hide:function(){return this},show:function(){return this},recalcOffsetValues:function(){return a(),this},setDimensions:function(e,o){return t.svg.setAttribute("width",e),t.svg.setAttribute("height",o),t.container.style.width=e+"px",t.container.style.height=o+"px",this},preview:(t.img.setAttribute("usemap","#map"),t.map=document.createElement("map"),t.map.setAttribute("name","map"),t.container.appendChild(t.map),function(){return m.unload(),i.setShape(null),o.hide(t.svg),t.map.innerHTML=i.getHTMLCode(),f.print(),this}),hidePreview:function(){return o.show(t.svg),t.map.innerHTML="",this},addNodeToSvg:function(e){return t.svg.appendChild(e),this},removeNodeFromSvg:function(e){return t.svg.removeChild(e),this},getOffset:function(t){switch(t){case"x":case"y":return e.offset[t]}},clear:function(){for(e.areas.length=0;t.svg.childNodes[0];)t.svg.removeChild(t.svg.childNodes[0]);return f.hide(),m.unload(),this},removeObject:function(t){return o.foreach(e.areas,(function(o,i){o===t&&e.areas.splice(i,1)})),t.remove(),this},deselectAll:function(){return o.foreach(e.areas,(function(t){t.deselect()})),this},getIsDraw:function(){return e.isDraw},setIsDraw:function(t){return e.isDraw=t,this},setMode:function(t){return e.appMode=t,this},getMode:function(){return e.appMode},setShape:function(t){return e.currentType=t,this},getShape:function(){return e.currentType},addObject:function(t){return e.areas.push(t),this},getNewArea:function(){return e.newArea},resetNewArea:function(){return e.newArea=null,this},getSelectedArea:function(){return e.selectedArea},setSelectedArea:function(t){return e.selectedArea=t,this},getEditType:function(){return e.editType},setFilename:function(t){return e.image.filename=t,this},setEditClass:function(){return t.container.classList.remove("draw"),t.container.classList.add("edit"),this},setDrawClass:function(){return t.container.classList.remove("edit"),t.container.classList.add("draw"),this},setDefaultClass:function(){return t.container.classList.remove("edit"),t.container.classList.remove("draw"),this},addEvent:function(t,o,i){return e.events.push(new n(t,o,i)),this},removeAllEvents:function(){return o.foreach(e.events,(function(t){t.remove()})),e.events.length=0,this},getHTMLCode:function(t){var i="";if(t){if(!e.areas.length)return"0 objects";i+=o.encode('<img src="'+e.image.filename+'" alt="" usemap="#map" />')+"<br />"+o.encode('<map name="map">')+"<br />",o.foreachReverse(e.areas,(function(t){i+="&nbsp;&nbsp;&nbsp;&nbsp;"+o.encode(t.toHTMLMapElementString())+"<br />"})),i+=o.encode("</map>")}else o.foreachReverse(e.areas,(function(t){i+=t.toHTMLMapElementString()}));return i}}}();function n(t,e,o){this.target=t,this.eventType=e,this.func=o,t.addEventListener(e,o,!1)}function r(t,e,o,i){this._el=document.createElementNS(s.SVG_NS,"rect"),this._el.classList.add(r.CLASS_NAME),this._el.setAttribute("height",r.SIZE),this._el.setAttribute("width",r.SIZE),this._el.setAttribute("x",e+r.OFFSET),this._el.setAttribute("y",o+r.OFFSET),t.appendChild(this._el),this._el.action=i,this._el.classList.add(r.ACTIONS_TO_CURSORS[i])}function s(t,e,o){if(this.constructor===s)throw new Error("This is abstract class");this._type=t,this._attributes={},o&&this.setInfoAttributes(o),this._coords=e,this._groupEl=document.createElementNS(s.SVG_NS,"g"),i.addNodeToSvg(this._groupEl),this._groupEl.obj=this,this._el=null,this._helpers={},i.addObject(this)}function c(t,e){s.call(this,"rectangle",t,e),this._coords={x:t.x||0,y:t.y||0,width:t.width||0,height:t.height||0},this._el=document.createElementNS(s.SVG_NS,"rect"),this._groupEl.appendChild(this._el);var o=t.x-this._coords.width/2,i=t.y-this._coords.height/2;this._helpers={center:new r(this._groupEl,o,i,"move"),top:new r(this._groupEl,o,i,"editTop"),bottom:new r(this._groupEl,o,i,"editBottom"),left:new r(this._groupEl,o,i,"editLeft"),right:new r(this._groupEl,o,i,"editRight"),topLeft:new r(this._groupEl,o,i,"editTopLeft"),topRight:new r(this._groupEl,o,i,"editTopRight"),bottomLeft:new r(this._groupEl,o,i,"editBottomLeft"),bottomRight:new r(this._groupEl,o,i,"editBottomRight")},this.redraw()}function d(t,e){s.call(this,"circle",t,e),this._coords={cx:t.cx||0,cy:t.cy||0,radius:t.radius||0},this._el=document.createElementNS(s.SVG_NS,"circle"),this._groupEl.appendChild(this._el),this.helpers={center:new r(this._groupEl,t.cx,t.cy,"move"),top:new r(this._groupEl,t.cx,t.cy,"editTop"),bottom:new r(this._groupEl,t.cx,t.cy,"editBottom"),left:new r(this._groupEl,t.cx,t.cy,"editLeft"),right:new r(this._groupEl,t.cx,t.cy,"editRight")},this.redraw()}function l(t,e){s.call(this,"polygon",t,e),this._coords={points:t.points||[{x:0,y:0}],isOpened:t.isOpened||!1},this._el=document.createElementNS(s.SVG_NS,this._coords.isOpened?"polyline":"polygon"),this._groupEl.appendChild(this._el),this._helpers={points:[]};for(var o=0,i=this._coords.points.length;o<i;o++)this._helpers.points.push(new r(this._groupEl,this._coords.points[o].x,this._coords.points[o].y,"movePoint").setId(o));this._selectedPoint=-1,this.redraw()}n.prototype.remove=function(){this.target.removeEventListener(this.eventType,this.func,!1)},r.SIZE=5,r.OFFSET=-Math.ceil(r.SIZE/2),r.CLASS_NAME="helper",r.ACTIONS_TO_CURSORS={move:"move",editLeft:"e-resize",editRight:"w-resize",editTop:"n-resize",editBottom:"s-resize",editTopLeft:"nw-resize",editTopRight:"ne-resize",editBottomLeft:"sw-resize",editBottomRight:"se-resize",movePoint:"pointer"},r.prototype.setCoords=function(t,e){return this._el.setAttribute("x",t+r.OFFSET),this._el.setAttribute("y",e+r.OFFSET),this},r.prototype.setId=function(t){return this._el.n=t,this},s.SVG_NS="http://www.w3.org/2000/svg",s.CLASS_NAMES={SELECTED:"selected",WITH_HREF:"with_href"},s.CONSTRUCTORS={rectangle:c,circle:d,polygon:l},s.REGEXP={AREA:/<area(?=.*? shape="(rect|circle|poly)")(?=.*? coords="([\d ,]+?)")[\s\S]*?>/gim,HREF:/ href="([\S\s]+?)"/,ALT:/ alt="([\S\s]+?)"/,TITLE:/ title="([\S\s]+?)"/,DELIMETER:/ ?, ?/},s.HTML_NAMES_TO_AREA_NAMES={rect:"rectangle",circle:"circle",poly:"polygon"},s.ATTRIBUTES_NAMES=["HREF","ALT","TITLE"],s.prototype.ABSTRACT_METHOD=function(){throw new Error("This is abstract method")},s.prototype.setSVGCoords=s.prototype.setCoords=s.prototype.dynamicDraw=s.prototype.onProcessDrawing=s.prototype.onStopDrawing=s.prototype.edit=s.prototype.dynamicEdit=s.prototype.onProcessEditing=s.prototype.onStopEditing=s.prototype.toString=s.prototype.toHTMLMapElementString=s.prototype.getCoordsForDisplayingInfo=s.prototype.ABSTRACT_METHOD,s.prototype.redraw=function(t){return this.setSVGCoords(t||this._coords),this},s.prototype.remove=function(){i.removeNodeFromSvg(this._groupEl)},s.prototype.move=function(t,e){return this.setCoords(this.edit("move",t,e)).redraw(),this},s.prototype.select=function(){return this._el.classList.add(s.CLASS_NAMES.SELECTED),console.info(this.toString()+" is selected now"),this},s.prototype.deselect=function(){return this._el.classList.remove(s.CLASS_NAMES.SELECTED),this},s.prototype.setStyleOfElementWithHref=function(){return this._el.classList.add(s.CLASS_NAMES.WITH_HREF),this},s.prototype.unsetStyleOfElementWithHref=function(){return this._el.classList.remove(s.CLASS_NAMES.WITH_HREF),this},s.prototype.setInfoAttributes=function(t){var e=this;$.each(t,(function(t,o){e._attributes[t]=o}))},s.prototype.toJSON=function(){return{type:this._type,coords:this._coords,attributes:this._attributes}},s.fromJSON=function(t){var e=s.CONSTRUCTORS[t.type];if(!e)throw new Error("This area type is not valid");if(!e.testCoords(t.coords))throw new Error("This coords is not valid for "+t.type);i.setIsDraw(!0);var o=new e(t.coords,t.attributes);return i.setIsDraw(!1).resetNewArea(),o},s.createAreasFromHTMLOfMap=function(t){if(!t)return!1;for(;;){var e=s.REGEXP.AREA.exec(t);if(!e)break;var o=e[0],i=e[1],n=e[2].split(s.REGEXP.DELIMETER),r={};s.ATTRIBUTES_NAMES.forEach((function(t,e){var i=s.REGEXP[t].exec(o);i&&(r[name]=i[1])})),n=n.map((function(t){return Number(t)})),i=s.HTML_NAMES_TO_AREA_NAMES[i],s.fromJSON({type:i,coords:s.CONSTRUCTORS[i].getCoordsFromHTMLArray(n),attributes:r})}return Boolean(o)},s.copy=function(t){return s.fromJSON(t.toJSON()).move(10,10).select()},o.inherits(c,s),c.prototype.setSVGCoords=function(t){this._el.setAttribute("x",t.x),this._el.setAttribute("y",t.y),this._el.setAttribute("width",t.width),this._el.setAttribute("height",t.height);var e=t.y,o=t.y+t.height/2,i=t.y+t.height,n=t.x,r=t.x+t.width/2,s=t.x+t.width;return this._helpers.center.setCoords(r,o),this._helpers.top.setCoords(r,e),this._helpers.bottom.setCoords(r,i),this._helpers.left.setCoords(n,o),this._helpers.right.setCoords(s,o),this._helpers.topLeft.setCoords(n,e),this._helpers.topRight.setCoords(s,e),this._helpers.bottomLeft.setCoords(n,i),this._helpers.bottomRight.setCoords(s,i),this},c.prototype.setCoords=function(t){return this._coords.x=t.x,this._coords.y=t.y,this._coords.width=t.width,this._coords.height=t.height,this},c.prototype.dynamicDraw=function(t,e,o){var i={x:this._coords.x,y:this._coords.y,width:t-this._coords.x,height:e-this._coords.y};return o&&(i=c.getSquareCoords(i)),i=c.getNormalizedCoords(i),this.redraw(i),i},c.prototype.onProcessDrawing=function(t){var e=o.getRightCoords(t.pageX,t.pageY);this.dynamicDraw(e.x,e.y,t.shiftKey)},c.prototype.onStopDrawing=function(t){var e=o.getRightCoords(t.pageX,t.pageY);this.setCoords(this.dynamicDraw(e.x,e.y,t.shiftKey)).deselect(),i.removeAllEvents().setIsDraw(!1).resetNewArea()},c.prototype.edit=function(t,e,o){var i=Object.create(this._coords);switch(t){case"move":i.x+=e,i.y+=o;break;case"editLeft":i.x+=e,i.width-=e;break;case"editRight":i.width+=e;break;case"editTop":i.y+=o,i.height-=o;break;case"editBottom":i.height+=o;break;case"editTopLeft":i.x+=e,i.y+=o,i.width-=e,i.height-=o;break;case"editTopRight":i.y+=o,i.width+=e,i.height-=o;break;case"editBottomLeft":i.x+=e,i.width-=e,i.height+=o;break;case"editBottomRight":i.width+=e,i.height+=o}return i},c.prototype.dynamicEdit=function(t,e){return t=c.getNormalizedCoords(t),e&&(t=c.getSavedProportionsCoords(t)),this.redraw(t),t},c.prototype.onProcessEditing=function(t){return this.dynamicEdit(this.edit(i.getEditType(),t.pageX-this.editingStartPoint.x,t.pageY-this.editingStartPoint.y),t.shiftKey)},c.prototype.onStopEditing=function(t){this.setCoords(this.onProcessEditing(t)),i.removeAllEvents()},c.prototype.toString=function(){return"Rectangle {x: "+this._coords.x+", y: "+this._coords.y+", width: "+this._coords.width+", height: "+this._coords.height+"}"},c.prototype.toHTMLMapElementString=function(){var t=this._coords.x+this._coords.width,e=this._coords.y+this._coords.height;return'<area shape="rect" coords="'+this._coords.x+", "+this._coords.y+", "+t+", "+e+'"'+(this._attributes.href?' href="'+this._attributes.href+'"':"")+(this._attributes.alt?' alt="'+this._attributes.alt+'"':"")+(this._attributes.title?' title="'+this._attributes.title+'"':"")+" />"},c.prototype.getCoordsForDisplayingInfo=function(){return{x:this._coords.x,y:this._coords.y}},c.testCoords=function(t){return t.x&&t.y&&t.width&&t.height},c.testHTMLCoords=function(t){return 4===t.length},c.getCoordsFromHTMLArray=function(t){if(!c.testHTMLCoords(t))throw new Error("This html-coordinates is not valid for rectangle");return{x:t[0],y:t[1],width:t[2]-t[0],height:t[3]-t[1]}},c.getNormalizedCoords=function(t){return t.width<0&&(t.x+=t.width,t.width=Math.abs(t.width)),t.height<0&&(t.y+=t.height,t.height=Math.abs(t.height)),t},c.getSquareCoords=function(t){var e=Math.abs(t.width),o=Math.abs(t.height);return e>o?t.width=t.width>0?o:-o:t.height=t.height>0?e:-e,t},c.getSavedProportionsCoords=function(t,e){var o=t.width/t.height;return e.width/e.height>o?t.width=Math.round(t.height*o):t.height=Math.round(t.width/o),t},c.createAndStartDrawing=function(t){var e=new c({x:t.x,y:t.y,width:0,height:0});return i.addEvent(i.domElements.container,"mousemove",e.onProcessDrawing.bind(e)).addEvent(i.domElements.container,"click",e.onStopDrawing.bind(e)),e},o.inherits(d,s),d.prototype.setSVGCoords=function(t){return this._el.setAttribute("cx",t.cx),this._el.setAttribute("cy",t.cy),this._el.setAttribute("r",t.radius),this.helpers.center.setCoords(t.cx,t.cy),this.helpers.top.setCoords(t.cx,t.cy-t.radius),this.helpers.right.setCoords(t.cx+t.radius,t.cy),this.helpers.bottom.setCoords(t.cx,t.cy+t.radius),this.helpers.left.setCoords(t.cx-t.radius,t.cy),this},d.prototype.setCoords=function(t){return this._coords.cx=t.cx,this._coords.cy=t.cy,this._coords.radius=t.radius,this},d.prototype.dynamicDraw=function(t,e){var o=Math.round(Math.sqrt(Math.pow(this._coords.cx-t,2)+Math.pow(this._coords.cy-e,2))),i={cx:this._coords.cx,cy:this._coords.cy,radius:o};return this.redraw(i),i},d.prototype.onProcessDrawing=function(t){var e=o.getRightCoords(t.pageX,t.pageY);this.dynamicDraw(e.x,e.y)},d.prototype.onStopDrawing=function(t){var e=o.getRightCoords(t.pageX,t.pageY);this.setCoords(this.dynamicDraw(e.x,e.y)).deselect(),i.removeAllEvents().setIsDraw(!1).resetNewArea()},d.prototype.edit=function(t,e,o){var i=Object.create(this._coords);switch(t){case"move":i.cx+=e,i.cy+=o;break;case"editTop":i.radius-=o;break;case"editBottom":i.radius+=o;break;case"editLeft":i.radius-=e;break;case"editRight":i.radius+=e}return i},d.prototype.dynamicEdit=function(t){return t.radius<0&&(t.radius=Math.abs(t.radius)),this.setSVGCoords(t),t},d.prototype.onProcessEditing=function(t){var e=i.getEditType();return this.dynamicEdit(this.edit(e,t.pageX-this.editingStartPoint.x,t.pageY-this.editingStartPoint.y))},d.prototype.onStopEditing=function(t){i.getEditType();this.setCoords(this.onProcessEditing(t)),i.removeAllEvents()},d.prototype.toString=function(){return"Circle {cx: "+this._coords.cx+", cy: "+this._coords.cy+", radius: "+this._coords.radius+"}"},d.prototype.toHTMLMapElementString=function(){return'<area shape="circle" coords="'+this._coords.cx+", "+this._coords.cy+", "+this._coords.radius+'"'+(this._attributes.href?' href="'+this._attributes.href+'"':"")+(this._attributes.alt?' alt="'+this._attributes.alt+'"':"")+(this._attributes.title?' title="'+this._attributes.title+'"':"")+" />"},d.prototype.getCoordsForDisplayingInfo=function(){return{x:this._coords.cx,y:this._coords.cy}},d.testCoords=function(t){return t.cx&&t.cy&&t.radius},d.testHTMLCoords=function(t){return 3===t.length},d.getCoordsFromHTMLArray=function(t){if(!d.testHTMLCoords(t))throw new Error("This html-coordinates is not valid for circle");return{cx:t[0],cy:t[1],radius:t[2]}},d.createAndStartDrawing=function(t){var e=new d({cx:t.x,cy:t.y,radius:0});return i.addEvent(i.domElements.container,"mousemove",e.onProcessDrawing.bind(e)).addEvent(i.domElements.container,"click",e.onStopDrawing.bind(e)),e},o.inherits(l,s),l.prototype.close=function(){var t=this._el;this._el=document.createElementNS(s.SVG_NS,"polygon"),this._groupEl.replaceChild(this._el,t),this._coords.isOpened=!1,this.redraw().deselect()},l.prototype.setSVGCoords=function(t){var e=t.points.reduce((function(t,e){return t+e.x+" "+e.y+" "}),"");return this._el.setAttribute("points",e),o.foreach(this._helpers.points,(function(e,o){e.setCoords(t.points[o].x,t.points[o].y)})),this},l.prototype.setCoords=function(t){return this._coords.points=t.points,this},l.prototype.addPoint=function(t,e){if(!this._coords.isOpened)throw new Error("This polygon is closed!");var o=new r(this._groupEl,t,e,"movePoint");return o.setId(this._helpers.points.length),this._helpers.points.push(o),this._coords.points.push({x:t,y:e}),this.redraw(),this},l.prototype.dynamicDraw=function(t,e,o){var i={points:[].concat(this._coords.points)};if(o){var n=l.getRightAngleLineLastPointCoords(this._coords,{x:t,y:e});t=n.x,e=n.y}return i.points.push({x:t,y:e}),this.redraw(i),i},l.prototype.onProcessDrawing=function(t){var e=o.getRightCoords(t.pageX,t.pageY);this.dynamicDraw(e.x,e.y,t.shiftKey)},l.prototype.onAddPointDrawing=function(t){var e=o.getRightCoords(t.pageX,t.pageY);t.shiftKey&&(e=l.getRightAngleLineLastPointCoords(this._coords,e)),this.addPoint(e.x,e.y)},l.prototype.onStopDrawing=function(t){("click"==t.type||"keydown"==t.type&&13==t.keyCode)&&l.testCoords(this._coords)&&(this.close(),i.removeAllEvents().setIsDraw(!1).resetNewArea()),t.stopPropagation()},l.prototype.edit=function(t,e,o){var i=Object.create(this._coords);switch(t){case"move":for(var n=0,r=i.points.length;n<r;n++)i.points[n].x+=e,i.points[n].y+=o;break;case"movePoint":i.points[this.selected_point].x+=e,i.points[this.selected_point].y+=o}return i},l.prototype.onProcessEditing=function(t){var e=i.getEditType();this.redraw(this.edit(e,t.pageX-this.editingStartPoint.x,t.pageY-this.editingStartPoint.y)),this.editingStartPoint.x=t.pageX,this.editingStartPoint.y=t.pageY},l.prototype.onStopEditing=function(t){var e=i.getEditType();this.setCoords(this.edit(e,t.pageX-this.editingStartPoint.x,t.pageY-this.editingStartPoint.y)).redraw(),i.removeAllEvents()},l.prototype.toString=function(){return"Polygon {points: ["+this._coords.points.map((function(t){return"["+t.x+", "+t.y+"]"})).join(", ")+"]}"},l.prototype.toHTMLMapElementString=function(){return'<area shape="poly" coords="'+this._coords.points.map((function(t){return t.x+", "+t.y})).join(", ")+'"'+(this._attributes.href?' href="'+this._attributes.href+'"':"")+(this._attributes.alt?' alt="'+this._attributes.alt+'"':"")+(this._attributes.title?' title="'+this._attributes.title+'"':"")+" />"},l.prototype.getCoordsForDisplayingInfo=function(){return{x:this._coords.points[0].x,y:this._coords.points[0].y}},l.testCoords=function(t){return t.points.length>=3},l.testHTMLCoords=function(t){return t.length>=6&&t.length%2==0},l.getCoordsFromHTMLArray=function(t){if(!l.testHTMLCoords(t))throw new Error("This html-coordinates is not valid for polygon");for(var e=[],o=0,i=t.length/2;o<i;o++)e.push({x:t[2*o],y:t[2*o+1]});return{points:e}},l.getRightAngleLineLastPointCoords=function(t,e){var o=.414,i=2.414,n=t.points.length-1,r=t.points[n],s=e.x-r.x,a=-(e.y-r.y),c=a/s,d=e.x,l=e.y;return s>0&&a>0?c>i?d=r.x:c<o?l=r.y:Math.abs(s)>Math.abs(a)?d=r.x+a:l=r.y-s:s<0&&a>0?c<-i?d=r.x:c>-o?l=r.y:Math.abs(s)>Math.abs(a)?d=r.x-a:l=r.y+s:s<0&&a<0?c>i?d=r.x:c<o?l=r.y:Math.abs(s)>Math.abs(a)?d=r.x+a:l=r.y-s:s>0&&a<0&&(c<-i?d=r.x:c>-o?l=r.y:Math.abs(s)>Math.abs(a)?d=r.x-a:l=r.y+s),{x:d,y:l}},l.createAndStartDrawing=function(t){var e=new l({points:[t],isOpened:!0});return i.addEvent(i.domElements.container,"mousemove",e.onProcessDrawing.bind(e)).addEvent(i.domElements.container,"click",e.onAddPointDrawing.bind(e)).addEvent(document,"keydown",e.onStopDrawing.bind(e)).addEvent(e._helpers.points[0]._el,"click",e.onStopDrawing.bind(e)),e};var h,p,g=function(){var t=o.id("help"),e=o.id("overlay"),i=t.querySelector(".close_button");function n(){o.hide(t),o.hide(e)}return e.addEventListener("click",n,!1),i.addEventListener("click",n,!1),{show:function(){o.show(t),o.show(e)},hide:n}}(),f=(h=o.id("code"),p=o.id("code_content"),h.querySelector(".close_button").addEventListener("click",(function(t){o.hide(h),t.preventDefault()}),!1),{print:function(){p.innerHTML=i.getHTMLCode(!0),o.show(h)},hide:function(){o.hide(h)}}),m=function(){var t;function e(e){var i={};$("input, select, textarea",$(".popup-box form")).each((function(){var t=$(this).val();"string"==typeof t&&(t=t.replace(/'/g,"&rsquo;").replace(/"/g,"&rdquo;"));var e=$(this).attr("name");if(t)switch(a()(i[e])){case"string":i[e]=[i[e],t];break;case"object":i[e].push(t);break;case"undefined":i[e]=t}})),t.setInfoAttributes(i),t[t.href?"setStyleOfElementWithHref":"unsetStyleOfElementWithHref"](),o()}function o(){t=null,$(".popup-box-wrap:last").remove(),$(window).trigger("popupUnload")}return{load:function(i){t=i,u(i,e,o)},unload:o}}(),v=function(){var t=o.id("from_html_wrapper"),e=o.id("code_input"),i=o.id("load_code_button"),n=t.querySelector(".close_button");function r(){o.hide(t)}return i.addEventListener("click",(function(t){s.createAreasFromHTMLOfMap(e.value)&&r(),t.preventDefault()}),!1),n.addEventListener("click",r,!1),{show:function(){e.value="",o.show(t)},hide:r}}();!function(){var t=$(".tools-bar span"),e=o.id("save"),n=o.id("load"),r=o.id("rectangle"),a=o.id("circle"),c=o.id("polygon"),d=o.id("edit"),l=o.id("clear"),u=o.id("from_html"),h=o.id("to_html"),p=o.id("preview"),y=o.id("show_help");function w(){t.removeClass(s.CLASS_NAMES.SELECTED)}function _(t){w(),t.classList.add(s.CLASS_NAMES.SELECTED)}function b(t){i.setMode("drawing").setDrawClass().setShape(this.id).deselectAll().hidePreview(),m.unload(),_(this),t.preventDefault()}$(e).on("click",(function(t){i.saveInLocalStorage(),t.preventDefault()})),$(n).on("click",(function(t){i.clear().loadFromLocalStorage(),t.preventDefault()})),$(r).on("click",b),$(a).on("click",b),$(c).on("click",b),$(l).on("click",(function(t){confirm("Clear all?")&&(i.setMode(null).setDefaultClass().setShape(null).clear().hidePreview(),w()),t.preventDefault()})),$(u).on("click",(function(t){v.show(),t.preventDefault()})),$(h).on("click",(function(t){m.unload(),f.print(),t.preventDefault()})),$(p).on("click",(function(t){"preview"===i.getMode()?(i.setMode(null).hidePreview(),w()):(i.deselectAll().setMode("preview").setDefaultClass().preview(),_(this)),t.preventDefault()})),$(d).on("click",(function(t){"editing"===i.getMode()?(i.setMode(null).setDefaultClass().deselectAll(),w(),o.show(domElements.svg)):(i.setShape(null).setMode("editing").setEditClass(),_(this)),i.hidePreview(),t.preventDefault()})),$(y).on("click",(function(t){g.show(),t.preventDefault()}))}();return{toJSON:i.toJSON,fromJSON:function(t){var e=JSON.parse(t);o.foreach(e.areas,(function(t){s.fromJSON(t)}))}}},p=function(){var t=$(".tools-bar"),e=$(".container"),o=$(".tools-bar-wrap"),i=$(".top_bead"),n=0,r={},s=0,a=function(){r.top-n<=$(window).scrollTop()?(t.css({position:"fixed",left:r.left,top:n,width:s,"z-index":100}),t.addClass("fixed-bar")):(t.css({position:"",left:"",top:"",width:"","z-index":""}),t.removeClass("fixed-bar"))},c=function(){t.css({position:"",left:"",top:"",width:"","z-index":""}),t.removeClass("fixed-bar"),n=e.height()+i.height()+1,r=t.offset(),s=t.width(),o.height(o.height()),a()};c(),$(window).on("scroll",a),$(window).on("resize",c)},g=$(".upload-image"),f=$(".btn-save-boxes"),m=$(".map-image"),v=$(".map-info"),y=$("#svg");p(),n({image:m,button:g,uploadUrl:"image-maps/upload",svg:y});var w=h();r({image:m,button:f,imageMap:w,form:v,saveUrl:"image-maps/save"}),function t(){window.imageMapsData?w.fromJSON(imageMapsData.items):setTimeout(t,500)}()}]);